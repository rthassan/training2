/*
 * Your installation or use of this SugarCRM file is subject to the applicable
 * terms available at
 * http://support.sugarcrm.com/06_Customer_Center/10_Master_Subscription_Agreements/.
 * If you do not agree to all of the applicable terms or do not have the
 * authority to bind the entity as an authorized representative, then do not
 * install or use this SugarCRM file.
 *
 * Copyright (C) SugarCRM Inc. All rights reserved.
 */(function(e){e.augment("config",{appId:"nomad",appVersion:"2.5.1",appBuild:"291/1552",buildTag:"",brandName:"SugarCRM",env:"prod",scheme:"store",debugSugarApi:!1,debugMemory:!1,logLevel:"WARN",logWriter:"ConsoleWriter",logFormatter:"SimpleFormatter",showLogLevelSetting:!1,deviceMode:{type:"auto",landscape:!1,portrait:!1},fastClickEnabled:!0,layoutCacheSize:10,maxAlertsPerLayout:2,disableLayoutCache:["associate","pickerlist"],pullToRefresh:!0,refreshOnResumeTimeout:3e4,authStore:"cache",keyValueStore:"localStorageKeyValueStore",cacheMeta:!0,minServerVersion:"6.7.1",supportedServerFlavors:["PRO","CORP","ENT","ULT"],siteUrl:"..",serverUrl:"../rest/v10",serverTimeout:30,logoutTimeout:3e3,searchDelay:600,hideLoginUrl:!1,allowUrlReconfigure:!1,clientID:"sugar",restVersion:"10",useHttps:!0,externalLoginEnabled:!0,alertAutoCloseDelay:6e3,maxQueryResult:20,fetchLimit:{activities:10,activityItemsPerModule:3,bulkQueryRelatedRecords:10,maxPageSize:60,recentlyUpdated:40,recents:20},alwaysShowMyItems:!1,configurableFontSize:!0,platform:"mobile",metadataTypes:["server_info","labels","ordered_labels","modules","relationships","currencies","_override_values","config","modules_info","views","editable_dropdown_filters"],knownModules:["Home","Settings","About","TxLog","Error","Forecasts","Users","Accounts","Contacts","Documents","Leads","Opportunities","RevenueLineItems","Meetings","Calls","Tasks","Notes","Reports","Cases","Quotes","Employees","Bugs","Campaigns","Contracts","KBDocuments","Products","Project","Prospects","Targets","Emails"],unsupportedModules:["Bugs","Campaigns","Contracts","KBDocuments","Products","Project","Prospects","Targets","Emails"],modulesWithFiles:["Documents"],modulesWithPDFs:["Reports"],modulesWithAvatars:["Contacts","Leads","Employees","Users"],nonDuplicatableModules:["Users","Documents","Employees","KBDocuments","Reports","Quotes","Emails"],nonCreatableModules:["TxLog","Users","Documents","Employees","KBDocuments","Reports","Quotes","Emails"],nonEditableModules:["KBDocuments","Quotes","Employees","Reports","Emails"],nonDeletableModules:["Users","Employees"],nonDeletableSalesStages:["Closed Won","Closed Lost"],nonLinkableModules:[],followableModules:["Accounts","Contacts","Leads","Opportunities","Cases","RevenueLineItems","Tasks","Notes","Products"],readonlyModules:["Teams","ProductTypes","ProductCategories","ProductTemplates","Manufacturers"],nonAclModules:["Home","Error","Login","About"],modulesToAlwaysRefresh:["TxLog"],hiddenModules:["Forecasts","Activities","Filters","Comments"],customViews:["offlineSettings","offlineStats"],includeModuleBuckets:!1,includeUpcomingBuckets:!0,includeRecentBuckets:!0,numberOfAdditionalListFields:1,displayListFieldLabel:!1,displayDetailFieldLabel:!1,showAdditionalFieldsOnSearch:!0,detailAfterCreate:!1,forceListReload:!1,about:{privacy:"http://www.sugarcrm.com/mobile_privacy",tos:"http://support.sugarcrm.com/06_Customer_Center/10_Master_Subscription_Agreements",trademark:"http://www.sugarcrm.com/about/trademark-information",displayTrademarks:!1,support:"support.sugarcrm.com",sugarcrm:"http://www.sugarcrm.com",supportEmail:"support@sugarcrm.com",displaySupportEmail:!1,thirdPartySoftware:"http://www.sugarcrm.com/third-party-software",forecastsConfig:"http://www.sugarcrm.com/#Forecasts/config"},analytics:{enabled:!1,id:{"native":"UA-33012372-5",web:"UA-33012372-6"},appName:"SugarCRM",optOut:!1,debug:!1,dryRun:!1,dispatchInterval:120,sessionTimeout:30,sampleRate:100,anonymize:!1,useHttps:!0},canvasTestModeOnUpload:!1,resizeImagesOnUpload:600,imageResizeTimeout:8e3,iosCanvasSizeLimit:5,jpegEncoderQuality:80,defaultViewScheme:"Search",fileSizeLimit:10,additionalComponents:{"main-menu":{target:"#menu-left"}},syncConfig:!1,transMap:null,allowBrowserContextMenu:!1,skipStringCleanup:!1,emulateBackButton:!0,skipTutorial:!1,maxPreloaderPanelMessages:4,navigationHistoryLimit:10,UI:{defaultFontSize:"normal",fontSizes:{tiny:10,small:12,normal:14,large:16,larger:18,huge:20,extra_huge:22}},sugarLogic:{enabled:!0,minServerVersion:"7.2",isDynamic:!1},offline:{enabled:!1,storageProvider:"sql",storageAdapter:"native",storageSize:5,debug:{ignoreEnabled:!1,render:!1,forceMigrate:!1,online:!0,syncManagerEnabled:!0,monitorStatus:!0,outOfSpace:!1},minServerVersion:"7.1.5RC1",httpThrottlingEnabled:!0,httpThrottleTimeout:1e4,httpThrottleCacheSize:10,exclude:["About","Settings","Search","Login","Offline","TxLog","Error","ErrorEmulation","Recents","Forecasts","BubbleChart","Dashboards","Activities","Filters","Comments"],prefetch:{enabled:!0,staticModules:{Users:20,Teams:20,ProductCategories:20,ProductTypes:40,ProductTemplates:20,Manufacturers:20},maxThreshold:100,pageSize:20,relationships:{pageSize:20,maxThreshold:100}},syncManager:{enabled:!0,syncTimeout:10,executors:{wins:{enabled:!0,interval:180,priority:1,preSyncMaxRecords:100,syncPageSize:20,preSyncPageSize:20},txLog:{enabled:!0,interval:20,priority:0}}},defaultPurgeInterval:7,maxMixedCollectionQueryResult:30,monitorTimeout:5e3,txLogMaxQueryLimit:20,cleanupConfirmationInterval:6e4,periodicSync:{enabled:!1}},dashboards:{enabled:!0,minServerVersion:"7.2",dashlets:{dashablelist:{enabled:!0,minServerVersion:"7.2"},"tabbed-dashlet":{enabled:!0,minServerVersion:"7.2"},"forecast-pareto":{enabled:!0,minServerVersion:"7.6.0.0RC3"},bubblechart:{enabled:!0,minServerVersion:"7.2"},"forecast-pipeline":{enabled:!0,minServerVersion:"7.6.0.0RC3"},"activitystream-dashlet":{enabled:!0,minServerVersion:"7.2"},"saved-reports-chart":{enabled:!0,minServerVersion:"7.2"},forecastdetails:{enabled:!0,minServerVersion:"7.6.0.0RC3"}},cache:{dbName:"nomad-dashboards",storageSize:5,storageProvider:"sql",storageAdapter:"native"}},raven:{enabled:!0,url:"https://0c866dad58bb4a29b88e405491cfc6a6@app.getsentry.com/22007",enhancedErrorReporting:!0,maxLogSize:30,env:"store"},errorEmulation:{enabled:!1,user:"Max"}},!1)})(SUGAR.App),SUGAR.expressions.AndExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.AndExpression,SUGAR.expressions.BooleanExpression,{className:"AndExpression",evaluate:function(){var e=this.getParameters();e instanceof Array||(e=[e]);for(var t=0;t<e.length;t++)if(e[t].evaluate()!=SUGAR.expressions.Expression.TRUE)return SUGAR.expressions.Expression.FALSE;return SUGAR.expressions.Expression.TRUE}}),SUGAR.expressions.BinaryDependencyExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.BinaryDependencyExpression,SUGAR.expressions.BooleanExpression,{className:"BinaryDependencyExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return t!=null&&n!=null&&t!=""&&n!=""?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 2},getParameterTypes:function(){return["string","string"]}}),SUGAR.expressions.EqualExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.EqualExpression,SUGAR.expressions.BooleanExpression,{className:"EqualExpression",evaluate:function(){var e=SUGAR.expressions.Expression,t=this.getParameters(),n=t[0].evaluate(),r=t[1].evaluate(),i=t[0]instanceof SUGAR.expressions.BooleanExpression||t[1]instanceof SUGAR.expressions.BooleanExpression;return n==r||i&&(e.isTruthy(n)&&e.isTruthy(r)||!e.isTruthy(n)&&!e.isTruthy(r))?e.TRUE:e.FALSE},getParamCount:function(){return 2},getParameterTypes:function(){return["generic","generic"]}}),SUGAR.expressions.GreaterThanExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.GreaterThanExpression,SUGAR.expressions.BooleanExpression,{className:"GreaterThanExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return t>n?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 2},getParameterTypes:function(){return["number","number"]}}),SUGAR.expressions.isAfterExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.isAfterExpression,SUGAR.expressions.BooleanExpression,{className:"isAfterExpression",evaluate:function(){var e=this.getParameters(),t=SUGAR.util.DateUtils.parse(e[0].evaluate()),n=SUGAR.util.DateUtils.parse(e[1].evaluate());return!t||!n||isNaN(t)||isNaN(n)?SUGAR.expressions.Expression.FALSE:t>n?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 2},getParameterTypes:function(){return["date","date"]}}),SUGAR.expressions.IsAlphaExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsAlphaExpression,SUGAR.expressions.BooleanExpression,{className:"IsAlphaExpression",evaluate:function(){var e=this.getParameters().evaluate();return/^[a-zA-Z]+$/.test(e)?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsAlphaNumericExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsAlphaNumericExpression,SUGAR.expressions.BooleanExpression,{className:"IsAlphaNumericExpression",evaluate:function(){var e=this.getParameters().evaluate();return/^[a-zA-Z0-9]+$/.test(e)?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.isBeforeExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.isBeforeExpression,SUGAR.expressions.BooleanExpression,{className:"isBeforeExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return!t||!n||isNaN(t)||isNaN(n)?SUGAR.expressions.Expression.FALSE:t<n?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 2},getParameterTypes:function(){return["date","date"]}}),SUGAR.expressions.IsForecastClosedExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsForecastClosedExpression,SUGAR.expressions.BooleanExpression,{className:"IsForecastClosedExpression",evaluate:function(){var e=this.getParameters().evaluate();if(App===undefined)return SUGAR.expressions.Expression.FALSE;var t=App.metadata.getModule("Forecasts","config"),n=_.union(t.sales_stage_won,t.sales_stage_lost);return n.indexOf(e)===-1?SUGAR.expressions.Expression.FALSE:SUGAR.expressions.Expression.TRUE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsForecastClosedLostExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsForecastClosedLostExpression,SUGAR.expressions.BooleanExpression,{className:"IsForecastClosedLostExpression",evaluate:function(){var e=this.getParameters().evaluate();if(App===undefined)return SUGAR.expressions.Expression.FALSE;var t=App.metadata.getModule("Forecasts","config"),n=t.sales_stage_lost;return n.indexOf(e)===-1?SUGAR.expressions.Expression.FALSE:SUGAR.expressions.Expression.TRUE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsForecastClosedWonExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsForecastClosedWonExpression,SUGAR.expressions.BooleanExpression,{className:"IsForecastClosedWonExpression",evaluate:function(){var e=this.getParameters().evaluate();if(App===undefined)return SUGAR.expressions.Expression.FALSE;var t=App.metadata.getModule("Forecasts","config"),n=t.sales_stage_won;return n.indexOf(e)===-1?SUGAR.expressions.Expression.FALSE:SUGAR.expressions.Expression.TRUE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsInEnumExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsInEnumExpression,SUGAR.expressions.BooleanExpression,{className:"IsInEnumExpression",evaluate:function(){var e=this.getParameters(),t=e[1].evaluate(),n=e[0].evaluate();for(var r=0;r<t.length;r++){var i=t[r];i instanceof SUGAR.expressions.Expression&&(i=i.evaluate());if(i==n)return SUGAR.expressions.Expression.TRUE}return SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 2},getParameterTypes:function(){return["generic","enum"]}}),SUGAR.expressions.IsInRangeExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsInRangeExpression,SUGAR.expressions.BooleanExpression,{className:"IsInRangeExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate(),r=e[2].evaluate();return t>=n&&t<=r?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 3},getParameterTypes:function(){return["number","number","number"]}}),SUGAR.expressions.IsNumericExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsNumericExpression,SUGAR.expressions.BooleanExpression,{className:"IsNumericExpression",evaluate:function(){var e=this.getParameters().evaluate();return e===""||e===null?SUGAR.expressions.Expression.FALSE:isFinite(e)&&!isNaN(parseFloat(e))?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsRequiredCollectionExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsRequiredCollectionExpression,SUGAR.expressions.BooleanExpression,{className:"IsRequiredCollectionExpression",evaluate:function(){var e=this.getParameters().evaluate();table=document.getElementById(e),children=YAHOO.util.Dom.getElementsByClassName("sqsEnabled","input",table);for(id in children)if(trim(children[id].value)!="")return SUGAR.expressions.Expression.TRUE;return SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsValidDateExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsValidDateExpression,SUGAR.expressions.BooleanExpression,{className:"IsValidDateExpression",evaluate:function(){var e=this.getParameters().evaluate();if(typeof e!="string"||e=="")return SUGAR.expressions.Expression.FALSE;var t="Y-m-d";SUGAR.expressions.userPrefs&&(t=SUGAR.expressions.userPrefs.datef);var n=SUGAR.util.DateUtils.parse(e,t);return n!=0&&n!="Invalid Date"?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsValidDBNameExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsValidDBNameExpression,SUGAR.expressions.BooleanExpression,{className:"IsValidDBNameExpression",evaluate:function(){var e=this.getParameters().evaluate();return e.length==0?!0:/^[a-zA-Z][a-zA-Z\_0-9]+$/.test(e)?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsValidEmailExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsValidEmailExpression,SUGAR.expressions.BooleanExpression,{className:"IsValidEmailExpression",evaluate:function(){var e=this.getParameters().evaluate();if(typeof e!="string")return SUGAR.expressions.Expression.FALSE;if(e=="")return SUGAR.expressions.Expression.TRUE;var t=e.charAt(e.length-1);if(!t.match(/[^\.]/i))return SUGAR.expressions.Expression.FALSE;var n=e.split(/[,;]/);for(var r=0;r<n.length;r++){var i=n[r];i=i.replace(/^\s+|\s+$/g,"");if(i!=""&&!/^.+@.+$/ig.test(i))return SUGAR.expressions.Expression.FALSE}return SUGAR.expressions.Expression.TRUE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsValidPhoneExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsValidPhoneExpression,SUGAR.expressions.BooleanExpression,{className:"IsValidPhoneExpression",evaluate:function(){var e=this.getParameters().evaluate();return e.length==0?SUGAR.expressions.Expression.TRUE:/^\+?[0-9\-\(\)\s]+$/.test(e)?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.IsValidTimeExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IsValidTimeExpression,SUGAR.expressions.BooleanExpression,{className:"IsValidTimeExpression",evaluate:function(){var e=this.getParameters().evaluate(),t=/^(\d{1,2}):(\d\d)\s*([ap]m)?$/i;if(e.length==0)return SUGAR.expressions.Expression.TRUE;myregexp=new RegExp(t);if(!myregexp.test(e))return SUGAR.expressions.Expression.FALSE;var n=e.match(t);return n[1]>23||n[2]>59?SUGAR.expressions.Expression.FALSE:n[3]&&(n[1]>12||n[1]==0)?SUGAR.expressions.Expression.FALSE:SUGAR.expressions.Expression.TRUE},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.NotExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.NotExpression,SUGAR.expressions.BooleanExpression,{className:"NotExpression",evaluate:function(){return this.getParameters().evaluate()==SUGAR.expressions.Expression.FALSE?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 1}}),SUGAR.expressions.OrExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.OrExpression,SUGAR.expressions.BooleanExpression,{className:"OrExpression",evaluate:function(){var e=this.getParameters();for(var t=0;t<e.length;t++)if(e[t].evaluate()==SUGAR.expressions.Expression.TRUE)return SUGAR.expressions.Expression.TRUE;return SUGAR.expressions.Expression.FALSE}}),SUGAR.expressions.AddDaysExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.AddDaysExpression,SUGAR.expressions.DateExpression,{className:"AddDaysExpression",evaluate:function(){var e=this.getParameters(),t=SUGAR.util.DateUtils.parse(e[0].evaluate(),"user"),n=e[1].evaluate(),r=new Date(t);return r.setDate(r.getDate()+n),this.context.view&&(r=App.date.format(r,"Y-m-d")),r},getParamCount:function(){return 2},getParameterTypes:function(){return["date","number"]}}),SUGAR.expressions.DayOfWeekExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.DayOfWeekExpression,SUGAR.expressions.NumericExpression,{className:"DayOfWeekExpression",evaluate:function(){var e,t=this.getParameters().evaluate();return _.isString(t)&&_.isEmpty(t)?"":(this.context.view?e=App.date(t).format("d").toString():e=(new Date(t)).getDay(),e)},getParamCount:function(){return 1},getParameterTypes:function(){return["date"]}}),SUGAR.expressions.DaysUntilExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.DaysUntilExpression,SUGAR.expressions.NumericExpression,{className:"DaysUntilExpression",evaluate:function(){var e=SUGAR.util.DateUtils.parse(this.getParameters().evaluate(),"user"),t=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0);var n=e-t,r=Math.ceil(n/864e5);return r},getParamCount:function(){return 1},getParameterTypes:function(){return["date"]}}),SUGAR.expressions.DefineDateExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.DefineDateExpression,SUGAR.expressions.DateExpression,{className:"DefineDateExpression",evaluate:function(){var e=this.getParameters().evaluate(),t=SUGAR.util.DateUtils.parse(e,"user");if(t==0)throw"Incorrect date format";return t},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.HoursUntilExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.HoursUntilExpression,SUGAR.expressions.NumericExpression,{className:"HoursUntilExpression",evaluate:function(){var e=this.getParameters().evaluate(),t=SUGAR.util.DateUtils.parse(e);if(!t&&t!==0)return!1;var n=new Date;typeof e=="string"&&e.indexOf(" ")==-1&&e.indexOf("T")==-1&&n.setHours(0,0,0,0);var r=t-n;return~~(r/36e5)},getParamCount:function(){return 1},getParameterTypes:function(){return["date"]}}),SUGAR.expressions.MaxRelatedDateExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MaxRelatedDateExpression,SUGAR.expressions.DateExpression,{className:"MaxRelatedDateExpression",evaluate:function(){},getParameterTypes:function(){return["relate","string"]}}),SUGAR.expressions.MonthOfYearExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MonthOfYearExpression,SUGAR.expressions.NumericExpression,{className:"MonthOfYearExpression",evaluate:function(){var e=this.getParameters().evaluate();return(new Date(e)).getMonth()+1},getParamCount:function(){return 1},getParameterTypes:function(){return["date"]}}),SUGAR.expressions.NowExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.NowExpression,SUGAR.expressions.DateExpression,{className:"NowExpression",evaluate:function(){var e=SUGAR.util.DateUtils.getUserTime();return e.setSeconds(0),this.context.view&&(e=App.date.format(e,"Y-m-d H:i:s")),e},getParamCount:function(){return 0}}),SUGAR.expressions.TimestampExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.TimestampExpression,SUGAR.expressions.DateExpression,{className:"TimestampExpression",evaluate:function(){var e=this.getParameters().evaluate(),t,n=[],r=this.context.parseDate(e);return Math.round(+r.getTime()/1e3)},getParamCount:function(){return 1}}),SUGAR.expressions.TodayExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.TodayExpression,SUGAR.expressions.DateExpression,{className:"TodayExpression",evaluate:function(){var e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),this.context.view&&(e=App.date.format(e,"Y-m-d")),e},getParamCount:function(){return 0}}),SUGAR.expressions.DefineEnumExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.DefineEnumExpression,SUGAR.expressions.EnumExpression,{className:"DefineEnumExpression",evaluate:function(){var e=this.getParameters(),t=[];if(typeof e.length=="undefined")return[e.evaluate()];for(var n=0;n<e.length;n++)t[t.length]=e[n].evaluate();return t},getParameterTypes:function(){return"generic"}}),SUGAR.expressions.ForecastSalesStageExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.ForecastSalesStageExpression,SUGAR.expressions.EnumExpression,{className:"ForecastSalesStageExpression",evaluate:function(){if(App===undefined)return SUGAR.language.get("app_list_strings","sales_stage_dom");var e=SUGAR.expressions.Expression,t=App.metadata.getModule("Forecasts","config"),n=this.getParameters(),r=n[0].evaluate(),i=n[1].evaluate(),s=App.lang.getAppListStrings("sales_stage_dom"),o=[];return e.isTruthy(r)||(o=_.union(o,t.sales_stage_won)),e.isTruthy(i)||(o=_.union(o,t.sales_stage_lost)),_.without(s,o)},getParamCount:function(){return 2},getParameterTypes:function(){return["boolean","boolean"]}}),SUGAR.expressions.SugarDropDownExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SugarDropDownExpression,SUGAR.expressions.EnumExpression,{className:"SugarDropDownExpression",evaluate:function(){var e=this.getParameters().evaluate(),t,n=[];App?t=App.lang.getAppListStrings(e):t=SUGAR.language.get("app_list_strings",e);if(t&&t!="undefined")for(var r in t)typeof r=="string"&&(n[n.length]=r);return n},getParamCount:function(){return 1},getParameterTypes:function(){return"string"}}),SUGAR.expressions.SugarListWhereExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SugarListWhereExpression,SUGAR.expressions.EnumExpression,{className:"SugarListWhereExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate(),r=[];for(var i=0;i<n.length;i++)if(n[i].length>0&&n[i][0]==t){r=n[i][1];break}return r=="undefined"?[]:r},getParamCount:function(){return 2},getParameterTypes:function(){return["string","enum"]}}),SUGAR.expressions.SugarTranslatedDropDownExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SugarTranslatedDropDownExpression,SUGAR.expressions.EnumExpression,{className:"SugarTranslatedDropDownExpression",evaluate:function(){var e=this.getParameters().evaluate(),t,n=[];App?t=App.lang.getAppListStrings(e):t=SUGAR.language.get("app_list_strings",e);if(t&&t!="undefined")for(var r in t)typeof r=="string"&&(n[n.length]=t[r]);return n},getParamCount:function(){return 1},getParameterTypes:function(){return"string"}}),SUGAR.expressions.ConditionExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.ConditionExpression,SUGAR.expressions.GenericExpression,{className:"ConditionExpression",evaluate:function(){var e=SUGAR.expressions.Expression,t=this.getParameters(),n=t[0].evaluate();return e.isTruthy(n)?t[1].evaluate():t[2].evaluate()},getParamCount:function(){return 3},getParameterTypes:function(){return["boolean","generic","generic"]}}),SUGAR.expressions.IndexValueExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IndexValueExpression,SUGAR.expressions.GenericExpression,{className:"IndexValueExpression",evaluate:function(){var e=this.getParameters(),t=e[1].evaluate(),n=e[0].evaluate();if(n>=t.length||n<0)throw"value_at: Attempt to access an index out of bounds";return t[n]},getParamCount:function(){return 2},getParameterTypes:function(){return["number","enum"]}}),SUGAR.expressions.RelatedFieldExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.RelatedFieldExpression,SUGAR.expressions.GenericExpression,{className:"RelatedFieldExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return typeof t=="string"&&t!=""?this.context.getRelatedField(t,"related",n):(typeof rel=="object","")},getParamCount:function(){return 2},getParameterTypes:function(){return["relate","string"]}}),SUGAR.expressions.SugarFieldExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SugarFieldExpression,SUGAR.expressions.GenericExpression,{className:"SugarFieldExpression",evaluate:function(){var e=this.getParameters().evaluate();return SUGAR.forms.AssignmentHandler.getValue(e)},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.AbsoluteValueExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.AbsoluteValueExpression,SUGAR.expressions.NumericExpression,{className:"AbsoluteValueExpression",evaluate:function(){return Math.abs(this.getParameters().evaluate())},getParamCount:function(){return 1}}),SUGAR.expressions.AddExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.AddExpression,SUGAR.expressions.NumericExpression,{className:"AddExpression",evaluate:function(){var e=this.getParameters(),t=0;for(var n=0;n<e.length;n++)t=this.context.add(t,e[n].evaluate());return t}}),SUGAR.expressions.AverageExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.AverageExpression,SUGAR.expressions.NumericExpression,{className:"AverageExpression",evaluate:function(){var e=0,t=0,n=this.getParameters();for(var r=0;r<n.length;r++)e=this.context.add(e,n[r].evaluate()),t++;return this.context.divide(e,t)}}),SUGAR.expressions.AverageRelatedExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.AverageRelatedExpression,SUGAR.expressions.NumericExpression,{className:"AverageRelatedExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return typeof t=="string"&&t!=""?SUGAR.forms.AssignmentHandler.getRelatedField(t,"rollupAve",n):(typeof rel=="object","")},getParamCount:function(){return 2},getParameterTypes:function(){return["relate","string"]}}),SUGAR.expressions.CeilingExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.CeilingExpression,SUGAR.expressions.NumericExpression,{className:"CeilingExpression",evaluate:function(){return Math.ceil(this.getParameters().evaluate())},getParamCount:function(){return 1}}),SUGAR.expressions.CountRelatedExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.CountRelatedExpression,SUGAR.expressions.NumericExpression,{className:"CountRelatedExpression",evaluate:function(){var e=this.getParameters().evaluate();return typeof e=="string"&&e!=""?this.context.getRelatedField(e,"count"):""},getParamCount:function(){return 1},getParameterTypes:function(){return["relate"]}}),SUGAR.expressions.DivideExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.DivideExpression,SUGAR.expressions.NumericExpression,{className:"DivideExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate();denominator=e[1].evaluate();if(denominator==0)throw"Division by 0 error";return this.context.divide(t,denominator)},getParamCount:function(){return 2}}),SUGAR.expressions.FloorExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.FloorExpression,SUGAR.expressions.NumericExpression,{className:"FloorExpression",evaluate:function(){return Math.floor(this.getParameters().evaluate())},getParamCount:function(){return 1}}),SUGAR.expressions.IndexOfExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.IndexOfExpression,SUGAR.expressions.NumericExpression,{className:"IndexOfExpression",evaluate:function(){var e=this.getParameters(),t=e[1].evaluate(),n=e[0].evaluate();for(var r=0;r<t.length;r++)if(t[r]==n)return r;return-1},getParamCount:function(){return 2},getParameterTypes:function(){return["generic","enum"]}}),SUGAR.expressions.LogExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.LogExpression,SUGAR.expressions.NumericExpression,{className:"LogExpression",evaluate:function(){var e=this.getParameters(),t=e[1].evaluate(),n=e[0].evaluate();return this.context.divide(Math.log(n),Math.log(t))},getParamCount:function(){return 2}}),SUGAR.expressions.MaximumExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MaximumExpression,SUGAR.expressions.NumericExpression,{className:"MaximumExpression",evaluate:function(){var e=this.getParameters(),t=null;for(var n=0;n<e.length;n++){var r=e[n].evaluate();if(t==null||r>t)t=r}return t}}),SUGAR.expressions.MaxRelatedExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MaxRelatedExpression,SUGAR.expressions.NumericExpression,{className:"MaxRelatedExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return typeof t=="string"&&t!=""?this.context.getRelatedField(t,"rollupMax",n):(typeof rel=="object","")},getParamCount:function(){return 2},getParameterTypes:function(){return["relate","string"]}}),SUGAR.expressions.MedianExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MedianExpression,SUGAR.expressions.NumericExpression,{className:"MedianExpression",evaluate:function(){var e=this.getParameters(),t=new Array;for(var n=0;n<e.length;n++)t[t.length]=parseFloat(e[n].evaluate());return t.sort(function(e,t){return e-t}),t.length%2==0?(t[t.length/2]+t[t.length/2-1])/2:t[Math.round(t.length/2)-1]}}),SUGAR.expressions.MinimumExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MinimumExpression,SUGAR.expressions.NumericExpression,{className:"MinimumExpression",evaluate:function(){var e=this.getParameters(),t=null;for(var n=0;n<e.length;n++){var r=e[n].evaluate();if(t==null||r<t)t=r}return t}}),SUGAR.expressions.MinRelatedExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MinRelatedExpression,SUGAR.expressions.NumericExpression,{className:"MinRelatedExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return typeof t=="string"&&t!=""?this.context.getRelatedField(t,"rollupMin",n):(typeof rel=="object","")},getParamCount:function(){return 2},getParameterTypes:function(){return["relate","string"]}}),SUGAR.expressions.MultiplyExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.MultiplyExpression,SUGAR.expressions.NumericExpression,{className:"MultiplyExpression",evaluate:function(){var e=this.getParameters(),t="1";for(var n=0;n<e.length;n++)t=this.context.multiply(t,e[n].evaluate());return t}}),SUGAR.expressions.NaturalLogExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.NaturalLogExpression,SUGAR.expressions.NumericExpression,{className:"NaturalLogExpression",evaluate:function(){return Math.log(this.getParameters().evaluate())},getParamCount:function(){return 1}}),SUGAR.expressions.NegateExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.NegateExpression,SUGAR.expressions.NumericExpression,{className:"NegateExpression",evaluate:function(){return this.context.multiply("-1",this.getParameters().evaluate())},getParamCount:function(){return 1}}),SUGAR.expressions.PowerExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.PowerExpression,SUGAR.expressions.NumericExpression,{className:"PowerExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return Math.pow(t,n)},getParamCount:function(){return 2}}),SUGAR.expressions.RoundExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.RoundExpression,SUGAR.expressions.NumericExpression,{className:"RoundExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return this.context.round(t,n)},getParamCount:function(){return 2}}),SUGAR.expressions.StandardDeviationExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.StandardDeviationExpression,SUGAR.expressions.NumericExpression,{className:"StandardDeviationExpression",evaluate:function(){var e=this.getParameters(),t=new Array,n=0,r=e.length;for(var i=0;i<e.length;i++)value=e[i].evaluate(),t[t.length]=value,n=this.context.add(n,value);var s=this.context.divide(n,r),o=0;for(var i=0;i<t.length;i++)o+=Math.pow(this.context.subtract(t[i],s),2);var u=this.context.multiply(this.context.divide(1,r),o);return Math.sqrt(u)}}),SUGAR.expressions.StringLengthExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.StringLengthExpression,SUGAR.expressions.NumericExpression,{className:"StringLengthExpression",evaluate:function(){var e=this.getParameters().evaluate()+"";return e.length},getParamCount:function(){return 1},getParameterTypes:function(){return"string"}}),SUGAR.expressions.SubtractExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SubtractExpression,SUGAR.expressions.NumericExpression,{className:"SubtractExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate();for(var n=1;n<e.length;n++)t=this.context.subtract(t,e[n].evaluate());return t}}),SUGAR.expressions.SumRelatedExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SumRelatedExpression,SUGAR.expressions.NumericExpression,{className:"SumRelatedExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate();return typeof t=="string"&&t!=""?this.context.getRelatedField(t,"rollupSum",n):(typeof rel=="object","")},getParamCount:function(){return 2},getParameterTypes:function(){return["relate","string"]}}),SUGAR.expressions.ValueOfExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.ValueOfExpression,SUGAR.expressions.NumericExpression,{className:"ValueOfExpression",evaluate:function(){var e=this.getParameters().evaluate()+"";e=e.replace(/,/g,"");var t=0;e.indexOf(".")!=-1?t=parseFloat(e):t=parseInt(e);if(isNaN(t))throw"Error: '"+e+"' is not a number";return t},getParamCount:function(){return 1},getParameterTypes:function(){return"generic"}}),SUGAR.expressions.CharacterAtExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.CharacterAtExpression,SUGAR.expressions.StringExpression,{className:"CharacterAtExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate()+"",n=e[1].evaluate();return t.charAt(n)},getParamCount:function(){return 2},getParameterTypes:function(){return["string","number"]}}),SUGAR.expressions.ConcatenateExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.ConcatenateExpression,SUGAR.expressions.StringExpression,{className:"ConcatenateExpression",evaluate:function(){var e="",t=this.getParameters();for(var n=0;n<t.length;n++)e+=t[n].evaluate();return e}}),SUGAR.expressions.ContainsExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.ContainsExpression,SUGAR.expressions.BooleanExpression,{className:"ContainsExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate()+"",n=e[1].evaluate();return t.indexOf(n)>-1?SUGAR.expressions.Expression.TRUE:SUGAR.expressions.Expression.FALSE},getParamCount:function(){return 2},getParameterTypes:function(){return"string"}}),SUGAR.expressions.DefineStringExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.DefineStringExpression,SUGAR.expressions.StringExpression,{className:"DefineStringExpression",evaluate:function(){return this.getParameters().evaluate()+""},getParamCount:function(){return 1},getParameterTypes:function(){return["generic"]}}),SUGAR.expressions.FormatedNameExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.FormatedNameExpression,SUGAR.expressions.StringExpression,{className:"FormatedNameExpression",evaluate:function(){var e=this.getParameters(),t={s:e[0].evaluate(),f:e[1].evaluate(),l:e[2].evaluate(),t:e[3].evaluate()},n="";for(i=0;i<name_format.length;i++)t[name_format.substr(i,1)]!=undefined?n+=t[name_format.substr(i,1)]:n+=name_format.substr(i,1);return n},getParamCount:function(){return 4}}),SUGAR.expressions.StrToLowerExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.StrToLowerExpression,SUGAR.expressions.StringExpression,{className:"StrToLowerExpression",evaluate:function(){var e=this.getParameters().evaluate()+"";return e.toLowerCase()}}),SUGAR.expressions.StrToUpperExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.StrToUpperExpression,SUGAR.expressions.StringExpression,{className:"StrToUpperExpression",evaluate:function(){var e=this.getParameters().evaluate()+"";return e.toUpperCase()}}),SUGAR.expressions.SubStrExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SubStrExpression,SUGAR.expressions.StringExpression,{className:"SubStrExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate()+"",n=e[1].evaluate(),r=e[2].evaluate();return t.substr(n,r)},getParamCount:function(){return 3},getParameterTypes:function(){return["string","number","number"]}}),SUGAR.expressions.SugarDropDownValueExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SugarDropDownValueExpression,SUGAR.expressions.StringExpression,{className:"SugarDropDownValueExpression",evaluate:function(){var e=this.getParameters(),t=e[0].evaluate(),n=e[1].evaluate(),r=this.context.getAppListStrings(t);if(r=="undefined")return"";for(var i in r)if(typeof i=="string"&&i==n)return r[i];return""},getParamCount:function(){return 2}}),SUGAR.expressions.SugarTranslateExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.SugarTranslateExpression,SUGAR.expressions.StringExpression,{className:"SugarTranslateExpression",evaluate:function(){var e=this.getParameters(),t=e[1].evaluate();t==""&&(t="app_strings");var n=e[0].evaluate();return SUGAR.language.get(t,n)},getParamCount:function(){return 2}}),SUGAR.expressions.DefineTimeExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.DefineTimeExpression,SUGAR.expressions.TimeExpression,{className:"DefineTimeExpression",evaluate:function(){var e=this.getParameters().evaluate(),t=Date.parse(e);if(isNaN(t))throw"Incorrect time format";return t},getParamCount:function(){return 1},getParameterTypes:function(){return["string"]}}),SUGAR.expressions.HourOfDayExpression=function(e,t){this.context=t,this.init(e)},SUGAR.util.extend(SUGAR.expressions.HourOfDayExpression,SUGAR.expressions.TimeExpression,{className:"HourOfDayExpression",evaluate:function(){var e=this.getParameters().evaluate();return(new Date(e)).getHours()},getParamCount:function(){return 1}}),SUGAR.forms.AssignToUserAction=function(e){if(SUGAR.App)return;this.expr=e,this.target="assigned_user_name",this.dataSource=new YAHOO.util.DataSource("index.php?",{responseType:YAHOO.util.XHRDataSource.TYPE_JSON,responseSchema:{resultsList:"fields",total:"totalCount",metaNode:"fields",metaFields:{total:"totalCount",fields:"fields"}},connMethodPost:!0})},SUGAR.util.extend(SUGAR.forms.AssignToUserAction,SUGAR.forms.AbstractAction,{exec:function(e){if(SUGAR.App)return;typeof e=="undefined"&&(e=this.context);var t=this.evalExpression(this.expr,e),n=SUGAR.util.paramsToUrl({to_pdf:"true",module:"Home",action:"quicksearchQuery",data:YAHOO.lang.JSON.stringify(sqs_objects["EditView_"+this.target]),query:t});this.sqs=sqs_objects["EditView_"+this.target],this.dataSource.sendRequest(n,{success:function(e,t){if(t.results.length>0){var n=t.results[0];for(var r=0;r<this.sqs.field_list.length;r++)SUGAR.forms.AssignmentHandler.assign(this.sqs.populate_list[r],n[this.sqs.field_list[r]])}},scope:this})},targetUrl:"index.php?module=Home&action=TaxRate&to_pdf=1"}),SUGAR.forms.SetPanelVisibilityAction=function(e,t){this.afterRender=!0,_.isObject(e)&&(t=e.value,e=e.target);if(_.isString(e)&&_.isUndefined(SUGAR.App)){var n=$("#"+e).parents("div");n.length&&(e=n.attr("id"))}this.target=e,this.expr="cond("+t+', "", "none")'},SUGAR.util.extend(SUGAR.forms.SetPanelVisibilityAction,SUGAR.forms.AbstractAction,{hideChildren:function(){typeof SUGAR.forms.SetPanelVisibilityAction.hiddenFields=="undefined"&&this.createFieldBin();var e=document.getElementById(this.target),t=e.getElementsByTagName("table")[0];t!=null&&(t.id=this.target+"_tbl",SUGAR.forms.SetPanelVisibilityAction.hiddenFields.appendChild(t))},showChildren:function(){var e=document.getElementById(this.target),t=document.getElementById(this.target+"_tbl");t!=null&&e.appendChild(t)},createFieldBin:function(){var e=document.createElement("div");e.id="panelHiddenFields",e.style.display="none",document.body.appendChild(e),SUGAR.forms.SetPanelVisibilityAction.hiddenFields=e},exec:function(e){typeof e=="undefined"&&(e=this.context);if(e.view)return this.sidecarExec(e);try{var t=this.evalExpression(this.expr,e),n=document.getElementById(this.target);if(n!=null){n.style.display!="none"&&(SUGAR.forms.animation.sizes[this.target]=n.clientHeight);if(SUGAR.forms.AssignmentHandler.ANIMATE){if(t=="none"&&n.style.display!="none"){SUGAR.forms.animation.Collapse(this.target,this.hideChildren,this);return}if(t!="none"&&n.style.display=="none"){this.showChildren(),SUGAR.forms.animation.Expand(this.target);return}}t=="none"?this.hideChildren():this.showChildren(),n.style.display=t}}catch(r){console&&console.log&&console.log(r)}},sidecarExec:function(e){var t=this.evalExpression(this.expr,e)==="none",n=e.view.$(".tab."+this.target),r=e.view.$("div.record-panel[data-panelname='"+this.target+"']"),i=n&&n.hasClass("active");if(!n||!n.length)r.length>0?(t?r.hide():r.show(),this.triggerFieldsVisibility(e,this.target,t)):console.log("unable to find panel "+this.target);else{if(t){n.hide();if(i){var s=e.view.$("li.tab:visible");s.length>0&&e.view.setActiveTab&&(e.view.setActiveTab({currentTarget:s[0].children[0]}),e.view.handleActiveTab())}}else n.show();this.triggerFieldsVisibility(e,this.target,t)}},triggerFieldsVisibility:function(e,t,n){_.each(this.getPanelFieldNames(e,t),function(t){var r=e.view.getField(t);r&&_.isUndefined(r.wasRequired)&&(r.wasRequired=r.def.required),e.setFieldDisabled(t,n),r.wasRequired===!0&&e.setFieldRequired(t,!n)})},getPanelFieldNames:function(e,t){var n=_.find(e.view.meta.panels,function(e){return e.name===t});return _.pluck(n.fields,"name")}}),SUGAR.forms.animation.sizes={},SUGAR.forms.animation.Collapse=function(e,t,n){var r=document.getElementById(e);if(r==null)return;SUGAR.forms.animation.sizes[e]=r.clientHeight,r.style.overflow="hidden";var i=new YAHOO.util.Anim(e,{height:{to:0}},.5,YAHOO.util.Easing.easeBoth);i.onComplete.subscribe(function(){r.style.display="none",t.call(n)}),i.animate()},SUGAR.forms.animation.Expand=function(e){var t=document.getElementById(e);if(t==null)return;t.style.overflow="hidden",t.style.height="0px",t.style.display="";var n=new YAHOO.util.Anim(e,{height:{to:SUGAR.forms.animation.sizes[e]}},.5,YAHOO.util.Easing.easeBoth);n.onComplete.subscribe(function(){t.style.height="auto"}),n.animate()},SUGAR.forms.ReadOnlyAction=function(e,t){_.isObject(e)&&(t=e.value,e=e.target),this.target=e,this.expr=t},SUGAR.util.extend(SUGAR.forms.ReadOnlyAction,SUGAR.forms.AbstractAction,{exec:function(e){typeof e=="undefined"&&(e=this.context);var t=this.evalExpression(this.expr,e),n=t==SUGAR.expressions.Expression.TRUE;if(e.view){if(_.isEmpty(e.view.fields)){e.view.once("render",function(){this.exec(e)},this);return}e.setFieldDisabled(this.target,n)}else this.bwcExec(e,n)},bwcExec:function(e,t){var n=SUGAR.forms.AssignmentHandler.getElement(this.target);if(!n)return;this.setReadOnly(n,t),this.setDateField(n,t)},setReadOnly:function(e,t){var n=YAHOO.util.Dom,r=e.type=="checkbox"||"select"?"disabled":"readonly";e[r]=t,t?(n.setStyle(e,"background-color","#EEE"),SUGAR.isIE||n.setStyle(e,"color","#22")):(n.setStyle(e,"background-color",""),SUGAR.isIE||n.setStyle(e,"color",""))},setDateField:function(e,t){var n=YAHOO.util.Dom,r=e.id,i=n.get(r+"_trigger");if(!i)return;var s=[n.get(r+"_date"),n.get(r+"_minutes"),n.get(r+"_meridiem"),n.get(r+"_hours")];for(var o in s)s[o]&&s[o].id&&this.setReadOnly(s[o],t);t?n.setStyle(i,"display","none"):n.setStyle(i,"display","")}}),SUGAR.forms.SetOptionsAction=function(e,t,n){this.afterRender=!0,_.isObject(e)&&(n=e.labels,t=e.keys,e=e.target),this.keyExpr=t,this.labelExpr=n,this.target=e},SUGAR.util.extend(SUGAR.forms.SetOptionsAction,SUGAR.forms.AbstractAction,{exec:function(e){typeof e=="undefined"&&(e=this.context);var t=this.evalExpression(this.keyExpr,e),n=this.evalExpression(this.labelExpr,e),r=(_.size(t)===0||_.size(t)===1)&&(t[0]==undefined||t[0]==="");selected="";if(e.view){var i=e.getField(this.target);if(!i)return;_.isString(n)?i.items=_.pick(App.lang.getAppListStrings(n),t):i.items=_.object(t,n),slContext=e,i.model.fields[this.target].options=i.items;var s=new SUGAR.forms.SetVisibilityAction(this.target,r?"false":"true","");s.setContext(e),s.exec(),selected=_.filter([].concat(i.model.get(this.target)),function(e){return _.contains(t,e)}),selected.length==0&&i.model.fields[i.name].type!="multienum"&&(selected=selected.concat(r?"":t[0])),e.setValue(this.target,selected)}else{var i=e.getElement(this.target);if(i==null)return null;if(t instanceof Array&&i.options!=null){var o=i.options;selected=[];for(var u=0;u<o.length;u++)o[u].selected&&(selected=selected.concat(o[u].value));while(o.length>0)i.remove(o[0]);if(typeof n=="string"){var a=SUGAR.language.get("app_list_strings",n);n=[];for(var u in t)n[u]=a[t[u]]}var f;for(var u in t)n instanceof Array?typeof t[u]=="string"&&(typeof n[u]=="string"?f=o[o.length]=new Option(n[u],t[u],t[u]==selected):f=o[o.length]=new Option(t[u],t[u],t[u]==selected)):typeof t[0]=="undefined"?typeof t[u]=="string"&&(f=o[o.length]=new Option(t[u],u)):typeof value[u]=="string"&&(f=o[o.length]=new Option(t[u],t[u])),_.indexOf(selected,t[u])>-1&&(f.selected=!0);!i.multiple&&i.value!=selected&&SUGAR.forms.AssignmentHandler.assign(this.target,i.value);var r=i.multiple&&i.options.length==0||!i.multiple&&i.options.length<=1&&i.value=="",s=new SUGAR.forms.SetVisibilityAction(this.target,r?"false":"true","");s.setContext(e),s.exec(),SUGAR.forms.AssignmentHandler.ANIMATE&&!r&&SUGAR.forms.FlashField(i)}else if(t instanceof Array&&(t.length==0||t.length==1&&t[0]=="")){var l=new SUGAR.forms.SetVisibilityAction(this.target,"false","");l.exec(e)}}}}),SUGAR.forms.SetRequiredAction=function(e,t,n){_.isObject(e)&&(t=e.value,n=e.label,e=e.target),this.variable=e,this.expr=t,this.label=n,this._el_lbl=document.getElementById(this.label),this._el_lbl&&(this.msg=this._el_lbl.innerText)},SUGAR.util.extend(SUGAR.forms.SetRequiredAction,SUGAR.forms.AbstractAction,{exec:function(e){typeof e=="undefined"&&(e=this.context),this.required=this.evalExpression(this.expr,e);if(e.view){if(_.isEmpty(e.view.fields)){e.view.once("render",function(){this.exec(e)},this);return}e.setFieldRequired(this.variable,this.required)}else this.bwcExec(e,this.required)},bwcExec:function(e,t){var n=SUGAR.forms.AssignmentHandler.getElement(this.variable);typeof SUGAR.forms.FormValidator!="undefined"&&SUGAR.forms.FormValidator.setRequired(n.form.name,n.name,this.required);if(this._el_lbl!=null&&n!=null){var r=this._el_lbl,i=YAHOO.util.Dom.getElementsBy(function(e){return e.className=="req"},"span",r),s=!1,o=n.name;i!=null&&i[0]!=null&&(s=i[0]);if(this.required==1||this.required=="true"){if(!s){var u=document.createElement("span");u.innerHTML="<font color='red'>*</font>",u.className="req",this._el_lbl.appendChild(u);var a=this.findInValidate(e.formName,o);a>-1?validate[e.formName][a][2]=!0:addToValidate(e.formName,o,"text",!0,this.msg)}}else{r!=null&&s!=0&&s.parentNode.removeChild(s);var a=this.findInValidate(e.formName,o);a>-1&&(validate[e.formName][a][2]=!1)}}},findInValidate:function(e,t){if(validate&&validate[e])for(var n in validate[e])if(typeof validate[e][n]=="object"&&validate[e][n][0]==t)return n;return-1}}),SUGAR.forms.SetValueAction=function(e,t){_.isObject(e)?(this.expr=e.value,this.target=e.target):(this.expr=t,this.target=e)},SUGAR.util.extend(SUGAR.forms.SetValueAction,SUGAR.forms.AbstractAction,{exec:function(e){typeof e=="undefined"&&(e=this.context);try{var t=this.evalExpression(this.expr,e),n=e.getValue(this.target).evaluate();!_.isUndefined(t)&&t!=n&&e.setValue(this.target,t)}catch(r){e.setValue(this.target,"")}}}),SUGAR.forms.StyleAction=function(e,t){this.target=e,this.attrs=t},SUGAR.util.extend(SUGAR.forms.StyleAction,SUGAR.forms.AbstractAction,{exec:function(e){if(SUGAR.App)return;typeof e=="undefined"&&(e=this.context);try{var t={};for(var n in this.attrs)t[n]=this.evalExpression(this.attrs[n],e);e.setStyle(this.target,t)}catch(r){return}}});var App=App||null;SUGAR.forms.SetVisibilityAction=function(e,t,n){this.afterRender=!0,_.isObject(e)&&(t=e.value,e=e.target),this.target=e,this.expr="cond("+t+', "", "none")',this.view=n;if(!SUGAR.forms.SetVisibilityAction.initialized){var r=document.getElementsByTagName("head")[0],i="span.vis_action_hidden, .vis_action_hidden * { visibility:hidden}",s=document.createElement("style");s.setAttribute("type","text/css"),s.styleSheet?s.styleSheet.cssText=i:s.innerHTML=i,r.appendChild(s),SUGAR.forms.SetVisibilityAction.initialized=!0}},SUGAR.util.extend(SUGAR.forms.SetVisibilityAction,SUGAR.forms.AbstractAction,{exec:function(e){typeof e=="undefined"&&(e=this.context);try{var t=this.evalExpression(this.expr,e),n=t=="none"||t=="hidden",r=e&&e.getElement&&e.getElement(this.target)||null;r!=null&&(SUGAR.App?this.sidecarExec(e,r,n):this.legacyExec(e,r,n))}catch(i){console&&console.log&&console.log(i)}},sidecarExec:function(e,t,n){var r="vis_action_hidden",i=$(t).hasClass(r),s=e.view.getField(this.target),o=$(t).parents(".panel_body")[0];s&&_.isUndefined(s.wasRequired)&&(s.wasRequired=s.def.required),n?(e.addClass(this.target,r,!0),e.setFieldDisabled(this.target,!0),s.wasRequired===!0&&e.setFieldRequired(this.target,!1)):(e.removeClass(this.target,r,!0),(!s.def.calculated||!s.def.enforced)&&e.setFieldDisabled(this.target,!1),i&&SUGAR.forms.FlashField(t,null,this.target),s.wasRequired===!0&&e.setFieldRequired(this.target,!0)),o&&this.checkRowSidecar(o,r)},legacyExec:function(e,t,n){var r=YAHOO.util.Dom,i="vis_action_hidden",s=r.getAncestorByTagName(t,"TD"),o=r.getPreviousSiblingBy(s,function(e){return e.tagName=="TD"});this.wrapContent(o),this.wrapContent(s);var u=r.hasClass(o,i);n?(r.addClass(o,i),r.addClass(s,i)):(r.removeClass(o,i),r.removeClass(s,i),u&&this.view=="EditView"&&SUGAR.forms.FlashField(t)),this.checkRow(r.getAncestorByTagName(s,"TR"),i)},wrapContent:function(e){if(e&&this.containsPlainText(e)){var t=document.createElement("SPAN"),n=[];for(var r=0;r<e.childNodes.length;r++)n[r]=e.childNodes[r];for(var r=0;r<n.length;r++)t.appendChild(n[r]);e.appendChild(t)}},containsPlainText:function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if(n.nodeName=="#text"&&YAHOO.lang.trim(n.textContent)!="")return!0}return!1},checkRow:function(e,t){var n=!0;for(var r=0;r<e.children.length;r++){var i=e.children[r];if(i.tagName.toLowerCase()=="td"&&!YAHOO.util.Dom.hasClass(i,t)){n=!1;break}}e.style.display=n?"none":""},checkRowSidecar:function(e,t){if(!e||e.children)return;var n=!0;for(var r=0;r<e.children.length;r++){var i=e.children[r];if(i.tagName.toLowerCase()=="div"&&!$(i).hasClass(t)&&$(i).children().length>1){n=!1;break}}e.style.display=n?"none":""}}),SUGAR.FunctionMap={and:SUGAR.expressions.AndExpression,doBothExist:SUGAR.expressions.BinaryDependencyExpression,equal:SUGAR.expressions.EqualExpression,greaterThan:SUGAR.expressions.GreaterThanExpression,isAfter:SUGAR.expressions.isAfterExpression,isAlpha:SUGAR.expressions.IsAlphaExpression,isAlphaNumeric:SUGAR.expressions.IsAlphaNumericExpression,isBefore:SUGAR.expressions.isBeforeExpression,isForecastClosed:SUGAR.expressions.IsForecastClosedExpression,isForecastClosedLost:SUGAR.expressions.IsForecastClosedLostExpression,isForecastClosedWon:SUGAR.expressions.IsForecastClosedWonExpression,isInList:SUGAR.expressions.IsInEnumExpression,isInEnum:SUGAR.expressions.IsInEnumExpression,isWithinRange:SUGAR.expressions.IsInRangeExpression,isNumeric:SUGAR.expressions.IsNumericExpression,isRequiredCollection:SUGAR.expressions.IsRequiredCollectionExpression,isValidDate:SUGAR.expressions.IsValidDateExpression,isValidDBName:SUGAR.expressions.IsValidDBNameExpression,isValidEmail:SUGAR.expressions.IsValidEmailExpression,isValidPhone:SUGAR.expressions.IsValidPhoneExpression,isValidTime:SUGAR.expressions.IsValidTimeExpression,not:SUGAR.expressions.NotExpression,or:SUGAR.expressions.OrExpression,addDays:SUGAR.expressions.AddDaysExpression,dayofweek:SUGAR.expressions.DayOfWeekExpression,daysUntil:SUGAR.expressions.DaysUntilExpression,date:SUGAR.expressions.DefineDateExpression,hoursUntil:SUGAR.expressions.HoursUntilExpression,maxRelatedDate:SUGAR.expressions.MaxRelatedDateExpression,monthofyear:SUGAR.expressions.MonthOfYearExpression,now:SUGAR.expressions.NowExpression,timestamp:SUGAR.expressions.TimestampExpression,today:SUGAR.expressions.TodayExpression,createList:SUGAR.expressions.DefineEnumExpression,"enum":SUGAR.expressions.DefineEnumExpression,forecastSalesStages:SUGAR.expressions.ForecastSalesStageExpression,getDropdownKeySet:SUGAR.expressions.SugarDropDownExpression,getDD:SUGAR.expressions.SugarDropDownExpression,getListWhere:SUGAR.expressions.SugarListWhereExpression,getDropdownValueSet:SUGAR.expressions.SugarTranslatedDropDownExpression,getTransDD:SUGAR.expressions.SugarTranslatedDropDownExpression,ifElse:SUGAR.expressions.ConditionExpression,cond:SUGAR.expressions.ConditionExpression,valueAt:SUGAR.expressions.IndexValueExpression,related:SUGAR.expressions.RelatedFieldExpression,sugarField:SUGAR.expressions.SugarFieldExpression,abs:SUGAR.expressions.AbsoluteValueExpression,add:SUGAR.expressions.AddExpression,currencyAdd:SUGAR.expressions.AddExpression,average:SUGAR.expressions.AverageExpression,avg:SUGAR.expressions.AverageExpression,rollupAve:SUGAR.expressions.AverageRelatedExpression,rollupAvg:SUGAR.expressions.AverageRelatedExpression,ceil:SUGAR.expressions.CeilingExpression,ceiling:SUGAR.expressions.CeilingExpression,countConditional:SUGAR.expressions.CountConditionalRelatedExpression,count:SUGAR.expressions.CountRelatedExpression,divide:SUGAR.expressions.DivideExpression,currencyDivide:SUGAR.expressions.DivideExpression,div:SUGAR.expressions.DivideExpression,floor:SUGAR.expressions.FloorExpression,indexOf:SUGAR.expressions.IndexOfExpression,log:SUGAR.expressions.LogExpression,max:SUGAR.expressions.MaximumExpression,rollupMax:SUGAR.expressions.MaxRelatedExpression,median:SUGAR.expressions.MedianExpression,min:SUGAR.expressions.MinimumExpression,rollupMin:SUGAR.expressions.MinRelatedExpression,multiply:SUGAR.expressions.MultiplyExpression,currencyMultiply:SUGAR.expressions.MultiplyExpression,mul:SUGAR.expressions.MultiplyExpression,ln:SUGAR.expressions.NaturalLogExpression,negate:SUGAR.expressions.NegateExpression,pow:SUGAR.expressions.PowerExpression,round:SUGAR.expressions.RoundExpression,stddev:SUGAR.expressions.StandardDeviationExpression,strlen:SUGAR.expressions.StringLengthExpression,subtract:SUGAR.expressions.SubtractExpression,currencySubtract:SUGAR.expressions.SubtractExpression,sub:SUGAR.expressions.SubtractExpression,rollupConditionalSum:SUGAR.expressions.SumConditionalRelatedExpression,rollupSum:SUGAR.expressions.SumRelatedExpression,rollupCurrencySum:SUGAR.expressions.SumRelatedExpression,number:SUGAR.expressions.ValueOfExpression,charAt:SUGAR.expressions.CharacterAtExpression,concat:SUGAR.expressions.ConcatenateExpression,contains:SUGAR.expressions.ContainsExpression,toString:SUGAR.expressions.DefineStringExpression,string:SUGAR.expressions.DefineStringExpression,formatName:SUGAR.expressions.FormatedNameExpression,strToLower:SUGAR.expressions.StrToLowerExpression,strToUpper:SUGAR.expressions.StrToUpperExpression,subStr:SUGAR.expressions.SubStrExpression,getDropdownValue:SUGAR.expressions.SugarDropDownValueExpression,getDDValue:SUGAR.expressions.SugarDropDownValueExpression,translateLabel:SUGAR.expressions.SugarTranslateExpression,translate:SUGAR.expressions.SugarTranslateExpression,time:SUGAR.expressions.DefineTimeExpression,hourOfDay:SUGAR.expressions.HourOfDayExpression},SUGAR.NumericConstants={pi:3.14159265359,e:2.71828182846},function(e){e.raven={ravenDataCallback:function(t){return t.tags=_.extend(t.tags||{},{"native":e.isNative,osVersion:e.clientInfo?e.clientInfo.device.osVersion:undefined,uuid:e.clientInfo?e.clientInfo.device.uuid:undefined,device:e.clientInfo?e.clientInfo.device.model:undefined,offline:e.config.offline&&e.config.offline.enabled}),t.extra=_.extend(t.extra||{},{device:e.clientInfo?e.clientInfo.device.modelName:undefined,serverUrl:e.nomad?e.nomad.getServerUrl():undefined,serverVersion:e.nomad?e.nomad.getServerVersion():undefined,extendedLog:e.enhancedErrorReporter.getLog()}),t},ravenShouldSendCallback:function(){return e.config.raven.enabled},ravenReported:function(t){if(e.error){var n=t.data||{};e.error.logFatalError(n.message,n)}},setUser:function(e){Raven.setUser(e?{id:e}:null)}},e.config.raven&&e.config.raven.enabled&&!_.isEmpty(e.config.raven.url)&&(document.addEventListener("ravenSuccess",e.raven.ravenReported,!1),document.addEventListener("ravenFailure",e.raven.ravenReported,!1),Raven.config(e.config.raven.url,{tags:{version:e.config.appVersion,build:e.config.appBuild,env:e.config.raven.env},dataCallback:e.raven.ravenDataCallback,shouldSendCallback:e.raven.ravenShouldSendCallback}).install(),e.events.on("app:start",function(){e.raven.setUser(e.api.isAuthenticated()?"authenticated":null)}).on("app:login:success",function(){e.raven.setUser("authenticated")}).on("app:logout",function(){e.raven.setUser()}))}(SUGAR.App),function(e){function n(e){this.bucketName=e+":"}var t=window.store;_.extend(n.prototype,{version:1,get:function(e,n){var r=t.get(this.bucketName+e);if(!n)return r;n(null,r)},getAll:function(e){var n=this.bucketName,r=t.getAll(),i={};_.each(r,function(e,t){t.indexOf(n)===0&&(i[t]=e)});if(!e)return i;e(null,i)},has:function(e,n){var r=t.has(this.bucketName+e);if(!n)return r;n(null,r)},set:function(e,n,r){t.set(this.bucketName+e,n),r&&r(null)},cut:function(e,n){t.cut(this.bucketName+e),n&&n(null)},cutAll:function(e,n){t.cutAll(this.bucketName+e),n&&n(null)}}),e.localStorageKeyValueStore={open:function(){},initBucket:function(e,t){t(null,new n(e))}}}(SUGAR.App),function(e){function r(e){this.cache={},this.bucketName=e}var t=function(){},n={db:null,openDb:function(t){this.db=t.native?window.sqlitePlugin.openDatabase({name:t.name,bgType:1}):window.openDatabase(t.name,"1.0",t.name,5);if(!this.db)throw new Error("Can't open SQL database "+t.name)},query:function(t,n,r){var i=this;this.db.transaction(function(s){s.executeSql(t,n||[],function(t,n){r&&r.call(i,null,n)},function(t,n){r&&r.call(i,n)})})},createDataTable:function(t,n){var r=this;this.query("CREATE TABLE IF NOT EXISTS "+t+" (key STRING PRIMARY KEY, value TEXT)",[],function(t,i){n&&n.apply(r,arguments)})},get:function(t,n,r){var i=this;this.query("SELECT value FROM "+t+" WHERE key = ? LIMIT 1",[n],function(t,n){if(t){r&&r.call(i,t);return}var s;n.rows.length&&(s=n.rows.item(0).value==="undefined"?undefined:JSON.parse(n.rows.item(0).value)),r&&r.call(i,null,s)})},getAll:function(t,n){var r=this;this.query("SELECT key, value FROM "+t,[],function(t,i){var s,o={},u;if(t){n&&n.call(r,t);return}for(u=i.rows.length,s=0;s<u;s++){var a=i.rows.item(s);o[a.key]=a.value==="undefined"?undefined:JSON.parse(a.value)}n&&n.call(r,null,o)})},has:function(t,n,r){var i=this;this.query("SELECT key FROM "+t+" WHERE key = ? LIMIT 1",[n],function(t,n){if(t){r&&r.call(i,t);return}r&&r.call(i,null,!!n.rows.length)})},set:function(t,n,r,i){var s=this;this.query("REPLACE INTO "+t+" (key, value) values (?, ?)",[n,JSON.stringify(r)],function(t,n){i&&i.apply(s,arguments)})},cut:function(t,n,r){var i=this;this.query("DELETE FROM "+t+" WHERE key = ?",[n],function(t,n){r&&r.apply(i,arguments)})},cutAll:function(t,n){var r=this;this.query("DELETE FROM "+t,[],function(t,i){n&&n.apply(r,arguments)})}};_.extend(r.prototype,{version:1,init:function(t){var r=this;n.createDataTable(this.bucketName,function(i){if(i){t&&t.call(r,i);return}n.getAll(r.bucketName,function(n,i){if(n){t&&t.call(r,n);return}r.cache=i,t&&t.call(r,null,r)})})},get:function(r,i){if(!i)return _.isObject(this.cache[r])?e.utils.deepCopy(this.cache[r]):this.cache[r];n.get(this.bucketName,r,_.bind(i,this))},getAll:function(r){if(!r)return e.utils.deepCopy(this.cache);n.getAll(this.bucketName,_.bind(r,this))},has:function(t,r){if(!r)return _.has(this.cache,t);n.has(this.bucketName,t,_.bind(r,this))},set:function(i,s,o){n.set(this.bucketName,i,s,o?_.bind(o,this):t),this.cache[i]=_.isObject(s)?e.utils.deepCopy(s):s},cut:function(r,i){n.cut(this.bucketName,r,i?_.bind(i,this):t),delete this.cache[r]},cutAll:function(r){n.cutAll(this.bucketName,r?_.bind(r,this):t),this.cache={}}}),e.sqlKeyValueStore={open:function(e){n.openDb(e)},initBucket:function(e,t){var n=new r(e);n.init(t)}}}(SUGAR.App),function(e){var t="SugarCRM",n=function(){},r={OAUTH:{},get:function(e){return this.OAUTH[e]},set:function(e,r){this.OAUTH[e]=r,window.plugins.keychain.setForKey(e,r,t,n,n)},cut:function(e){delete this.OAUTH[e],window.plugins.keychain.removeForKey(e,t,n,n)}};e.augment("keychain",r)}(SUGAR.App),function(e){e.view.NomadView=e.view.View.extend({globalEvents:{"acl:change":"onModelAclChange"},onModelAclChange:function(e){_.each(this.fields,function(t){var n=t.type==="address"?t.def.fields[0].name:t.name;n in e&&t.render()},this)},initialize:function(t){t.globalEvents&&(this.globalEvents=t.globalEvents),e.view.View.prototype.initialize.call(this,t),this.config=e.config},onLoadData:function(){},delegateEvents:function(t){if(!t&&!(t=_.result(this,"events")))return;_.extend(t,{"click a[href]":"handleLinkClick"}),e.view.View.prototype.delegateEvents.call(this,t)},_render:function(){return this.onBeforeRender(),e.config.analytics.enabled&&e.analytics.detachAnalytics(this.$el),e.view.View.prototype._render.call(this),e.config.analytics.enabled&&e.analytics.attachAnalytics(this.$el),this.onAfterRender(),this._rendered=!0,this.trigger("view:after:render"),this},executeOnRender:function(e,t){this._rendered?e.call(t):this.once("view:after:render",function(){e.call(t)})},bindGlobalEvents:function(){var t=this._populateGlobalEvents(this);_.each(t,function(t,n){t=_.isFunction(t)?t:this[t],e.events.on(n,t,this)},this),_.each(this.fields,function(t){_.each(t.globalEvents,function(t,n){t=_.isFunction(t)?t:this[t],e.events.on(n,t,this)},t)})},unbindGlobalEvents:function(){var t=this._populateGlobalEvents(this);_.each(t,function(t,n){e.events.off(n,null,this)},this),_.each(this.fields,function(t){_.each(t.globalEvents,function(t,n){e.events.off(n,null,this)},t)})},_populateGlobalEvents:function(e){var t=[],n={},r=function(e,t){e&&(t.push(e.constructor.prototype.globalEvents),r(e.constructor.__super__,t))};return this.hasOwnProperty("globalEvents")&&t.push(this.globalEvents),r(e,t),_.each(t.reverse(),function(e){n=_.extend(n,e)}),n},initRelationshipFields:function(t,n){var r=e.data.getRelationshipFields(t,n);return r&&r.length&&(this.relationshipFields=_.map(r,function(t){return e.metadata.getModule(this.module).fields[t]},this)),this.relationshipFields},getFieldNames:function(t){if(!this.module)return[];var n=e.metadata.getModule(this.module,"mergedFields")||[];return this.model instanceof e.Bean&&this.model.canHaveAttachments()&&n.push("attachment_list"),this.relationshipFields&&(n=_.union(n,_.pluck(this.relationshipFields,"name"))),t&&(n=_.filter(n,function(t){var n=this._getFieldViewDef(t);return _.isEmpty(n)?!1:e.acl.hasAccessToModel(this.action,this.model,t)&&n.type!=="fieldset"&&e.nomad.canDisplay(this,n)},this)),n},_getFieldViewDef:function(e){var t;return _.find(this.meta.panels[0].fields,function(n){return n.name===e?t=n:_.isEmpty(n.fields)||(t=_.find(n.fields,function(t){return t.name===e})),t}),t},isEditView:function(){return this.action==="create"||this.action==="edit"},onAfterRender:function(){},onAfterShow:function(){this.collection&&e.nomad.showDataSyncEndAlert(null,null,"read",this.collection.cid)},onBeforeRender:function(){},getState:function(e){var t=this._getState();return e?t[e]:t},setState:function(e,t){var n=this._getState();n[e]=t,this._setState(n)},_getStateKey:function(){return this.name+"."+this.module},_getState:function(){return e.nomad.getSetting(this._getStateKey())||{}},_setState:function(t){e.nomad.setSetting(this._getStateKey(),t||{})},handleLinkClick:function(t){if(t.defaultPrevented)return;var n=t.target.tagName.toLowerCase()==="a"?t.target:t.currentTarget,r=n.getAttribute("href"),i;/^#.*/.test(r)?(t.preventDefault(),t.stopPropagation(),i=$(n).hasClass("append-root")?this._adjustRouteBasedOnRoot(r):r,e.controller.navigate(i)):e.nomad.utils.urlHasProtocolRegExp.test(r)&&(t.preventDefault(),e.nomad.openUrl(r))},_adjustRouteBasedOnRoot:function(t){var n=e.controller.getScreenContext(),r=e.controller.getScreenContextRoot(),i=new RegExp("#.*"+n.module),s;return r?s="#"+r+"/"+n.module:s="#"+n.module,t.replace(i,s)},createViewDefs:function(t){var n={};_.each(t,function(t){var r=e.metadata.getView(t,"list"),i;r&&(i=e.metadata.getView(t,"list").panels),i&&(n[t]=i[0].fields)}),this.viewDefs=n},onDetach:function(){}})}(SUGAR.App),function(e){e.view.views.SyncableView=e.view.NomadView.extend({initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),e.syncableViewsManager.registerView(this),this.bindViewSyncListener()},_dispose:function(){e.syncableViewsManager.unregisterView(this),this.unbindViewSyncListener(),e.view.NomadView.prototype._dispose.call(this)},bindViewSyncListener:function(){},unbindViewSyncListener:function(){},publishSyncData:function(t,n,r){e.syncableViewsManager.triggerViewSync(this,t,n,r)},receiveSyncData:function(e,t){}})}(SUGAR.App),function(e){e.view.views.RecordView=e.view.views.SyncableView.extend({_statusMessageMap:{403:"LBL_NOT_AUTHORIZED",404:"LBL_RECORD_NOT_FOUND",link:"LBL_RELATED_RECORD_NOT_FOUND"},_modelEvents:{sync:"onDataSyncSuccess","data:sync:error":"onDataSyncError","data:sync:complete":"onDataSyncComplete"},_isModelUpdated:!1,initialize:function(){e.view.views.SyncableView.prototype.initialize.apply(this,arguments),this._bindModelEvents()},onBeforeRender:function(){e.view.views.SyncableView.prototype.onBeforeRender.apply(this,arguments),this.model.dataFetched=!1},dispose:function(){e.view.views.SyncableView.prototype.dispose.apply(this,arguments),this._unbindModelEvents()},showRecordOverlay:function(t,n){document.activeElement&&document.activeElement.blur(),n=t.link&&n===404?"link":n;var r=e.lang.get(this._statusMessageMap[n]);r&&!this.$el.find(".overlay-view").length&&(this.overlayIsShown=!0,this.$el.append("<div class='overlay-view'><span class='message'>"+r+"</span></div>"))},hideRecordOverlay:function(){this.overlayIsShown=!1,this.$el.find(".overlay-view").remove()},bindViewSyncListener:function(){this.listenTo(this.model,"sync",this.publishModelSyncData)},unbindViewSyncListener:function(){this.stopListening(this.model,"sync",this.publishModelSyncData)},publishModelSyncData:function(e,t,n){this.publishSyncData(e.toJSON(),null,_.extend({},n,{responseData:t}))},receiveSyncData:function(t){var n,r=!1;_.isArray(t)?n=_.find(t,function(e){return e.id===this.model.id},this):t&&t.id===this.model.id&&(n=t),n&&!e.nomad.utils.isModelSynchronized(this.model,n)&&(this.model.set(n),r=!0),this._isModelUpdated=r},onDataSyncSuccess:function(){this.overlayIsShown&&this.hideRecordOverlay()},onDataSyncError:function(t,n,r){t==="read"&&(this.showRecordOverlay(this.model,r.status),e.error.isAccessError(r)&&(this.publishSyncData(this.model.toJSON(),r),this._clearModel()))},onDataSyncComplete:function(){},_clearModel:function(){var e={};_.each(this.model.attributes,function(t,n){n!=="id"&&(e[n]=void 0)}),this.model.set(e,{unset:!0})},_bindModelEvents:function(){_.each(this._modelEvents,function(e,t){this.listenTo(this.model,t,this[e])},this)},_unbindModelEvents:function(){_.each(this._modelEvents,function(e,t){this.stopListening(this.model,t,this[e])},this)}})}(SUGAR.App),function(e){e.view.NomadField=e.view.Field.extend({delegateEvents:function(e){Backbone.View.prototype.delegateEvents.call(this,e)},initialize:function(t){t.view.name==="view"&&(t.viewName="readonly"),e.view.Field.prototype.initialize.call(this,t),t.view.name==="edit"&&(Boolean(this.def.calculated)&&Boolean(this.def.enforced)||Boolean(this.def.readonly))&&(t.viewName="readonly")},handleValidationError:function(e){this._displayValidationMessage(e)},_displayValidationMessage:function(t){var n,r=[];this.$(".controls").children(".error-display").remove(),this.$(".control-group").removeClass("error"),t&&(this.$(".control-group").addClass("error"),_.each(t,function(t,n){r.push(e.error.getErrorString(n,t))}),n=e.template.get("edit-field-error"),this.$(".controls").append(n(r))),e.analytics.trackEvent("validation",this.name)},_render:function(){return this.onBeforeRender(),e.config.analytics.enabled&&e.analytics.detachAnalytics(this.$el),e.view.Field.prototype._render.call(this),this.onAfterRender(),e.config.analytics.enabled&&e.analytics.attachAnalytics(this.$el),this.hasAccess=this.getAccess(),this},_getFallbackTemplate:function(t){return t==="disabled"?"readonly":e.view.Field.prototype._getFallbackTemplate.apply(this,arguments)},getAccess:function(){var t=this.options.def.view||this.options.viewName||(this.view.meta&&this.view.meta.type?this.view.meta.type:this.view.name),n=t!==this.view.action?this.view.action:t;return e.acl.hasAccessToModel(n,this.model,this.name)},onBeforeRender:function(){this.view.name==="edit"&&this.getAccess()&&!this.isDisabled()&&(this.action="edit")},onAfterRender:function(){},unformat:function(e){return _.isString(e)?e.trim():e},isReadOnly:function(){return this.tplName==="readonly"},bindDomChange:function(){if(!(this.model instanceof Backbone.Model))return;var e=this.$el.find(this.fieldTag);e.on("change",_.bind(this.onFieldChange,this)),this._$fieldEl=e},onFieldChange:function(){this.model.set(this.name,this.unformat(this._$fieldEl.val()))},bindDataChange:function(){this.model&&this.model.on("change:"+this.name,function(e,t,n){if(n&&n.disableRenderForContext===this.view)return!1;this.render()},this)},_loadTemplate:function(){this.view.name==="edit"&&this.isReadOnly()&&(this.options.viewName="readonly"),e.view.Field.prototype._loadTemplate.call(this)}})}(SUGAR.App),function(e){e.view.NumericField=e.view.NomadField.extend({isFloat:!1,format:function(t){return!t&&t!==0||_.isString(t)&&t.trim().length===0?"":(isNaN(t)||(t=e.utils.formatNumber(t,null,this.isFloat?this.def.precision||e.user.getPreference("decimal_precision"):0,this.def.number_group_seperator||e.user.getPreference("number_grouping_separator"),this.def.decimal_seperator||e.user.getPreference("decimal_separator")),this.isFloat&&this.model.set(this.name,this.unformat(t),{silent:!0})),t)},unformat:function(t){var n=e.utils.unformatNumberStringLocale(t.toString(),this.isFloat);return n===""||isNaN(n)?t:n}})}(SUGAR.App),function(e){function i(e){return e.replace(/[-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var t=/-|,| |;/g,n={};e.offline&&(n[e.offline.SYNC_ACTIONS.CREATE]="LBL_ACTION_CREATE",n[e.offline.SYNC_ACTIONS.UPDATE]="LBL_ACTION_UPDATE",n[e.offline.SYNC_ACTIONS.DELETE]="LBL_ACTION_DELETE",n[e.offline.SYNC_ACTIONS.LINK]="LBL_ACTION_LINK",n[e.offline.SYNC_ACTIONS.UNLINK]="LBL_ACTION_UNLINK",n[e.offline.SYNC_ACTIONS.FAVORITE]="LBL_ACTION_FAVORITE",n[e.offline.SYNC_ACTIONS.FOLLOW]="LBL_ACTION_FOLLOW");var r={};e.offline&&(r[e.offline.SYNC_ACTIONS.CREATE]="LBL_ACTION_CREATE_EXPLANATION",r[e.offline.SYNC_ACTIONS.UPDATE]="LBL_ACTION_UPDATE_EXPLANATION",r[e.offline.SYNC_ACTIONS.DELETE]="LBL_ACTION_DELETE_EXPLANATION",r[e.offline.SYNC_ACTIONS.LINK]="LBL_ACTION_LINK_EXPLANATION",r[e.offline.SYNC_ACTIONS.UNLINK]="LBL_ACTION_UNLINK_EXPLANATION",r[e.offline.SYNC_ACTIONS.FAVORITE]="LBL_ACTION_FAVORITE_EXPLANATION",r[e.offline.SYNC_ACTIONS.FOLLOW]="LBL_ACTION_FOLLOW_EXPLANATION");var s=function(){var t=function(t){var n,r,i=e.serverInfo.isSevenUp;i?(n=/<strong>.*?<\/strong>/g,r=/(<strong>)|(<\/strong>)/g):(n=/<span class="highlight">.*?<\/span>/g,r=/(<span class="highlight">)|(<\/span>)/g);var s=Handlebars.Utils.escapeExpression,o=s(t),u=t.match(n),a;return _.each(u,function(e){a=e.replace(r,""),a=s(a),o=o.replace(s(e),'<span class="highlight">'+a+"</span>")}),o};return Handlebars.helpers.__sanitizeSearchResult=t,t}();Handlebars.registerHelper("shouldDisplay",function(t,n){return e.nomad.canDisplay(t,this)?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("ifHasAccessToModel",function(t,n,r){var i=r.hash.field;return e.acl.hasAccessToModel(t,n,i)?r.fn(this):r.inverse(this)}),Handlebars.registerHelper("moduleNameSingular",function(t){return e.nomad.getSingularModuleName(t)}),Handlebars.registerHelper("optionLabel",function(t,n){var r=_.isString(t)?e.lang.getAppListStrings(t):t;return r[n]}),Handlebars.registerHelper("globalSearchItem",function(t){if(!e.acl.hasAccess("list",t.module))return Handlebars.SafeString("");var n=t.searchInfo,r=n?n.highlighted:null,i=Handlebars.Utils.escapeExpression(t.get("name")),o="",u="",a=this,f=[];this.fields&&this.fields.length?this.fields[0].type!=="name"&&f.push(this.fields[0]):this.view.viewDefs[t.module]&&this.view.viewDefs[t.module][0].type!=="name"&&f.push(this.view.viewDefs[t.module][0]);var l=[];_.each(r,function(t,n){var r=s(t.text);n==="name"?i=r:(l.push(n),o+='<div class="search-result clip">'+e.lang.get(t.label,t.module)+": "+r+"</div>")},this);var c=this.view.modContextData[t.module];if((e.config.showAdditionalFieldsOnSearch||!_.isEmpty(f))&&c){var h=c.displayListFields.length!==1||e.config.displayListFieldLabel?"additional":"";f=f.concat(c.displayListFields),u+='<div class="fields '+h+'">',_.each(f,function(n){if(n.type!=="name"&&_.indexOf(l,n.name)===-1){u+='<div class="field">',e.config.displayListFieldLabel&&(u+='<div class="item-label clip">'+Handlebars.helpers.str(n.label,t.module)+"</div>");var r={def:n,view:a.view,model:t};if(n.name==="email"||n.name==="filename")r.viewName="";var i=e.view.createField(r);u+='<div class="search-result clip">'+i.getPlaceholder()+"</div>"+"</div>"}}),u+="</div>"}var p='<div class="item-name clip">'+i+"</div>"+u;return _.isEmpty(o)||(p+=o),new Handlebars.SafeString(p)}),Handlebars.registerHelper("getTxLogActionName",function(t){t=n[t];var r=e.lang.get(t)||t;return new Handlebars.SafeString(r)}),Handlebars.registerHelper("getTxLogModuleName",function(){return e.nomad.getPluralModuleName(this.model.attributes._tx_bean_module)}),Handlebars.registerHelper("getTxLogActionExplanation",function(){var t=this.model.attributes._tx_action,n,i=this.model.attributes.bean,s,o;i?o=_.isEmpty(i.name)?i[e.nomad.contextMeta.list[i._module].nameField.name]:i.name:o=e.lang.get("LBL_RECORD_DELETED"),s={module:e.nomad.getSingularModuleName(this.model.attributes._tx_bean_module),name:o},t===e.offline.SYNC_ACTIONS.FAVORITE&&!this.model.attributes._tx_updated_fields.my_favorite.after?n="LBL_ACTION_UNFAVORITE_EXPLANATION":t===e.offline.SYNC_ACTIONS.FOLLOW&&!this.model.attributes._tx_updated_fields.following.after?n="LBL_ACTION_UNFOLLOW_EXPLANATION":this.model.attributes.related&&(s.relatedModule=e.nomad.getSingularModuleName(this.model.attributes._tx_related_module),s.relatedName=this.model.attributes.related.name,t===e.offline.SYNC_ACTIONS.CREATE&&(n="LBL_ACTION_CREATE_RELATED_EXPLANATION")),n=n||r[t]||"Unknown action",s.relatedName=s.relatedName||e.lang.get("LBL_RECORD_DELETED"),s.relatedModule=s.relatedModule||e.nomad.getSingularModuleName(this.model.attributes._tx_related_module);var u=e.lang.get(n,null,s);return new Handlebars.SafeString(u)}),Handlebars.registerHelper("getTxLogItemStatusClass",function(){var t;if(this.model.attributes._tx_error_count){var n=parseInt(this.model.attributes._tx_error,10),r=e.offline.TRANSACTION_STATUSES.UNRECOVERABLE;t=_.indexOf(r,n)>-1?"error":"warning"}return t}),Handlebars.registerHelper("getErrorDescription",function(t){var n=t;switch(t){case"403":n=e.lang.get("ERR_MOBILE_NOT_AUTHORIZED");break;case"409":n=e.lang.get("ERR_OFFLINE_SYNC_CONFLICT");break;case"412":n=e.lang.get("ERR_MOBILE_METADATA_CHANGED");break;case"500":n=e.lang.get("ERR_MOBILE_INTERNAL",null,{code:t})}return new Handlebars.SafeString(n)}),Handlebars.registerHelper("teamSearchItem",function(e){var t,n,r="",s="",o=(e.collection.query||"").trim();return o&&(n=new RegExp("("+i(Handlebars.Utils.escapeExpression(o))+")","i"),_.each(["name","name_2"],function(i){s=e.get(i),t=s.match(n),t?r+=s.replace(t[0],"<b>"+t[0]+"</b>"):r+=s,r+=" "})),new Handlebars.SafeString(r)}),Handlebars.registerHelper("humanFileSize",function(t){var n=e.nomad.utils.humanFileSize(t);return n===null?e.lang.get("LBL_NOT_AVAILABLE"):n.toString(!0)}),Handlebars.registerHelper("ifShowAdditionalFieldsOnSearch",function(t){var n=this.model.collection.query;return n?e.config.showAdditionalFieldsOnSearch?t.fn(this):t.inverse(this):t.fn(this)}),Handlebars.registerHelper("include",function(t,n,r,i){var s=i.hash.fields||r.viewDefs[i.hash.module],o=r.options.templateOptions&&r.options.templateOptions.partials?r.options.templateOptions.partials[t]:e.template.get(t);return new Handlebars.SafeString(o({model:n,view:r,context:r.context||e.controller.context,fields:s}))}),Handlebars.registerHelper("partial",function(t,n,r){var i=r.hash.view,s=i&&i.options.templateOptions&&i.options.templateOptions.partials?i.options.templateOptions.partials[t]:e.template.get(t);return new Handlebars.SafeString(s?s(n):"")}),Handlebars.registerHelper("emailPlaceholder",function(t,n){return e.lang.get(t&&t.length?"LBL_EMAIL_ADD":n.hash.required?"":"LBL_OPTIONAL")}),Handlebars.registerHelper("primaryEmail",function(e){return e&&e.length?e[0].email_address:""}),Handlebars.registerHelper("buildRoute",function(t,n){var r,i=e.controller.getScreenContextRoot(),s=n.hash.action,o=n.hash.link;return o?r=e.nomad.buildLinkRoute(t.link.bean.module,t.link.bean.id,o,t.id,s):r=e.router.buildRoute(t.module,t.id,s),n.hash.appendRoot&&i&&(r=i+"/"+r),new Handlebars.SafeString(r)}),Handlebars.registerHelper("ifHasValue",function(e,t,n){return e.get(t)?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("imageUrl",function(t,n){function i(){var i=e.api.buildFileURL({field:r.name,module:t.module,id:t.id},e.nomad.getFileOptions());return n&&(i+="&ts="+(new Date).getTime()),i}var r=this;return r&&t.get(r.name)?i():""}),Handlebars.registerHelper("moduleIconLabel",function(t){var n=e.lang.getAppListStrings("moduleIconList")[t]||e.lang.getAppListStrings("moduleListSingular")[t]||e.lang.getAppListStrings("moduleList")[t]||t,r=n.indexOf(" ");return r!==-1?n.substring(0,1)+n.substring(r+1,r+2):n.substring(0,2)}),Handlebars.registerHelper("iterate",function(e,t){var n="",r;return _.isObject(e)&&(r=function(e,r){n+=t.fn({key:r,value:e})}),_.each(e,r,this),new Handlebars.SafeString(n)}),Handlebars.registerHelper("favoriteable",function(t,n){var r,i,s="";return t instanceof Backbone.Model?(r=t.module,i={isFavorite:t.get("my_favorite")}):(r=t,i={}),r&&(r.toLowerCase()==="home"?s=n.fn(this):e.nomad.supportsFavs(r)&&(s=n.fn(i))),new Handlebars.SafeString(s)}),Handlebars.registerHelper("join",function(e,t){var n=t.hash.delimiter||",",r=t.hash.start||0,i=e?e.length:0,s=t.hash.end||i,o="";s>i&&(s=i);if(_.isFunction(t.fn)){for(var u=r;u<s;u++)u>r&&(o+=n),_.isString(e[u])?o+=e[u]:o+=t.fn(e[u]);return o}return[].concat(e).slice(r,s).join(n)}),Handlebars.registerHelper("joinPrimaryFirst",function(e,t){var n=_.sortBy(e,function(e){return!e.primary});return Handlebars.helpers.join(n,t)}),Handlebars.registerHelper("multienumStr",function(t,n){var r="",i=", ";if(n&&n.length){var s=_.isString(t)?e.lang.getAppListStrings(t):t;n=_.isString(n)?n.replace(/(\^)/g,"").split(","):n,_.each(n,function(e){s[e]&&(r+=s[e]+i)})}return r&&(r=r.substr(0,r.length-2)),new Handlebars.SafeString(r)}),Handlebars.registerHelper("multienumLabels",function(t,n,r){var i="";if(n&&n.length){var s=_.isString(t)?e.lang.getAppListStrings(t):t;_.each(n,function(e){s[e]&&(i+=r.fn({id:e,name:s[e]}))})}return i&&(i=i.substr(0,i.length-2)),new Handlebars.SafeString(i)}),Handlebars.registerHelper("fieldWithName",function(t,n,r,i,s){var o=e.view.createField({view:i,model:r,def:{type:n,name:t,view:s.hash.tpl}});return o.getPlaceholder()}),Handlebars.registerHelper("prop",function(t,n,r){return t=t||{},_.isString(t)&&(t=e.lang.getAppListStrings(t)),t[n]?t[n]:_.isUndefined(r.hash.defaultValue)?e.nomad.isEmptyValue(n)?"":n:r.hash.defaultValue}),Handlebars.registerHelper("nl2",function(e,t){var n=t.hash.str||" ";return e.replace(/\n|\r|\t/,n)}),Handlebars.registerHelper("ifHasValueAndReadAccessToParent",function(t){var n=this.model.get("parent_type");return!_.isEmpty(this.value)&&e.acl.hasAccess("read",n)&&_.isObject(e.metadata.getModule(n))?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("ifFewCurrenciesAreAvailable",function(t){var n=_.any(e.metadata.getCurrencies(),function(e){return e.status==="Active"});return n?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("isEmpty",function(t,n){return e.nomad.isEmptyValue(t)?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("isNotEmpty",function(t,n){return e.nomad.isEmptyValue(t)?n.inverse(this):n.fn(this)}),Handlebars.registerHelper("withObjectProp",function(e,t,n){var r="";return e.hasOwnProperty(t)&&(r+=n.fn(e[t])),r}),Handlebars.registerHelper("checkDisplayListFields",function(t,n){return t.length!==1||e.config.displayListFieldLabel?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("withDisplayListFields",function(e,t,n){var r={displayListFields:e.getListFields(t)};return n.fn(r)}),Handlebars.registerHelper("ifFeatureSupported",function(t,n){return e.supportedFeatures[t]?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("brandName",function(){return e.config.brandName||"SugarCRM"}),Handlebars.registerHelper("html2text",function(e,t){var n=/(<([^>]+)>)/ig,r=e.replace(n,"").replace(/\s\s+/g," ");return r.length>=t&&(r=r.substr(0,t)),r&&(r+="..."),r}),Handlebars.registerHelper("ternary",function(e,t,n){return e?t:n}),Handlebars.registerHelper("eachPair",function(e,t){var n="";for(var r=0;r<e.length;r++)n+=t.fn({key:e[r],value:e[++r]});return new Handlebars.SafeString(n)}),Handlebars.registerHelper("isTablet",function(t){return e.isTablet?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("activity",function(t){var n=t.get("activity_type"),r;return n==="post"?r=e.template.get("activity-"+n)({model:t.attributes,view:this.view}):r=e.template.get("activity-item")({model:t.attributes,view:this.view}),new Handlebars.SafeString(r)}),Handlebars.registerHelper("labeledFields",function(t,n){var r=e.metadata.getModule(n,"fields"),i=[];return _.each(t,function(t,n){var s=r[n],o=e.lang.get(s.vname);i.push(o)}),new Handlebars.SafeString(i.join(", "))}),Handlebars.registerHelper("comment",function(t,n){var r=_.union(e.metadata.getModuleNames({filter:"visible"}),["Users"]).sort(),i,s=t.length,o="";for(i=0;i<s;i++)o+=e.nomad.utils.charHtmlEntity(t[i],!0);return o=e.nomad.utils.formatLinks(o),_.each(n,function(e){var t=new RegExp("@\\["+e.module+":"+e.id+":"+e.name+"\\]","g"),n=_.indexOf(r,e.module,!0)===-1?e.name:"<a href='#"+e.module+"/"+e.id+"' class='sugar_tag label-"+e.module+"'>"+e.name+"</a>";o=o.replace(t,n)}),new Handlebars.SafeString(o)}),Handlebars.registerHelper("userPicture",function(t){var n=$('<i class="icon btn btn-inverse icon-user"></i>'),r=e.api.buildFileURL({field:"picture",module:"Users",id:t},e.nomad.getFileOptions());return n.css({backgroundImage:"url("+r+")"}).addClass("withPicture"),new Handlebars.SafeString(n[0].outerHTML)}),Handlebars.registerHelper("activityItem",function(t){var n=t.model.activity_type,r=t.model.data,i=r.object,s=r.subject,o="LBL_ACTIVITY_"+n.toUpperCase(),u={record:Handlebars.helpers.moduleLink(i),module:i.type},a;switch(n){case"update":_.extend(u,{changes:Handlebars.helpers.labeledFields(r.changes_module)});break;case"link":case"unlink":_.extend(u,{relatedRecord:Handlebars.helpers.moduleLink(s)})}return a=e.lang.get(o,null,u),new Handlebars.SafeString(a)}),Handlebars.registerHelper("moduleLink",function(t){var n=e.metadata.getModuleNames({filter:"visible"}),r=_.contains(n,t.module),i=r?'<a href="#'+t.module+"/"+t.id+'">'+t.name+"</a>":'<span class="module-name">'+t.name+"</span>";return new Handlebars.SafeString(i)}),Handlebars.registerHelper("debug-attributes",function(){var t=Array.prototype.slice.call(arguments,0),n=_.first(t),r=_.last(t),i,s,o=t.length>2?t.slice(1,t.length-1):[];if(_.indexOf(["debug","e2e"],e.config.scheme)===-1)return"";if(n==="TxLog")return new Handlebars.SafeString('record_id = "'+this.model.attributes._tx_bean_id+'"');if(n==="Teams")return new Handlebars.SafeString('team_name = "'+this.model.attributes.name+'"');if(n==="text")return s=o[0],new Handlebars.SafeString(s);if(n==="attribute")return i=o[0],s=o[1],new Handlebars.SafeString(i+'="'+s+'"')}),Handlebars.registerHelper("searchBoxPlaceholder",function(e){var t="";return this.isGlobalSearch||this.module==="Search"?t=Handlebars.helpers.str.apply(this,["LBL_SEARCH_ALL_RECORDS"]):e==="Teams"?t=Handlebars.helpers.str.apply(this,["LBL_MOBILE_SEARCH_TEAMS"]):t=Handlebars.helpers.str.apply(this,["LBL_SEARCH_ALL",e,this.modulePlural]),new Handlebars.SafeString(t)}),Handlebars.registerHelper("currencySelect",function(t){var n="";if(e.supportedFeatures.nativeEnum){var r=_.find(t,function(e,t){return e.selected});r=r?r.iso4217:t[0].iso4217,n='<span class="actionsheet-select">'+r+"</span>"}else n='<select name="currency_select">',_.each(t,function(e,t){var r=e.selected?"selected":"",i=e.disabled?"disabled":"";n+='<option value="'+t+'" '+r+" "+i+">"+e.iso4217+"</option>"}),n+="</select>";return new Handlebars.SafeString(n)}),Handlebars.registerHelper("menuItemIcon",function(){return this.view.isListItemSwippable?new Handlebars.SafeString("|||"):new Handlebars.SafeString('<i class="icon icon-ellipsis-v"></i>')}),Handlebars.registerHelper("gaTrack",function(t,n){var r=n.gaTrack&&n.gaTrack[t];return r?new Handlebars.SafeString(e.utils.formatString('track="{0}"',[r])):""})}(SUGAR.App),function(e){e.view.NomadLayout=e.view.Layout.extend({searchBoxName:"search-box",header:null,initialize:function(t){t.meta=t.meta||{},t.meta.components=t.meta.components||[],t.name!=="login"&&!_.find(t.meta.components,function(e){return e.view==="header"})&&t.meta.components.unshift({view:"header"}),e.view.Layout.prototype.initialize.call(this,t),this.initializeHeader();var n=this.module?"layout_"+this.module:"",r=this.meta.type?"layout-"+this.meta.type:"",i=e.controller.getScreenContext(),s=!_.isEmpty(this.options.link),o=this.options.def?this.options.def.name:"";this.$el.addClass(n+" "+r+" layout-def"+(s?" related":"")),this.$el.attr("layout-name",o)},initializeHeader:function(){this.header=_.find(this._components,function(t){return t instanceof e.view.views.HeaderView}),this.header&&(this.header.data=this.getHeaderData(),this.header.on("app:header:cancel",this._onHeaderCancel,this)),this.model.on("data:sync:complete",function(){this.header.data.title=this.getHeaderData().title,this.header.$("h1.nomad").text(this.header.data.title)},this)},bindGlobalEvents:function(){_.invoke(this._components,"bindGlobalEvents")},unbindGlobalEvents:function(){_.invoke(this._components,"unbindGlobalEvents")},onDetach:function(){this.unbindGlobalEvents()},render:function(t){var n=this;this._prepareBodyScroll(),t=t||{animation:{enabled:!1}},this._handleRenderWithAnimation(function(){e.view.Layout.prototype.render.apply(n,arguments)},t)},renderFromCache:function(e){var t=this;this._prepareBodyScroll(),this._handleRenderWithAnimation(function(){_.invoke(t._components,"onBeforeRender"),_.each(t._components,function(e){_.each(e.fields,function(e){(e.cacheDisabled===!0||e.hasAccess!==e.getAccess())&&e.render()})}),_.invoke(t._components,"onAfterRender")},e)},loadData:function(){e.view.Layout.prototype.loadData.apply(this,arguments),_.each(this._components,function(e){e.onLoadData()})},onAfterShow:function(){this.bindGlobalEvents(),_.invoke(this._components,"onAfterShow")},getHeaderData:function(){var t={};return _.each(this._components,function(e){e.getHeaderData&&(t=e.getHeaderData())}),t.layoutOptions=this.options.def,t.offlineEnabled=e.offlineEnabled,t},isDynamic:function(){return this.options.def&&this.options.def.isDynamic},getDefinition:function(){return this.options.def},getOverlay$El:function(){var e=this.getDefinition().appendTo.el.find(".background");return e.length?e:null},getDataById:function(e){return this.model.id===e?this.model.toJSON():this.collection&&this.collection.get(e)?this.collection.get(e).toJSON():null},_handleRenderWithAnimation:function(e,t){var n=this.getOverlay$El();t.animation.enabled&&n?(n.show(),e(),_.delay(function(){n.animate({opacity:0},{duration:t.animation.animationLength,complete:function(){n.hide(),n.css("opacity",1)}})},t.animation.preAnimationDelay)):(e(),n.hide())},_onHeaderCancel:function(){e.trigger("app:header:cancel")},_prepareBodyScroll:function(){if(e.isBodyScrollRequired){var t=_.find(this._components,function(e){return e._bodyScroll});if(t)$("html").addClass((this.name==="login"?"loginView":"")+" bodyScroll"),_.defer(function(){document.body.scrollTop=0});else{$("html").removeClass("bodyScroll loginView");var n=$("#alerts");n.remove(),_.defer(function(){document.body.scrollTop=0,$("#nomad").append(n)})}}},_dispose:function(){this.model&&this.stopListening(this.model),this.header&&this.header.off("app:header:cancel"),e.analytics.detachAnalytics(this.$el),this.$el.off(),e.view.Layout.prototype._dispose.call(this)}})}(SUGAR.App),function(e){e.view.layouts.ListLayout=e.view.NomadLayout.extend({className:"layout-list",initialize:function(t){var n=[],r,i;r=this._getListName(t),n=[{view:r}],i=this._getSearchBoxName(t),i&&n.unshift({view:i}),t.module==="Recents"&&(this.className="list-layout"),this.options.meta={type:"list",components:n},e.view.NomadLayout.prototype.initialize.call(this,t),this.$el.attr("layout-name",this.options.def.subType||this.options.def.name||""),this._list=this.getComponent(r),this._searchBox=this.getComponent(i),this._searchBox&&(this._list.on("list:item:clicked",this._searchBox.resetSearch,this._searchBox),this.enableSearch()),this.listenTo(this.collection,"data:sync:complete",function(e,t,n){this._searchBox&&this._searchBox.hideProgress()})},loadData:function(t){t=t||{},e.config.alwaysShowMyItems&&(t.myItems=!0),this.collection.orderBy||(this.collection.orderBy=this.module==="Meetings"?{field:"date_start",direction:"ASC"}:null),this.collection.options&&(delete this.collection.options.update,this.collection.options.offset=0,this.collection.options.page=0),e.view.NomadLayout.prototype.loadData.call(this,t)},enableSearch:function(){this._searchBox.on("search:text",this.search,this)},search:function(t){this.collection.options=null,this.collection.fetch({query:t}),e.analytics.trackEvent("search",this.module,0)},_getListName:function(t){var n,r={associate:"list-associate",parent:"list-parent",relate:"list-relate",teamset:"list-teamset",invitees:"list-invitees",relationships:"list"};return _.contains(e.config.readonlyModules,t.module)&&!t.editable?n="readonly-list":t.subType?n=r[t.subType]:t.module==="Home"?n="home":n=t.name||"list",n},_getSearchBoxName:function(t){var n;return _.contains(e.config.readonlyModules,t.module)&&!t.editable||t.module==="Recents"||t.module==="Dashboards"||t.subType==="relationships"?null:(t.module==="Home"?n="global-search-box":n="search-box",n)},getCollections:function(){return[this.collection]},abortActiveRequests:function(){_.each(this.getCollections(),function(e){e.getFetchRequest()&&(this.needLoadData=!0,e.abortFetchRequest())},this)},onDetach:function(){e.view.NomadLayout.prototype.onDetach.call(this),this.abortActiveRequests()}})}(SUGAR.App),function(e){e.view.layouts.MobileActivitiesListLayout=e.view.layouts.ListLayout.extend({listName:"activitystream-dashlet",dashlet:null,initialize:function(){this._super("initialize",arguments),this.dashlet=this.getComponent(this.listName)},_getListName:function(){return this.listName},_getSearchBoxName:function(){return null},loadData:function(e){if(this.disposed)return;this.dashlet.loadData(e)},getHeaderData:function(){return{cube:!0,title:e.lang.getAppString("LBL_ACTIVITY_STREAM"),offlineEnabled:e.offlineEnabled}}})}(SUGAR.App),function(e){var t={type:"list",components:[{view:"list-picker"}]};e.view.layouts.PickerlistLayout=e.view.NomadLayout.extend({className:"layout-list list-picker",initialize:function(n){this.options.meta=t,e.view.NomadLayout.prototype.initialize.call(this,n);var r=this.getComponent("list-picker"),i=this.context.get("action"),s=this.context.get("parentModule"),o=e.nomad.getSubpanels(s),u=i==="create"?_.filter(o,function(t){return e.nomad.canCreateRelated(t.module,s,"create",t.context.link)}):_.filter(o,function(t){return t.linkable&&e.acl.hasAccess("list",t.module)});_.each(u,function(e){e.currentModule=s}),r.setData({items:u,parentModelId:this.context.get("parentModelId"),parentModule:s,context:this.context,action:i}),r.on("row:clicked",function(t){var n=this.data.parentModule,r=e.nomad.buildLinkRoute(n,this.data.parentModelId,t,null,this.context.get("action"));e.router.navigate(r,{trigger:!0})})}})}(SUGAR.App),function(e){e.view.layouts.HomeLayout=e.view.layouts.ListLayout.extend({className:"layout-list",initialize:function(t){this.moduleCollections={},this.currentRequestList=[],this.ftsModules=e.nomad.getFtsEnabledModules()||[],e.view.layouts.ListLayout.prototype.initialize.call(this,t),this.initializeBucketMeta(),this.initializeModuleCollections()},loadData:function(t){t=t||{},_.isEmpty(this.collection.query)?(this.collection.module_list=e.supportedFeatures.fts?this.ftsModules:null,this.loadModulesData(t.disableGlobalDataAlerts,t)):e.view.Layout.prototype.loadData.call(this,t,!1)},initializeBucketMeta:function(){var t=[],n=[];this.activityBucketsData=[];var r=e.metadata.getModuleNames({filter:"visible",access:"view"});n=e.config.excludeFromHomePage,n&&_.each(n,function(e){r=_.without(r,e)});var i=[{name:"Recent",label:e.lang.get("LBL_RECENTLY_UPDATED"),modules:r,numberOfItems:e.config.activityItemsRecent||10,displayMore:!1,displayModule:!0,enabled:e.config.includeRecentBuckets,labelNoRecords:e.lang.get("LBL_MOBILE_NO_RECORDS"),noSkipModules:!0}];this._canDisplayModule("Meetings")&&i.unshift({name:"Upcoming",label:e.lang.get("LBL_UPCOMING"),module:"Meetings",numberOfItems:e.config.activityItemsUpcoming||4,displayMore:!1,displayModule:!0,myItemsOnly:!0,enabled:e.config.includeUpcomingBuckets,labelNoRecords:e.lang.get("LBL_MOBILE_NO_RECORDS")});for(var s in i)i.hasOwnProperty(s)&&(t=this.addCustomBucket(i[s],t));if(e.config.includeModuleBuckets)for(s in r)t.indexOf(r[s])===-1&&this.activityBucketsData.push({name:r[s],module:r[s],label:e.nomad.getPluralModuleName(r[s]),numberOfItems:e.config.fetchLimit.activityItemsPerModule||3,displayMore:!0,labelNoRecords:e.lang.get("LBL_MOBILE_NO_RECORDS")})},initializeModuleCollections:function(){_.each(this.activityBucketsData,function(t){var n;t.modules?(n=e.data.createMixedBeanCollection(),n.fetchConfig={orderBy:{field:"date_modified",direction:"desc"},myItems:t.myItemsOnly||this.collection.myItems,favorites:this.collection.favorites,limit:t.numberOfItems||e.config.fetchLimit.activityItemsPerModule||3,module_list:t.modules||[]}):(n=e.data.createBeanCollection(t.module||t.name),n.fetchConfig={myItems:t.myItemsOnly||this.collection.myItems,favorites:this.collection.favorites,fields:e.metadata.getModule(t.module).mergedFields,limit:t.numberOfItems||e.config.fetchLimit.activityItemsPerModule||3},n.module_list=[t.module||t.name]),_.extend(n,{bucketName:t.name,isActivityCollection:!0,displayModule:t.displayModule||!1,displayMore:t.displayMore,label:t.label||t.name,myItemsOnly:t.myItemsOnly||!1}),this._bindEvents(n),this.moduleCollections[t.name]=n},this),this.trigger("home:collections:initialized")},loadModulesData:function(t,n){n.params=n.params||{},_.each(this.activityBucketsData,function(r){var i=this.moduleCollections[r.name];if(n.requestParams&&!_.isEqual(n.requestParams,i.options.params))return!1;_.extend(i.fetchConfig,{byPtr:t,disableGlobalDataAlerts:!0,params:null}),i.options=null,i.orderBy=r.name==="Upcoming"?{field:"date_start",direction:"ASC"}:{field:"date_modified",direction:"DESC"};var s=_.extend({},i.fetchConfig,n),o=_.pick(s,_.functions(s)),u=e.utils.deepCopy(s);_.extend(u,o),s=u,r.name==="Upcoming"&&(s.myItems=!0),i.fetch(s),this.currentRequestList.push(r.name)},this),this.context._fetchCalled=!0},_bindEvents:function(e){var t=this.getComponent("home");this.listenTo(e,"data:sync:start",function(n,r){t.onDataSyncStart(n,e,r)}),this.listenTo(e,"sync",function(){t.onDataSyncSuccess.apply(t,arguments)}),this.listenTo(e,"data:sync:error",function(){var n=_.toArray(arguments);n.push(e),t.onDataSyncError.apply(t,n)}),this.listenTo(e,"remove",function(e){t.onItemRemoved(e)}),this.listenTo(e,"data:sync:abort",function(){t.onDataSyncAbort.apply(t,arguments)})},getDataById:function(e){var t=_.flatten(this.moduleCollections),n=null;return this.collection&&t.push(this.collection),_.each(t,function(t){t.get(e)&&(n=t.get(e).toJSON())}),n},addCustomBucket:function(e,t){if(e.enabled){if(!e.noSkipModules)if(e.modules)_.each(t,function(t){e.modules.splice(e.modules.indexOf(t),1)});else if(t.indexOf(e.module)>-1)return t;this.activityBucketsData.push(e),t=t.concat(e.modules||e.module)}return t},_canDisplayModule:function(t){return e.metadata.getModule(t)&&e.acl.hasAccess("access",t)&&e.acl.hasAccess("list",t)},_dispose:function(){_.each(this.moduleCollections,function(e){this.stopListening(e)},this),e.view.NomadLayout.prototype._dispose.apply(this,arguments)},getCollections:function(){return Array.prototype.concat(this.collection,_.values(this.moduleCollections))}})}(SUGAR.App),function(e){e.view.layouts.MobileTxLogListLayout=e.view.NomadLayout.extend({className:"layout-list",initialize:function(t){e.view.NomadLayout.prototype.initialize.call(this,t),this.collection.sync=function(t,n,r){var i=r.success;n.options.add||(r.offset=0),async.waterfall([function(t){r.success=function(e){var i;e&&!_.isArray(e)&&(e=[e]),n.options.add||(n.offset=0),n.options.update=!1,n.options.add=!1,i=e.pop().totalTransactions,n.offset=n.offset+e.length,n.next_offset=i-n.offset,n.next_offset||(n.next_offset=-1),n.page=n.getPageNumber(r),e=_.map(e,function(e){return e.id=e._tx_uid,e}),t(null,n,e,r)},e.offline.storage.readTransactions(_.extend({limit:e.config.offline.txLogMaxQueryLimit,count:!0,errFirst:!0},r))},function(t,n,r,i){e.offline.storage.fillTxLogData(n,function(){i(null,t,n,r)})}],function(e,t,n,r){e||(i(t,n,r),r.complete&&r.complete(t,n,r))})}}})}(SUGAR.App),function(e){var t=function(){};e.view.layouts.MobileTxLogDetailLayout=e.view.NomadLayout.extend({className:"detail-layout",initialize:function(t){e.view.NomadLayout.prototype.initialize.call(this,t)},loadData:function(n){var r=this;this.model.sync=function(n,i,s){var o=s.success;async.waterfall([function(t){s.success=function(e){t(null,e)},e.offline.storage.readTransactions(s,{id:i.id})},function(n,r){n?e.offline.storage.fillTxLogData([n],function(){r(null,n)}):r(new t)}],function(n,u){n?n instanceof t&&(e.controller.clean(),e.controller.goBack()):(o(i,u,s),r.render())})},this.model.fetch(n)}})}(SUGAR.App),function(e){e.view.layouts.MobileDashboardsDetailLayout=e.view.NomadLayout.extend({initialize:function(e){this._super("initialize",[e]),this.dashboardView=this.getComponent("dashboard");var t=this.getComponent("header");this.listenTo(this.dashboardView,"dashlets:changed",this.onDashletChanged),this.listenTo(t,"app:header:dashboard:home",this.onDashboardHomeClick)},_getDashboardName:function(){return e.lang.get(this.model.get("name"))||null},onDashletChanged:function(e){var t,n=this.$el.find(".dashHomeBtn");_.isEmpty(e)?(n.hide(),t=this._getDashboardName()):(n.show(),t=e[0].view.title,e[0].view.dataTitle&&(t+=e[0].view.dataTitle)),this.header.setTitle(t)},onDashboardHomeClick:function(){var t=e.router.buildRoute("Dashboards",this.model.id);e.controller.navigate(t)},loadData:function(){},getFieldNames:function(e){return null},getHeaderData:function(){return{dashboardHome:!0,cube:!0,back:!1,title:this._getDashboardName()||e.lang.get("LBL_LOADING"),offlineEnabled:e.offlineEnabled}},onDetach:function(){this.dashboardView.onDetach(),this._super("onDetach")},clean:function(){this.dashboardView.clean()}})}(SUGAR.App),function(e){e.view.layouts.MobileSearchListLayout=e.view.layouts.ListLayout.extend({initialize:function(e){this._super("initialize",[e]),this._adjustCollectionParams()},search:function(e){this.collection.query=e,this._adjustCollectionParams(e),this._super("search",arguments)},_adjustCollectionParams:function(){_.isEmpty(this.collection.query)?(this.collection.orderBy={field:"date_modified",direction:"DESC"},this.collection.limit=e.config.fetchLimit.recentlyUpdated,this.collection.module_list=e.metadata.getModuleNames({filter:"visible"})):(delete this.collection.orderBy,delete this.collection.limit,this.collection.module_list=e.nomad.getFtsEnabledModules())}})}(SUGAR.App),function(e){var t,n;e.view.views.HeaderView=e.view.NomadView.extend({className:"view-header",events:{"click .cube":"onHomeClicked","click .create-entity":"onAddClicked","click .saveBtn":"onSave","click .cancelBtn":"onCancel","click .backBtn":"onBack","click .caretBtn":"onCaret","click .dashHomeBtn":"onDashboardHome","click h1":"onHeaderClicked","click .right-menu":function(){this.toggleRightMenu(!1)},swipeLeft:"onSwipeLeft",swipeRight:"onSwipeRight"},plugins:["fast-click-highlight"],allowCreateMenuInModule:["About","Home","Settings","Recents","Search"],RIGHT_MENU:"right_menu",_isRightMenuOpened:!1,_isMainMenuOpened:!1,dataContainer:null,globalEvents:{"app:logout":function(){delete this.avatar},"offline:status:update":function(t){var n=this.$el.find(".offline-icon, .offline-status");n.removeClass("status-success status-warning status-error status-default"),n.addClass(e.nomad.utils.getOfflineStatusClass())},"app:orientation:changed":function(){if(!e.isTablet)return;window.scrollTo(0,0),e.controller.layoutManager.getRecordLayout()&&t.addClass("show-content-child")},"app:mainmenu:show":function(e){this._isMainMenuOpened=e.show}},offlineStatusIconPartial:"offline-status-icon",offlineStatusClass:function(){return e.nomad.utils.getOfflineStatusClass()},initialize:function(r){var i=this;e.events.register("app:header:save",this),e.events.register("app:header:clicked",this),e.events.register("app:header:add",this),e.view.NomadView.prototype.initialize.call(this,r),this.defaults={title:"SugarCRM",cube:!0,plus:!0,back:!1,save:!1,otherActions:!1,cancel:!1},t=$(document.body),n=e.$rootEl.find("#content-overlay"),this.isAnimationEnabled=e.supportedFeatures.menuAnimation,this._initializeCancelSaveHandlers()},_initializeCancelSaveHandlers:function(){var e=this.layout.options.subType,t=this;e==="associate"?this.dataContainer=this.collection:this.dataContainer=this.model,this.dataContainer&&this.dataContainer.on("data:sync:start",function(e,n,r){t.setButtonsEnabled(!1)},this).on("sync",function(e,n,r,i){t.setButtonsEnabled(!0,null,r.method)},this).on("data:sync:error",function(e,n,r){t.setButtonsEnabled(!0,r,e)},this)},setButtonsEnabled:function(t,n,r){t?(this.data.otherActions&&this._refreshHeaderActions(),this.$(".save-container").toggle(this._hasAccessToSave()),n&&(n.status===404||n.status===403&&r==="read"||r==="read"&&(!e.offlineEnabled||n instanceof e.offline.Error))?(this.$(".save-container").hide(),(n.status===404||n.status===403)&&this.$(".createBtn").hide()):n||this.$(".createBtn").show(),this.$(".saveBtn .btn").removeClass("disabled"),this.$(".cancelBtn .btn").removeClass("disabled")):(this.$(".saveBtn .btn").addClass("disabled"),this.$(".cancelBtn .btn").addClass("disabled"))},_hasAccessToSave:function(){var t=this.model.get("id");return!t||e.acl.hasAccessToModel("edit",this.model)&&!_.contains(e.config.nonEditableModules,this.module)},_refreshHeaderActions:function(){var t=!1;_.each(this.data.otherActions,function(n){var r=n.isEnabled(this.model);n.enabled=r&&(!n.needsAccess||e.acl.hasAccessToModel(n.needsAccess.action,this.model,n.needsAccess.field)),n.enabled&&(t=!0)},this),this.$(".caretBtn").toggle(t),this.$(".saveBtn").toggleClass("combined",t)},onBeforeRender:function(){this.data.save&&!this.context.get("create")&&!this.layout.isDynamic()&&(this.data.saveHidden=!0),this.buildRightMenu(),this.data.isCubeSupported=this._isCubeSupported()},onAfterRender:function(){this.$menuContainer=e.$rootEl.find("#menu-left"),this.$contentWrapper=e.$rootEl.find("#wrapper")},onHeaderClicked:function(t){t.preventDefault(),e.trigger("app:header:clicked",this.layout)},onSave:function(e){this.$(".saveBtn .btn").hasClass("disabled")||this._onButtonClicked(e,"app:header:save")},onCancel:function(e){this.$(".cancelBtn .btn").hasClass("disabled")||this._onButtonClicked(e,"app:header:cancel")},onDashboardHome:function(e){this._onButtonClicked(e,"app:header:dashboard:home")},onBack:function(e){this._onButtonClicked(e,"app:header:cancel")},onHomeClicked:function(t){t.preventDefault();if(!this._isCubeSupported())return;e.trigger("app:header:home"),e.tutorial.show("home-menu"),e.nomad.dismissAlerts()},onSwipeLeft:function(e){this._isMainMenuOpened?this.onHomeClicked(e):!this._isRightMenuOpened&&this.data.plus&&!this.rightMenuData.createOnly&&this.onAddClicked(e)},onSwipeRight:function(t){if(e.nomad.getOrientation()==="landscape"&&e.isTablet)return;if(this._isRightMenuOpened){this.onAddClicked(t);return}this.onHomeClicked(t)},_onButtonClicked:function(t,n){e.nomad.dismissAlerts(),t&&t.preventDefault(),this.trigger(n,this.layout)},onAddClicked:function(t){t.preventDefault(),t.stopPropagation();if(this.rightMenuData.createOnly){var n=e.router.buildRoute(this.rightMenuData.module,null,"create");e.router.navigate(n,{trigger:!0})}else this.toggleRightMenu(!this._isRightMenuOpened),e.tutorial.show("plus-menu");e.trigger("app:header:add",this._isRightMenuOpened),e.nomad.dismissAlerts()},toggleRightMenu:function(n,r,i){var s,o=this;s={show:n,disableAnimation:r,callback:i,view:this},n?t.on("touchstart.header"+o.cid,function(e){var t=$(e.target),n=(t.hasClass("create-entity")||t.hasClass("icon-plus"))&&!_.isEmpty(o.$el.find(t)),r=!_.isEmpty(o.$el.find(".right-menu").find(t));!n&&!r&&_.delay(function(){o.toggleRightMenu(!1)},100)}):t.off("touchstart.header"+o.cid);if(e.isTablet)this._isRightMenuOpened=n,this.$(".createBtn")[n?"addClass":"removeClass"]("active"),this.$(".right-menu")[n?"fadeIn":"fadeOut"](),e.trigger("app:rightmenu:show",s);else{e.trigger("app:rightmenu:show",s);var u=r||!this.isAnimationEnabled?0:200,a=this.$(".right-menu"),f={menuAnimation:{"-webkit-transform":n?"translate3d(100%, 0, 0)":"translate3d(100%, 0, 0)"},contentAnimation:{"-webkit-transform":n?"translate3d(-86%, 0, 0)":"translate3d(0, 0, 0)"},overlayAnimation:{"-webkit-transform":n?"translate3d(-86%, 0, 0)":"translate3d(-100%, 0, 0)"}},l=function(){t.toggleClass("show-right-menu",n),o._isRightMenuOpened=n,i&&i()};this.animateMenu({isShowing:n,data:f,$menu:a,callback:l,duration:u})}},animateMenu:function(t){var n=t.data,r=t.isShowing;r&&t.$menu.animate(n.menuAnimation,0),this.$contentWrapper.animate(n.contentAnimation,t.duration,"ease-out",function(){r||t.$menu.animate(n.menuAnimation,0),n.overlayAnimation&&e.$rootEl.find("#content-overlay").animate(n.overlayAnimation,0),t.callback&&t.callback()})},setTitle:function(e){this.$el.find("h1").text(e)},onCaret:function(t){var n=[],r=[],i=this;t&&(t.preventDefault(),t.stopPropagation()),_.each(this.data.otherActions,function(t){t.enabled&&(n.push(e.lang.get(t.label,null,i)),r.push(t.name))}),n.length&&e.nomad._showActionSheet(e.lang.get("LBL_SELECT_ACTION_LABEL"),n,function(n,i){e.trigger("app:header:action",r[i])})},buildRightMenu:function(){var t="",n=this.data.layoutOptions;if(!this.data||!this.data.plus||!n)return;var r,i,s,o,u,a,f;if(n.subType==="relationships")s=n.parentModule,o=n.parentModelId,u=n.link,a=e.data.getRelatedModule(s,u),r="menu-right-rel-list",f=e.nomad.getSingularModuleName(a),i={createRelationshipHref:{url:e.nomad.buildLinkRoute(s,o,u,"create"),label:e.lang.get("LBL_CREATE_RELATED",a,f),disabled:!e.nomad.canCreateRelated(a,s,"create",u)},associateRelationshipHref:{url:e.nomad.buildLinkRoute(s,o,u,"associate"),label:e.lang.get("LBL_ASSOC_EXISTING",a,f),disabled:!e.nomad.canLinkRelated(s,u)}},this.data.plus=!i.createRelationshipHref.disabled||!i.associateRelationshipHref.disabled;else if(n.name==="detail"){r="menu-right-detail";if(n.link)s=n.parentModule,o=n.parentModelId,u=n.link,a=e.data.getRelatedModule(s,u),i={params:n,duplicateHref:{url:e.nomad.buildLinkRoute(s,o,u,n.modelId,"duplicate"),label:e.lang.get("LBL_DUPLICATE_BUTTON"),disabled:!e.nomad.canCreateModule(a)||_.include(e.config.nonDuplicatableModules,a)||!e.nomad.hasAccessToReqFields(a,"create")}},this.data.plus=!i.duplicateHref.disabled;else{switch(e.controller.getScreenContext().root){case"home":t="home/";break;case"Recents":t="Recents/"}i={params:n,duplicateHref:{url:t+e.router.buildRoute(n.module,n.modelId,"duplicate"),label:e.lang.get("LBL_DUPLICATE_BUTTON"),disabled:!e.nomad.canCreateModule(n.module)||_.include(e.config.nonDuplicatableModules,n.module)||!e.nomad.hasAccessToReqFields(n.module,"create")},createRelationshipHref:{url:t+e.router.buildRoute(n.module,n.modelId)+"/create-related",label:e.lang.get("LBL_CREATE_RELATED_RECORD"),disabled:!this.data.hasCreatableRels},associateRelationshipHref:{url:t+e.router.buildRoute(n.module,n.modelId)+"/associate-related",label:e.lang.get("LBL_ASSOC_RELATED_RECORD"),disabled:!this.data.hasRels}},this.data.plus=!(i.duplicateHref.disabled&&i.createRelationshipHref.disabled&&i.associateRelationshipHref.disabled)}}else{r="menu-right-list";if(_.contains(this.allowCreateMenuInModule,n.module)){var l=_.reject(e.metadata.getModuleNames({filter:"visible"}),function(t){return!e.nomad.canCreateModule(t)||!e.nomad.hasAccessToReqFields(t,"create")});switch(n.module){case"Home":t="home/";break;case"Recents":t="Recents/";break;case"Search":t="Search/"}l.length>0?i=_.map(l,function(n){return{url:t+n,module:n,label:e.lang.get("LBL_CREATE_MODULE",n,e.nomad.getSingularModuleName(n))}}):this.data.plus=!1}else n.module!=="Dashboards"&&(n.module&&(!e.nomad.canCreateModule(n.module)||!e.nomad.hasAccessToReqFields(n.module,"create"))?this.data.plus=!1:i={createOnly:!0,module:n.module})}this.rightMenuData=i,this.rightMenuTemplate=r},_isCubeSupported:function(){return this.data.cube},_dispose:function(){e.events.off("app:header:picturechanged",null,this),this.dataContainer&&this.dataContainer.off("data:sync:start sync data:sync:error",null,this),e.view.NomadView.prototype._dispose.apply(this)}})}(SUGAR.App),function(e){e.view.views.AboutView=e.view.NomadView.extend({events:{"click .legal a":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)},"click .support_email":function(t){t.preventDefault();var n=e.isNative?"\n\n\nrequest ID: "+e.clientInfo.device.uuid:"";e.nomad.sendConsoleLog(e.config.about.supportEmail,e.config.brandName+" Mobile support request",n)},"click .support_website":function(t){t.preventDefault(),e.nomad.openUrl("http://"+e.config.about.support)},"swipeRight .support_website":function(e){this._feedBack=(this._feedBack||0)+1,this._feedBack>=3&&this.getField("support_email").$el.removeClass("hide")}},onAfterRender:function(){!e.config.about.displaySupportEmail||this.getField("support_email").$el.removeClass("hide"),e.config.about.support||this.getField("support_website").$el.addClass("hide")},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.fallbackFieldTemplate="readonly",this._displayTrademarks=e.config.about.displayTrademarks;var n=e.nomad.getServerVersion(),r;r=this._getServerUrl().replace(/(http:\/\/)|(https:\/\/)|(\/rest\/v10\/)/,""),this.model.set({app_version:e.nomad.getVersion(),server_version:n,server_url:r,support_email:e.config.about.supportEmail,support_website:e.config.about.support,privacy:e.config.about.privacy,tos:e.config.about.tos,thirdPartySoftware:e.config.about.thirdPartySoftware})},_getServerUrl:function(){var t;return e.isNative?e.config.hideLoginUrl?t=e.config.defaultServerUrl:e.api.isAuthenticated()&&(t=e.nomad.getSetting("loginUrl")||"N/A"):(t=e.config.siteUrl,t.indexOf("..")===0&&(t=e.nomad.utils.resolveUrl(t,window.location.href))),t||"N/A"},getHeaderData:function(){return{title:e.lang.get("LNK_ABOUT"),cube:e.api.isAuthenticated()&&e.isSynced,plus:!1,back:!0}}})}(SUGAR.App),function(e){e.view.views.AddressEditView=e.view.NomadView.extend({_bodyScroll:!0,globalEvents:{"app:header:save":"save"},plugins:["clear-field","hide-alerts-onfocus","focus-on-input"],initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.action="edit",this.fallbackFieldTemplate="edit",this.addressFields=this.context.get("addressFields"),this.addressFieldsNames=_.pluck(this.addressFields,"name"),this.model=this.context.get("model")},getHeaderData:function(){var e=this.context.get("editedFieldName");return{title:e,save:!0,saveLabel:"LBL_DONE_BUTTON_LABEL",cancel:!0}},save:function(){var t=this,n=this.model.cid;e.nomad.showDataSyncOverlay(n),this.model.doValidate(this.addressFieldsNames,function(r){e.nomad.hideDataSyncOverlay(null,null,n),r&&(_.each(t.addressFields,function(e){t.context.get("parentModel").set(e.name,t.model.get(e.name))}),e.controller.goBack())})}})}(SUGAR.App),function(e){e.view.views.SettingsView=e.view.NomadView.extend({_bodyScroll:!0,_defaultViewSplitter:":",_defaultViewFieldName:"default_view",globalEvents:{"app:header:save":"saveSettings","app:header:cancel":"cancel"},initialize:function(t){this._modelBackup=null,this._showOfflineButton=e.config.offline.enabled&&(e.config.offlineEnabled||e.config.offline.debug.ignoreEnabled)&&e.supportedFeatures.offline,this._offlineEnabled=e.offlineEnabled,this._configurableFontSize=e.config.configurableFontSize;var n=new Backbone.Model(e.user.get("preferences")),r=e.logger.levels[e.config.logLevel];r&&n.set("logging",r.value-1);var i=e.nomad.getSetting("fontSize")||"normal";this._configurableFontSize&&i&&n.set("fontSize",i),t.layout.context.set("model",n),t.layout.model=n,this._super("initialize",[t]);if(this._configurableFontSize){var s=this.getFieldMeta("fontSize");s.options={},_.each([["tiny","LBL_FONTSIZE_TINY"],["small","LBL_FONTSIZE_SMALL"],["normal","LBL_FONTSIZE_NORMAL"],["large","LBL_FONTSIZE_LARGE"],["larger","LBL_FONTSIZE_LARGER"],["huge","LBL_FONTSIZE_HUGE"],["extra_huge","LBL_FONTSIZE_EXTRA_HUGE"]],function(t){s.options[t[0]]=e.lang.get(t[1])})}else this.meta.panels[0].fields=_.filter(this.meta.panels[0].fields,function(e){return e.name!=="fontSize"});e.supportedFeatures.settingsDefaultView&&(this._defineDefaultViewFields(),this._adjustDefaultViewOptions(),this.applyDefaultViewOnModel()),this.listenTo(this.model,"change",this.onSettingChange)},_defineDefaultViewFields:function(){var t=this.meta.panels[0].fields;this._defaultViewFields=[{name:"default_view",label:"LBL_MOBILE_DEFAULT_VIEW",options:{Modules:e.lang.get("LBL_MOBILE_SPECIFIC_MODULE")},view:"edit",type:"enum",dependencies:[]},{name:"default_module",label:"LBL_MOBILE_DEFAULT_MODULE",options:{},view:"edit",type:"enum",dependencies:[{parentField:"default_view",condition:function(e){var t=e.get(this.parentField);return t==="Modules"},result:function(){var t=e.metadata.getModuleNames({filter:"visible"});return _.object(t,t)}}]},{name:"default_dashboard",label:"LBL_MOBILE_DEFAULT_DASHBOARD",options:{},view:"edit",type:"enum",dependencies:[{parentField:"default_view",condition:function(t){var n=t.get(this.parentField);return e.supportedFeatures&&n==="Dashboards"},result:function(){return _.object(_.pluck(e.nomad.dashboards.getCollection().models,"id"),e.nomad.dashboards.getNames())}}]},{name:"default_dashlet",label:"LBL_MOBILE_DEFAULT_DASHLET",options:{},view:"edit","default":"-1",type:"enum",dependencies:[{parentField:"default_dashboard",condition:function(e){var t=e.get("default_view");return t==="Dashboards"},result:this._getDashboardDashlets}]}],_.each(this._defaultViewFields,function(e){var n=_.find(t,function(t){return t.name===e.name});n||t.push(e)},this),this._defaultViewFieldNames=_.pluck(this._defaultViewFields,"name")},applyDefaultViewOnModel:function(){this.defaultView=e.nomad.getSetting(this._defaultViewFieldName)||e.config.defaultViewScheme;var t=this.defaultView.split(this._defaultViewSplitter);_.each(this._defaultViewFields,function(e){if(!this.defaultView)return;var n=!_.isEmpty(e.dependencies)&&e.dependencies[0].parentField,r=this.model.get(n),i=!0,s;r&&(i=!!_.find(e.dependencies,function(e){return e.condition(this.model)},this)),!_.isEmpty(t)&&i&&(s=t.shift(),this.model.set(e.name,s,{silent:!0}))},this)},onSettingChange:function(e){var t=_.keys(e.changed),n=_.intersection(this._defaultViewFieldNames,t);_.each(n,function(e){this._onDefaultViewChange(e)},this)},_adjustDefaultViewOptions:function(){var t=_.find(this.meta.panels[0].fields,function(e){return e.name===this._defaultViewFieldName},this);if(e.supportedFeatures.dashboards){var n=e.nomad.dashboards.getNames();t.options.Search=e.lang.get("LBL_MOBILE_GLOBAL_SEARCH"),_.isEmpty(n)||(t.options.Dashboards=e.lang.get("LBL_MOBILE_SPECIFIC_DASHBOARD"))}e.supportedFeatures.recents&&(t.options.Recents=e.lang.get("LBL_RECENTLY_VIEWED")),e.supportedFeatures.activities&&(t.options.Activities=e.lang.get("LBL_ACTIVITY_STREAM"))},_getDependentFields:function(e){var t=[];return _.each(this._defaultViewFields,function(n){_.contains(_.pluck(n.dependencies,"parentField"),e)&&t.push(n)}),t},_getDashboardDashlets:function(t){var n=e.nomad.dashboards.getCollection().get(t).get("metadata"),r=e.view.views.BaseDashletView,i=n.dashlets,s=_.chain(i).pluck("view").pluck("label").value(),o;return s=_.map(s,function(t,n){var s=i[n].view,o={name:s.type,modulePlural:e.lang.getAppListStrings("moduleList")[s.module]||s.module,getLangContext:r.prototype.getLangContext};return r.prototype.getTitle.call(o,t)}),o=_.object(_.pluck(i,"id"),s),o[-1]=e.lang.get("LBL_ALL_DASHLETS"),o},_onDefaultViewChange:function(e,t){var n=this.getField(e),r=n.getValue(),i=this._getDependentFields(e);_.each(i,function(e){var n=e.name,i=this.getField(n),s={};if(!i)return;_.each(e.dependencies,function(e){e.condition(this.model)&&(s=e.result,_.isFunction(s)&&!_.isUndefined(r)&&(s=s(r)))},this),this._adjustSubviewGrid(i,s,t)},this)},_adjustSubviewGrid:function(e,t,n){_.isObject(t)&&(e.def.options=t,(!n&&!_.isEmpty(this.model.changed)||_.isUndefined(this.model.get(e.name)))&&this.model.set(e.name,e.getDefaultValue()),e.render())},getHeaderData:function(){return{title:e.lang.get("LNK_SETTINGS"),save:!0,cancel:!0}},onAfterRender:function(){this.backupModel(),this.$pad=this.$(".pad"),this.$modalFooter=this.$(".modal-footer"),e.config.showLogLevelSetting||this.getField("logging").remove(),_.each(this._defaultViewFieldNames,function(e){this.getField(e).$el.detach().appendTo(this.$pad),this._onDefaultViewChange(e,!0)},this),this.$modalFooter.detach().appendTo(this.$pad)},saveSettings:function(){this.setFontSize();var t=this,n=this.model.get("language"),r=this.$el.find("#offline-toggle").attr("checked"),i=r!==e.offlineEnabled,s=!1,o=!1,u=!1,a=[function(){return t._showOfflineButton&&i},function(){return t.model.get("fontSize")!==t._modelBackup.fontSize},function(){var e=!1;return _.each(t._defaultViewFieldNames,function(n){if(e)return;var r=t.model.get(n);r&&(e=r!==t._modelBackup[n])},this),e},function(){return t.model.get("logging")!==t._modelBackup.logging},function(){var t=n!==e.user.getLanguage();return t&&(u=!0),t},function(){var e=t._showOfflineButton&&i;return e&&r&&(u=!0),e}],f=[function(n){t._showOfflineToggleConfirm(!e.offlineEnabled,function(e){e&&(s=e),n()})},function(n){var r=t.model?t.model.get("fontSize"):t._modelBackup.fontSize;e.nomad.setSetting("fontSize",r),n(null)},function(n){var r=t._modelBackup.default_view;t.model&&(r=_.reduce(t._defaultViewFieldNames,function(e,n){var r=t.model.get(n);return n==="default_dashlet"&&parseInt(r,10)===-1?e:(r&&e.push(t.model.get(n)),e)},[]).join(t._defaultViewSplitter)),e.nomad.setSetting(t._defaultViewFieldName,r),n(null)},function(n){var r=t.getField("logging");e.config.logLevel=r.options.def.options[r.value],e.config.debugSugarApi=r.value<=1,n(null)},function(t){o=!0,e.lang.setLanguage(n,function(e){t(e)})},function(n){s?(o=!0,t.toggleOffline(!e.offlineEnabled,n)):n()}],l;l=_.select(f,function(e,n){return a[n].call(t)}),l.length?(u&&e.overlay.show("app:sync",{template:"preloader-panel",label:"LBL_LOADING"}),async.series(l,function(t){e.overlay.hide("app:sync"),t||(o&&e.controller.clean(),e.trigger("app:settings:changed"),e.controller.goBack())})):e.controller.goBack()},cancel:function(){e.nomad.setFontSize(e.nomad.getSetting("fontSize")),this.restoreModel()},backupModel:function(){var e=JSON.stringify(this.model.toJSON());this._modelBackup=JSON.parse(e)},restoreModel:function(){e.user.set("preferences",this._modelBackup)},toggleOffline:function(t,n){var r=this;if(t&&!e.nomad.isOnline())return this.showOfflineConnectionError(n),!1;e.logger.debug("Offline enabled: "+t),this.toggleOfflineUserSetting(t),t?(e.events.once("offline:enabled",_.bind(this.onOfflineEnabled,this)),e.events.once("offline:failure",_.bind(this.onOfflineFailure,this)),e.offline.start({callback:function(){e.events.off("offline:enabled",r.onOfflineEnabled),e.events.off("offline:failure",r.onOfflineFailure),n()}})):(e.nomad.setSetting(e.nomad.recordsPreloaderPromptKey,!1),this.stopOffline(n))},showOfflineConnectionError:function(t){t=t||function(){};var n="offline_enable_error";e.alert.show(n,{level:"error",messages:e.lang.get("ERR_OFFLINE_NO_CONNECTION_ENABLE_ERROR"),autoClose:!0}),t(n)},onOfflineEnabled:function(){var t=function(){_.delay(function(){e.overlay.hide("app:sync")},300)};e.nomad.startRecordsPreloader(t)},onOfflineFailure:function(t){this.toggleOfflineUserSetting(!1);if(!t.err)return;t.err.status===0&&_.contains(["error","abort","timeout"],t.err.textStatus)&&(e.alert.dismiss("offline_error"),this.showOfflineConnectionError()),this.stopOffline()},toggleOfflineUserSetting:function(t){e.offline.userEnabled=t,e.nomad.setSetting("offlineEnabled",t)},stopOffline:function(t){t=t||function(){};var n=[_.bind(e.nomad.dashboards.cleanDashletsCache,e.nomad.dashboards),function(t){e.offline.stop({dropDb:!0,callback:t})}];async.parallel(n,t)},_showOfflineToggleConfirm:function(t,n){var r=t?"LBL_OFFLINE_ENABLE_PROMPT":"LBL_OFFLINE_DISABLE_PROMPT";e.nomad.showConfirm(e.lang.get(r),function(e){n(e===2)})},setFontSize:function(){var t=this.model.get("fontSize");e.nomad.setFontSize(t)}})}(SUGAR.App),function(e){e.view.views.OfflineView=e.view.NomadView.extend({_devMode:e.config.offline.debug.render,globalEvents:{"offline:status:update":"onOfflineStatusUpdated"},events:{"click #preload_records_button":"onPreloadRecordsClick","click #preload_relationships_button":"onPreloadRelationshipsClick"},offlineStatusIconPartial:"offline-status-icon",initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t)},render:function(t){this.offlineStatusClass=e.nomad.utils.getOfflineStatusClass(),this.offlineMessage=this.getOfflineMessage(),e.view.NomadView.prototype.render.call(this,t)},onOfflineStatusUpdated:function(){var t=this.$el.find(".offline-icon"),n=this.$el.find("#offline-message");t.removeClass("status-success status-warning status-error status-default"),t.addClass(e.nomad.utils.getOfflineStatusClass()),n.html(this.getOfflineMessage())},onPreloadRecordsClick:function(){e.nomad.promptAndPreloadUserRecords(!1)},onPreloadRelationshipsClick:function(){e.nomad.promptAndPreloadUserRecords(!1,!0)},getHeaderData:function(){return{title:e.lang.get("LNK_OFFLINE_SETTINGS"),cube:!0,back:!0}},getOfflineMessage:function(){var t=e.offline.status,n="",r="",i="LBL_OFFLINE_STATUS_ONLINE",s="LBL_OFFLINE_STATUS_NO_PENDING_TX",o="ERR_OFFLINE_OUT_OF_SPACE";return t?(t.isSyncing?r="LBL_OFFLINE_SYNC_IN_PROGRESS":t.lastSyncTs&&t.totalTransactions>0&&(n=e.lang.get("LBL_OFFLINE_LAST_SYNC_TS",null,{ts:t.lastSyncTs.toLocaleString()})),e.offline.isOnline()?t.noConnection&&(i="LBL_OFFLINE_STATUS_BAD_NETWORK"):i="LBL_OFFLINE_STATUS_OFFLINE",t.state===e.offline.STATE.ERROR?s="LBL_OFFLINE_STATUS_SYNC_FAILED":t.state===e.offline.STATE.WARNING&&t.totalTransactions>0&&(s="LBL_OFFLINE_STATUS_PENDING_TX"),e.lang.get(s)+" "+(t.isOutOfSpace?e.lang.get(o)+" ":"")+e.lang.get(i)+" "+e.lang.get(r)+" "+n):"..."}})}(SUGAR.App),function(e){e.view.views.OfflineSettingsView=e.view.NomadView.extend({events:{"touchstart .offline-property input":"onPropTouchstart"},onBeforeRender:function(){var t=e.config.offline.debug;this.configProperties={online:t.online,forceMigrate:t.forceMigrate,syncManagerEnabled:t.syncManagerEnabled,monitorStatus:t.monitorStatus,outOfSpace:t.outOfSpace}},getHeaderData:function(){return{title:e.lang.get("LBL_OFFLINE_SETTINGS"),cube:!0,back:!0}},onPropTouchstart:function(t){var n=$(t.target).attr("class");e.config.offline.debug[n]=!e.config.offline.debug[n]}})}(SUGAR.App),function(e){e.view.views.OfflineStatsView=e.view.NomadView.extend({events:{"click #compactDbButton":"onCompactDbClick","click #clearDbButton":"onClearDbClick"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.getStatsAndRender()},getStatsAndRender:function(){var t=this;e.offline.storage.getStats({success:function(n){function i(t){e.acl.hasAccess("access",t)&&r.push({moduleName:e.nomad.getPluralModuleName(t),module:t,count:n.count[t]})}var r=[],s=e.metadata.getModuleNames({filter:"enabled"});s=_.filter(s,function(t){return!_.contains(e.config.offline.exclude,t)}),_.each(s,i),s=_.difference(_.keys(n.count),s),_.each(s,i),n.count=r,n.totalRecordsCount=_.reduce(n.count,function(e,t){return _.isNumber(t.count)&&(e+=t.count),e},0),t.dbStats=n,t.render()}})},getHeaderData:function(){return{title:e.lang.get("LBL_OFFLINE_STATS"),cube:!0,back:!0}},onCompactDbClick:function(){var t=this;e.nomad.showConfirm(e.lang.get("LBL_OFFLINE_CLEAN_UP_PROMPT"),function(n){if(n===2){var r="db_cleanup";e.nomad.dismissAlerts(),e.overlay.show(r),e.alert.show(r,{level:"info",messages:e.lang.get("LBL_OFFLINE_DB_CLEANING_IN_PROGRESS"),autoClose:!1,closable:!1}),e.offline.compactStorage({callback:function(n){e.overlay.hide(r),e.alert.dismiss(r),n?e.alert.show(r,{level:"error",messages:e.lang.get("ERR_OFFLINE_DB_CLEANING_ERROR"),autoClose:!0,closable:!0}):e.alert.show(r,{level:"success",messages:e.lang.get("LBL_OFFLINE_DB_CLEANING_COMPLETED"),autoClose:!0,closable:!0}),e.controller.clean(),t.getStatsAndRender()}})}})},onClearDbClick:function(){var t=this;e.nomad.showConfirm(e.lang.get("LBL_OFFLINE_CLEAR_DB_PROMPT"),function(n){if(n===2){var r="db_cleanup";e.nomad.dismissAlerts(),e.overlay.show(r),e.alert.show(r,{level:"info",messages:e.lang.get("LBL_OFFLINE_DB_CLEANING_IN_PROGRESS"),autoClose:!1,closable:!1}),e.offline.clearStorage({callback:function(n){e.overlay.hide(r),e.alert.dismiss(r),n?e.alert.show(r,{level:"error",messages:e.lang.get("ERR_OFFLINE_DB_CLEANING_ERROR"),autoClose:!0,closable:!0}):e.alert.show(r,{level:"success",messages:e.lang.get("LBL_OFFLINE_DB_CLEANING_COMPLETED"),autoClose:!0,closable:!0}),e.controller.clean(),t.getStatsAndRender()}})}})}})}(SUGAR.App),function(e){e.view.NomadAlertView=e.view.AlertView.extend({initialize:function(e){},close:function(t){t=t||{};var n=this,r=!$.os.android||this.options.level!=="load";r=_.isUndefined(t.animate)?r:t.animate,r?this.$el.animate({minHeight:"0",height:"0",borderTop:"0"},500,"ease",function(){e.view.AlertView.prototype.close.call(n)}):e.view.AlertView.prototype.close.call(n)},getCloseSelector:function(){return this.$el}})}(SUGAR.App),function(e){e.view.views.LoginView=e.view.NomadView.extend({className:"login",privacyLink:e.config.about.privacy,tosLink:e.config.about.tos,appVersion:e.config.appVersion,useHttps:e.config.useHttps,_bodyScroll:!0,events:{"click .about-link":function(){var t=e.context.getContext({module:"About",create:!0,skipFetch:!0}).prepare();e.controller.loadDynamic({layoutDef:{className:"no-main-menu",module:"About",name:"about",appendTo:"root",gaTrack:"about",meta:{components:[{view:"header"},{view:"about"}]},context:t}}),$(document.body).removeClass("show-content-child")},"click #login_btn":"login","click #external_login_btn":"externalLogin","click .legal-link":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)},"keypress input":function(e){e.which===13&&(e.srcElement.blur(),this.login())},"keyup input":"_updateBtnsState","focusout input":"_updateBtnsState","change input":"_updateBtnsState"},plugins:["clear-field","hide-alerts-onfocus"],onAfterShow:function(){_.delay(_.bind(function(){e.overlay.hideAll(),this.disposed||this.$el.animate({opacity:"1"},500,"ease")},this),100)},login:function(){var t={password:this.model.get("password"),username:this.model.get("username")};if(!this.updateButtonAndInfo("#login_btn",t.username))return;var n=this.model.fields;_.isEmpty(this.$("input[type=url]"))&&(n={username:this.model.fields.username,password:this.model.fields.password});var r=this,i=function(){r.reEnableLogin("#login_btn","LBL_LOGIN_BUTTON_TITLE")};this.model.doValidate(n,function(n){if(!n){i();return}e.alert.dismiss("field_validation_error"),e.logger.debug("Username: "+t.username),e.api.setExternalLogin(!1),e.login(t,e.clientInfo,{error:function(e){if(r.disposed)return;e&&e.status>=400&&e.status<=403&&r.model.unset("password"),i()},success:function(){_.delay(function(){i()},500)}})})},externalLogin:function(){if(!this.updateButtonAndInfo("#external_login_btn"))return;var t=this;e.api.setExternalLogin(!0),e.api.ping(null,{complete:function(){t.reEnableLogin("#external_login_btn","LBL_EXTERNAL_LOGIN_BUTTON_TITLE")},error:function(t){t.status===401?e.error.handleExternalLoginNotAvailable():e.error.handleHttpError(t)}})},updateButtonAndInfo:function(t,n){var r=this.$(t);r.focus();if(r.is("[disabled=disabled]"))return!1;e.alert.dismissAll();var i=this.model.get("url"),s=this.$el.find(".checkbox"),o=s.length?s.attr("checked"):e.config.useHttps;return this.$el.find(".btn").attr("disabled","disabled"),r.html('<i class="icon icon-circle-o-notch"></i>'+e.lang.get("LBL_LOADING")),e.overlay.show("login",{spinner:!1}),e.isNative&&(e.config.siteUrl=e.view.views.LoginView.normalizeUrl(i,o),e.api.serverUrl=e.nomad.getServerUrl(),e.logger.debug("Site URL: "+e.config.siteUrl)),e.nomad.setSetting({loginName:n,loginUrl:i,siteUrl:e.config.siteUrl}),!0},reEnableLogin:function(t,n){e.overlay.hide("login");if(this.disposed)return;this.$(t).text(e.lang.get(n)),this._updateBtnsState()},render:function(){var t=e.nomad.getSetting("loginUrl")||e.config.defaultServerUrl;this.model.set({username:e.api.isExternalLogin()?"":e.nomad.getSetting("loginName"),url:t===""?null:t},{silent:!0}),e.view.NomadView.prototype.render.call(this);if(!e.isNative||e.config.hideLoginUrl)this.getField("url").remove(),this.$el.find(".control-ssl").remove();return this._updateBtnsState(),this},_updateBtnsState:function(){e.config.externalLoginEnabled&&this._setSsoBtnState(),this._setLoginBtnState()},_setLoginBtnState:function(){var e=["username","password"],t=0;_.isEmpty(this.$("input[type=url]"))||e.push("url"),_.each(e,function(e){$("input[name="+e+"]").val()&&++t}),e.length===t?this.$("#login_btn").removeAttr("disabled"):this.$("#login_btn").attr("disabled","disabled")},_setSsoBtnState:function(){var t=$("input[name=url]");!e.isNative||t&&t.val()?this.$("#external_login_btn").removeAttr("disabled"):this.$("#external_login_btn").attr("disabled","disabled")}},{normalizeUrl:function(e,t){e=e.trim();var n=/^no-ssl:\/\//.test(e);return!n&&!/^https?:\/\//.test(e)&&(e="http://"+e),t&&!n&&e.indexOf("http://")===0&&(e="https:"+e.substr(5)),e.indexOf("no-ssl://")===0&&(e="http://"+e.substr(9)),e.replace(/\/+$/,"")}})}(SUGAR.App),function(e){e.view.views.ListView=e.view.views.SyncableView.extend({events:{"click  article .grip":"onClickGrip","swipeLeft article":"onSwipeLeftItem","swipeRight article":"onSwipeRightItem","click .list-view-item":"onClickItem","click .cm-item-btn:not(.disabled)":"onClickCMItem","longTap    article":"onLongTapItem"},plugins:["fast-click-highlight","pagination","pulldown-to-refresh","current-record","item-actions"],_offlineDisabled:!1,basicMenuActions:[{name:"view",label:"LBL_VIEW_BUTTON",icon:"icon-eye",isEnabled:function(t){return!e.acl.hasAccessToModel("edit",t)||_.contains(e.config.nonEditableModules,t.module)},action:"onEditItem"},{name:"edit",label:"LBL_EDIT_BUTTON",icon:"icon-pencil",isEnabled:function(t){return e.acl.hasAccessToModel("view",t)&&!_.contains(e.config.nonEditableModules,t.module)},action:"onEditItem"},{name:"follow",label:"LBL_FOLLOW",icon:"icon-check-circle-o",isEnabled:function(t){return e.nomad.canFollow(t)},isFollow:!0,action:"onFollowItem"},{name:"unfollow",label:"LBL_UNFOLLOW",icon:"icon-check-circle",isEnabled:function(t){return e.nomad.canFollow(t)},isFollow:!0,action:"onFollowItem"},{name:"unlink",label:"LBL_UNLINK_BUTTON",icon:"icon-minus-circle",isEnabled:function(e){return this.unlinkVisible&&e.hasUnlinkAccess(this.relateFields,this.relationship)},action:"onUnlinkItem"},{name:"delete",label:"LBL_DELETE_BUTTON",isEnabled:function(e){return!e.link&&e.hasDeleteAccess()},icon:"icon-trash-o",action:"onRemoveItem"},{name:"call",access:"list",label:"LBL_CALL_BUTTON",icon:"icon-phone",isEnabled:function(e){var t=this.modContextData[e.module];if(!t.actions.phone)return!1;var n=e.getAccessibleFields(t.phoneFields);return e.isDataDefined(n)},isMultiple:function(e){var t=e.getAccessibleFields(this.modContextData[e.module].phoneFields),n=e.getFieldsDataArray(t);return n.length>1},action:"onCall",autoClose:!0},{name:"email",access:"list",label:"LBL_EMAIL_BUTTON",icon:"icon-envelope",isEnabled:function(e){var t=this.modContextData[e.module];if(t.actions.email){var n=e.getAccessibleFields(t.emailFields);return e.hasActiveEmail(n)}return!1},isMultiple:function(t){var n=t.getAccessibleFields(this.modContextData[t.module].emailFields),r=t.getFieldsDataArray(n),i=e.nomad.utils.extractAndSortEmails(r);return i.length>1},action:"onEmail",autoClose:!0},{name:"sms",access:"list",label:"LBL_SMS_BUTTON",icon:"icon-comment",isEnabled:function(e){var t=this.modContextData[e.module];if(!t.actions.phone)return!1;var n=e.getAccessibleFields(t.phoneFields);return e.isDataDefined(n)},isMultiple:function(e){var t=e.getAccessibleFields(this.modContextData[e.module].phoneFields),n=e.getFieldsDataArray(t);return n.length>1},action:"onSMS",autoClose:!0},{name:"map",access:"list",label:"LBL_MAP_BUTTON",icon:"icon-map-marker",isEnabled:function(e){var t=this.modContextData[e.module];if(!t.actions.map)return!1;var n=e.getAccessibleFieldsGroups(t.addressFieldsGroups),r=e.getAddresses(n);return _.any(r)},isMultiple:function(e){var t=e.getAccessibleFieldsGroups(this.modContextData[e.module].addressFieldsGroups),n=e.getAddresses(t);return n.length>1},action:"onMap",autoClose:!0},{name:"url",access:"list",label:"LBL_URL_BUTTON",icon:"icon-external-link",isEnabled:function(t){var n=this.modContextData[t.module];if(!n.actions.url)return!1;var r=t.getAccessibleFields(n.urlFields),i=e.view.fields.UrlField.prototype.regexp;return t.isDataDefined(r,i)},isMultiple:function(t){var n=t.getAccessibleFields(this.modContextData[t.module].urlFields),r=t.getFieldsDataArray(n,e.view.fields.UrlField.prototype.regexp);return r.length>1},action:"onURL",autoClose:!0},{name:"file",access:"list",label:"LBL_FILE_BUTTON",icon:"icon-file",isEnabled:function(t){var n=t.getAccessibleFields(this.modContextData[t.module].docFields),r=!_.isEmpty(n)||!_.isEmpty(t.docData)||t._canHaveFiles()||t.canHaveAttachments()||t._canHavePDFs(),i=e.acl.hasAccessToModel("view",t);return r&&i},isMultiple:function(e){return e.docData&&e.docData.length>1},isFile:!0,action:"onViewFile",autoClose:!0}],contextMenuActions:null,isListItemSwippable:!0,globalEvents:{"offline:data:updated":function(e){if(this.collection.query)return;this.isCurrentListUpdated(e)&&this.collection.fetch({add:!0,params:{skipServerSync:!0,serverOffset:e.serverOffset}})}},LIST_VIEW_CONTEXT_MENU:"list_view_context_menu",initialize:function(t){this.setTemplateOption("partials",{"list-item":e.template.get("list-item")}),e.view.views.SyncableView.prototype.initialize.call(this,t),this.activeListItem=null,this.relationshipFields=null,this.unlinkVisible=!1,this.disableListItemClick=!1,this.contextMenuOnSwipeDisabled=this.contextMenuDisabled||t.contextMenuOnSwipeDisabled;var n=this.context.get("link");if(n){var r=this.context.get("parentModule"),i=e.metadata.getModule(r,"fields")[n];this.relationship=e.metadata.getRelationship(i.relationship),this.relateFields=e.data.getRelateFields(r,n),this.unlinkVisible=e.nomad.canUnlinkRelated(r,n)&&_.reduce(this.relateFields,function(e,t){return e&&!t.required},!0),this.initRelationshipFields(r,n)}this.modContextData=e.nomad.contextMeta.list,this.listenTo(this.collection,"data:sync:start",function(e,t){this.onDataSyncStart(e,this.collection,t)}),this.listenTo(this.collection,"sync",this.onDataSyncSuccess),this.listenTo(this.collection,"data:sync:error",this.onDataSyncError);if(this.layout){var s=this.layout.getComponent("header");s&&this.listenTo(s,"app:header:cancel",this.onHeaderCancel)}this.contextMenuActions=[].concat(this.basicMenuActions),this.isListItemSwippable=this.module!=="Activities"&&this.layout&&this.layout.module!=="Dashboards",this.initLabels(),this._initNoRecFoundLabelBehavior()},initLabels:function(){this.labelLoading=e.lang.get("LBL_LOADING"),this.labelNoRecords=e.lang.get("LBL_MOBILE_NO_RECORDS"),this.labelShowMoreTop=e.lang.get("LBL_MOBILE_SHOW_MORE_TOP"),this.labelShowMoreBottom=e.lang.get("LBL_MOBILE_SHOW_MORE"),this.labelServerFetch=e.lang.get("LBL_OFFLINE_SERVER_FETCH")},onBeforeRender:function(){},onAfterRender:function(){this._super("onAfterRender",arguments),_.isEmpty(this.$easyScrollerParent)&&(this.$el.wrap('<div class="easy-scroller-parent"><div class="easy-scroller-holder"></div></div>'),this.$easyScrollerParent=this.$el.closest(".easy-scroller-parent"))},getViewContainer:function(){return this.$easyScrollerParent},refresh:function(e){e.disableGlobalDataAlerts=!0,e.paginate?(delete e.paginate,this.collection.paginate(e)):this.collection.fetch(e)},getHeaderData:function(){var t=this.modulePlural,n=!1;return this.context.get("link")&&(t=e.lang.get("LBL_RELATED_MODULE_PLURAL",this.module,this.modulePlural),n=!0),{title:t,cube:!0,back:n,plus:!0}},onItemAdded:function(t,n,r){this.$el.find(".no-records-found").hide();var i=e.view.getFieldId(),s=Handlebars.helpers.include("list-item",t,this,{hash:this.meta&&this.meta.panels?this.meta.panels[0]:{}});r.addTop?this.$(".items").prepend(s.toString()):this.$(".items").append(s.toString());for(var o=i+1;o<=e.view.getFieldId();++o)this._renderField(this.fields[o])},onItemRemoved:function(e){this.$("#"+this.cid+this.module+e.id).remove()},bindDataChange:function(){this.collection&&(this.collection.on("reset",this.render,this),this.collection.on("add",this.onItemAdded,this),this.collection.on("remove",this.onItemRemoved,this))},getMaxPageSize:function(){return Math.max(e.config.fetchLimit.maxPageSize||20,e.config.maxQueryResult)},onClickGrip:function(e){if(this.disableListItemClick)return this.disableListItemClick=!1,!1;e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget).closest("article");return t.hasClass("active-list-item")?this.hideContextMenu(t,!0):(this.activeListItem&&this.hideContextMenu(this.activeListItem,!0,!!this.activeListItem),this.toggleMenu(t)),!1},onSwipeLeftItem:function(e){if(this.contextMenuOnSwipeDisabled)return;if($.__swipeHelper.swipeOrientation!=="vertical"){var t=$(e.currentTarget);if(this.activeListItem){if(e.currentTarget.id===this.activeListItem.attr("id"))return;this.hideContextMenu(this.activeListItem,!0,!!this.activeListItem)}this.toggleMenu(t)}},onSwipeRightItem:function(e){if(this.contextMenuOnSwipeDisabled)return;var t=this.activeListItem&&this.activeListItem.get(0);e.currentTarget===t&&this.hideContextMenu(null,!0)},toggleMenu:function(t){var n=t.find(".menu-container"),r=t.attr("module")||this.module,i=this._extractId(t.attr("id"),r),s=this.getModel(i,r);if(_.isEmpty(n))return;this.activeListItem=t,s&&(this.initContextMenu(n,s),this.renderContextMenu(n,s),this.listenTo(s,"change",this._refreshContextMenu)),_.delay(function(){n.addClass("on")},0),this.activeListItem.addClass("active-list-item"),e.config.analytics.enabled&&e.analytics.attachAnalytics(n),e.events.trigger("list:item:context:menu:show",!0,this)},initContextMenu:function(e,t){var n=this,r=this.modContextData&&this.modContextData[t.module];this.calculateContextMenuItems(t),r&&this.hasDocAction&&(t.once("docs:ready",function(r){t.docData=r,n.calculateContextMenuItems(t),n.renderContextMenu(e,t)}),t.getDocuments(r.docFields))},renderContextMenu:function(t,n){var r={contextMenuItems:this.contextMenuItems,isEmptyMenu:_.isEmpty(this.contextMenuItems),fileIconDisabled:!n.docsLoading&&!e.nomad.utils.docIsAvailable(n.docData),docsLoading:n.docsLoading,following:n.get("following")},i=e.template.get("context-menu")(r);t.find(".context-menu").remove(),t.append(i)},calculateContextMenuItems:function(t){var n=5,r=t.get("following"),i=[],s=!1;_.each(this.contextMenuActions,function(o){var u=e.acl.hasAccessToModel(o.access||o.name,t),a=u&&o.isEnabled&&o.isEnabled.call(this,t);a&&i.length<n&&(o.name!=="follow"||!r)&&(o.name!=="unfollow"||r)&&(i.push(o),o.isFile&&(s=!0))},this),this.contextMenuItems=i,this.hasDocAction=s},hideContextMenu:function(t,n,r){var i=t||this.activeListItem;if(i){i=$(i);var s=i.attr("module")||this.module,o=this._extractId(i.attr("id"),s),u=this.getModel(o,s),a=i.find(".menu-container");_.delay(function(){a.removeClass("on").find(".context-menu").remove()},n?0:400),i.removeClass("active-list-item"),e.config.analytics.enabled&&e.analytics.detachAnalytics(a),u&&(u.off("docs:ready"),this.stopListening(u,"change",this._refreshContextMenu))}this.activeListItem=null,e.events.trigger("list:item:context:menu:show",!1,this,r)},_refreshContextMenu:function(e){this.renderContextMenu(this.activeListItem.find(".menu-container"),e)},onClickCMItem:function(t){function h(){c.call(n,t,f),!l&&o.autoClose&&n.hideContextMenu()}t.preventDefault(),t.stopPropagation();var n=this,r=$(t.target).closest("article"),i=$(t.currentTarget),s=i.attr("action"),o=_.find(this.contextMenuActions,function(e){return e.name===s}),u=r.attr("module")||this.module,a=this._extractId(r.attr("id"),u),f=this.getModel(a,u),l=_.isFunction(o.isMultiple)&&o.isMultiple.call(n,f),c=o.action&&this[o.action];c?e.events.trigger("list:item:contextmenu:action:execute",h,l):e.nomad.showAlert("Action not implemented"),e.events.trigger("list:item:contextmenu:action:end",this,l,r)},onViewFile:function(t,n){var r=n.docData;if(_.isEmpty(r)){alert(e.lang.get(n.docsLoading?"LBL_LOADING_FILES":"ERR_NO_DOCS"));return}e.nomad.openDoc(n.docData)},onCall:function(t,n){var r=n.getAccessibleFields(this.modContextData[n.module].phoneFields),i=n.getFieldsDataArray(r);e.nomad.callPhone(i,n)},onSMS:function(t,n){var r=n.getAccessibleFields(this.modContextData[n.module].phoneFields),i=n.getFieldsDataArray(r);e.nomad.sendSms(i)},onEmail:function(t,n){var r=n.getAccessibleFields(this.modContextData[n.module].emailFields),i=n.getFieldsDataArray(r),s=e.nomad.utils.extractAndSortEmails(i);_.isEmpty(s)||e.nomad.sendEmail(s)},onURL:function(t,n){var r=n.getAccessibleFields(this.modContextData[n.module].urlFields),i=n.getFieldsDataArray(r,e.view.fields.UrlField.prototype.regexp);e.nomad.openUrl(i)},onMap:function(t,n){var r=n.getAccessibleFieldsGroups(this.modContextData[n.module].addressFieldsGroups),i=n.getAddresses(r);e.nomad.openAddress(i)},onRemoveItem:function(e,t){return this._deleteRecord(e,t)},onUnlinkItem:function(e,t){return this._deleteRecord(e,t,!0)},onFollowItem:function(e,t){var n=$(e.currentTarget).filter(".follow-item, .unfollow-item"),r="."+n.attr("action")+"-item",i=n.siblings(".follow-item, .unfollow-item").not(r),s=t.get("following"),o=this;t.follow(!s,{error:function(){t.set("following",s),o.toggleFollowEl(n,i)}}),this.toggleFollowEl(i,n),this.hideContextMenu()},toggleFollowEl:function(e,t){e.show(),t.hide()},_deleteRecord:function(t,n,r){var i=this,s=e.lang.get(r?"LBL_MOBILE_UNLINK_CONFIRM":"LBL_MOBILE_DELETE_CONFIRM");return i.hideContextMenu(),e.nomad.showConfirm(s,function(e){e===2&&i._deleteRecordAction(n,r)}),!1},_deleteRecordAction:function(e,t){e.destroy({relate:t,wait:!0})},onEditItem:function(t,n){return!t.defaultPrevented&&!t.cancelBubble&&e.controller.navigate(Handlebars.helpers.buildRoute(n,{hash:{link:this.context.get("link"),appendRoot:!0,action:"edit"}})),!1},onDataSyncStart:function(e,t,n){},onDataSyncSuccess:function(e,t,n){this.onDataSyncComplete(n.method,n,null,e)},onDataSyncError:function(e,t,n){this.onDataSyncComplete(e,t,n)},onDataSyncComplete:function(t,n,r){this.activeListItem&&this.hideContextMenu();if(t==="update")return;this.collection.options&&(this.collection.options.disableGlobalDataAlerts=!1);if(r&&r.status===403){var i=e.template.get("list-not-authorized");this.$el.html(i(r))}e.nomad.showDataSyncEndAlert(null,r,t,this.collection.cid)},onClickItem:function(t){if(this.disableListItemClick)return this.disableListItemClick=!1,!1;this.trigger("list:item:clicked");var n=$(t.currentTarget).closest("article");this.activeListItem&&this.activeListItem[0]!==n[0]&&this.activeListItem.find(".menu-container").hasClass("on")&&(this.hideContextMenu(null,null,!0),t.preventDefault());if(!t.defaultPrevented&&!t.cancelBubble&&!$(t.currentTarget).hasClass("active-list-item")){var r=$(t.target).closest("article"),i,s=r.attr("module")||this.module,o=this.getModel(this._extractId($(t.currentTarget).attr("id"),s),s);o&&e.acl.hasAccessToModel("view",o)&&(i=Handlebars.helpers.buildRoute(o,{hash:{link:this.context.get("link"),appendRoot:!0}}),i&&e.controller.navigate("#"+i)),this.activeListItem=null}},getModel:function(e){return this.collection.get(e)},onLongTapItem:function(t){if(this.contextMenuDisabled||this.activeListItem&&this.activeListItem.get(0)===t.currentTarget)return;$.os.android&&(this.disableListItemClick=!0,e.analytics.trackEvent("longTap","c-menu"),this.activeListItem&&this.hideContextMenu(null,!0,!0),this.showContextMenuActionSheet(t))},showContextMenuActionSheet:function(t){this.disableListItemClick=!0;var n=$(t.currentTarget).closest("article"),r=n.attr("module")||this.module,i=this._extractId(n.attr("id"),r),s=this.getModel(i,r),o=[],u=[],a=this,f=s.get("following");this.activeListItem=n,_.each(this.contextMenuActions,function(t){var n=e.acl.hasAccessToModel(t.access||t.name,s),r=t.isEnabled&&t.isEnabled.call(a,s);n&&r&&(t.name!=="follow"||!f)&&(t.name!=="unfollow"||f)&&(o.push(t),u.push(e.lang.get(t.label)))}),u.length>0&&e.nomad._showActionSheet(e.lang.get("LBL_SELECT_ACTION_LABEL"),u,function(i,u){function c(){a[f.action].call(a,t,s),a.activeListItem=null}var f=o[u],l=_.isFunction(f.isMultiple)&&f.isMultiple.call(a,s);a.onCloseContextMenuActionSheet(n),e.events.trigger("list:actionsheet:item:click",c,l);if(e.isNative)return;return l?!1:!0},function(){a.onCloseContextMenuActionSheet(n),a.activeListItem=null}),s.off("docs:ready"),s.on("docs:ready",function(e){s.docData=e}),this.modContextData[s.module]&&s.getDocuments(this.modContextData[s.module].docFields)},onCloseContextMenuActionSheet:function(e){e.removeClass("selected-item"),this.disableListItemClick=!1},loadData:function(t){this.collection.dataFetched=!1,e.view.views.SyncableView.prototype.loadData.apply(this,arguments)},bindViewSyncListener:function(){this.listenTo(this.collection,"sync",this.publishCollectionSyncData)},unbindViewSyncListener:function(){this.stopListening(this.collection,"sync",this.publishCollectionSyncData)},publishCollectionSyncData:function(e,t,n){this.publishSyncData(e.toJSON(),null,n)},getAllSyncableCollections:function(){return[this.collection]},receiveSyncData:function(e,t,n){e&&e.id&&_.each(this.getAllSyncableCollections(),function(r){this.processCollection(r,e,t,n)},this)},processCollection:function(t,n,r,i){var s=t.get(n.id);s&&(r&&r.status===404||!r&&i.method==="delete"?t.remove(s):!r&&!e.nomad.utils.isModelSynchronized(s,n)&&(s.set(n),e.acl.hasAccessToModel("list",s)||t.remove(s)))},_dispose:function(){var t=this.getViewContainer();this.activeListItem=null,this.disableListItemClick=!1,this.stopListening(this.collection,"data:sync:start"),this.stopListening(this.collection,"sync"),this.stopListening(this.collection,"data:sync:error"),this.stopListening(e.events,"offline:server:read");if(this.layout){var n=this.layout.getComponent("header");n&&this.stopListening(n,"app:header:cancel",this.onHeaderCancel)}t&&t.remove(),e.view.views.SyncableView.prototype._dispose.apply(this)},_getRelateSubpanel:function(t){var n=this.module;return _.find(e.nomad.getSubpanels(t),function(e){return e.module===n})},_extractId:function(e,t){var n=new RegExp((t||this.module)+"|"+this.cid,"g");return e?e.replace(n,""):null},isCurrentListUpdated:function(t){var n=t.relationsData,r=this.context.get("parentModule"),i=this.context.get("link");return this.collection instanceof e.BeanCollection?this.collection.cid===t.cid:!1},setOfflineEnabled:function(e){this.collection.offlineReadDisabled=!e},_initNoRecFoundLabelBehavior:function(){e.offline.isUp()?this.listenTo(e.events,"offline:server:read",function(t){var n=this.$(".no-records-found"),r=e.offline.api.SERVER_READ_STATUS;if(!this.isCurrentListUpdated(t.apiOptions))return;switch(t.status){case r.start:n.hide();break;case r.finish:n.toggle(!t.dataUpdated);break;case r.error:n.toggle(!this.collection.length)}},this):(this.listenTo(this.collection,"data:sync:start",_.bind(function(){this.$(".no-records-found").hide()},this)),this.listenTo(this.collection,"sync",_.bind(function(e,t,n){n.method!=="update"&&this.collection.length===0&&this.$(".no-records-found").show()},this)))},getListFields:function(e){return this.modContextData[e].displayListFields}})}(SUGAR.App),function(e){e.view.views.MobileRecentsListView=e.view.views.ListView.extend({onBeforeRender:function(){this.collection.each(function(t){var n=t.attributes._module;t.module=n,t.fields=e.metadata.getModule(n,"fields")}),e.view.views.ListView.prototype.onBeforeRender.apply(this,arguments)},initialize:function(){e.view.views.ListView.prototype.initialize.apply(this,arguments),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-recents")})},getHeaderData:function(){return _.defaults({plus:!0,title:e.lang.get(this.meta.label)},this._super("getHeaderData",arguments))},onItemRemoved:function(e){this.$("#"+this.cid+e.module+e.id).remove()}})}(SUGAR.App),function(e){e.view.views.MobileSearchListView=e.view.views.ListView.extend({initialize:function(t){this._super("initialize",[t]),this.collection.displayModule=!0,this.createViewDefs(e.metadata.getModuleNames({filter:"visible",access:"view"})),this.modContextData=e.nomad.contextMeta.list,this.template=e.template.get("global-search-list"),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-global-search")})},getHeaderData:function(){return _.defaults({title:e.lang.get(this.meta.label)},this._super("getHeaderData",arguments))},onItemRemoved:function(e){this.$("#"+this.cid+e.get("_module")+e.id).remove()}})}(SUGAR.App),function(e){var t=2,n=30,r=8,i=100,s=50,o=e.config.searchDelay,u="@",a="#",f=["name","first_name","last_name"].join();e.view.views.TaggableView=e.view.NomadView.extend({className:"v__taggable",tagListOptionTemplate:Handlebars.compile('<li{{#if noAccess}} class="disabled"{{/if}}><a class="taggable-listItem">{{#if noAccess}}<span class="taggable-status">{{str "LBL_NO_ACCESS_LOWER"}}</span>{{/if}}<div class="label label-module-sm label-{{module}}" {{debug-attributes "attribute" "record_id" id}}>{{moduleIconLabel module}}</div>{{{htmlName}}}</a></li>'),tagShadowTemplate:Handlebars.compile('<span class="sugar_tag {{class}} label-{{module}}">{{text}}</span>'),tagTextTemplate:Handlebars.compile("@[{{module}}:{{id}}:{{name}}]"),_taggableEnabled:!1,_taggableListOpen:!1,_taggableModuleName:null,_taggableModuleList:null,_taggableModelId:null,_searchForTagsTimerId:null,_lastSearch:null,_prevValue:"",_tags:null,_textareaSelector:".taggable",_shadowSelector:".taggable-shadow",_dropdownSelector:".taggable-dropdown",$textarea:null,textarea:null,$shadow:null,$dropdown:null,globalEvents:{"app:header:save":"save"},events:{"input .taggable":"onInput","click .taggable-dropdown li":"onSearchResultClick","click .sugar_tag":function(){this.$textarea.focus()}},initialize:function(){this._super("initialize",arguments),this._tags={},this._taggableModuleList=_.filter(e.metadata.getModuleNames({filter:"visible"}),function(e){return e!=="Employees"&&e!=="Users"}),this.model.link?(this._taggableModuleName=this.model.link.bean.get("parent_type"),this._taggableModelId=this.model.link.bean.get("parent_id")):(this._taggableModuleName=this.model.module,this._taggableModelId=this.model.id),this._resetLastSearch()},dispose:function(){this._abortRequests(!0),this._super("dispose",arguments)},getHeaderData:function(){return{save:!this.options.isReadOnly,saveLabel:"LBL_COMMENT",cancel:!0,btnsLong:!0}},getPost:function(){var t={},n=this.textarea.value,r=0,i=n.length,s,o={},u;t.value="";while(r<i)s=this._tags[r],s?(u={id:s.model.get("id"),module:s.model.get("_module"),name:s.model.get("name")},o[u.id]=u,t.value+=this.tagTextTemplate(u),r+=s.text.length):(t.value+=n[r],++r);return t.tags=_.values(o),t},save:function(){var n=this.getPost(),r=e.nomad.utils.stripLastEmptyStrings(n.value);this.model.set("tags",n.tags,{silent:!0}),this.model.set("value",r),e.controller.goBack()},onAfterRender:function(){this.$shadow=this.$el.find(this._shadowSelector),this.$dropdown=this.$el.find(this._dropdownSelector),this.$textarea=this.$el.find(this._textareaSelector),this.textarea=this.$textarea[0],this.$textarea.focus().scroll(_.bind(this.onScroll,this))},onScroll:_.throttle(function(){var t=this.$textarea.scrollTop();this.$shadow.scrollTop(t)},s),onInput:function(){_.defer(_.bind(function(){if(this.disposed)return;var t,n;this.textarea.value!==this._prevValue&&(this._fixTags(),this._refreshShadow(),t=this._findSearchTerm(),n=t.offset!==-1,!n&&this._taggableEnabled&&(this._closeDropdown(),this._resetLastSearch()),this._taggableEnabled=n,this._abortRequests(!this._taggableEnabled),this._taggableEnabled&&this._searchForTags(t),this._prevValue=this.textarea.value)},this))},onSearchResultClick:function(t){var n=$(t.target).closest("li"),r=n.closest("ul").children("li").index(n),i=this._lastSearch.results.models[r];i.get("has_access")===!1||this._insertSearchResult(i,this._lastSearch.searchTerm)},onDataFetch:function(t,n){this._taggableEnabled&&_.isEqual(this._findSearchTerm(),t)&&(this._lastSearch.searchTerm=t,this._lastSearch.results=n,this._populateTagList(n,t))},_isReferenceOrMention:function(e){return e===u||e===a},_refreshShadow:_.throttle(function(){if(this.disposed)return;var n,r=this.textarea.value,i=0,s=r.length,o="",u=e.nomad.utils.charHtmlEntity;while(i<s)n=this._tags[i],n?(o+=n.html,i+=n.text.length):(o+=u(r[i]),++i);this.$shadow.html(o).trigger("scroll")},i),_findSearchTerm:function(){var r={offset:-1,action:"",term:""},i="",s=0,o=this.textarea.selectionEnd-1,u=n,a=this.textarea.value;if(this.textarea.selectionEnd&&this.textarea.selectionStart===this.textarea.selectionEnd)while(o>=0&&u){if(this._isReferenceOrMention(a[o])){s>=t&&(r.offset=o,r.action=a[o],r.term=i);break}if(a[o]==="\n")break;a[o]!==" "&&(++s,--u),i=a[o]+i,--o}return r},_abortRequests:function(n){var r=!1;this._searchForTagsTimerId&&(window.clearTimeout(this._searchForTagsTimerId),this._searchForTagsTimerId=null),this._lastSearch.referenceCollection.getFetchRequest()&&(this._lastSearch.referenceCollection.abortFetchRequest(),r=!0),this._lastSearch.mentionCollection.getFetchRequest()&&(this._lastSearch.mentionCollection.abortFetchRequest(),r=!0),n&&r&&e.alert.dismiss("data_syncing")},_resetLastSearch:function(){var n={offset:-1,action:"",term:""};this._lastSearch?(this._lastSearch.searchTerm=n,this._lastSearch.results=[]):this._lastSearch={searchTerm:n,results:[],referenceCollection:e.data.createMixedBeanCollection(),mentionCollection:e.data.createBeanCollection("Users")}},_matchLastSearch:function(t){var n=this._lastSearch.searchTerm,r=!1;return n.action===t.action&&n.action===t.action&&n.offset===t.offset&&(n.term.trim()===t.term.trim()||!t.term.trim().indexOf(n.term.trim())&&!this._lastSearch.results.length)&&(r=!0),r},_getUserFilter:function(t){var n=t.term.trim(),r=null,i,s,o;return i=n.match(/([^\s]+)(\s?)(.*)/),i&&(s=i[1].trim(),o=i[3].trim(),r=[{$and:[{status:{$not_equals:"Inactive"}},{$or:[{first_name:{$starts:n}},{last_name:{$starts:n}}]}]}],o&&(r[0].$and[1].$or.push({$and:[{first_name:{$starts:s}},{last_name:{$starts:o}}]}),r[0].$and[1].$or.push({$and:[{first_name:{$starts:o}},{last_name:{$starts:s}}]}))),r},_searchForTags:function(n){this._searchForTagsTimerId=window.setTimeout(_.bind(function(n){this._searchForTagsTimerId=null;if(this.disposed||this._matchLastSearch(n)||!e.nomad.isOnline())return;var i=_.bind(this.onDataFetch,this,n);if(n.action===u){var s=this._getUserFilter(n);s&&(this._lastSearch.mentionCollection.offlineReadDisabled=e.offlineEnabled,this.listenTo(this._lastSearch.mentionCollection,"sync",i),this._lastSearch.mentionCollection.fetch({limit:r,filter:s,params:{has_access_module:this._taggableModuleName,has_access_record:this._taggableModelId}}))}else n.action===a&&(this._lastSearch.referenceCollection.offlineReadDisabled=e.offlineEnabled,this.listenTo(this._lastSearch.referenceCollection,"sync",i),this._lastSearch.referenceCollection.fetch({query:n.term,limit:r,fields:["name"],module_list:this._taggableModuleList,params:{search_fields:f}}))},this,n),o)},_populateTagList:function(e,t){if(!e.length){this._closeDropdown();return}this.$dropdown.empty(),e.each(function(e){var n=e.get("name").replace(new RegExp("("+t.term+")","ig"),function(e,t){return"<strong>"+t+"</strong>"}),r={module:e.get("_module"),id:e.get("id"),name:e.get("name"),htmlName:n,noAccess:e.get("has_access")===!1},i=$(this.tagListOptionTemplate(r));this.$dropdown.append(i)},this),this._taggableListOpen||(this._taggableListOpen=!0,this.$el.addClass("show-dropdown"),document.activeElement.blur(),this.textarea.focus(),this.$dropdown.show())},_closeDropdown:function(){this._taggableListOpen&&(this.$el.removeClass("show-dropdown"),this.$dropdown.empty().hide(),this._taggableListOpen=!1)},_insertSearchResult:function(t,n){var r=this.textarea.value||"",i=r.slice(n.offset,n.offset+n.term.length+1),s,o=t.get("name"),u=this.textarea.selectionStart,a=this.textarea.selectionEnd,f,l,c,h;i===n.action+n.term&&(s=r.slice(0,n.offset)+o+r.slice(n.offset+i.length),this.textarea.value=s,this._fixTags(),this._prevValue=s,this.textarea.focus(),this.textarea.setSelectionRange&&(f=Math.min(u,a),l=Math.max(u,a),f>n.offset&&f<n.offset+i.length||l>n.offset&&l<n.offset+i.length||f<=n.offset&&l>=n.offset+i.length?(c=n.offset+o.length,h=c):l>=n.offset+i.length?(c=u-i.length+o.length,h=a-i.length+o.length):(c=u,h=a),this.textarea.setSelectionRange(c,h)),this._addTag({model:t,offset:n.offset,text:o}),this._refreshShadow()),this._closeDropdown()},_addTag:function(t){var n={text:t.text,module:t.model.get("_module")};n["class"]=n.module==="Users"?"mention":"reference",this._tags[t.offset]=t,this._tags[t.offset].html=this.tagShadowTemplate(n)},_fixTags:function(){var t=this.textarea.value,n=t.length-this._prevValue.length,r,i={};n===-1&&(r=_.find(this._tags,function(e){return e.text.length>1&&t.slice(e.offset,e.offset+e.text.length)!==e.text&&t.slice(e.offset,e.offset+e.text.length-1)===e.text.slice(0,-1)}),r&&(t=t.slice(0,r.offset)+t.slice(r.offset+r.text.length-1),this.textarea.value=t,this.textarea.setSelectionRange(r.offset,r.offset),n=-r.text.length)),_.each(this._tags,function(e){if(t.slice(e.offset,e.offset+e.text.length)!==e.text){if(t.slice(e.offset+n,e.offset+e.text.length+n)!==e.text)return;e.offset+=n}i[e.offset]=e}),this._tags=i}})}(SUGAR.App),function(e){e.view.views.TextareaEditView=e.view.NomadView.extend({editElTag:"textarea",globalEvents:{"app:header:save":"save"},getHeaderData:function(){var e=this.options.editedFieldName;return{title:e,save:!this.options.isReadOnly,saveLabel:"LBL_DONE_BUTTON_LABEL",cancel:!0}},setValue:function(e){var t=this.$(this.editElTag),n=this.context.get("isReadOnly");t.val(e),n&&t.attr("readOnly",n);if(e||n)return;t.attr("tabindex",1e5).attr("name","somename").get(0).focus()},getValue:function(){return this.$(this.editElTag).val()},save:function(){var t=this.getValue(),n=e.nomad.utils.stripLastEmptyStrings(t);this.context.get("parentModel").set(this.context.get("fieldName"),n),e.controller.goBack()}})}(SUGAR.App),function(e){e.view.views.EmailbodyEditView=e.view.views.TextareaEditView.extend({events:{"click .email-body-content a":function(t){t.preventDefault(),t.stopPropagation();var n=t.target.getAttribute("href");e.nomad.openUrl(n)}},getHeaderData:function(){var e=this.options.editedFieldName;return{title:e,save:!1,cancel:!0}}})}(SUGAR.App),function(e){e.view.views.DetailView=e.view.views.RecordView.extend({className:"summary-view",events:{"click .record-action .phone:not(.disabled)":function(){var t=this.model.getAccessibleFields(this.phoneFields),n=this.model.getFieldsDataArray(t);e.nomad.callPhone(n,this.model)},"click .record-action .email:not(.disabled)":function(){var t=this.model.getAccessibleFields(this.emailFields),n=this.model.getFieldsDataArray(t),r=e.nomad.utils.extractAndSortEmails(n);_.isEmpty(r)||e.nomad.sendEmail(r)},"click .record-action .message:not(.disabled)":function(){var t=this.model.getAccessibleFields(this.phoneFields),n=this.model.getFieldsDataArray(t);e.nomad.sendSms(n)},"click .record-action .link:not(.disabled)":function(){var t=this.model.getAccessibleFields(this.urlFields),n=this.model.getFieldsDataArray(t,e.view.fields.UrlField.prototype.regexp);e.nomad.openUrl(n)},"click .record-action .map:not(.disabled)":function(){var t=this.model.getAccessibleFieldsGroups(this.addressFieldsGroups),n=this.model.getAddresses(t);e.nomad.openAddress(n)},"click .record-action .doc:not(.disabled)":function(){_.isEmpty(this.docData)?e.nomad.showAlert(e.lang.get("ERR_NO_DOCS")):e.nomad.openDoc(this.docData)},"click .record-action .emailbody:not(.disabled)":function(){e.nomad.showEmailBody(this.emailbodyFields,this.model)},"click .show-more":"toggleSummaryView"},plugins:["fast-click-highlight"],globalEvents:{"field:image:filechanged":"_onImageFieldFilechanged","offline:data:updated":function(e){if(e.id!==this.model.id)return;if(e.action==="delete"){this.showRecordOverlay(e.data,e.status);return}this.model.fetch({params:{skipServerSync:!0}})}},_afterRenderTasks:{},_docsRequestTimestamp:null,_requestsInProgress:{},initialize:function(t){e.view.views.RecordView.prototype.initialize.call(this,t),this.initLabels();var n,r=[],i=this.context.get("link"),s=999,o=this.module;i&&(r=this.initRelationshipFields(this.context.get("parentModule"),i),r&&r.length>s&&(r.length=s),r||(r=[])),n=e.nomad.contextMeta.detail[this.model.module],this.headerField=n.headerField,this.avatarField=n.avatarField,this.subpanels=n.subpanels,this.subpanels=_.filter(this.subpanels,function(t){return e.acl.hasAccess("list",t.module)}),_.each(this.subpanels,function(t){e.nomad.canCreateRelated(t.module,o,"create",t.context.link)&&(t.canCreate=!0)}),this.hasLinkableSubpanels=n.hasLinkableSubpanels,this.hasCreatableSubpanels=n.hasCreatableSubpanels,this.phoneFields=n.phoneFields,this.emailFields=n.emailFields,this.urlFields=n.urlFields,this.docFields=n.docFields,this.emailbodyFields=n.emailbodyFields,this.otherFields=_.union(r,n.otherFields),this.addressFieldsGroups=n.addressFieldsGroups,this.addressFields=this.getAddressFields(),this.actions=n.actions,this.actions.available=n.actions.available,this.followable=e.nomad.canFollow(this.model),this.model.on("docs:ready",function(e){this.docData=e,this._setDocLoading(!1)},this)},getAddressFields:function(e){return _.map(e||[],function(e,t){return{name:t,type:"address",fields:e,label:"LBL_"+t.toUpperCase().replace(/_C$/,"")}},this)},onDataSyncComplete:function(t,n,r){e.view.views.RecordView.prototype.onDataSyncComplete.apply(this,arguments),e.session.set(this.model.id,this.model.attributes),this._renderActionButtons(),this._requestDocuments()},onLoadData:function(){e.supportedFeatures.bulkApi&&e.nomad.isOnline()&&this.getRelationshipData(_.bind(this._renderSubpanels,this))},receiveSyncData:function(t,n,r){var i=this.layout===e.controller.layoutManager.getRecordLayout(),s,o,u;e.view.views.RecordView.prototype.receiveSyncData.call(this,t),r=r||{},s=r.responseData||{},o=s[r.fileFieldName],this._isModelUpdated&&(o&&(u={},u[r.fileFieldName]=o,this._afterRenderTasks.file=_.bind(this._requestDocuments,this,u)),i&&(this._renderActionButtons(),this._requestDocuments()))},initLabels:function(){this.labelShowMore=e.lang.get("LBL_MOBILE_DETAIL_SHOW_MORE"),this.labelShowLess=e.lang.get("LBL_MOBILE_DETAIL_SHOW_LESS")},_renderHtml:function(){this._calculateActionButtons(),e.view.views.RecordView.prototype._renderHtml.call(this)},_renderActionButtons:function(){var t=e.template.get("record-actions"),n=this.$(".record-action");this._calculateActionButtons(),e.config.analytics.enabled&&e.analytics.detachAnalytics(n),n.html(t(this.buttons)),this.$el.find(".bizcard").toggleClass("noactions",!this.buttons.available),e.config.analytics.enabled&&e.analytics.attachAnalytics(n)},_prepareActionButtonsFields:function(){var e=this.model.getAccessibleFields(this.phoneFields),t=this.model.getAccessibleFields(this.emailFields),n=this.model.getAccessibleFields(this.urlFields),r=this.model.getAccessibleFieldsGroups(this.addressFieldsGroups);this.actionButtonsData={phoneFields:e,emailFields:t,urlFields:n,addressFieldsGroups:r,addressFields:this.getAddressFields(r)}},_calculateActionButtons:function(){this._prepareActionButtonsFields();var t=_.clone(this.actions),n=this.model.getAccessibleFields(this.phoneFields),r=this.model.getAccessibleFields(this.emailFields),i=this.model.getAccessibleFields(this.urlFields),s=this.model.getAccessibleFieldsGroups(this.addressFieldsGroups);t.phone&&(t.phone.label="LBL_CALL_BUTTON",t.phone.state=!!this.model.isDataDefined(n)),t.message&&(t.message.label="LBL_SMS_BUTTON",t.message.state=!!this.model.isDataDefined(n)),t.email&&(t.email.state=this.model.hasActiveEmail(r)),t.url&&(t.url.label="LBL_URL_BUTTON",t.url.state=!!this.model.isDataDefined(i,e.view.fields.UrlField.prototype.regexp)),t.map&&(t.map.state=_.any(this.model.getAddresses(s)));if(t.doc){t.doc.label="LBL_FILE_BUTTON";var o=this.model._canHaveFiles(this.model.getAccessibleFields(this.docFields))||this.model._canHavePDFs()||this.model.canHaveAttachments();o?t.doc.state=e.nomad.utils.docIsAvailable(this.docData):delete t.doc}t.emailbody&&(t.emailbody.state=!!this.emailbodyFields),delete t.available,t.available=_.any(t),this.buttons=t},_setDocLoading:function(e){if(!this.actions.doc)return;this.actions.doc.loading=e,this._renderActionButtons()},getHeaderData:function(){var t=this.context.get("link")?e.lang.get("LBL_RELATED_MODULE",this.module,this.moduleSingular):this.moduleSingular,n=!!this.context.get("link"),r=!e.isTablet||e.isTablet&&!n;return{title:t,cube:!0,plus:!0,back:r,hasRels:this.hasLinkableSubpanels,hasCreatableRels:this.hasCreatableSubpanels}},onBeforeRender:function(){e.view.views.RecordView.prototype.onBeforeRender.apply(this,arguments),this.expanded=!1,this.$el.removeClass("bizcard-more"),this.$el.find(".show-more").text(this.labelShowMore)},onAfterRender:function(){e.view.views.RecordView.prototype.onAfterRender.apply(this,arguments);if($.os.ios&&window.ScrollFix)var t=new ScrollFix(this.$el.find(".card").get(0)),n=new ScrollFix(this.$el.find(".scroll").get(0));this._renderActionButtons(),this._performActionsAfterViewRendered()},toggleSummaryView:function(){var e=this.$el.find(".show-more");return this.expanded?(this.$el.removeClass("bizcard-more"),e.text(this.labelShowMore)):(this.$el.addClass("bizcard-more"),e.text(this.labelShowLess)),this._redrawScrollFix(),this.expanded=!this.expanded,!1},_redrawScrollFix:function(){this.el.querySelector(".card").style.display="none",this.el.querySelector(".card").offsetHeight,this.el.querySelector(".card").style.display="block",this.el.querySelector(".scroll").style.display="none",this.el.querySelector(".scroll").offsetHeight,this.el.querySelector(".scroll").style.display="block"},_onImageFieldFilechanged:function(t,n,r){r==="fileselected"?t.prepareFile():r==="preparing"?this._showOverlay():r==="prepared"?this._postFile(t,n):r==="error"&&(this._hideOverlay(),e.alert.show("file_upload_error",{level:"error",messages:arguments[1],autoClose:!0,closeable:!0}),this.render())},_showOverlay:function(){e.overlay.show("uploading_image",{spinner:!1}),e.alert.show("upload_mask",{level:"info",messages:e.lang.get("LBL_MOBILE_UPLOAD_IN_PROGRESS"),autoClose:!1,closeable:!1})},_hideOverlay:function(){e.overlay.hide("uploading_image"),e.alert.dismiss("upload_mask")},_postFile:function(t,n){var r={success:_.bind(function(n){e.alert.show("file_upload_success",{level:"success",messages:e.lang.get("LBL_MOBILE_UPLOAD_SUCCESS"),autoClose:!0,closeable:!0}),this.model.set(t.name,n[t.name].name),this._requestDocuments(),this._hideOverlay()},this),error:_.bind(function(n){e.error.handleHttpError(n),t.render(),this._hideOverlay()},this)};this.model.uploadFile(t.name,n,r,{htmlJsonFormat:!1})},_performActionsAfterViewRendered:function(){_.each(this._afterRenderTasks,function(e,t){e.call(this),delete this._afterRenderTasks[t]},this)},_requestDocuments:function(e){var t=this.model.get("date_modified");this._setDocLoading(!1);if(e||!this._docsRequestTimestamp||this.model._docsUpdated||this._docsRequestTimestamp<t)this._docsRequestTimestamp=t,this.model._docsUpdated=!1,this._setDocLoading(!0),this.model.getDocuments(this.docFields,e)},getRelationshipData:function(t){var n,r,i=this,s;n=_.map(this.subpanels,function(t){return e.nomad.buildBulkRequest({module:this.module,attributes:{id:this.model.id,link:t.context.link},params:{max_num:e.config.fetchLimit.bulkQueryRelatedRecords,fields:"id"}})},this);if(_.isEmpty(n))return;r={success:function(e){t(null,e)},error:function(n){e.logger.debug("Get related records error "+i.module+" : "+n),t(n)},complete:function(e,t){s&&(i._requestsInProgress[s.uid]=null)}},s=e.api.bulk({requests:n},r),s&&(this._requestsInProgress[s.uid]=s.uid)},_renderSubpanels:function(t,n){if(t)return;var r=e.template.get("subpanels"),i=this.$(".subpanels");this.subpanelsWithData=_.map(this.subpanels,function(t,r){var i=n[r];if(i.status===200){var s=i.contents;if(_.isArray(s.records)){var o=s.records.length,u=e.config.fetchLimit.bulkQueryRelatedRecords;t.recordsCount=o,s.next_offset!==-1&&(t.recordsCount=u+"+"),t.isEmpty=!o}}else e.error.isAccessError(i)&&e.events.trigger("app:access:error",_.extend(i,{module:t.module}));return i.status!==200&&(t.recordsCount="!"),t}),i.html(r(this))},_dispose:function(){_.each(this._requestsInProgress,function(t,n){e.api.abortRequest(n)}),e.view.views.RecordView.prototype._dispose.apply(this,arguments)}})}(SUGAR.App),function(e){e.view.views.EditView=e.view.views.RecordView.extend({NOTHING_CHANGED_ERR:"nothing_changed",VALIDATION_ERR:"validation_error",_bodyScroll:!0,events:{"click .delete":"deleteRecord"},plugins:["fast-click-highlight","clear-field","hide-alerts-onfocus","focus-on-input","item-actions"],globalEvents:{"app:header:save":function(e){this.saveRecord()},"app:header:action":"onHeaderAction","field:image:filechanged":"_onImageFieldFilechanged","field:image:fileclear":"_onImageFieldFileclear","offline:data:updated":function(t){if(t.isCollection||t.id!==this.model.id)return;if(t.action==="delete"){this.showRecordOverlay(t.data,t.status);return}if(!this._modelBackup||t.date_modified===this._modelBackup.date_modified)return;var n=e.lang.get("LBL_OFFLINE_MERGE_DATA_CONFIRM"),r=_.pick(this.model.attributes,this._getChangedFields()),i=t.complete;_.isEmpty(r)?this.model.fetch({params:{skipServerSync:!0}}):e.nomad.showConfirm(n,_.bind(function(e){if(e===2){var n=this.model;t.complete=function(){n.set(r),i&&i.apply(this,arguments)}}this.model.fetch(_.extend(t,{params:{skipServerSync:!0}}))},this))}},initialize:function(t){e.view.views.RecordView.prototype.initialize.call(this,t),this._fileUploads={},this._modelBackup=null,this.relateFields=null,this.selectedItem=null;var n=this.context.get("link");if(n){var r=this.context.get("parentModule"),i=e.data.getRelateFields(r,n);this.relateFields=_.isEmpty(i)?null:_.pluck(i,"name"),this.initRelationshipFields(r,n)}if(this.context.isCreate()){var s=e.metadata.getModule(this.module).fields.assigned_user_name;if(s&&s.type==="relate"){var o={};o[s.id_name]=e.user.get("id"),o[s.name]=e.user.get("full_name"),this.model.set(o)}var u=e.metadata.getModule(this.module).fields.team_name;if(u){var a=this.model.get(u.name)||e.user.getPreference("default_teams")||[];a.length||a.push({id:1,name:"Global",primary:!0}),this.model.set(u.name,a)}}this._updateReadOnlyStatus()},_render:function(){this.action=this.context.isCreate()?"create":"edit",this.action==="edit"&&(this._updateReadOnlyStatus(),this.action=this.name=this.isReadOnly?"view":"edit"),e.view.views.RecordView.prototype._render.call(this)},onBeforeRender:function(){e.view.views.RecordView.prototype.onBeforeRender.apply(this,arguments),this.model.off("error:validation"),this.model.on("error:validation",function(){e.alert.show("validation_error",{level:"error",messages:e.lang.get("ERR_MOBILE_VALIDATION"),autoClose:!0})},this)},onAfterRender:function(){function h(t){if(t){n=e.lang.get("LBL_RELATED_RECORD_DEFAULT_NAME",a.module,t);var r=e.metadata.getModule(a.module),i=r?r.fields.name:null,s=i?i.len:null;s&&s<n.length&&(n=n.substr(0,s-3)+"..."),a.model.set("name",n)}}e.view.views.RecordView.prototype.onAfterRender.apply(this,arguments);var t=e.metadata.getStrings("mod_strings")[this.module],n=t?t.LBL_RELATED_RECORD_DEFAULT_NAME:null,r=this.context.isCreate(),i=this.context.get("link"),s=this.context.get("parentModule"),o=this.context.get("parentModel"),u=!1,a=this,f=o&&e.session.get(o.id),l=n&&r&&i&&!this.context.get("dupe")&&this.model&&_.isEmpty(this.model.get("name")),c=r&&i&&e.nomad.isStandardModule(s)&&!o.parentInfoPopulated;o&&!f&&(f=o.dataFetched?o.toJSON():null),l&&(f?h(f.full_name||f.name):u=!0),c&&(f?this._populateParentInfo(f,s,i):u=!0),u&&o&&!f&&o.fetch({success:function(){if(!a.model)return;l&&_.isEmpty(a.model.get("name"))&&h(o.get("full_name")||o.get("name")),c&&(a._populateParentInfo(o.toJSON(),s,i),o.parentInfoPopulated=!0)}})},_populateParentInfo:function(t,n){var r=this.model.fields;(n==="Accounts"||t.account_id)&&r.account_id&&r.account_name&&e.acl.hasAccessToModel("edit",this.model,"account_name")&&this.model.set({account_id:t.account_id||t.id,account_name:t.account_name||t.name})},_updateReadOnlyStatus:function(){this.isReadOnly=!e.acl.hasAccessToModel("edit",this.model)||e.config.nonEditableModules.indexOf(this.model.module)>=0},getHeaderData:function(){var t=this.onlyRelationshipEdit,n=this.context.get("link"),r=this.context.get("create"),i,s;s={save:!0,cancel:!0,cube:!1,otherActions:this.getOtherActions(r)};if(t)i=e.lang.get("LBL_MOBILE_EDIT_REL");else if(r){var o=this.context.get("layoutOptions")&&this.context.get("layoutOptions").isLoggingCall;i=n&&!o?e.lang.get("LBL_CREATE_RELATED",this.module,this.moduleSingular):e.lang.get("LBL_CREATE_MODULE",this.module,this.moduleSingular)}else this.isReadOnly?i=n?e.lang.get("LBL_RELATED_MODULE",this.module,this.moduleSingular):this.moduleSingular:i=n?e.lang.get("LBL_EDIT_RELATED",this.module,this.moduleSingular):e.lang.get("LBL_EDIT",this.module,this.moduleSingular);return s.title=i,s},onDataSyncSuccess:function(t,n,r){e.view.views.RecordView.prototype.onDataSyncSuccess.apply(this,arguments),this._onDataSyncComplete(r.method,t,r)},onDataSyncError:function(t,n,r){e.view.views.RecordView.prototype.onDataSyncError.apply(this,arguments);var i=this;this._onDataSyncComplete(t,this.model,n,r),r.status===409&&e.nomad.showConfirm(e.lang.get("ERR_MOBILE_CONFLICT"),function(t){var n={},s=i.model,o=r.payload.record;o&&(t===2?(_.each(i._getChangedFields(),function(e){n[e]=s.get(e)}),i.backupModel(o),o=e.data.beanModel.merge(o,n,i.module)):i.backupModel(o),s.set(o))})},_onDataSyncComplete:function(t,n,r,i){!this.context.isCreate()&&this.context.isDataFetched()&&(t==="read"&&this.backupModel(),e.config.nonEditableModules.indexOf(this.model.module)===-1&&this.action!==(e.acl.hasAccessToModel("edit",this.model)?"edit":"view")&&this.render(),this.$(".btn.delete").toggleClass("hide",!this.model.hasDeleteAccess()||!!i&&t==="read"))},deleteRecord:function(){var t=this;e.nomad.showConfirm(e.lang.get("LBL_MOBILE_DELETE_CONFIRM"),function(e){e===2&&t.model.destroy({wait:!0})})},saveRecord:function(t){var n=this.context.get("create");this._removeErrorMessages();var r=this.model.get("email");r&&(r=_.filter(r,function(e){return!_.isEmpty(e.email_address)}),this.model.set("email",r));var i=this,s=i.model.cid,o=this._getSavingTasks(t);async.series(o,function(t){e.nomad.hideDataSyncOverlay(t,null,s);if(t===i.VALIDATION_ERR)return;if(t===i.NOTHING_CHANGED_ERR)return e.controller.goBack();t?i._handleSaveError(t):e.trigger("edit:view:save",{model:i.model,parentModel:{id:i.context.get("parentModelId"),module:i.context.get("parentModule")},isCreate:n}),e.nomad.showDataSyncEndAlert(e.lang.get("LBL_SAVED"),t,n?"create":"update",s)})},_handleSaveError:function(t){t.isFileUploadError&&e.error.handleHttpError(t)},_getSavingTasks:function(e){var t,n=this.getFieldNames(!0),r=this.context.get("dupe")?_.keys(this.model.attributes):this._getChangedFields(n),i=this;return e=e||[],(this._sendParentId||_.include(r,"parent_id"))&&e.push("parent_id","parent_type","parent_name"),r=_.isEmpty(r)?null:_.union(r,e),t=[function(t){i._validateRecord(t,r,n)},function(t){i._saveRecord(t,i._omitFileFields(r))}],_.each(this._fileUploads,function(e){t.push(_.bind(e,this))},this),t},_beforeValidateAndSave:function(){},_validateRecord:function(t,n,r){var i={},s=e.metadata.getModule(this.module).fields,o=_.filter(r,function(e){var t={};return _.each(this.fields,function(n){n.name===e&&(t=n)},this),!!s[e]&&t.action!=="disabled"},this);e.nomad.showDataSyncOverlay(this.model.cid),this._beforeValidateAndSave(),_.each(o,function(e){var t=s[e],n=this.getField(e);n&&(t=n.def);if(t.type==="address")_.each(t.fieldNames,function(e){i[e]=s[e]});else if(t.required||!t.calculated||!t.enforced)i[t.name]=t},this),this.context.get("dupe")&&_.each(i,function(t,n){e.acl.hasAccessToModel("edit",this.model,n)||delete i[n]},this);var u=this;this.model.doValidate(i,function(e){e?_.isEmpty(n)?t(u.NOTHING_CHANGED_ERR):t(null):t(u.VALIDATION_ERR)})},_shouldUpdateNameAndFullname:function(t){var n=e.metadata.getModule(this.model.module).fields,r=n.name,i=n.full_name,s="last_name";return _.intersection(t,["first_name","last_name","salutation","title"]).length===0?!1:r&&i&&r.group===s&&i.group===s},_saveRecord:function(t,n){var r=e.metadata.getModule(this.module).fields.name;if(e.offlineEnabled&&_.intersection(n,r.fields).length!==0)if(this._shouldUpdateNameAndFullname(n)){var i=e.utils.formatNameModel(this.model.module,this.model.attributes);this.model.set("full_name",i),this.model.set("name",i),n.push("full_name"),n.push("name")}else{var s=r.fields[0];this.model.set("name",this.model.get(s)),n.push("name")}e.nomad.showDataSyncStartAlert(e.lang.get("LBL_SAVING"),this.model.cid),_.isEmpty(n)?t():this.model.save(null,{relate:!this._viaParent&&!!this.context.get("link"),disableGlobalDataAlerts:!0,fields:n,modelBackup:this._modelBackup,viewed:!0,success:function(){t()},error:function(e){t(e)}})},onHeaderAction:function(e){this.headerActions&&this.headerActions[e]&&this.headerActions[e].fn.call(this)},getOtherActions:function(e){var t=[];return this.headerActions&&!this.isReadOnly&&_.each(this.headerActions,function(n,r){var i=n.isEnabled(this.model);i&&(!e||n.showOnCreate)&&(n.name=r,t.push(n))},this),t.length?t:!1},_removeErrorMessages:function(){this.$(".controls").find(".error-display").remove(),this.$(".control-group").removeClass("error")},backupModel:function(t){this._modelBackup=e.utils.deepCopy(t||this.model.attributes),this.context.set("_modelBackup",this._modelBackup)},restoreModel:function(){this.model.set(this.model.getChangeDiff(this._modelBackup))},receiveSyncData:function(e){},_getChangedFields:function(){return _.keys(this.model.getChangeDiff(this._modelBackup))||[]},_omitFileFields:function(t){var n=_.filter(e.metadata.getModule(this.module).fields,function(e){return e.type==="image"||e.type==="file"}).map(function(e){return e.name});return _.difference(t,n)},_onImageFieldFilechanged:function(t,n,r){var i=this;if(r==="fileselected")this._showOverlay(t.type),t.prepareFile();else if(r==="prepared"){this._hideOverlay(),this._enqueueFileHandler("create",t,n);var s=n.fileData.name;this._setFileFieldValue(t,s),i.model.doValidate([t.name],function(e){e&&t.handleValidationError()})}else r==="error"&&(this._hideOverlay(),e.alert.show("file_upload_error",{level:"error",messages:arguments[1],autoClose:!0,closeable:!0}),this.render())},_setFileFieldValue:function(e,t){this.model.set(e.name,t,{silent:!0}),_.isEmpty(e.def.fields)||_.each(e.def.fields,function(e){this.model.set(e,t,{silent:!0})},this)},_onImageFieldFileclear:function(e){this._enqueueFileHandler("delete",e),this._setFileFieldValue(e,"")},_enqueueFileHandler:function(e,t,n){var r,i=this;r=function(r){var s=i.model.get(t.name),o=n&&n.fileData.name||"",u={success:function(e){i.model.trigger("change:attachment_list"),i.model.trigger("sync",i.model,e,{fileFieldName:t.name}),r()},error:function(e){delete i._fileUploads[t.name],i.model.set(t.name,s),r(e)}};i.model.set(t.name,o),e==="create"?_.defer(function(){i.model.uploadFile(t.name,n,u,{htmlJsonFormat:!1,isCreate:i.context.get("create")})}):i.model.deleteFile(t.name,n,u,{htmlJsonFormat:!1})},this._fileUploads[t.name]=r},_showOverlay:function(t){var n=t==="image"?"LBL_MOBILE_PROCESSING_IMAGE":"LBL_MOBILE_PROCESSING_FILE";e.overlay.show("preparing_image",{spinner:!1}),e.alert.show("upload_mask",{level:"info",messages:e.lang.get(n),autoClose:!1,closeable:!1})},_hideOverlay:function(){e.alert.dismiss("upload_mask"),e.overlay.hide("preparing_image")},_dispose:function(){e.view.views.RecordView.prototype._dispose.apply(this,arguments)}})}(SUGAR.App),function(e){e.view.views.EditRelationshipView=e.view.views.EditView.extend({initialize:function(t){e.view.views.EditView.prototype.initialize.call(this,t),this.template=e.template.get("edit"),this.meta=e.metadata.getView(this.module,"edit"),this.fallbackFieldTemplate="edit",this.onlyRelationshipEdit=!0},saveRecord:function(){e.trigger("edit:view:save")}})}(SUGAR.App),function(e){e.view.views.ListSelectorView=e.view.views.ListView.extend({events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .list-item":"onClickMenuItem"})},disabledPlugins:["fast-click-highlight"],contextMenuDisabled:!0,globalEvents:{"app:header:save":"save"},initialize:function(t){e.view.views.ListView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.meta=e.metadata.getView(this.module,"list"),this.fallbackFieldTemplate="list"},onBeforeRender:function(){this.selected=[],_.each(this.$(".selected-flag:checked"),function(e){var t=this._extractId($(e).closest("article").attr("id"));this.selected.push(t)},this),e.view.views.ListView.prototype.onBeforeRender.call(this)},onAfterRender:function(){_.isEmpty(this.selected)||_.each(this.selected,function(e){this.selectItem(this.$("article[id="+this.cid+this.module+e+"]"))},this),this.selected=[],e.view.views.ListView.prototype.onAfterRender.call(this)},onClickMenuItem:function(e){!e.defaultPrevented&&!e.cancelBubble&&this.selectItem($(e.currentTarget).closest("article"))},selectItem:function(e){e.toggleClass("selected-item");var t=e.hasClass("selected-item");e.find(".selected-flag").prop("checked",t)}})}(SUGAR.App),function(e){e.view.views.ListAssociateView=e.view.views.ListSelectorView.extend({initialize:function(t){e.view.views.ListSelectorView.prototype.initialize.call(this,t),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-associate")}),this.parentModule=this.context.get("parentModule"),this.parentModelId=this.context.get("parentModelId"),this.link=this.context.get("link"),this.parentModel=this.context.get("parentModel")||e.data.createBean(this.parentModule,{id:this.parentModelId}),this.relFieldNames=e.data.getRelationshipFields(this.parentModule,this.link),this.multiselect=e.data.canHaveMany(this.parentModule,this.link),e.logger.debug("Record(s) are to be associated with "+this.parentModel+" via link "+this.link),e.logger.debug("Multiselect: "+this.multiselect),this.initRelationshipFields(this.parentModule,this.link)},onBeforeRender:function(){var t=this.parentModelId,n=this.collection.get(t);n&&this.collection.remove(n,{silent:!0}),e.view.views.ListSelectorView.prototype.onBeforeRender.call(this)},getHeaderData:function(){var t=e.lang.get("LBL_ASSOC",this.module,this.moduleSingular);return{title:t,save:!0,cancel:!0}},refresh:function(t){t=_.extend(t,{relate:!1}),e.view.views.ListSelectorView.prototype.refresh.call(this,t)},loadData:function(){this.collection.fetch({relate:!1})},save:function(){var t=this.$(".selected-flag:checked");t.length===0?e.nomad.showAlert(e.lang.get("ERR_NO_RECORDS_SELECTED"),function(){}):this._save(t)},_save:function(t){var n=this,r;e.nomad.showDataSyncStartAlert(e.lang.get("LBL_SAVING"),n.collection.cid);var i=async.queue(function(e,t){e.relateBean.save(null,{disableGlobalDataAlerts:!0,relate:!0,fields:["id"],success:function(){t()},error:function(e){r=e,t(e)}})},1);i.drain=function(){e.nomad.showDataSyncEndAlert(e.lang.get("LBL_SAVED"),r,"update",n.collection.cid),r||e.trigger("associate:view:save",{model:{module:n.module},parentModel:{id:n.parentModel.get("id"),module:n.parentModule},isCreate:!0})},t.each(function(){var t=n._extractId($(this).closest("article").attr("id"));i.push({relateBean:e.data.createRelatedBean(n.parentModel,t,n.link)})})}})}(SUGAR.App),function(e){e.view.views.ListPickerView=e.view.views.ListView.extend({events:{"click .picker-list-row":"onRowClick"},plugins:["fast-click-highlight","pulldown-to-refresh"],initialize:function(t){this.disablePtr=!0,e.view.views.ListView.prototype.initialize.call(this,t),this.options.templateOptions={},this.data={}},_renderHtml:function(){e.view.NomadView.prototype._renderHtml.apply(this,arguments)},getHeaderData:function(){return{title:e.lang.get("LBL_CHOOSE_LINK"),cancel:!0,plus:!1}},setData:function(e){this.data=e},onRowClick:function(e){var t=$(e.currentTarget).closest(".picker-list-row");t&&this.trigger("row:clicked",t.attr("entity-name"),t.attr("module"))}})}(SUGAR.App),function(e){e.view.views.ListRelateView=e.view.views.ListView.extend({events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .list-item":"onClickMenuItem"})},contextMenuDisabled:!0,initialize:function(t){e.view.views.ListView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.meta=e.metadata.getView(this.module,"list"),this.fallbackFieldTemplate="list",this.setTemplateOption("partials",{"list-item":e.template.get("list-item-relate")})},onClickMenuItem:function(e){if(!e.defaultPrevented&&!e.cancelBubble){var t=this._extractId($(e.target).closest("article").attr("id")),n=this.collection.get(t);this.trigger("menu:item:clicked",n)}},getHeaderData:function(){return{title:e.lang.get("LBL_ASSIGN",this.module,this.moduleSingular),cancel:!0,plus:!1}}})}(SUGAR.App),function(e){e.view.views.ListTeamsetView=e.view.views.ListSelectorView.extend({initialize:function(t){e.view.views.ListSelectorView.prototype.initialize.call(this,t),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-teamset")})},save:function(){var e=[],t=this;this.$(".selected-flag:checked").each(function(){var n=t._extractId($(this).closest("article").attr("id"));e.push(t.collection.get(n))},this),this.trigger("multienum:save:clicked",e)},getHeaderData:function(){return{title:e.lang.get("LBL_MOBILE_SELECT_TEAMS"),cancel:!0,save:!0,saveLabel:"LBL_DONE_BUTTON_LABEL",plus:!1}}})}(SUGAR.App),function(e){e.view.views.ListMultiselectView=e.view.views.ListPickerView.extend({events:function(){return _.extend({},e.view.views.ListPickerView.prototype.events,{"click .picker-list-row":"onRowClick"})},disabledPlugins:["fast-click-highlight"],globalEvents:{"app:header:save":"onClickSave"},initialize:function(t){e.view.views.ListPickerView.prototype.initialize.call(this,t),this.template=e.template.get("list-multiselect")},_renderHtml:function(){e.view.views.ListPickerView.prototype._renderHtml.call(this,this.data)},getHeaderData:function(){return{title:e.lang.get("LBL_CHOOSE_ITEMS"),save:!0,saveLabel:"LBL_DONE_BUTTON_LABEL",cancel:!0,plus:!1}},onRowClick:function(e){this.selectItem($(e.currentTarget).closest("article"))},selectItem:function(e){e.toggleClass("selected-item");var t=e.hasClass("selected-item");e.find(".selected-flag").prop("checked",t)},onClickSave:function(){var e=[];this.$(".selected-flag:checked").each(function(){e.push($(this).attr("key"))}),this.trigger("multienum:save:clicked",e)}})}(SUGAR.App),function(e){e.view.views.ListParentView=e.view.views.ListView.extend({events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .parent-item":"onClickParentItem"})},globalEvents:{"app:header:save":"save"},contextMenuDisabled:!0,initialize:function(t){e.view.views.ListView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.meta=e.metadata.getView(this.module,"list"),this.fallbackFieldTemplate="list",this.setTemplateOption("partials",{"list-item":e.template.get("list-item-parent")})},getHeaderData:function(){return{title:e.lang.get("LBL_ASSIGN",this.module,this.moduleSingular),cancel:!0,plus:!1,save:!1}},onClickParentItem:function(e){this.$selectedItem&&this.toggleItem(this.$selectedItem,!1),!e.defaultPrevented&&!e.cancelBubble&&(this.$selectedItem=$(e.currentTarget).closest("article"),this.toggleItem(this.$selectedItem,!0));var t=this._extractId(this.$selectedItem.attr("id")),n=this.collection.get(t);this.trigger("menu:item:clicked",n)},toggleItem:function(e,t){e[t?"addClass":"removeClass"]("selected-item"),e.find(".selected-flag").prop("checked",t)},save:function(){var t=this.$(".selected-flag:checked");if(t.length===0)e.nomad.showAlert(e.lang.get("ERR_NO_RECORDS_SELECTED"),function(){});else{var n=this._extractId(t.closest("article").attr("id")),r=this.collection.get(n);this.trigger("click:save",r)}},onHeaderCancel:function(){this.trigger("click:cancel")}})}(SUGAR.App),function(e){e.view.views.ListInviteesView=e.view.views.ListSelectorView.extend({disabledPlugins:["fast-click-highlight"],contextMenuDisabled:!0,globalEvents:{"app:header:save":"onClickSave"},onClickSave:function(){var t=[],n=this;this.$(".selected-flag:checked").each(function(){var e=n._extractId($(this).closest("article").attr("id"));t.push(n.collection.get(e))});if(t.length===0){e.nomad.showAlert(e.lang.get("ERR_NO_RECORDS_SELECTED"),function(){});return}this.trigger("save:clicked",t)},getHeaderData:function(){return{title:e.lang.get("LBL_ASSOC",this.module,this.moduleSingular),cancel:!0,save:!0,plus:!1}}})}(SUGAR.App),function(e){var t=e.view.NomadView;e.view.views.MobileCommentsListView=t.extend({events:{"click .comments-more-btn":"_showMoreComments"},plugins:["refresh-timeago","create-post"],globalEvents:{"offline:data:updated":function(e){this.isCurrentCommentsUpdated(e)&&this.collection.fetch({add:!0,params:{skipServerSync:!0,serverOffset:e.serverOffset}})}},_moreCommentsCount:0,initialize:function(n){t.prototype.initialize.call(this,n);var r=this.options.parentModel,i=[];r.get("last_comment").id&&i.push(r.get("last_comment")),this.collection=e.data.createRelatedCollection(r,"comments",i),this.listenTo(this.collection,"sync",this.onDataSyncSuccess),this.listenTo(this.collection,"data:sync:error",this.onDataSyncError),this._updateMoreCommentsCount(this.collection.length),this.template=e.template.get("list-item-comment")},_updateMoreCommentsCount:function(e){this._moreCommentsCount=this.options.parentModel.get("comment_count")-e,this._moreCommentsCount<0&&(this._moreCommentsCount=0)},_showMoreComments:function(e){e.preventDefault(),this.collection.paginate({relate:!0,add:!0})},onDataSyncSuccess:function(){this._updateMoreCommentsCount(this.collection.length),this.render()},onCreateCommentItem:function(t,n){var r=e.data.createRelatedBean(n,e.data.createBean("Comments"),"comments",{parent_id:n.get("id")}),i=this;this.createPost(r,{moduleName:this.module,appendTo:"root",savePost:function(){var t=r.get("value"),n=r.get("tags");t&&e.nomad.utils.executeNextTickWithScreenLock(function(e){r.set("data",{value:t,tags:n},{silent:!0}),r.save(null,{relate:!0,fields:["parent_id","data"],success:function(e){i.collection.unshift(e),i.render()},complete:e})})}})},isCurrentCommentsUpdated:function(e){return e.relationsData&&e.relationsData.relatedModule==="Comments"&&this.options.parentModel.id===e.relationsData.id},onDataSyncError:function(e){}})}(SUGAR.App),function(e){e.view.views.HomeView=e.view.views.ListView.extend({_numReads:0,_fieldsByBucket:{},globalEvents:{"offline:data:updated":function(e){this.scroll&&this.scroll.reflow();if(this.collection.query)return;this.isCurrentListUpdated(e)&&this.layout.loadData({disableGlobalDataAlerts:!0,myItems:this.collection.myItems,params:{skipServerSync:!0},requestParams:e.requestParams})}},events:function(){return _.extend({},e.view.views.ListView.prototype.events,{"click .list-view-item":"onClickItem"})},onDataSyncStart:function(t,n,r){n instanceof e.BeanCollection&&!r.query&&(t==="read"&&!r.byPtr&&this._numReads===0&&e.nomad.showDataSyncStartAlert(e.lang.get("LBL_LOADING"),this.collection.cid,_.extend(r,{disableOverlay:!0})),this._numReads+=1)},initialize:function(){this.fallbackFieldTemplate="list",e.view.views.ListView.prototype.initialize.apply(this,arguments),this.createViewDefs(e.metadata.getModuleNames({filter:"visible",access:"view"})),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-global-search-legacy")})},_renderHtml:function(){this.activityModuleOrder=this.layout.activityBucketsData,e.view.views.ListView.prototype._renderHtml.call(this)},onDataSyncAbort:function(){this._numReads&&(this._numReads-=1)},onDataSyncError:function(e,t,n,r){this.onDataSyncComplete(e,t,n,r)},onDataSyncComplete:function(t,n,r,i){this.hideContextMenu();if(i instanceof e.BeanCollection)if(this.collection.query)this.$(".no-records-found").toggle(!i.length);else{t==="read"&&--this._numReads===0?e.nomad.showDataSyncEndAlert(null,r,t,this.collection.cid):t==="read"&&n.byPtr&&e.nomad.hideDataSyncOverlay(r,t,this.collection.cid);if(e.offlineEnabled&&t==="read"&&!this._isResponseRelevant(n))return!1;this.collection.reset([],{silent:!0}),this.$("#bucket-"+i.bucketName+" .no-records-found").toggle(!i.length),i.isActivityCollection?this._renderActivityStreamBucket(i):this._renderActivityStream();var s=this.layout.currentRequestList.indexOf(i.bucketName);s>-1&&this.layout.currentRequestList.splice(s,1),e.config.analytics.enabled&&(e.analytics.detachAnalytics(this.$el),e.analytics.attachAnalytics(this.$el))}else t==="delete"&&this._refreshActivityData(i.module);this.scroll&&this.scroll.reflow()},_isResponseRelevant:function(e){var t=["favorites","my_items"];return!e.requestParams||_.every(t,function(t){return e.requestParams[t]===e.params[t]})},onItemRemoved:function(e){this.$("#"+this.cid+e.get("_module")+e.id).remove()},getAllSyncableCollections:function(){var e={};return this.layout.moduleCollections&&_.extend(e,this.layout.moduleCollections),this.layout.collection&&_.extend(e,{search:this.layout.collection}),e},bindViewSyncListener:function(){this.listenTo(this.layout,"home:collections:initialized",function(){_.each(this.getAllSyncableCollections(),function(e){this.listenTo(e,"sync",this.publishCollectionSyncData)},this)},this)},unbindViewSyncListener:function(){_.each(this.getAllSyncableCollections(),function(e){this.stopListening(e,"sync",this.publishCollectionSyncData)},this),this.stopListening(this.layout,"home:collections:initialized")},onLongTapItem:function(t){if(!_.isEmpty(this.collection.query))return;e.view.views.ListView.prototype.onLongTapItem.call(this,t)},_refreshActivityData:function(e){var t=this.getCollections(e);for(var n=0;n<t.length;n++)t[n].fetch(t[n].fetchConfig),this.layout.currentRequestList.push(t[n].bucketName)},_renderActivityStream:function(){_.each(this.layout.moduleCollections,function(e){this.collection.favorites===e.favorites&&this.collection.myItems===e.myItems?this._renderActivityStreamBucket(e):(e.fetchConfig.favorites=this.collection.favorites,e.fetchConfig.myItems=e.myItemsOnly||this.collection.myItems,e.fetch(e.fetchConfig),this.layout.currentRequestList.push(e.bucketName))},this)},_renderActivityStreamBucket:function(t){var n=this._fieldsByBucket;n[t.bucketName]&&(_.each(n[t.bucketName],function(e){e.dispose(),delete this.fields[e.sfId]},this),n[t.bucketName]=[]);var r=e.view.getFieldId();this.setTemplateOption("partials",{"list-item":e.template.get("list-item")});var i=e.template.get("bucket-items"),s=this.$("#bucket-items-"+(t.bucketName||t.module));if(s.length===0){var o=e.template.get("bucket"),u={label:t.label||t.module,name:t.bucketName||t.module,labelNoRecords:this.labelNoRecords};this.$("#activity-stream").append(o(u)),s=this.$("#bucket-items-"+(t.bucketName||t.module))}var a={collection:t,view:this,viewDefs:this.viewDefs};s.html(i(a)),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-global-search-legacy")});for(var f=r+1;f<=e.view.getFieldId();++f)this.fields[f]&&this._renderField(this.fields[f]);if(t.models.length===0){var l=this.$("#bucket-"+(t.bucketName||t.module));l.find(".no-records-found").show(),t.displayMore&&l.find("."+(t.bucketName||t.module)+"-more").hide()}},createViewDefs:function(t){var n={};_.each(t,function(t){var r=e.metadata.getView(t,"list"),i;r&&(i=e.metadata.getView(t,"list").panels),i&&(n[t]=i[0].fields)}),this.viewDefs=n},getModel:function(t,n){var r=e.view.views.ListView.prototype.getModel.call(this,t,n);if(!r){var i=this.getCollections(n);for(var s=0;s<i.length;s++){r=i[s].get(t);if(r)break}}return r},getCollections:function(e){var t=[];return _.each(this.layout.moduleCollections,function(n){n.module_list.indexOf(e)>-1&&t.push(n)}),t},loadData:function(t){this.collection.dataFetched=!1,e.view.views.SyncableView.prototype.loadData.call(this,t,!1)},onAfterRender:function(){var t=[];_.each(this.layout.moduleCollections,function(e){t.push(_.map(e.models,function(e){return e.id}))});if(t.length){var n=_.intersection.apply(null,t);_.each(n,function(e){var t;_.each(this.layout.moduleCollections,function(n){if(!t)t=n.get(e);else{var r=n.get(e);r&&r.set(_.extend({},r.attributes,t.attributes))}},this)},this)}e.view.views.ListView.prototype.onAfterRender.call(this)},onItemAdded:function(){this.collection.query&&e.view.views.ListView.prototype.onItemAdded.apply(this,arguments)},onFieldCreate:function(e,t){var n=this._fieldsByBucket,r=t.model.collection.bucketName;if(!r)return;_.isArray(n[r])?n[r].push(e):n[r]=[e]},_dispose:function(){this._fieldsByBucket={},e.view.views.ListView.prototype._dispose.call(this)},_disposeFields:function(){this._fieldsByBucket={},e.view.views.ListView.prototype._disposeFields.call(this)},_initNoRecFoundLabelBehavior:function(){if(!e.offline.isUp())return;this.listenTo(e.events,"offline:server:read",function(t){var n=this.$(".no-records-found"),r=e.offline.api.SERVER_READ_STATUS;if(!this.isCurrentListUpdated(t.apiOptions))return;switch(t.status){case r.start:n.hide();break;case r.finish:n.toggle(!t.dataUpdated);break;case r.error:n.toggle(!this.collection.length)}},this)}})}(SUGAR.App),function(e){e.view.views.SearchBoxView=e.view.NomadView.extend({plugins:["clear-field","android-keyboard-tracker"],className:"search-box",touchOutsideEventName:"touchstart.outside",ITEM_TYPE_DELAY:e.config.searchDelay,events:{"textInput .search-query":"onKeyUp","keyup .search-query":"onKeyUp","cut   .search-query":"onCutOrPaste","paste .search-query":"onCutOrPaste","focusin .search-query":"onFocusIn","click .favorites-btn":"onClickFavoritesBtn","click .my-items-btn":"onClickMyItemsBtn"},initialize:function(t){e.view.NomadView.prototype.initialize.call(this,t),this.isHideMyItems=!!t.isHideMyItems,this.timerId=null,this.searchStateFlag=!1,this.$searchBox=null,this._loadSearchState(),$.os.ios&&this.$el.find(".search-query").on("textInput",this.onKeyUp,this)},_renderHtml:function(){this.isHideMyItems=!e.nomad.supportsMyItems(this.module),e.view.NomadView.prototype._renderHtml.call(this),this.$searchBox=this.$(".search-query")},onAfterShow:function(){this.hideProgress()},onKeyUp:function(e){this.searchStateFlag=!0,this._clearTimer();var t=this,n=t.$searchBox.val();this.timerId=window.setTimeout(function(){t.search(n),n===""&&t.focusSearchBox()},this.ITEM_TYPE_DELAY)},onCutOrPaste:function(e){var t=this;window.setTimeout(function(){t.onKeyUp(e)},200)},onFocusIn:function(){this._bindTouchOutside()},onClickFavoritesBtn:function(e){if(this.searchStateFlag)return!1;e.preventDefault();var t=this.context.get("collection");this.fetchByOption($(e.currentTarget),t,"favorites")},onClickMyItemsBtn:function(e){if(this.searchStateFlag)return!1;e.preventDefault();var t=this.context.get("collection");this.fetchByOption($(e.currentTarget),t,"myItems")},resetSearch:function(){this.timerId&&window.clearTimeout(this.timerId)},fetchByOption:function(t,n,r,i){var s=!n[r];i=i||{},this._setOptionState(t,n,r,i,s),i.byPtr=!1,e.offlineEnabled||(i.error=_.bind(function(){this._setOptionState(t,n,r,i,!s),this._onFetchError(r,!s)},this)),n.options=null,n.fetch(i)},loadData:function(){},_setOptionState:function(e,t,n,r,i){this._changeBtnState(e,i),this._saveSearchState(n,i,this.module),r[n]=i,n==="myItems"&&(r.myItems=t.myItemsOnly||i)},_loadSearchState:function(){var e=this.context.get("collection"),t=this._getSearchState(this.module);e.favorites=t.favorites,e.myItems=t.myItems},_getSearchState:function(t){var n=e.nomad.getSetting("searchState");return n?n[t]||{}:{}},_saveSearchState:function(t,n,r){var i=e.nomad.getSetting("searchState");i=i||{},i[r]=i[r]||{},i[r][t]=n,e.nomad.setSetting("searchState",i)},_changeBtnState:function(e,t){e[t?"addClass":"removeClass"]("active")},_onFetchError:function(e,t){},focusSearchBox:function(){this.$searchBox.get(0).focus()},search:function(e){this.trigger("search:text",e),this.showProgress(),this.searchStateFlag=!1},showProgress:function(){this.$el.addClass("in-progress")},hideProgress:function(){this.$el.removeClass("in-progress")},getFieldNames:function(){return[]},_clearTimer:function(){this.timerId&&window.clearTimeout(this.timerId)},_dispose:function(){this._clearTimer(),e.view.NomadView.prototype._dispose.call(this)},onSearchClearClick:function(){this.searchStateFlag=!0;var e=this;this.timerId=window.setTimeout(function(){e.search("")},e.ITEM_TYPE_DELAY)},_bindTouchOutside:function(){var e=this,t=this.$searchBox.get(0);$(document).bind(this.touchOutsideEventName,function(n){n.target!==t&&(document.activeElement.blur(),e._unbindTouchOutside())})},_unbindTouchOutside:function(){$(document).unbind(this.touchOutsideEventName)}})}(SUGAR.App),function(e){e.view.views.MainMenuView=e.view.NomadView.extend({events:{"click #desktop":function(t){t.preventDefault(),e.nomad.openUrl(t.currentTarget.href)},"click .nav li.disabled a":function(e){e.preventDefault(),e.stopPropagation()},'click .nav li:not(.disabled) a:not([target="_blank"])':"onMenuItemClicked",swipe:function(e){e.stopPropagation()}},globalEvents:{"app:settings:changed":function(){this.render()},"offline:status:update":function(t){var n=this.$el.find(".offline-icon");n.removeClass("status-success status-warning status-error status-default"),n.addClass(e.nomad.utils.getOfflineStatusClass())},"app:view:change":function(e){if(e.layoutDef&&e.layoutDef.isDynamic)return;this.highlightActiveMenuItem(e),this.toggleMenu(!1,!0)},"app:orientation:changed":function(){if(!e.isTablet)return;this.toggleMenu(!1,!0)}},plugins:["fast-click-highlight"],offlineStatusIconPartial:"offline-status-icon",_isOpened:!1,initialize:function(t){var n=this,r=$(document.body);this.$contentWrapper=e.$rootEl.find("#wrapper"),e.view.NomadView.prototype.initialize.call(this,t),e.events.register("app:header:picturechanged",this),e.events.register("app:header:home",this),e.events.on("app:header:picturechanged",_.bind(this._loadUserPicture,this),this),e.events.on("app:header:home",function(e,t){this.toggleMenu(!this._isOpened,!1,t)},this),r.on("click.menu swipe.menu",function(){n._isOpened&&n.toggleMenu(!1)}),this._isOpened=r.hasClass("show-menu-left")?!0:!1,e.nomad.mainMenu=this},start:function(){this.render(),this._loadUserPicture()},onMenuItemClicked:function(t){var n=$(t.currentTarget),r=n.attr("data-action")==="tour";e.isTablet||this.toggleMenu(!1);if(r){e.config.skipTutorial=!1,e.tutorial.resetPrefs();var i=e.controller.getScreenContext(),s=i.root==="home"&&!i.module;return s?(this.toggleMenu(!1,!0),e.tutorial.show("home","Home")):e.controller.navigate("#"),!1}this.handleLinkClick(t)},onBeforeRender:function(){e.view.NomadView.prototype.onBeforeRender.call(this),this.buildMenu()},onAfterRender:function(){e.view.NomadView.prototype.onAfterRender.call(this);var t=e.controller.getScreenContext();this.highlightActiveMenuItem(t)},toggleMenu:function(t,n,r){var i=this,s=n||!e.supportedFeatures.menuAnimation?0:200,o=i.$("#moduleList"),u=$(document.body),a;r=r||function(){};var f={contentAnimation:{"-webkit-transform":t?"translate3d(300px, 0, 0)":"translate3d(56px, 0, 0)"},overlayAnimation:{"-webkit-transform":t?"translate3d(300px, 0, 0)":"translate3d(-100%, 0, 0)"}},l={menuAnimation:{"-webkit-transform":t?"translate3d(0, 0, 0)":"translate3d(-100%, 0, 0)"},contentAnimation:{"-webkit-transform":t?"translate3d(86%, 0, 0)":"translate3d(0, 0, 0)"},overlayAnimation:{"-webkit-transform":t?"translate3d(86%, 0, 0)":"translate3d(-100%, 0, 0)"}};a=e.isTablet?f:l;var c=function(){u.toggleClass("show-menu-left",t),i._isOpened=t,e.trigger("app:mainmenu:show",{show:i._isOpened,disableAnimation:n,callback:r,view:i}),r&&r()};this.animateMenu({isShowing:t,data:a,$menu:o,callback:c,duration:s})},animateMenu:function(t){var n=t.data,r=t.isShowing;r&&t.$menu.animate(n.menuAnimation,0),this.$contentWrapper.animate(n.contentAnimation,t.duration,"ease-out",function(){r||t.$menu.animate(n.menuAnimation,0),n.overlayAnimation&&e.$rootEl.find("#content-overlay").animate(n.overlayAnimation,0),t.callback&&t.callback()})},_loadUserPicture:function(t){if(!e.api.isAuthenticated())return;var n=e.api.buildFileURL({field:"picture",module:"Users",id:e.user.get("id")},e.nomad.getFileOptions()),r=new Image,i;t&&(n+="&id="+t,i=!0),this.avatar||(i=!0),r.onload=_.bind(this._applyUserPicture,this,{img:r,url:n}),i?r.src=n:this._applyUserPicture(this.avatar)},_applyUserPicture:function(t){if(this.disposed)return;var n=this.$("#me i"),r={image:t.img,height:n.css("height"),width:n.css("width")};if(t.el){n.replaceWith(t.el);return}e.nomad.utils.sizePicture(r),n.css({backgroundSize:r.sizeProp,backgroundImage:"url("+t.url+")"}).addClass("withPicture"),this.avatar={url:t.url,el:n}},highlightActiveMenuItem:function(e){var t=e.root||e.module||e.parentModule;t==="TxLog"?t="Offline":t==="Dashboards"&&(t+="/"+e.dashboardId),this.$el.find("li").removeClass("current"),this.$el.find("a[href='#"+t+"']").parent("li").addClass("current")},buildMenu:function(){_.extend(this,{items:_.map(e.metadata.getModuleNames({filter:"visible",access:"list"}),function(t){return{url:t,label:e.nomad.getPluralModuleName(t)}}),userName:e.user.get("full_name"),userId:e.user.get("id"),desktopURI:e.nomad.getDesktopUrl(),offlineEnabled:e.offlineEnabled,errorEmulationEnabled:e.nomad.utils.isErrorEmulationEnabled(),offlineStatusIconPartial:this.offlineStatusIconPartial,offlineStatusClass:e.nomad.utils.getOfflineStatusClass(),recentsEnabled:e.supportedFeatures.recents});var t,n=e.nomad.dashboards.getCollection();n&&n.length>0&&(t=n.map(function(t){return{id:t.id,label:e.lang.getAppString(t.get("name"))||t.get("name")}})),_.extend(this,{dashboards:t,dashboardsSupported:e.supportedFeatures.dashboards,activitiesSupported:e.supportedFeatures.activities})},_dispose:function(){e.events.off("app:header:picturechanged",null,this),$(document.body).off("click.menu swipe.menu")}})}(SUGAR.App),function(e){e.view.views.GlobalSearchBoxView=e.view.views.SearchBoxView.extend({initialize:function(t){e.view.views.SearchBoxView.prototype.initialize.call(this,t),this.isGlobalSearch=!0,this.template=e.template.get("search-box"),this.collection.myItems=!0},onClearSearch:function(){e.view.views.SearchBoxView.prototype.onClearSearch.call(this)},onClickFavoritesBtn:function(t){t.preventDefault(),_.isEmpty(this.context.get("collection").query)?_.isEmpty(this.$searchBox.val())&&(_.each(this.layout.moduleCollections,function(e){e.fetchConfig.params={},this.fetchByOption($(t.currentTarget),e,"favorites",e.fetchConfig)},this),this.collection.favorites=!this.collection.favorites):e.view.views.SearchBoxView.prototype.onClickFavoritesBtn.call(this,t)},onClickMyItemsBtn:function(t){t.preventDefault(),_.isEmpty(this.context.get("collection").query)?_.isEmpty(this.$searchBox.val())&&(_.each(this.layout.moduleCollections,function(e){e.fetchConfig.params={},this.fetchByOption($(t.currentTarget),e,"myItems",e.fetchConfig)},this),this.collection.myItems=!this.collection.myItems):e.view.views.SearchBoxView.prototype.onClickMyItemsBtn.call(this,t)},_onFetchError:function(e,t){this.collection&&(this.collection[e]=t)}})}(SUGAR.App),function(e){e.view.views.ActivityEditView=e.view.views.EditView.extend({_populateParentInfo:function(t,n,r){var i=e.acl.hasAccessToModel("edit",this.model,"parent_name"),s=e.acl.hasAccessToModel("edit",this.model,"contact_name"),o=e.metadata.getRelationship(e.metadata.getModule(n,"fields")[r].relationship)||{};o.via_parent_id&&(this._viaParent=!0),n==="Contacts"?(s&&(this.model.set({contact_id:t.id,contact_name:t.full_name||t.name}),this._sendContactId=!0),i&&(this.model.set({parent_id:t.account_id,parent_type:"Accounts",parent_name:t.account_name}),this._sendParentId=!0)):i&&(this.model.set({parent_name:t.name,parent_id:t.id,parent_type:n}),this._sendParentId=!0)},saveRecord:function(t){t=t||[],this._sendContactId&&t.push("contact_id"),e.view.views.EditView.prototype.saveRecord.call(this,t)}})}(SUGAR.App),function(e){e.view.views.MeetingCallEditView=e.view.views.ActivityEditView.extend({onAfterRender:function(){if(this.context.isCreate())this.model.set({send_invites:!1});else{var t=this.getField("invitees");t&&t.$el.hide()}e.view.views.ActivityEditView.prototype.onAfterRender.call(this),this.context.isCreate()&&this.model.fields.duration_hours&&!this.model.has("duration_hours")&&this.model.set({duration_hours:0,duration_minutes:"15"})},saveRecord:function(t){this.model.unset("date_end"),t=t||[],t.push("send_invites"),this.sendInvites=this.model.get("send_invites"),e.view.views.ActivityEditView.prototype.saveRecord.call(this,t)},_saveRecord:function(e,t){t=_.without(t,"invitees"),this._super("_saveRecord",[e,t])},_getSavingTasks:function(t){var n=e.view.views.EditView.prototype._getSavingTasks.call(this,t),r=this,i=this.model.get("invitees");return i&&_.each(i,function(t){n.push(function(n){var i=e.data.createRelatedBean(r.model,t.id,t.link);i.save(null,{relate:!0,disableGlobalDataAlerts:!0,fields:["id"],success:function(){n()},error:function(e){n(e)}})})}),this.sendInvites&&this.context.isCreate()&&n.push(function(e){r.model.set({send_invites:!0},{silent:!0}),r._saveRecord(e,["send_invites"])}),n},_beforeValidateAndSave:function(){this.context.isCreate()&&this.model.unset("send_invites",{silent:!0})},_handleSaveError:function(t){e.view.views.EditView.prototype._handleSaveError.call(this,t),t.isFileUploadError||this.model&&this.model.set({send_invites:this.sendInvites},{silent:!0})}})}(SUGAR.App),function(e){e.view.views.MobileCallsEditView=e.view.views.MeetingCallEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileMeetingsEditView=e.view.views.MeetingCallEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileNotesEditView=e.view.views.ActivityEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileTasksEditView=e.view.views.ActivityEditView.extend({})}(SUGAR.App),function(e){e.view.views.MobileRevenueLineItemsEditView=e.view.views.EditView.extend({onAfterRender:function(){e.view.views.EditView.prototype.onAfterRender.call(this);var t;this.model.link&&(t=this.model.link.bean.id),this.context.isCreate()&&_.isEmpty(this.model.get("opportunity_id"))&&this.model.set("opportunity_id",t)}})}(SUGAR.App),function(e){e.view.views.MobileUsersEditView=e.view.views.EditView.extend({initialize:function(t){e.view.views.EditView.prototype.initialize.apply(this,arguments),this.model.on("change:attachment_list",_.bind(this._onChangeAttachmentList,this))},_onChangeAttachmentList:function(){this.model.hasChanged("picture")&&e.trigger("app:header:picturechanged",this.model.get("picture"))}})}(SUGAR.App),function(e){e.view.views.MobileTxLogListView=e.view.views.ListView.extend({basicMenuActions:[{name:"delete",label:"LBL_ROLLBACK_BUTTON",icon:"icon-trash-o",action:"onRollbackClick",isEnabled:function(){return!0}}],globalEvents:{"offline:tx:delete":"onTxDeleted"},initialize:function(t){e.view.views.ListView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-tx-log")}),this.modContextData=e.nomad.contextMeta.list},onAfterRender:function(){e.view.views.ListView.prototype.onAfterRender.apply(this,arguments),this.toggleNoRecLbl()},getHeaderData:function(){return{title:e.lang.get("LBL_TX_LOG"),cube:!0,back:!0}},onRollbackClick:function(t,n){e.offline.syncManager.isSyncing()?e.nomad.showAlert(e.lang.get("LBL_OFFLINE_SYNC_IN_PROGRESS")):this._rollbackTx(n)},_rollbackTx:function(t){var n=this;e.nomad.showConfirm(e.lang.get("LBL_OFFLINE_ROLLBACK_PROMPT"),function(r){r===2&&e.offline.storage.rollbackTransaction(t.attributes,{},function(r){r?(e.alert.show("rollback_success",{level:"error",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_FAILED"),closeable:!0,autoClose:!0}),e.logger.error(""+r)):(n.collection.remove(n.collection.get(t.id)),e.alert.show("rollback_success",{level:"success",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_SUCCESS"),closeable:!0,autoClose:!0}),e.controller.clean(),e.controller.getScreenContext().modelId&&e.controller.goBack(),n.toggleNoRecLbl())})})},onTxDeleted:function(e){var t=this.collection.where({_tx_uid:e.txOptions.txId})[0];this.collection.remove(t),this.toggleNoRecLbl(),this.scroll.reflow()},toggleNoRecLbl:function(){this.collection.length||this.$(".no-records-found").show()}})}(SUGAR.App),function(e){e.view.views.MobileTxLogDetailView=e.view.NomadView.extend({events:{"click .delete:not(.disabled)":"rollbackRecord"},globalEvents:{"offline:tx:delete":"onTxDeleted"},getHeaderData:function(){var t=e.lang.get("LBL_TX_LOG_DETAIL");return{title:t,cancel:!0}},_render:function(){if(!this.model.get("_tx_action"))return;e.view.NomadView.prototype._render.apply(this,arguments)},onBeforeRender:function(){var t=this.model.get("_tx_bean_module"),n=parseInt(this.model.get("_tx_action"),10),r=e.metadata.getModule(t),i=r||{fields:{}};this.updatedFields=e.utils.deepCopy(this.model.get("_tx_updated_fields"));if(this.updatedFields){var s=this.updatedFields.currency_id,o=this.updatedFields.parent_type;o?o=_.clone(o):this.updatedFields.parent_id&&(this.model.attributes.parent_type=this.model.attributes.bean.parent_type);switch(n){case e.offline.SYNC_ACTIONS.CREATE:case e.offline.SYNC_ACTIONS.UPDATE:var u=this._getViewableFields(t);this.updatedFields=u?_.pick(this.updatedFields,this._getViewableFields(t)):this.updatedFields}e.offline.SYNC_ACTIONS.LINK===n||e.offline.SYNC_ACTIONS.UNLINK===n?this.updatedFields.link=!0:_.each(this.updatedFields,function(n,u){if(u==="my_favorite")n.vname="LBL_ACTION_FAVORITE",delete n.before,n.after=""+n.after;else if(u==="following")e.nomad.canFollow(this.model)?(n.vname="LBL_ACTION_FOLLOW",delete n.before,n.after=""+n.after):delete this.updatedFields.following;else{var a=_.contains(["assigned_user_id","deleted","currency_id"],u)||n.type==="id";if(r&&(!i.fields[u]||!e.config.offline.debug.render&&a)){delete this.updatedFields[u];return}n.vname=i.fields[u]||u,_.extend(n,i.fields[u]);var f={def:i.fields[u]||{type:"varchar",name:u},view:this,model:this.model,module:t};f.def.type==="email"&&(f.def=_.defaults({type:"varchar"},f.def),n.before=_.pluck(n.before,"email_address").join(", "),n.after=_.pluck(n.after,"email_address").join(", "));var l=e.view.createField(f),c=e.view.createField(f);if(n.before||n.before===0)l.model.set(u,n.before,{silent:!0}),n.type==="currency"&&s?l.model.set("currency_id",s.before,{silent:!0}):n.type==="parent"&&o&&l.model.set("parent_type",o.before,{silent:!0}),n.before=l.render();c.model.set(u,n.after,{silent:!0}),n.type==="currency"&&s?c.model.set("currency_id",s.after,{silent:!0}):n.type==="parent"&&o&&c.model.set("parent_type",o.after,{silent:!0}),n.after=c.render()}},this)}this.fields={},e.view.NomadView.prototype.onBeforeRender.apply(this,arguments)},_getViewableFields:function(t){var n=e.metadata.getView(t,"edit");return n?_.reduce(n.panels,function(e,t){var n=[];return _.each(t.fields,function(e){e.fields?n.push.apply(n,_.pluck(e.fields,"name")):n.push(e.name)}),_.union(e,n)},[]):null},onAfterRender:function(){e.view.NomadView.prototype.onAfterRender.apply(this,arguments),_.each(this.updatedFields,function(e,t){if(t==="my_favorite"||t==="following"||!e)return;e.before&&(e.before.dispose(),e.before=null),e.after&&(e.after.dispose(),e.after=null)},this)},_rollbackTx:function(){var t=this;e.nomad.showConfirm(e.lang.get("LBL_OFFLINE_ROLLBACK_PROMPT"),function(n){n===2&&e.offline.storage.rollbackTransaction(t.model.attributes,{},function(n){n?(e.alert.show("rollback_success",{level:"error",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_FAILED"),closeable:!0,autoClose:!0}),e.logger.error(""+n)):(t.collection.remove(t.collection.get(t.model.id)),e.alert.show("rollback_success",{level:"success",messages:e.lang.get("LBL_OFFLINE_ROLLBACK_SUCCESS"),closeable:!0,autoClose:!0}),e.controller.clean(),e.controller.goBack())})})},rollbackRecord:function(t,n){e.offline.syncManager.isSyncing()?e.nomad.showAlert(e.lang.get("LBL_OFFLINE_SYNC_IN_PROGRESS")):this._rollbackTx()},onTxDeleted:function(t){t.txOptions.txId===this.model.get("_tx_uid")&&this.$el.find(".btn.delete").addClass("disabled").html(e.lang.get("LBL_OFFLINE_TRANSACTION_SYNCED"))}})}(SUGAR.App),function(e){e.view.views.MobileReadonlyListView=e.view.views.MobileTeamsListView=e.view.views.ListView.extend({basicMenuActions:[],events:{},initialize:function(t){t.meta=e.metadata.getView(t.module,"list"),e.view.NomadView.prototype.initialize.call(this,t),this.template=e.template.get("list"),this.setTemplateOption("partials",{"list-item":e.template.get("list-item-relate")}),this.modContextData=e.nomad.contextMeta.list},getHeaderData:function(){var t=e.view.views.ListView.prototype.getHeaderData.call(this);return delete t.plus,t}})}(SUGAR.App),function(e){e.view.views.ErrorView=e.view.NomadView.extend({className:"list-layout",events:{"click #sugar_url":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)}},errors:{403:"ERR_MOBILE_NOT_AUTHORIZED"},defaultErrorLabel:"ERR_GENERIC_TITLE",onBeforeRender:function(){this.context.get("backToSugar")&&(this.showSugarBackLink=!0,this.sugarLink=e.nomad.getDesktopUrl()+"#"+this.context.get("sugarRoute")),this.errorCode=this.context.get("code"),this.errorLabel=this.errors[this.errorCode]||this.defaultErrorLabel},getHeaderData:function(){return{title:e.lang.get("ERR_GENERIC_TITLE"),cube:!0}}})}(SUGAR.App),function(e){e.view.views.DashboardView=e.view.NomadView.extend({events:{"click .prev":"previous","click .next":"next","click .dashlets__list .dashlet__item":"_onDashletItemClick","swipeRight .pagination__bar":"previous","swipeLeft .pagination__bar":"next","swipeRight .dashlets__slider":"onSwipeDashlet","swipeLeft .dashlets__slider":"onSwipeDashlet"},globalEvents:{"app:orientation:changed":"_onOrientationChange"},plugins:["fast-click-highlight"],_dashlets:[],_dashletTabs:{},_primaryDashletId:null,_$dashboard:null,_cleaned:null,initialize:function(t){this._super("initialize",[t]),e.events.on("offline:data:updated",function(e){this.isCurrentDashboardUpdated(e.id)&&this.model.fetch({params:{skipServerSync:!0}})},this),this.startDashboard()},startDashboard:function(){this.model&&this.model.get("metadata")&&this.start()},_getDashboardName:function(){var t=this.model.get("name");return t?e.lang.get(t)||t:null},isCurrentDashboardUpdated:function(e){return this.model.id===e},dispose:function(){this._super("dispose",arguments),_.each(this._dashlets,function(e){e.view&&e.view.dispose()},this),this._dashlets=null,this._$dashboard=null},start:function(){var e=this,t=this.model.get("metadata");this._dashlets=[],t=t||{},_.each(t.dashlets,function(t,n){var r=e._initDashletView(t,t.id);r.render(),e._dashlets.push({index:n,meta:t,view:r})}),this._cleaned=!1},_initDashletView:function(t,n){var r=t.view.template||t.view.type,i={dashletId:n},s=e.metadata.getView(null,r);return s&&s.tabs&&(r="tabbed-dashlet"),_.extend(i,{name:r,meta:t,module:t.view.module,layout:this.layout,dashboardId:this.model.id}),e.view.createView(i)},onAfterRender:function(){var t=this._dashletWidth;this._super("onAfterRender",arguments),this._$dashboard=this.$el.parent(".layout_Dashboards"),this.setDashletWidth();var n=this.layout.options.def.dashletId?parseInt(this.layout.options.def.dashletId):null;if(n&&!e.nomad.dashboards.isDashletAvailable(this.model.id,n)){var r=e.router.buildRoute("Dashboards",this.model.id);e.routing.replaceRoute(r);return}n?this._primaryDashletId!==n&&(this._primaryDashletId=n,this.layOutDashlets()):this.home(),t!==this._dashletWidth&&this.animateToSlide(this._primaryDashletId,!0)},home:function(){this.trigger("dashlets:changed",[]),this._$dashboard.removeClass("show-slider"),_.each(this._activeDashletsIds,function(e){this.getDashletData(e).view.onBeforeHide()},this),this._activeDashletsIds=null,this._primaryDashletId=null},previous:function(){this.navigateInDirection(!1)},next:function(){this.navigateInDirection(!0)},navigateInDirection:function(e){if(!this._primaryDashletId)return;var t=this.getDashletIds(),n=_.indexOf(t,this._primaryDashletId)+(e?1:-1),r=t[n];if(!r)return;this.navigateToDashlet(r)},onSwipeDashlet:function(e){var t=this.getCurrentDashlet();t&&t.view.isSwipable()&&(e.type==="swipeLeft"?this.next():this.previous())},bindGlobalEvents:function(){this._super("bindGlobalEvents",arguments),this._eachActiveDashlet(function(e){e.view.bindGlobalEvents()})},unbindGlobalEvents:function(){this._super("unbindGlobalEvents",arguments),this._eachActiveDashlet(function(e){e.view.unbindGlobalEvents()})},_eachActiveDashlet:function(e){_.each(this._activeDashletsIds,function(t){e.call(this,this.getDashletData(t))},this)},_onDashletItemClick:function(e){var t=this._getDashletId(e);this.navigateToDashlet(t)},_getDashletId:function(e){return parseInt($(e.currentTarget).data("dashlet-id"),10)},navigateToDashlet:function(t){var n=e.router.buildRoute(this.module,this.model.id,String(t));e.controller.navigate(n,{trigger:!0})},layOutDashlets:function(e){this._cleaned&&this.start(),this._$dashboard.addClass("show-slider");var t=this._primaryDashletId,n=this._activeDashletsIds||[],r=[t];this._activeDashletsIds=r,_.each(this._dashlets,function(e){var t=e.meta.id,i=_.contains(r,t);i?_.contains(n,t)||(e.view.appended||this._appendDashlet(e),e.view.bindGlobalEvents(),e.view.loadData()):e.view.onBeforeHide()},this);var i=_.map(r.sort(),function(e){return this.getDashletData(e)},this);this.trigger("dashlets:changed",i);var s=_.min(r);this.togglePagination(s),this.animateToSlide(s,e)},setDashletWidth:function(){this._dashlets.length&&(this._dashletWidth=this.$el.width(),this.$el.find(".dashlet__b").width(this._dashletWidth))},_appendDashlet:function(e){var t=e.view,n=this.$el.find(".dashlets__slider .dashlet__b[data-dashlet-id='"+e.meta.id+"']");n.append(t.$easyScrollerParent||t.$el),t.appended=!0},togglePagination:function(e){var t=this.$el.find(".icon-circle"),n=this.$el.find(".icon[data-dashlet-id='"+e+"']"),r=this.getDashletIds(),i=parseInt(r.indexOf(e),10);this.$el.find(".prev").toggleClass("disabled",i<=0),this.$el.find(".next").toggleClass("disabled",i>=r.length-1),t.removeClass("icon-circle").addClass("icon-circle-thin"),n.removeClass("icon-circle-thin").addClass("icon-circle")},animateToSlide:function(e,t){var n="translate3d(-"+_.indexOf(this.getDashletIds(),e)*this._dashletWidth+"px, 0px, 0px)",r=t?"none":"all 0.3s ease";$(".dashlets__slider").css({"-webkit-transform":n,transform:n,"-webkit-transition":r,transition:r})},_onOrientationChange:function(){this.setDashletWidth(),this._primaryDashletId&&this.layOutDashlets(!0)},getDashletData:function(e){return _.find(this._dashlets,function(t){return t.meta.id===e})},getDashletIds:function(){return _.chain(this._dashlets).pluck("meta").pluck("id").value()},getCurrentDashlet:function(){return _.find(this._dashlets,function(e){return e.meta.id===this._primaryDashletId},this)},getSupportedDashletsTabsMetas:function(n){if(!this._dashletTabs[n]){var r=e.metadata.getView("Home",n);r?this._dashletTabs[n]=_.select(r.tabs,function(t){return!_.contains(e.config.unsupportedModules,t.module)}):this._dashletTabs[n]=[]}return this._dashletTabs[n]},onDetach:function(){this.unbindGlobalEvents(),this._eachActiveDashlet(function(e){e.view.onDetach()}),this._super("onDetach")},refreshData:function(){this._eachActiveDashlet(function(e){e.view.refreshData()})},clean:function(){_.each(this._dashlets,function(e,t){var n=e.meta.id===this._primaryDashletId;n||e.view.dispose()},this),this._cleaned=!0}})}(SUGAR.App),function(e){e.view.views.BaseDashletView=e.view.NomadView.extend({initialize:function(t){this._super("initialize",[t]),this.meta=t.meta,e.offlineEnabled&&(this.cacheStorage=e.nomad.dashboards.cache.storage),this.dashletParams=e.metadata.getView("Home",this.meta.view.type),this.title=this.getTitle(this.meta.view.label),this.activeRequests=[],this.initDashletOptions()},getLangContext:function(){switch(this.name){case"dashablelist":return{module:this.modulePlural};default:return{}}},getTitle:function(t){return e.lang.get(t,null,this.getLangContext())},dismissNetworkAlerts:function(){e.alert.dismiss("network_error",{animate:!1})},applyViewState:function(e){_.isEmpty(e.filters)||this.viewState.filters.set(e.filters,{silent:!0}),e.visibility&&(this.viewState.visibility=e.visibility,this.viewState.myItemsOnly=e.visibility==="user",this.previousVisibilityState=this.viewState.visibility),this.viewState.filtersDef=e.filtersDef,this.render()},initDashletOptions:function(){var t=this.getState(this.options.dashboardId,this.meta.id)||{};this.viewState={visibility:t.visibility||this.meta.view.visibility},this.viewState.myItemsOnly=this.viewState.visibility==="user",this.dashletOptionsTemplate=e.template.get("dashlet-options"),this.initFilters(t),this.enableOptionsToolbar()},enableOptionsToolbar:function(){this.dashletOptionsEnabled()&&this.$el.addClass("has-dashlet-options")},abortActiveRequests:function(){if(_.isEmpty(this.activeRequests))return;_.each(this.activeRequests,function(t){e.api.abortRequest(t.uid)}),this.activeRequests=[],this.loaded=!1},onBeforeHide:function(){this.unbindGlobalEvents(),this.abortActiveRequests(),e.alert.dismissAll()},onAfterRender:function(){this.dashletOptionsEnabled()&&(this.$el.prepend(this.dashletOptionsTemplate(this)),this.$switcher=this.$(".visibility-switcher"),this.$switcherBtns=this.$switcher.find(".btn"),this.listenTo(this.$switcher,"click",_.bind(this.changeVisibility,this)),e.config.analytics.enabled&&e.analytics.attachAnalytics(this.$(".dashlet-options")),_.isEmpty(this.fields)||this._renderFields())},_dispose:function(){e.config.analytics.enabled&&e.analytics.detachAnalytics(this.$(".dashlet-options")),this._super("_dispose",arguments)},changeVisibility:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target),n=t.data("value"),r="active";n!==this.viewState.visibility&&(this.$switcherBtns.removeClass(r),t.addClass(r),this.viewState.visibility=n,this.refreshData())},initFilters:function(t){this.viewState.filtersDef={},this.viewState.filters=e.data.createBean("Filters"),this.updateFiltersViewState(t),this.listenTo(this.viewState.filters,"change",function(){this.refreshData()})},updateFiltersViewState:function(){},dashletOptionsEnabled:function(){return this.viewState&&(this.viewState.visibility||!_.isEmpty(this.viewState.filtersDef))},loadData:function(){},refreshData:function(e){this.saveState(),this.abortActiveRequests(),this.loadData(e)},saveState:function(){var t=this.getSettingName(),n=e.nomad.getSetting(t)?JSON.parse(e.nomad.getSetting(t)):[],r={visibility:this.viewState.visibility,filters:this.viewState.filters.toJSON(),currentTab:this.viewState.currentTab,dashboardId:this.options.dashboardId,dashletId:this.meta.id},i;_.each(n,function(e,t){r.dashboardId===e.dashboardId&&r.dashletId===e.dashletId&&(n[t]=i=r)}),i||n.push(r),e.nomad.setSetting(t,JSON.stringify(n))},getState:function(t,n){var r=this.getSettingName(),i=e.nomad.getSetting(r),s=i&&JSON.parse(i);if(_.isEmpty(s))return;return _.find(s,function(e){return e.dashboardId===t&&e.dashletId===n})},getSettingName:function(){return"dashlet_states"},apiCall:function(){this.activeRequests.push(e.api.call.apply(e.api,arguments))},isSwipable:function(){return!0},onDetach:function(){this.onBeforeHide(),this._super("onDetach")}})}(SUGAR.App),function(e){e.view.views.BaseChartView=e.view.views.BaseDashletView.extend({className:"chart-wrapper",chart:null,chartData:null,isManager:!1,showManagerData:!1,loaded:!1,responseDataAttr:"data",LATEST_AVAILABLE_WARN_KEY:"LATEST_AVAILABLE_DATA",_chartElSize:null,ERR_NO_DATA_AVAILABLE:"NO_DATA_AVAILABLE",globalEvents:{"app:orientation:changed":function(){this._updateChartElSize(),this._onOrientationChange()}},plugins:["ptr"],initialize:function(t){this._super("initialize",[t]),this.isManager=e.user.get("is_manager")},_updateChartElSize:function(){this.$el&&(this._chartElSize={width:this.$el.width(),height:this.$el.height()}),this._maxLegendRows=e.nomad.getOrientation()==="landscape"&&!e.isTablet?1:4},_onOrientationChange:function(){this.chart&&(this.chart.legend&&this.chart.legend.rowsCount(this._maxLegendRows),this.dispatchChartMethod("tooltipHide"),this.chart.update())},onBeforeRender:function(){this.enableOptionsToolbar(),this._updateChartElSize(),this._super("onBeforeRender",arguments)},renderChart:function(){return this.$(".nv-chart svg").remove(),nv.tooltip.cleanup(),this.chartData.data.length?!0:!1},onAfterRender:function(){this._super("onAfterRender",arguments),this.$chartEl=this.$(".nv-chart"),this.$dataUnavailableLbl=this.$(".data-unavailable-label"),this.$preloader=this.$(".preloader"),this.listenTo(this.$(".nv-chart"),"click",_.bind(function(e){this.dispatchChartMethod("chartClick")},this))},loadData:function(){if(this.loaded){this.chart&&(this.dispatchChartMethod("tooltipHide"),this.chart.update());return}var t=this,n=[_.bind(this.loadChartData,this)];!this._isInitialized&&this.loadInitData&&n.unshift(_.bind(this.loadInitData,this)),async.series(n,function(r,i){t.activeRequests=[],t.trigger("ptr:data:load:complete");if(r){r.request.aborted||t.loadDataError(r);return}var s=_.last(i);if(t.isDataEmpty(s,i)){t.loadDataError(t.ERR_NO_DATA_AVAILABLE);return}t.loadDataSuccess(s,function(n){n&&e.logger.error(n+" Couldn't cache chart data")})})},showLatestAvailableDataWarn:function(t){var n=e.date(t.last_fetched).fromNow();e.alert.show(this.LATEST_AVAILABLE_WARN_KEY,{level:"warning",messages:e.lang.get("LBL_SHOWING_CACHED_DATA",null,{lastFetched:n}),autoClose:!1,closable:!0})},isDataEmpty:function(e,t){return _.isEmpty(e)||(this.responseDataAttr?_.isEmpty(e[this.responseDataAttr]):!1)},showPreloader:function(){this.$chartEl.hide(),this.$preloader.show(),this.$dataUnavailableLbl.hide()},refreshData:function(e){this.loaded=!1,e||this.showPreloader(),this._super("refreshData",arguments)},loadDataSuccess:function(t,n){t.title&&(this.dataTitle=t.title,this.layout.dashboardView.trigger("dashlets:changed",[{meta:this.meta,view:this}])),this.dispatchCacheStorageMethod("set",this.options.dashletId,{chartData:t,filters:this.viewState.filters,filtersDef:this.viewState.filtersDef,visibility:this.viewState.visibility,last_fetched:e.utils.getTimestamp()},n),this.loaded=!0,this.$preloader.hide(),this.$chartEl.show(),this.$dataUnavailableLbl.hide(),this.processData(t)},loadDataError:function(t){this.$preloader.hide();var n=this;if(t===this.ERR_NO_DATA_AVAILABLE){this.$chartEl.hide(),this.$dataUnavailableLbl.show();return}e.error.handleHttpError(t,this.model);if(t.status===412)return;this.dismissNetworkAlerts(),this.dispatchCacheStorageMethod("get",this.options.dashletId,function(t,r){var i=Boolean(!t&&r);n.$chartEl.toggle(i);if(!i){n.$dataUnavailableLbl.show();return}n.showLatestAvailableDataWarn(r),n.applyViewState(r),n.$preloader.hide(),n.processData(r.chartData)})},dispatchCacheStorageMethod:function(e){if(!this.cacheStorage)return e==="get"&&(this.$chartEl.hide(),this.$dataUnavailableLbl.show()),!1;var t=_.toArray(arguments).slice(1);this.cacheStorage[e].apply(this.cacheStorage,t)},processData:function(e){this.prepareChartObject(),this.renderChart()},applyViewState:function(e){this._super("applyViewState",arguments),_.isUndefined(this._isInitialized)||(this._isInitialized=!0)},setFilters:function(e){var t=this.getState(this.options.dashboardId,this.meta.id)||{},n=_.isEmpty(t.filters)?e:t.filters;this.viewState.filters.set(n,{silent:!0})},ptrRefresh:function(){this.refreshData(!0)},isSwipable:function(){return _.isEmpty(this.$chartEl.find(".nv-scroll-wrap").attr("clip-path"))},dispatchChartMethod:function(e){this.chart&&this.chart.dispatch[e]()}})}(SUGAR.App),function(e){var t=e.view.views.BaseDashletView;e.view.views.DashablelistView=e.view.views.BaseDashletView.extend({contextMenuOnSwipeDisabled:!0,_listItemContentTemplates:{"planned-activities":"user-activity-list-item","active-tasks":"user-activity-list-item","inactive-tasks":"user-activity-list-item"},isManager:!0,initialize:function(e){t.prototype.initialize.apply(this,arguments),this.initLists(e)},initLists:function(e){this.listView=this.createList(this.meta.view,e),this.listView.setOfflineEnabled(!1)},render:function(){this.$el.append(this.listView.getViewContainer())},createList:function(t,n){var r=e.view.createView({name:"configurable-list",module:t.module,layout:n.layout,listParams:t,contextMenuOnSwipeDisabled:this.contextMenuOnSwipeDisabled});return this.overrideListView(r),r.render(),r},getListViews:function(){return[this.listView]},getListCollections:function(){return _.pluck(this.getListViews(),"collection")},overrideListView:function(e){_.extend(e,{name:"list",action:"list",listItemContentTemplate:this._listItemContentTemplates[this.meta.view.type]}),e.collection.preserveNomadFilter=!0},abortActiveRequests:function(){var e=this.getListViews();_.each(e,function(e){var t=e.collection;t.getFetchRequest()&&(e.context.resetLoadFlag(),t.abortFetchRequest())},this)},bindGlobalEvents:function(){this._super("bindGlobalEvents",arguments),_.each(this.getListViews(),function(e){e.bindGlobalEvents()})},unbindGlobalEvents:function(){this._super("unbindGlobalEvents",arguments),_.each(this.getListViews(),function(e){e.unbindGlobalEvents()})},loadData:function(t){t=t||{},this.listView.loadData(_.extend(t,{myItems:this.viewState.myItemsOnly,fields:e.metadata.getModule(this.listView.module).mergedFields}))},updateFiltersViewState:function(t){this._super("updateFiltersViewState",arguments);var n=this.dashletParams.filter||[];this.meta.view.date&&n.push({name:"date",type:"radioenum",options:{today:e.utils.capitalize(e.lang.get("LBL_TODAY")),future:e.utils.capitalize(e.lang.get("LBL_FUTURE"))},gaTrack:{today:"click:today",future:"click:future"}}),_.each(n,function(n){var r=this.meta.view[n.name];t.filters&&t.filters[n.name]&&(r=t.filters[n.name]),_.isEmpty(n.options)&&(n.options=e.lang.getAppListStrings(n.options)),_.extend(n,{view:"edit"}),this.viewState.filters.set(n.name,r),this.viewState.filtersDef[n.name]=n},this)},refreshData:function(){var e=this.viewState,t=this.getFilters(),n=_.map(this.getListViews(),function(n,r){return function(){var i={myItems:e.visibility==="user",params:{forceServerSync:!0}};t&&t[r]&&(i.filter=t[r]),n.refresh(i)}});this.saveState(),async.parallel(n,function(e){})},getFilters:function(){},dispose:function(){t.prototype.dispose.apply(this,arguments),_.each(this.getListViews(),function(e){e.dispose()})}})}(SUGAR.App),function(e){e.view.views.ConfigurableListView=e.view.views.ListView.extend({plugins:_.union(e.view.views.ListView.prototype.plugins,["refresh-timeago"]),initialize:function(t){this.listParams=t.listParams,this.listItemContextMenuDisabled=t.listItemContextMenuDisabled;var n=this.getCollection(t.listParams);t=_.extend({},t,{meta:this.calculateListMeta(t.listParams),collection:n,context:e.context.getContext({module:t.listParams.module,collection:n,model:e.data.createBean("Filters"),limit:t.listParams.limit,fields:e.metadata.getModule(t.listParams.module).mergedFields}),template:e.template.getView("list")}),e.view.views.ListView.prototype.initialize.call(this,t)},getCollection:function(t){var n={limit:t.limit},r=e.data.createBeanCollection(t.module,null,n);return this.setFilter(r,t),r.options=n,r},setFilter:function(t,n){var r=n.filter,i=n.filter_id||"assigned_to_me";if(!r){var s=e.metadata.getModule(n.module,"filters");s&&s.basic&&(r=_.find(s.basic.meta.filters,function(e){return e.id===i}))}r?t.filterDef=r.filter_definition||r:t.filterId=i},calculateListMeta:function(t){var n=e.metadata.getModule(t.module,"fields"),r=[];return _.each(t.display_columns,function(e){r.push(n[e])}),{panels:[{fields:r}]}},refresh:function(t){this.collection.resetOptions(),e.view.views.ListView.prototype.refresh.call(this,t)},getFieldNames:function(){return this.listParams.display_columns},loadData:function(t){var n=[],r=this;if(!this.collection.filterDef&&this.collection.filterId){var i=e.data.createBean("Filters",{id:this.collection.filterId});i.offlineReadDisabled=i.skipLoadAlertHiding=!0,n.push(function(t){i.fetch({success:function(e,n){r.collection.filterDef=n.filter_definition,t()},error:function(e){t(e)},disableOverlay:!0})})}async.series(n,function(n,i){n?e.nomad.showAlert(e.lang.get("ERR_SYNC_FAILED")):e.view.views.ListView.prototype.loadData.call(r,t,!1)})},onClickItem:function(t){return $(t.target).closest("a").length||e.view.views.ListView.prototype.onClickItem.apply(this,arguments),!0},getListFields:function(){var t=this.meta.panels[0].fields,n=[];return _.each(t,function(t,r){r>0&&r<=e.config.numberOfAdditionalListFields&&n.push(t)}),n}})}(SUGAR.App),function(e){e.view.views.TabbedDashletView=e.view.views.DashablelistView.extend({className:"tabbed__dashlet",dashletParams:{},_views:[],_currentTabIndex:0,_activeTabClass:"active-tab",_defaultTabStorageKey:"dashboards:dashlets:{0}:default_tab_id",_extraFields:{"planned-activities":["assigned_user_id","assigned_user_name"],"inactive-tasks":["assigned_user_id","assigned_user_name"]},events:{"click .tab":"_onTabClick"},globalEvents:{"app:view:change":function(e){e.dashletId===this.meta.id.toString()&&this._gaHandler()}},initLists:function(){this.dashletParams.tabs=_.select(this.dashletParams.tabs,function(t){return e.nomad.utils.isAccessibleModule(t.module,"list")}),this._views=_.map(this.dashletParams.tabs,function(t,n){var r=e.lang.get(t.label);t.limit=this.meta.view.limit,t.label=_.isString(r)?r:e.nomad.getPluralModuleName(t.module),t.display_columns=_.pluck(e.metadata.getModule(t.module,"views").list.meta.panels[0].fields,"name"),this._extraFields[this.meta.view.type]&&(t.display_columns=_.union(t.display_columns,this._extraFields[this.meta.view.type]));var i=this.createList(t,{layout:this.layout,contextMenuOnSwipeDisabled:this.contextMenuOnSwipeDisabled});return i.tab=t,this._initViewEvents(i),i.setOfflineEnabled(!1),i},this),this._currentTabIndex=this._getDefaultTabIndex(),this.setCurrentTab()},_initViewEvents:function(e){e.listenTo(e.collection,"sync",_.bind(this.onCollectionSyncSuccess,this,e)),e.listenTo(e.collection,"remove",_.bind(this.onCollectionSyncSuccess,this,e))},onCollectionSyncSuccess:function(e){var t=e.collection;t.next_offset===-1||_.isUndefined(t.next_offset)?e.tab.recordsCount=e.collection.length:e.tab.recordsCount=e.collection.length+"+",this._updateTabInfo(e)},_updateTabInfo:function(e){var t;_.find(this.getListViews(),function(n,r){return t=r,n===e});var n=this.$tabs.eq(t).find(".tab-record-count");n.text(e.tab.recordsCount)},_onTabClick:function(e){this._currentTabIndex=parseInt($(e.currentTarget).data("tab-index"),10),this.setCurrentTab(),this.switchTab(),this._gaHandler()},render:function(){e.view.views.BaseDashletView.prototype.render.apply(this,arguments),this.$tabs=this.$(".tabs__bar").find(".tab"),_.each(this.getListViews(),function(e){var t=e.getViewContainer();e.current||t.addClass("hide-container"),this.$el.append(t)},this)},loadData:function(t){var n=this.meta.view,r=this.viewState,i=this.getFilters();t=t||{},_.each(this.getListViews(),function(s,o){var u=s.tab,a;u.order_by&&(a=u.order_by.split(":"),s.collection.orderBy={field:a[0],direction:a[1]}),u.filters=this.adjustFilters(u.filters),s.collection.filterDef=i[o],s.loadData(_.extend({},t,{myItems:r.visibility==="user",limit:n.limit,fields:e.metadata.getModule(u.module).mergedFields}))},this)},adjustFilters:function(e){var t=new Date;return t.setHours(23,59,59),t.toISOString(),e.date_due&&_.each(e.date_due,function(n,r){n==="today"&&(e.date_due[r]=t)}),e},getFilters:function(){this._super("getFilters",arguments);var t=[];return _.each(this.getListViews(),function(n,r){var i=t[r]=[];Array.prototype.push.apply(i,this._getCollectionFilters(n.tab)),_.each(this.viewState.filters.attributes,function(t,r){var s={},o,u=parseInt(t,10);isNaN(u)&&(u=0),o=e.date().subtract("days",u).format("YYYY-MM-DD"),r==="date"&&t==="today"?s[n.tab.filter_applied_to]={$lte:o}:s[n.tab.filter_applied_to]={$gt:o},i.push(s)})},this),t},_getCollectionFilters:function(t){var n=[];return _.each(t.filters,function(e,t){var r={};r[t]=e,n.push(r)}),(t.module==="Meetings"||t.module==="Calls")&&this.viewState.visibility==="user"&&n.push({$or:[{assigned_user_id:e.user.id},{"users.id":e.user.id}]}),n},_getDefaultTabIndex:function(){return e.cache.get(this._getDefaultTabStorageKey())||0},_getDefaultTabStorageKey:function(){return e.utils.formatString(this._defaultTabStorageKey,[this.meta.view.type])},setCurrentTab:function(){var t=this._currentTabIndex,n=this.getListViews();e.cache.set(this._getDefaultTabStorageKey(),this._currentTabIndex),_.each(n,function(e){e.current=!1},this),n[t]&&(n[t].current=!0)},switchTab:function(){this.$tabs.removeClass(this._activeTabClass),_.each(this.getListViews(),function(e,t){e.getViewContainer().addClass("hide-container"),e.current&&(e.getViewContainer().removeClass("hide-container"),this.$tabs.eq(t).addClass(this._activeTabClass),this.viewState.currentTab=t,this.saveState())},this)},getListViews:function(){return this._views},applyViewState:function(){this._super("applyViewState",arguments),_.each(this.getListViews(),_.bind(this.onCollectionSyncSuccess,this))},_gaHandler:function(){if(!e.config.analytics.enabled)return;var t=this._currentTabIndex,n=this.meta.view.type,r=this.getListViews()[t],i=["dashlet",n],s;switch(n){case"inactive-tasks":case"active-tasks":s=t;break;default:s=r.module}i.push(s),e.analytics.setActiveView(i.join("/"))}})}(SUGAR.App),function(e){e.view.views.ForecastChartView=e.view.views.BaseChartView.extend({forecastBy:"Opportunities",initialize:function(){e.nomad.utils.isModuleVisible("RevenueLineItems")&&(this.forecastBy="RevenueLineItems"),this._super("initialize",arguments)},getTitle:function(t){return e.lang.get(t,this.forecastBy)}})}(SUGAR.App),function(e){e.view.views.ForecastParetoView=e.view.views.ForecastChartView.extend({_isInitialized:!1,isForecastSetup:!1,isForecastConfigValid:!1,forecastsNotSetUpMsg:"",$groupByFilter:null,events:function(){var t=e.view.views.BaseChartView.prototype.events;return _.extend({},t,{"click .lnk-non-forecast":function(t){t.preventDefault(),e.nomad.openUrl(t.target.href)}})},initialize:function(t){this._super("initialize",[t]),this.forecastConfig=e.metadata.getModule("Forecasts","config"),this.isForecastSetup=this.forecastConfig.is_setup,this.isForecastsConfigValid=e.nomad.utils.isForecastConfigValid(),this.showManagerData=!1;if(this.isForecastSetup){this.dashletConfig=e.metadata.getView(null,"forecast-pareto");if(_.isString(this.dashletConfig.dataset.options)&&_.isString(this.dashletConfig.group_by.options)){var n=e.lang.getAppListStrings(this.dashletConfig.dataset.options);this.dashletConfig.group_by.options=e.lang.getAppListStrings(this.dashletConfig.group_by.options),this.dashletConfig.dataset.options={},this.forecastConfig.show_worksheet_worst&&e.acl.hasAccess("read",this.forecastBy,e.user.get("id"),"worst_case")&&(this.dashletConfig.dataset.options.worst=n.worst),this.forecastConfig.show_worksheet_likely&&e.acl.hasAccess("read",this.forecastBy,e.user.get("id"),"likely_case")&&(this.dashletConfig.dataset.options.likely=n.likely),this.forecastConfig.show_worksheet_best&&e.acl.hasAccess("read",this.forecastBy,e.user.get("id"),"best_case")&&(this.dashletConfig.dataset.options.best=n.best)}}else{var r=_.isUndefined(e.user.getAcls().Forecasts.admin);this.forecastsNotSetUpMsg=e.nomad.utils.getForecastNotSetUpMessage(r)}},refreshData:function(e){this.previousVisibilityState!==this.viewState.visibility?(this.previousVisibilityState=this.viewState.visibility,this._super("refreshData"),this.$groupByFilter&&this.$groupByFilter.toggle()):e?this._super("refreshData",arguments):this._serverData&&(this.saveState(),this.renderChart())},loadData:function(){this.isForecastSetup&&this._super("loadData",arguments)},processData:function(t){this._serverData=t,this._serverData&&e.view.views.BaseChartView.prototype.processData.call(this,t)},loadInitData:function(n){var r=this;this.apiCall("GET",e.api.buildURL("Forecasts/init"),null,{success:function(t){r.initForecast(t),n(null,t)},error:n})},loadChartData:function(n){var r={},i;r.no_data=this.viewState.filters.get("no_data")===!0,this.isManager&&(r.target_quota=this.viewState.filters.get("show_target_quota")?1:0),i=e.api.buildURL(this.buildChartUrl(),null,null,r),this.apiCall("read",i,{},e.nomad.utils.wrapAsyncCallback(n))},initForecast:function(t){var n={user_id:e.user.get("id"),show_target_quota:!1,selectedTimePeriod:t.defaultSelections.timeperiod_id.id,timeperiod_id:t.defaultSelections.timeperiod_id.id,timeperiod_label:t.defaultSelections.timeperiod_id.label,dataset:t.defaultSelections.dataset,group_by:t.defaultSelections.group_by,ranges:_.keys(e.lang.getAppListStrings(this.forecastConfig.buckets_dom))};this._isInitialized=!0,this.viewState.filtersDef={group_by:this.dashletConfig.group_by,dataset:this.dashletConfig.dataset},this.previousVisibilityState=this.viewState.visibility,this.setFilters(n),this.render()},prepareChartObject:function(){this.chartId=this.cid+"_chart",this.chart=nv.models.paretoChart().margin({top:0,right:10,bottom:0,left:10}).showTitle(!1).tooltips(!0).tooltipQuota(function(t,n,r,i,s){var o=e.currency.formatAmountLocale(i.val,e.currency.getBaseCurrencyId());return"<p><b>"+i.key+": <b>"+o+"</b></p>"}).tooltipLine(function(t,n,r,i,s){var o=e.currency.formatAmountLocale(i.point.y,e.currency.getBaseCurrencyId());return"<p><b>"+e.lang.get("LBL_CUMULATIVE_TOTAL","Forecasts")+"</b></p><p>"+t+": <b>"+o+"</b></p>"}).tooltipBar(_.bind(function(t,n,r,i,s){var o=e.currency.formatAmountLocale(i.value),u=e.lang.get("LBL_SALES_STAGE","Forecasts");return this.viewState.filters.get("group_by")==="probability"&&(u=e.lang.get("LBL_OW_PROBABILITY","Forecasts")+" (%)"),"<p>"+u+": <b>"+t+"</b></p>"+"<p>"+e.lang.get("LBL_AMOUNT","Forecasts")+": <b>"+o+"</b></p>"+"<p>"+e.lang.get("LBL_PERCENT","Forecasts")+": <b>"+n+"%</b></p>"},this)).colorData("default").colorFill("default").yAxisTickFormat(function(t){return e.currency.getCurrencySymbol(e.currency.getBaseCurrencyId())+d3.format(",.2s")(t)}).quotaTickFormat(function(t){return e.currency.getCurrencySymbol(e.currency.getBaseCurrencyId())+d3.format(",.3s")(t)}).barClick(function(e,t,n,r){return}).id(this.chartId).strings({legend:{close:e.lang.getAppString("LBL_CHART_LEGEND_CLOSE"),open:e.lang.getAppString("LBL_CHART_LEGEND_OPEN")},noData:e.lang.getAppString("LBL_CHART_NO_DATA")})},renderChart:function(){this.isManager&&this.viewState.visibility==="group"?(this.showManagerData=!0,this.convertManagerDataToChartData()):(this.showManagerData=!1,this.convertUserDataToChartData()),this.generateD3Chart()},convertUserDataToChartData:function(){_.each(this._serverData.data,function(e){_.has(e,"likely")&&isNaN(e.likely)&&(e.likely=0),_.has(e,"best")&&isNaN(e.best)&&(e.best=0),_.has(e,"worst")&&isNaN(e.worst)&&(e.worst=0)});var t=this.viewState.filters.get("group_by"),n=this.viewState.filters.get("dataset"),r=this.viewState.filters.get("ranges"),i=0,s=[],o=this._serverData["x-axis"].map(function(e,t){return{series:i,x:t+1,y:0}}),u={key:this._serverData.labels.dataset[n],type:"line",series:i,values:[],valuesOrig:[]},a={properties:{name:this._serverData.title,quota:parseFloat(this._serverData.quota),quotaLabel:e.lang.get("LBL_QUOTA","Forecasts"),groupData:this._serverData["x-axis"].map(function(e,t){return{group:t,l:e.label,t:0}})},data:[]},f=this._serverData.data,l=_.isEmpty(r)?f:f.filter(function(e){return _.contains(r,e.forecast)});_.each(this._serverData.labels[t],function(r,u){var f=l.filter(function(e){return e[t]==u});if(!_.isEmpty(f)){var c=this._serverData["x-axis"].map(function(e,t){return{series:i,x:t+1,y:0,y0:0}}),h=this._serverData["x-axis"];_.each(f,function(e){for(var t=0;t<h.length;t++)if(e.date_closed_timestamp>=h[t].start_timestamp&&e.date_closed_timestamp<=h[t].end_timestamp){var r=parseFloat(e[n]);c[t].y+=r,a.properties.groupData[t].t+=r,o[t].y+=r;break}},this),s.push({key:r,series:i,type:"bar",values:c,valuesOrig:e.utils.deepCopy(c)}),i++}},this);if(!_.isEmpty(s)){var c=0;_.each(o,function(e,t,n){n[t].y+=c,c=n[t].y}),u.values=o,u.valuesOrig=e.utils.deepCopy(o),s.push(u),a.data=s}this.chartData=a},convertManagerDataToChartData:function(){var t=this.viewState.filters.get("dataset"),n=this._serverData.data,r={properties:{name:this._serverData.title,quota:parseFloat(this._serverData.quota),quotaLabel:e.lang.get(this.viewState.filters.get("show_target_quota")?"LBL_QUOTA_ADJUSTED":"LBL_QUOTA","Forecasts"),groupData:n.map(function(e,n){return{group:n,l:e.name,t:parseFloat(e[t])+parseFloat(e[t+"_adjusted"])}})},data:[]},i=[t,t+"_adjusted"].map(function(e,t){var r=n.map(function(n,r){return{series:t,x:r+1,y:parseFloat(n[e]),y0:0}});return{key:this._serverData.labels.dataset[e],series:t,type:"bar",values:r,valuesOrig:r}},this),s=[t,t+"_adjusted"].map(function(e,t){var r=n.map(function(n,r){return{series:t,x:r+1,y:parseFloat(n[e])}}),i=0;return _.each(r,function(e,t,n){n[t].y+=i,i=n[t].y}),{key:this._serverData.labels.dataset[e],series:t,type:"line",values:r,valuesOrig:r}},this);this.viewState.filters.get("show_target_quota")&&(r.properties.targetQuota=+this._serverData.target_quota,r.properties.targetQuotaLabel=e.lang.get("LBL_QUOTA","Forecasts")),r.data=i.concat(s),this.chartData=r},generateD3Chart:function(){if(!this._super("renderChart"))return;this.chart.barLegend.rowsCount(this._maxLegendRows),this.chart.stacked(!this.showManagerData),d3.select(this.el).select(".nv-pareto").append("svg").datum(this.chartData).call(this.chart)},buildChartUrl:function(){var e=[this.viewState.visibility==="group"?"ForecastManagerWorksheets":"ForecastWorksheets","chart",this.viewState.filters.get("timeperiod_id"),this.viewState.filters.get("user_id")];return e.join("/")},onAfterRender:function(){this._super("onAfterRender",arguments),this.$groupByFilter=this.$(".chart-filter.group_by"),this.viewState.visibility==="group"&&this.$groupByFilter.hide()}})}(SUGAR.App),function(e){e.view.views.BubblechartView=e.view.views.ForecastChartView.extend({params:null,likelyField:"",filterDuration:null,responseDataAttr:"records",initialize:function(t){this._super("initialize",[t]);var n=["id","name","account_name","base_rate","currency_id","assigned_user_name","date_closed","probability","account_id","sales_stage","commit_stage"],r;this.dashletConfig=e.metadata.getView(null,"bubblechart"),this.filterDuration=this.dashletConfig.filter_duration[0],this.setFilterDurationOptions(),this.viewState.filtersDef.filter_duration=this.filterDuration,this.likelyField=this.forecastBy==="Opportunities"?"amount":"likely_case",n.push(this.likelyField),r=this.likelyField+":desc",this.params={fields:n.join(","),max_num:10,order_by:r},this.tooltiptemplate=e.template.getView("bubblechart-tooltip"),this.setFilters({filter_duration:_.keys(this.viewState.filtersDef.filter_duration.options)[0]})},setFilterDurationOptions:function(){if(!_.isString(this.filterDuration.options))return!1;this.filterDuration.options=e.lang.getAppListStrings(this.filterDuration.options),_.isEmpty(this.filterDuration.options)&&(this.filterDuration.options=e.lang.getAppListStrings("generic_timeperiod_options"))},loadChartData:function(n){this.setDateRange();var r=[{date_closed:{$gte:this.dateRange.begin}},{date_closed:{$lte:this.dateRange.end}}];(!this.isManager||this.viewState.visibility==="user")&&r.push({$owner:""});var i=_.extend({filter:r},this.params),s=e.api.buildURL(this.forecastBy,null,null,i,this.params);this.apiCall("read",s,null,e.nomad.utils.wrapAsyncCallback(n))},processData:function(t){this.evaluateResult(t),_.isEmpty(t.records)||e.view.views.BaseChartView.prototype.processData.call(this,t),this.$chartEl.toggle(!_.isEmpty(t.records)),this.$dataUnavailableLbl.toggle(_.isEmpty(t.records))},prepareChartObject:function(){var t=this;this.chart=nv.models.bubbleChart().x(function(e){return d3.time.format("%Y-%m-%d").parse(e.x)}).y(function(e){return e.y}).tooltipContent(function(e,n,r,i,s){return i.point.close_date=d3.time.format("%x")(d3.time.format("%Y-%m-%d").parse(i.point.x)),i.point.amount=i.point.currency_symbol+d3.format(",.2d")(i.point.base_amount),t.tooltiptemplate(i.point).replace(/(\r\n|\n|\r)/gm,"")}).showTitle(!1).tooltips(!0).showLegend(!0).bubbleClick(function(n){e.router.navigate(e.router.buildRoute(t.forecastBy,n.point.id),{trigger:!0})}).colorData("class",{step:2}).groupBy(function(e){return t.isManager&&t.viewState.visibility==="user"?e.sales_stage_short:e.assigned_user_name}).filterBy(function(e){return e.probability}).strings({legend:{close:e.lang.getAppString("LBL_CHART_LEGEND_CLOSE"),open:e.lang.getAppString("LBL_CHART_LEGEND_OPEN")},noData:e.lang.getAppString("LBL_CHART_NO_DATA")})},renderChart:function(){if(!this._super("renderChart"))return;this.chart.legend.rowsCount(this._maxLegendRows),d3.select(this.el).select(".nv-chart-bubble").append("svg").datum(this.chartData).transition().duration(500).call(this.chart)},evaluateResult:function(t){this.total=t.records.length;var n="sales_stage_dom",r=e.metadata.getModule(this.forecastBy,"fields");r&&(n=r.sales_stage.options||n),this.chartData={data:t.records.map(function(t){var r=e.lang.getAppListStrings(n)[t.sales_stage]||t.sales_stage;return{id:t.id,x:t.date_closed,y:Math.round(parseInt(t[this.likelyField],10)/parseFloat(t.base_rate)),shape:"circle",account_name:t.account_name,assigned_user_name:t.assigned_user_name,sales_stage:r,sales_stage_short:r,probability:parseInt(t.probability,10),base_amount:parseInt(t[this.likelyField],10),currency_symbol:e.currency.getCurrencySymbol(t.currency_id)}},this),properties:{title:e.lang.getAppString("LBL_DASHLET_TOP10_SALES_OPPORTUNITIES_NAME"),value:t.records.length}}},setDateRange:function(){var t=new Date,n=this.getDateRangeDuration(),r=Math.floor(t.getMonth()/3)*3,i=new Date(t.getFullYear(),n===12?0:r+n,1),s=new Date(t.getFullYear(),n===12?12:i.getMonth()+3,0);this.dateRange={begin:e.date.format(i,"Y-m-d"),end:e.date.format(s,"Y-m-d")}},getDateRangeDuration:function(){var e=parseInt(this.viewState.filters.get("filter_duration"),10),t={current:0,next:3,year:12};return isNaN(e)&&(e=t[this.viewState.filters.get("filter_duration")]),e}})}(SUGAR.App),function(e){e.view.views.ForecastPipelineView=e.view.views.ForecastChartView.extend({_isInitialized:!1,forecastAdmin:!1,forecastConfig:null,isForecastSetup:!1,isForecastsConfigValid:!1,forecastsNotSetUpMsg:null,initialize:function(t){this._super("initialize",[t]),this.forecastConfig=e.metadata.getModule("Forecasts","config"),this.isForecastSetup=this.forecastConfig.is_setup,this.isForecastsConfigValid=e.nomad.utils.isForecastConfigValid(),this.forecastAdmin=_.isUndefined(e.user.getAcls().Forecasts.admin),this.salesStageLabels=e.lang.getAppListStrings("sales_stage_dom"),this.isForecastSetup||(_.isEmpty(e.metadata.getModule("Forecasts").views)?this.forecastsNotSetUpMsg=e.nomad.utils.getForecastNotSetUpMessage(this.forecastAdmin):(this.viewState.filtersDef.timeperiod=e.utils.deepCopy(e.metadata.getModule("Forecasts").views["forecast-pipeline"].meta.timeperiod[0]),this.viewState.filtersDef.timeperiod.options=e.lang.getAppListStrings("generic_timeperiod_options"),this.setFilters({selectedTimePeriod:this.viewState.filtersDef.timeperiod.options[0]}),this._isInitialized=!0))},loadData:function(){this.forecastsNotSetUpMsg||this._super("loadData",arguments)},loadInitData:function(n){var r=this;async.parallel({loadTimeperiodOptions:function(n){r.apiCall("read",e.api.buildURL("Forecasts/enum/selectedTimePeriod"),null,e.nomad.utils.wrapAsyncCallback(n))},loadCurrentTimeperiod:function(n){r.apiCall("GET",e.api.buildURL("TimePeriods/current"),null,e.nomad.utils.wrapAsyncCallback(n))}},function(i,s){if(i){n.apply(this,arguments);return}r.viewState.filtersDef.timeperiod=e.utils.deepCopy(e.metadata.getModule("Forecasts").views["forecast-pipeline"].meta.timeperiod[0]),r.viewState.filtersDef.timeperiod.options=s.loadTimeperiodOptions,r.setFilters({selectedTimePeriod:s.loadCurrentTimeperiod.id}),r._isInitialized=!0,r.render(),n(null,s)})},loadChartData:function(n){var r=[this.forecastBy,"chart","pipeline"],i;r.push(this.viewState.filters.get("selectedTimePeriod")),r.push(this.viewState.visibility),i=e.api.buildURL(r.join("/")),this.apiCall("GET",i,null,e.nomad.utils.wrapAsyncCallback(n))},processData:function(t){t&&t.data&&_.each(t.data,function(e){e&&e.key&&this.salesStageLabels&&this.salesStageLabels[e.key]&&(e.key=this.salesStageLabels[e.key])}),this.chartData=t,e.view.views.BaseChartView.prototype.processData.call(this,t)},prepareChartObject:function(){this.chart=nv.models.funnelChart().showTitle(!1).tooltips(!0).wrapLabels(!1).tooltipContent(function(t,n,r,i,s){var o=e.currency.formatAmountLocale(r,e.currency.getBaseCurrencyId()),u=e.lang.getAppListStrings("sales_stage_dom"),a=u&&u[t]?u[t]:t;return"<p>"+SUGAR.App.lang.get("LBL_SALES_STAGE","Forecasts")+": <b>"+a+"</b></p>"+"<p>"+SUGAR.App.lang.get("LBL_AMOUNT","Forecasts")+": <b>"+o+"</b></p>"+"<p>"+SUGAR.App.lang.get("LBL_PERCENT","Forecasts")+": <b>"+n+"%</b></p>"}).colorData("class",{step:2}).fmtValueLabel(function(t){var n=t.label||t;return e.currency.formatAmountLocale(n,e.currency.getBaseCurrencyId()).replace(/\,00$|\.00$/,"")}).strings({legend:{close:e.lang.getAppString("LBL_CHART_LEGEND_CLOSE"),open:e.lang.getAppString("LBL_CHART_LEGEND_OPEN")},noData:e.lang.getAppString("LBL_CHART_NO_DATA")})},renderChart:function(){if(!this._super("renderChart"))return;this.chart.legend.rowsCount(this._maxLegendRows),d3.select(this.el).select(".nv-funnelChart").append("svg").datum(this.chartData).transition().duration(500).call(this.chart)}})}(SUGAR.App),function(e){var t=e.view.views.DashablelistView;e.view.views.ActivitystreamDashletView=t.extend({events:{"click .panel__addpost":"onAddPost"},plugins:["refresh-timeago","create-post"],basicMenuActions:[{name:"comment",label:"LBL_COMMENT",icon:"icon-comment",isEnabled:function(){return!0},action:"onCreateCommentItem"}],_getFilterDefFromMeta:function(t){var n;if(t){var r=e.metadata.getModule("Activities");_.isObject(r)&&_.isObject(r.filters)&&_.each(r.filters,function(e){_.isObject(e.meta)&&_.each(e.meta.filters,function(e){e.id===t&&(n=e)})})}return n},overrideListView:function(n){t.prototype.overrideListView.apply(this,arguments);var r=this;n.template=e.template.get("activity-list"),n.setTemplateOption("partials",{"list-item":e.template.get("list-item-activity")}),n.contextMenuActions=this.basicMenuActions,n.onCreateCommentItem=function(t,i){e.routing.emulateBackButton&&n.hideContextMenu(n.activeListItem,!0),_.defer(function(){var e=_.find(r._commentsViews,function(e){return e.options.parentModel.id===i.id});e.onCreateCommentItem(t,i)})},n.listenTo(n.collection,"add",_.bind(this.onItemAdded,this)),n.listenTo(n.collection,"data:sync:start",_.bind(this.removeTimeago,this)),n.listenTo(n.collection,"data:sync:complete",_.bind(this.onCollectionSync,this));var i=this._getFilterDefFromMeta(this.meta.view.currentFilterId);i&&(n.collection.filterDef=i.filter_definition)},onItemAdded:function(e,t){var n;t.each(function(t,r){if(t.id===e.id){n=r;return}}),this.createCommentsView(e,n)},onCollectionSync:function(){this.refreshTimeago(),this.initComments()},initComments:function(){this.resetCommentsViews(),this.listView.collection.each(_.bind(this.createCommentsView,this)),_.each(this._commentsViews,function(e){this.listenTo(e,"view:after:render",this.listReflowScroll,this)},this),this.listView.scrollReflow()},listReflowScroll:function(){this.listView.scrollReflow()},createCommentsView:function(t,n){this.$(".activitystream-item").eq(n).append('<div class="clip comments-container"></div>');var r=this.$(".comments-container").eq(n),i=e.view.createView({name:"list",module:"Comments",parentModel:t,el:r,layout:this.layout});i.render(),i.bindGlobalEvents(),this._commentsViews.push(i)},resetCommentsViews:function(){_.each(this._commentsViews,function(e){this.stopListening(e,"view:after:render",this.listReflowScroll),delete this._listeners[e._listenerId],e.dispose()},this),this._commentsViews=[]},onAddPost:function(){var t=e.data.createBean("Activities"),n=this;this.createPost(t,{appendTo:"root",savePost:function(){var r=t.get("value"),i=t.get("tags");r&&e.nomad.utils.executeNextTickWithScreenLock(function(e){t.set("data",{value:r,tags:i},{silent:!0}),t.save(null,{fields:["activity_type","data"],success:function(e){n.listView.collection.unshift(e),n.listView.render()},complete:e})})}})},dispose:function(){this.resetCommentsViews(),t.prototype.dispose.call(this)}})}(SUGAR.App),function(e){e.view.views.SavedReportsChartView=e.view.views.BaseChartView.extend({responseDataAttr:"chartData",initialize:function(t){e.view.views.BaseChartView.prototype.initialize.apply(this,arguments),this.model=e.data.createBean("Forecasts"),this.chartId=Math.floor(Math.random()*1e4)},loadChartData:function(n){var r=this.meta.view.saved_report_id,i=this;this.apiCall("create",e.api.buildURL("Reports/chart/"+r),null,e.nomad.utils.wrapAsyncCallback(n))},isDataEmpty:function(e){if(this._super("isDataEmpty",arguments))return!0;var t=e.chartData.properties[0].type,n=this.getChartConfig(t),r=this._getDataAttribute(n);return _.isEmpty(e.chartData[r])},processData:function(t){t&&t.chartData&&this.model.set({rawChartData:t.chartData},{silent:!0}),e.view.views.BaseChartView.prototype.processData.call(this,t)},prepareChartObject:function(){var t=this.model.get("rawChartData"),n={minColumnWidth:120,show_title:!0,show_legend:!0,show_controls:!1,show_tooltips:!0,show_y_label:!1,y_axis_label:"",show_x_label:!1,x_axis_label:"",wrapTicks:!0,staggerTicks:!0,rotateTicks:!0,reduceXTicks:!1,overflowHandler:!1,allowScroll:!1,vertical:!0,showValues:!1,hideEmptyGroups:!0,stacked:!0,colorData:"default",margin:{top:10,right:10,bottom:10,left:10}},r=t.properties[0].type;e.supportedFeatures.configurableSavedReportsChart&&(_.extend(n,this.meta.view),r=this.meta.view.chart_type);var i=this.getChartConfig(r),s=this.translateDataToD3(t,n,i);this.chart=this.getChartModel(n,i),this.chart.id(this.chartId).margin(n.margin).showTitle(n.show_title).showLegend(n.show_legend).tooltips(n.show_tooltips).tooltipContent(function(e,t,n,r,i){return"<h3>"+e+"</h3>"+"<p>"+n+"</p>"}).colorData(n.colorData).strings({legend:{close:e.lang.get("LBL_CHART_LEGEND_CLOSE"),open:e.lang.get("LBL_CHART_LEGEND_OPEN")},noData:e.lang.get("LBL_CHART_NO_DATA")}),this.chartData=s,i.ReportModule&&this.chart.legend.showAll(!0)},renderChart:function(){if(!this._super("renderChart"))return;this.chart.legend.rowsCount(this._maxLegendRows),d3.select(this.el).select(".nv-chart-reports").append("svg").datum(this.chartData).transition().duration(500).call(this.chart),this.$el.on("touchcancel",function(e){var t=d3.select(window);_.each(_.keys(window),function(e){var n=e.match(/^__on((?:touch|drag|select).+)$/);n&&t.on(n[1],null)})})},getChartModel:function(e,t){var n;switch(t.chartType){case"pieChart":n=nv.models.pieChart();break;case"funnelChart":n=nv.models.funnelChart();break;case"lineChart":n=nv.models.lineChart(),n.x(function(e){return e[0]}).y(function(e){return e[1]}).size(function(){return 123});break;case"barChart":n=nv.models.multiBarChart().vertical(t.orientation==="vertical"?!0:!1).stacked(t.barType==="stacked"?!0:!0).showControls(e.show_controls).showValues(e.showValues).rotateTicks(e.rotateTicks).reduceXTicks(e.reduceXTicks),n.yAxis.tickSize(0).axisLabel(e.show_y_label).tickFormat(d3.format(",.0f")),e.show_x_label&&n.xAxis.axisLabel(e.x_axis_label),e.show_y_label&&n.yAxis.axisLabel(e.y_axis_label);break;default:n=nv.models.multiBarChart()}return n},getChartConfig:function(e){var t;switch(e){case"pie chart":t={pieType:"basic",tip:"name",chartType:"pieChart"};break;case"line chart":t={lineType:"basic",tip:"name",chartType:"lineChart"};break;case"funnel chart 3D":t={lineType:"basic",tip:"name",chartType:"funnelChart"};break;case"stacked group by chart":t={orientation:"vertical",barType:"stacked",tip:"title",chartType:"barChart"};break;case"group by chart":t={orientation:"vertical",barType:"grouped",tip:"name",chartType:"barChart"};break;case"bar chart":t={orientation:"vertical",barType:"basic",tip:"label",chartType:"barChart"};break;case"horizontal group by chart":t={orientation:"horizontal",barType:"stacked",tip:"name",chartType:"barChart"};break;case"horizontal bar chart":case"horizontal":t={orientation:"horizontal",barType:"basic",tip:"label",chartType:"barChart"};break;default:t={orientation:"vertical",barType:"stacked",tip:"name",chartType:"barChart"}}return this.chartType=t.chartType,t},translateDataToD3:function(t,n,r){var i=[],s=0,o=e.lang.get("LBL_CHART_UNDEFINED"),u=this._getDataAttribute(r),a=t[u],f;if(t.values.filter(function(e){return e.values&&e.values.length}).length)switch(r.chartType){case"barChart":f=r.barType==="stacked"||r.barType==="grouped"?function(e,n){return{key:e!==""?e:o,type:"bar",values:t.values.map(function(e,t){return{series:n,x:t+1,y:parseFloat(e.values[n])||0,y0:0}})}}:function(e,n){return{key:e.values.length>1?e.label:e.label[0]!==""?e.label[0]:o,type:"bar",values:t.values.map(function(e,t){return{series:n,x:t+1,y:n===t?e.values.length>1?e.values.reduce(function(e,t){return parseFloat(e)+parseFloat(t)}):parseFloat(e.values[0]):0,y0:0}})}};break;case"pieChart":f=function(e,t){return{key:e.label[0]!==""?e.label[0]:o,value:parseFloat(e.values[0])}};break;case"funnelChart":a=t[u].reverse(),f=function(e,t){return{key:e.label[0]!==""?e.label[0]:o,values:[{series:t,label:e.valuelabels[0]?e.valuelabels[0]:e.values[0],x:0,y:parseFloat(e.values[0])||0,y0:0}]}};break;case"lineChart":f=function(e,t){return{key:e.label!==""?e.label:o,values:e.values.map(function(e,t){return[t,parseFloat(e)]})}}}return f&&(i=a.map(f)),{properties:{title:this.meta.view.report_title,labels:t.values.filter(function(e){return e.values.length}).length?t.values.map(function(e,t){return{group:t+1,l:e.label!==""?e.label:o}}):[],values:r.chartType==="gaugeChart"?[{group:1,t:s}]:t.values.filter(function(e){return e.values.length}).length?t.values.map(function(e,t){return{group:t+1,t:e.values.reduce(function(e,t){return parseFloat(e)+parseFloat(t)},0)}}):[]},data:i}},_getDataAttribute:function(e){var t;switch(e.chartType){case"barChart":t=e.barType==="stacked"||e.barType==="grouped"?"label":"values";break;default:t="values"}return t}})}(SUGAR.App),function(e){e.view.views.ForecastdetailsView=e.view.views.ForecastChartView.extend({forecastConfig:null,isForecastSetup:!1,isForecastsConfigValid:!1,forecastsNotSetUpMsg:!1,isAdmin:!1,isTopLevelManager:!1,showTargetQuota:!1,spanCSS:"",detailsDataSet:null,responseDataAttr:null,initialize:function(t){this._super("initialize",[t]),this.forecastConfig=e.metadata.getModule("Forecasts","config"),this.isForecastSetup=this.forecastConfig.is_setup,this.isForecastsConfigValid=e.nomad.utils.isForecastConfigValid(),this.isAdmin=_.isUndefined(e.user.getAcls().Forecasts.admin);if(this.isForecastSetup){this.serverData=e.data.createBean("Forecasts"),this.model=e.data.createBean("Forecasts");var n=this.forecastBy==="RevenueLineItems"?"likely_case":"amount";this.fieldDataAccess={likely:e.acl.hasAccess("read",this.forecastBy,e.user.get("id"),n),best:e.acl.hasAccess("read",this.forecastBy,e.user.get("id"),"best_case"),worst:e.acl.hasAccess("read",this.forecastBy,e.user.get("id"),"worst_case")},this.spanCSS=_.compact([this.forecastConfig.show_worksheet_likely,this.forecastConfig.show_worksheet_best,this.forecastConfig.show_worksheet_worst]).length,this.spanCSS=_.compact([this.forecastConfig.show_worksheet_likely,this.forecastConfig.show_worksheet_best,this.forecastConfig.show_worksheet_worst]).length,this.model.set({opportunities:0,spanCSS:this.spanCSS,isForecastSetup:this.isForecastSetup,isForecastAdmin:this.isForecastAdmin}),this.isTopLevelManager=e.user.get("is_top_level_manager"),this.showTargetQuota=this.isManager&&!this.isTopLevelManager,this.detailsDataSet=this.getDetailsDataSet()}else this.forecastsNotSetUpMsg=e.nomad.utils.getForecastNotSetUpMessage(this.isAdmin)},onAfterRender:function(){this._super("onAfterRender",arguments),this.$chartEl=this.$(".fd__wrapper")},loadData:function(t){this.isForecastSetup&&this._super("loadData",arguments),!this.loaded&&!t&&this.$chartEl.hide()},loadInitData:function(n){var r=this;async.parallel({loadTimeperiodOptions:function(n){r.apiCall("read",e.api.buildURL("Forecasts/enum/selectedTimePeriod"),null,e.nomad.utils.wrapAsyncCallback(n))},loadCurrentTimeperiod:function(n){r.apiCall("GET",e.api.buildURL("TimePeriods/current"),null,e.nomad.utils.wrapAsyncCallback(n))}},function(i,s){if(i){n.apply(this,arguments);return}r.viewState.filtersDef.timeperiod=e.metadata.getView(null,"forecastdetails").timeperiod[0],r.viewState.filtersDef.timeperiod.options=s.loadTimeperiodOptions,r.setFilters({timePeriods:s.loadCurrentTimeperiod.id,selectedTimePeriod:s.loadCurrentTimeperiod.id}),r._isInitialized=!0,n(null,s)})},loadChartData:function(t){var n=this.buildChartUrl();this.apiCall("read",n,null,e.nomad.utils.wrapAsyncCallback(t))},processData:function(e){e=this.adjustDashletData(e),this.calculateData(e),this.render(),this.renderCSSChanges(),this.$preloader.hide(),this.$chartEl.show()},getDetailsDataSet:function(){var t=e.metadata.getStrings("app_list_strings").forecasts_options_dataset||[],n={};return _.each(t,function(e,t){this.forecastConfig["show_worksheet_"+t]===1&&(n[t]=e)},this),n},buildChartUrl:function(){var t=this.isManager?"progressManager":"progressRep",n=["Forecasts",this.viewState.filters.get("selectedTimePeriod"),t,e.user.get("id")],r={};return this.isManager&&(r={target_quota:this.showTargetQuota?1:0}),e.api.buildURL(n.join("/"),"create",null,r)},adjustDashletData:function(e){return this.isManager?(e.likely=e.likely_adjusted||e.likely_case,e.best=e.best_adjusted||e.best_case,e.worst=e.worst_adjusted||e.worst_case):(e.likely=e.amount,e.best=e.best_case,e.worst=e.worst_case,e.closed_amount=e.won_amount,_.isUndefined(e.closed_amount)&&delete e.closed_amount),e},calculateData:function(t){this.serverData.set(t);var n=_.extend({},t,this.serverData.toJSON()),r=this.forecastConfig;this.likelyTotal=n.likely,this.bestTotal=n.best,this.worstTotal=n.worst,n.quota_amount_str=e.currency.formatAmountLocale(n.quota_amount),n.closed_amount_str=e.currency.formatAmountLocale(n.closed_amount),this.showTargetQuota?n.target_quota_amount_str=e.currency.formatAmountLocale(n.target_quota_amount):this.serverData.unset("target_quota_amount_str"),n.showTargetQuota=this.showTargetQuota,n.deficit_amount=Math.abs(e.math.sub(n.quota_amount,n.closed_amount)),n.deficit_amount_str=e.currency.formatAmountLocale(n.deficit_amount),n.is_deficit=parseFloat(n.quota_amount)>parseFloat(n.closed_amount);var i=n.is_deficit?"LBL_FORECAST_DETAILS_DEFICIT":"LBL_FORECAST_DETAILS_SURPLUS";n.deficit_label=e.lang.get(i,"Forecasts"),n.detailsOpts=[],r.show_worksheet_worst&&n.detailsOpts.push(this.getDetailsForCase("worst",this.worstTotal,n.quota_amount,n.closed_amount)),r.show_worksheet_likely&&n.detailsOpts.push(this.getDetailsForCase("likely",this.likelyTotal,n.quota_amount,n.closed_amount)),r.show_worksheet_best&&n.detailsOpts.push(this.getDetailsForCase("best",this.bestTotal,n.quota_amount,n.closed_amount)),this.isManager&&!_.isEmpty(e.user.get("reports_to_id"))?n.quota_label=e.lang.get("LBL_QUOTA_ADJUSTED","Forecasts"):n.quota_label=e.lang.get("LBL_QUOTA","Forecasts"),this.model.set(n,{silent:!0})},getDetailsForCase:function(t,n,r,i){var s={},o=e.math.add(n,i),u=parseFloat(r),a=0;return s.label=e.lang.get("LBL_"+t.toUpperCase(),"Forecasts"),s.spanCSS=this.spanCSS,s.case=t,s.shortOrExceed="&nbsp;",s.openPipeline="&nbsp;",s.feedbackLn1="",s.feedbackLn2="",s.hasAccess=!0,!this.isManager&&!this.fieldDataAccess[t]&&(s.hasAccess=!1),s.hasAccess&&(n&&(s.amount=e.currency.formatAmountLocale(n),s.labelAmount=s.label+": "+s.amount.toString()),o===0&&u===0?s.amount=e.lang.get("LBL_FORECAST_DETAILS_NO_DATA","Forecasts"):o!==0&&u!==0&&o===u?s.shortOrExceed=e.lang.get("LBL_FORECAST_DETAILS_MEETING_QUOTA","Forecasts"):(o>u?(s.shortOrExceed=e.lang.get("LBL_FORECAST_DETAILS_EXCEED","Forecasts"),a=e.math.sub(o,u)):(s.shortOrExceed=e.lang.get("LBL_FORECAST_DETAILS_SHORT","Forecasts"),a=e.math.sub(u,o)),s.percent=this.getPercent(a,u),s.openPipeline="("+e.currency.formatAmountLocale(a)+")"),s.feedbackLn1=s.shortOrExceed,s.percent&&(s.feedbackLn1+=" "+s.percent),s.feedbackLn2=s.openPipeline),s},renderCSSChanges:function(){this.checkPropertySetCSS("worst"),this.checkPropertySetCSS("likely"),this.checkPropertySetCSS("best");var e=this.model.get("is_deficit");e?this.$el.find(".deficitRow").addClass(this.getClassBasedOnAmount(0,1,"color")):this.$el.find(".deficitRow").addClass(this.getClassBasedOnAmount(1,0,"color"))},checkPropertySetCSS:function(t){if(this.forecastConfig["show_worksheet_"+t]&&(this.isManager||!this.isManager&&this.fieldDataAccess[t])){var n=this.getClassBasedOnAmount(e.math.add(this.serverData.get(t),this.serverData.get("closed_amount")),this.model.get("quota_amount"),"background-color");this.$el.find(".forecast_details_"+t+"_feedback").addClass(n)}},getClassBasedOnAmount:function(e,t,n){var r="";return e=parseFloat(e),t=parseFloat(t),n==="color"?e!==t&&(e>t?r="font-green":r="font-red"):n==="background-color"&&(e===t?r="grayLight":e>t?r="green":r="red"),r},getPercent:function(e,t){var n=0;return t>0&&e>0&&(n=e/t*100,n>1?n=Math.round(n):n=Math.round(n*100)/100),Math.abs(n)+"%"}})}(SUGAR.App),function(e){e.view.fields.BoolField=e.view.NomadField.extend({events:{"touchstart .checkbox":"touchCheckbox"},format:function(e){return e=="1"},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this),this.model&&this.view.isEditView()&&!this.model.has(this.name)&&this.model.set(this.name,!1,{silent:!0})},unformat:function(){return!!this.$(this.fieldTag)[0].checked},touchCheckbox:function(e){e.stopPropagation()}})}(SUGAR.App),function(e){e.view.fields.CurrencyField=e.view.NumericField.extend({events:{"change select":"onCurrencySelection"},initialize:function(){e.view.NumericField.prototype.initialize.apply(this,arguments),this.context.isCreate()&&e.metadata.getCurrency(e.user.getPreference("currency_id")).status==="Active"&&this.model.set("currency_id",e.user.getPreference("currency_id"),{silent:!0})},onBeforeRender:function(){e.view.NumericField.prototype.onBeforeRender.call(this),_.isEmpty(this.model.get("currency_id"))&&this.model.set("currency_id",e.user.getPreference("currency_id")||"-99",{silent:!0}),this.availableCurrencies=this._getCurrencies()},_getCurrencies:function(){var t=this.model,n=t.get("currency_id"),r=e.user.getPreference("currency_id"),i={},s=e.metadata.getCurrencies(),o;_.each(s,function(e,t){var r=_.clone(e);r.id=t,r.status==="Active"?(i[t]=r,o=r):r.id===n&&(r.disabled=!0,i[t]=r)});var u="-99";n&&_.has(i,n)?u=n:_.has(i,r)&&(u=r);var a=i[u]||o;return a&&(a.selected="selected"),i},onAfterRender:function(){var t=this;e.view.NumericField.prototype.onAfterRender.call(this);if(e.supportedFeatures.nativeEnum){var n=[];_.each(this.availableCurrencies,function(e){n.push(e.iso4217)}),this.$ct=this.$el.find(".actionsheet-select"),this.$ct.bind("click",function(){e.nomad._showActionSheet(t.label,n,function(n){var r=null;_.each(t.availableCurrencies,function(e,t){e.iso4217===n&&(r=t)}),t.$ct.attr("value",r),t.$ct.text(n),t.onCurrencySelection()})})}else this.$ct=$("select",this.$el);!this.model.get("currency_id")&&this.context.isCreate()&&this.model.changeCurrencyId(this.$ct.val()||this.$ct.attr("value"),{silent:!0})},format:function(t){if(!t&&t!==0||_.isString(t)&&t.trim().length===0)return"";var n=t;if(!isNaN(parseFloat(e.currency.unformatAmountLocale(t)))){var r=this.model.get("currency_id"),i=e.user.getPreference("currency_id");if(_.contains(["list","list-associate","list-parent"],this.action)&&r!==i)n=e.currency.formatAmountLocale(t,r);else if(this.action!=="edit"&&this.action!=="create"||this.tplName==="readonly")n=e.currency.formatAmountLocale(t,r);else{var s=e.currency.formatAmountLocale(t,r),o=e.currency.getCurrencySymbol(r);n=s.replace(o,"")}}return n},onCurrencySelection:function(){this.model.changeCurrencyId(this.$ct.val()||this.$ct.attr("value"));var e=this.format(this.model.get(this.name));this.$("input").val(e)},onFieldChange:function(){this.model.set(this.name,this.unformat(this._$fieldEl.val()),{disableRenderForContext:this.view})}})}(SUGAR.App),function(e){var t;e.view.fields.DateField=t=e.view.NomadField.extend({events:function(){var n={"focusout input":"onBlur"};e.isNative&&!t.nativeSupport&&(n["click input"]="onClick");var r=$.os.desktop?"click":"touchstart";return n[r+" .clear-button"]="onClear",n},validDateRE:/^\d{4}-\d{2}-\d{2}$/,ONCLICK_BLOCKER_TIMEOUT:2e3,chromeForAndroid:$.os.android&&$.browser.chrome,initialize:function(n){e.view.NomadField.prototype.initialize.call(this,n),t._dateFormat||t.initFormat(),this.setFormatting()},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this),this.setDefaultValue(),this.setClearButtonVisibility()},onAfterRender:function(){e.view.NomadField.prototype.onAfterRender.call(this),this.setControls(),this.toggleControls()},bindDomChange:function(){if(!this.model)return;this.setInputs(),t.nativeSupport&&this.dateInput.on($.browser.chromeMobile?"change":"blur",_.bind(this.handleValueChange,this))},format:function(n){if(_.isEmpty(n)||this.isFormView()&&t.nativeSupport&&!this.isReadOnly()){if(n&&!this.validDateRE.test(n)){var r=new Date(n);n=e.date.format(r,"Y-m-d")}return n}var i=new Date(n);isNaN(i.getDate())&&(i=e.date.parse(n,"Y-m-d"));var s=$.os.android&&$.os.version&&e.utils.versionCompare("4.1",$.os.version,">="),o=e.isNative&&s?0:i.getTimezoneOffset()*6e4,u=new Date(i.getTime()+o);return e.date.format(u,t._dateFormat)},unformat:function(n){var r=_.isEmpty(n),i;return r||t.nativeSupport&&this.isFormView()?n:(i=e.date.parse(n,t._dateFormat),i?e.date.format(i,"Y-m-d"):null)},setInputs:function(){this.dateInput=this.$el.find("input"),this.inputs=this.dateInput},onClick:function(e){if(this.isOnClickLocked())return;this.setOnClickBlocker(),this.showDatePicker(e)},onBlur:function(){this.toggleControls()},onClear:function(e){return this.setChanged(),!t.nativeSupport&&$.os.android&&this.setOnClickBlocker(500),this.model.set(this.name,""),!1},setFormatting:function(){this.shouldFormatValues=!t.nativeSupport&&this.isFormView()},setDefaultValue:function(){if(this.context.isCreate()&&!this.getValue()&&this.def.display_default&&!this._changed){var t=e.date.parseDisplayDefault(this.def.display_default);this.model.set(this.name,this._adjustDefaultValue(t),{silent:!0})}},_adjustDefaultValue:function(t){return e.date.format(t,"Y-m-d")},getDateInputValue:function(){var n=this.dateInput.val();if(n&&this.shouldFormatValues){var r=e.date.parse(n,t._dateFormat);n=e.date.format(r,"Y-m-d")}return n},setDateInputValue:function(n){if(n&&this.shouldFormatValues){var r=e.date.parse(n,"Y-m-d");n=e.date.format(r,t._dateFormat)}this.dateInput.val(n)},setClearButtonVisibility:function(){this.showClearButton=!this.def.required&&!_.isEmpty(this.getValue())},setControls:function(){this.input=this.$el.find("input"),this.clearButton=this.$el.find(".clear-button")},toggleControls:function(){var e=_.isEmpty(this.getValue());this.input.toggleClass("empty",!this.def.required&&e),this.clearButton.toggle(!this.def.required&&!e)},setChanged:function(){this._changed=!0},getValue:function(){return this.model.get(this.name)},handleValueChange:function(e){this.setChanged(),this.model.set(this.name,this.unformat(this.getDateInputValue()),{disableRenderForContext:this.view}),this.toggleControls()},showDatePicker:function(n){var r=this.unformat(this.value)||"";if(t.ios7){var i=new Date;if(r){var s=e.date.parse(r,"Y-m-d");e.nomad.utils.isValidDate(s)&&(i=s)}var o={date:i,mode:"date"};this._setPopoverCoordinates(o,n);var u=e.date.format(o.date,"Y-m-d");this.setDateInputValue(u),this.model.set(this.name,u),this.toggleControls(),window.datePicker.show(o,_.bind(function(n){this.clearOnClickBlocker();var r=e.date.format(n,"Y-m-d");this.model.set(this.name,r)},this),_.bind(function(){this.clearOnClickBlocker()},this));return}e.nomad.showDateTimePicker(r,"showDatePicker",_.bind(function(e){this.clearOnClickBlocker(),this.model.set(this.name,e)},this))},_setPopoverCoordinates:function(e,t){var n=t.screenX,r=t.screenY,i=document.body.scrollTop;r-i<250&&(r+=30),r-=i,e.x=String(n),e.y=String(r)},isFormView:function(){return _.contains(["create","edit"],this.view.action)},isOnClickLocked:function(){return t._onClickBlocker},setOnClickBlocker:function(e){t._onClickBlocker=window.setTimeout(_.bind(this.clearOnClickBlocker,this),e||this.ONCLICK_BLOCKER_TIMEOUT)},clearOnClickBlocker:function(){window.clearTimeout(t._onClickBlocker),t._onClickBlocker=!1},_dispose:function(){this.clearOnClickBlocker(),this.clearButton&&this.clearButton.off(),e.view.NomadField.prototype._dispose.call(this)}},{initFormat:function(){t._dateFormat=e.user.getPreference("datepref")},setNativeSupport:function(){this.nativeSupport=$.os.ios||$.browser.chromeMobile||$.browser.chrome||!$.os.ios&&!$.os.android&&$.browser.webkit||!1,this.ios7=$.os.ios&&$.os.version&&($.os.version[0]==="7"||e.utils.versionCompare($.os.version,"8",">=")&&$.os.tablet),this.ios7&&e.isNative&&this.iosDatePickerPlugin&&(this.nativeSupport=!1)},iosDatePickerPlugin:!0}),e.events.on("app:sync:complete",function(){t.initFormat()}).on("app:init",function(){t.setNativeSupport()})}(SUGAR.App),function(e){var t;e.view.fields.DatetimecomboField=t=e.view.fields.DateField.extend({initialize:function(n){e.view.fields.DateField.prototype.initialize.call(this,n),t._tsFormat||t.initFormat()},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this),this.setDefaultValue(),this.calculateAndBackupInputValues(),this.setClearButtonVisibility()},bindDomChange:function(){this.setInputs(),t.nativeSupport&&this.inputs.on($.browser.chromeMobile?"change":"blur",_.bind(this.handleValueChange,this))},format:function(n){var r=_.isEmpty(n);return r||this.view.name==="edit"&&t.nativeSupport&&!this.isReadOnly()?n:e.date.format(new Date(n),t._tsFormat)},unformat:function(e){return e},setInputs:function(){this.dateInput=this.$("input[data-type=date]"),this.timeInput=this.$("input[data-type=time]"),this.inputs=this.dateInput.add(this.timeInput)},calculateAndBackupInputValues:function(){var n="",r="",i=this.getValue(),s;i&&(s=new Date(i),n=e.date.format(s,"Y-m-d"),r=e.date.format(s,"H:i:00")),this.values={date:n,time:r},this.formattedValues=null,i&&this.shouldFormatValues&&(s=new Date(i),this.formattedValues={date:e.date.format(s,t._dateFormat),time:e.date.format(s,t._timeFormat)}),this._prevValues=this.values},handleValueChange:function(e){this.setChanged(),this.setDefaultInputValues(),this.setModelValue(this.getDateInputValue(),this.getTimeInputValue()),this.calculateAndBackupInputValues(),this.toggleControls()},setDefaultInputValues:function(){var t=this.getDateInputValue(),n=this.getTimeInputValue(),r=this._prevValues.date&&!t,i=this._prevValues.time&&!n;if(t&&!n&&!i){var s=this.def.default_current_time?e.date.format(new Date,"H:i"):"00:00";this.setTimeInputValue(s)}else if(n&&!t&&!r){var o=e.date.format(new Date,"Y-m-d");this.setDateInputValue(o)}else r?this.setTimeInputValue(""):i&&this.setDateInputValue("")},onClick:function(e){if(this.isOnClickLocked())return!1;var t=e.target.getAttribute("data-type");this.setOnClickBlocker(),this.showDateTimePicker(t,e)},onBlur:function(){this.toggleControls()},getTimeInputValue:function(){var n=this.timeInput.val();if(n&&this.shouldFormatValues){var r=e.date.parse(n,t._timeFormat);n=e.date.format(r,"H:i")+":00"}return n},setTimeInputValue:function(n){if(n&&this.shouldFormatValues){var r=e.date.parse(n,"H:i");n=e.date.format(r,t._timeFormat)}this.timeInput.val(n)},setModelValue:function(e,n){var r="",i=new Date(this.getValue()),s,o;t.nativeSupport&&(o={disableRenderForContext:this.view}),e&&n&&(s=this._getDate(e+" "+n+":00",!0),r=s.toISOString()),(!s||s.getTime()!==i.getTime())&&this.model.set(this.name,r,o)},showDateTimePicker:function(n,r){var i=n==="date",s=this.getDateInputValue()||e.date.format(new Date,"Y-m-d"),o=this.getTimeInputValue()||(this.def.default_current_time?e.date.format(new Date,"H:i"):"00:00");if(t.ios7){var u=this._getDate(s+" "+o+":00",!0);e.nomad.utils.isValidDate(u)||(u=new Date);var a={date:u,mode:i?"date":"time"};this._setPopoverCoordinates(a,r),this.setDateInputValue(s),this.setTimeInputValue(o),this.setModelValue(s,o),this.toggleControls(),window.datePicker.show(a,_.bind(function(t){this.clearOnClickBlocker();if(i){var n=e.date.format(t,"Y-m-d H:i")+":00";this.setDateInputValue(n)}else this.setTimeInputValue(t);this.setDefaultInputValues(),this.setModelValue(this.getDateInputValue(),this.getTimeInputValue()),this.toggleControls()},this),_.bind(function(){this.clearOnClickBlocker()},this));return}e.nomad.showDateTimePicker(i?s:o,i?"showDatePicker":"showTimePicker",_.bind(function(e){this.clearOnClickBlocker(),i?this.setDateInputValue(e):this.setTimeInputValue(e),this.setDefaultInputValues(),this.setModelValue(this.getDateInputValue(),this.getTimeInputValue()),this.toggleControls()},this))},_adjustDefaultValue:function(e){return e.toISOString()},_getDate:function(e,t){var n=e.split(/[^0-9]/),r=new Date(n[0],n[1]-1,n[2],n[3],n[4],n[5]),i=t?0:r.getTimezoneOffset()*6e4;return new Date(r.getTime()-i)},_dispose:function(){e.view.fields.DateField.prototype._dispose.call(this),this.inputs&&this.inputs.off()}},{initFormat:function(){t._tsFormat=e.user.getPreference("datepref")+" "+e.user.getPreference("timepref"),t._dateFormat=e.user.getPreference("datepref")||"Y-m-d",t._timeFormat=e.user.getPreference("timepref")}}),e.events.on("app:sync:complete",function(){t.initFormat()}).on("app:init",function(){t.setNativeSupport()})}(SUGAR.App),function(e){e.view.fields.IntField=e.view.NumericField.extend({})}(SUGAR.App),function(e){e.view.fields.InviteesField=e.view.NomadField.extend({cacheDisabled:!0,events:{"touchstart .checkbox":"touchCheckbox","click .secondary-btn":"onSecondaryClick","click .invitees":"onClick"},fieldTag:"invitees",touchCheckbox:function(e){e.stopPropagation()},onClick:function(t){if(t.defaultPrevented)return!1;var n=e.context.getContext({layout:"picker-list",module:this.module,model:this.model,collection:new e.BeanCollection,skipFetch:!0});n.prepare();var r=e.controller.loadDynamic({layoutDef:{className:"layout-list",gaTrack:"invitees-picker-list",meta:{components:[{view:"list-picker"}]},context:n}}),i=r.getComponent("list-picker");i.setTemplateOption("partials",{"list-item-picker":e.template.get("list-item-parent-picker")}),i.getHeaderData=function(){return{title:e.lang.get("LBL_CHOOSE_LINK"),cancel:!0,plus:!1}};var s=["Contacts","Leads","Users"],o=e.metadata.getModuleNames({filter:"visible",access:"list"});e.acl.hasAccess("list","Users")&&o.push("Users"),s=_.intersection(s,o);var u=_.map(s,function(t){return{value:t,label:e.nomad.getPluralModuleName(t)}}).sort(function(e,t){return e.label>t.label?1:-1});i.setData({items:u}),i.on("row:clicked",function(e,t){this.createListLayout(t,this.model)},this),i.render()},createListLayout:function(t){var n=e.context.getContext({module:t});n.prepare();var r=e.controller.loadDynamic({layoutDef:{gaTrack:"invitees-list",name:"list",subType:"invitees",editable:!0,context:n}}),i=r.getComponent("list-invitees");i.setTemplateOption("partials",{"list-item":e.template.get("list-item-invitees")}),i.on("save:clicked",function(n){n=_.map(n,function(e){var n=_.pick(e.attributes,"id","name");return n.link=t.toLowerCase(),n},this);var r=_.compact(this.model.get("invitees")),i=_.pluck(r,"id");i=_.map(i,function(e){return e.toString()}),n=_.chain(n).reject(function(e){return _.include(i,e.id.toString())}).union(r).value(),this.model.set("invitees",n),e.controller.disposeDynamic({disposeAll:!0})},this)},onSecondaryClick:function(e){var t=this.model.get("invitees"),n=$(e.currentTarget).attr("uid"),r=_.reject(t,function(e){return e.id==n});return this.model.set("invitees",r),!1}})}(SUGAR.App),function(e){e.view.fields.FileField=e.view.NomadField.extend({events:{"click .input_upload":"_onInputClick","click .file-remove":"_onClearClick","change .input_upload":"_onFileSelected"},globalEvents:{"app:header:cancel":"_onHeaderCancelClick"},supportedTypes:$.os.android?["*/*"]:["image/*","video/*"],_fileType:null,_fileIsTooBigMessage:"9f2e903a-5bd9-4c8f-a822-83c125c43e5f",_fileErrorCodesToStrings:{1:"ERR_MOBILE_FILE_NOT_SUPPORTED",2:"ERR_MOBILE_FILE_NOT_READABLE",3:"ERR_MOBILE_FILE_ABORTED",4:"ERR_MOBILE_FILE_SECURITY"},initialize:function(){this.inputAccept=this.supportedTypes.join(","),e.view.NomadField.prototype.initialize.apply(this,arguments)},onAfterRender:function(){e.view.NomadField.prototype.onAfterRender.apply(this,arguments),this._dirty=!1,this.$fileInput=this.$el.find(".input_upload"),this.$fileRemoveBtn=this.$el.find(".file-remove"),this.def.required&&this.$fileRemoveBtn.addClass("hide");var t=this.value=this.model.get(this.name);this.$el.attr("file-id",t||"")},bindDomChange:function(){return},_onInputClick:function(t){e.acl.hasAccessToModel("edit",this.model,this.name)||(t.preventDefault(),t.stopPropagation())},_onFileSelected:function(){if(this.$fileInput[0].files.length===0)return;var t=this.$fileInput[0].files[0].type;this._fileType=this._getFileType(t);if(t&&!this._fileType){e.trigger("field:image:filechanged",this,e.lang.get("ERR_MOBILE_FILE_NOT_SUPPORTED"),"error");return}this._dirty=!0,e.trigger("field:image:filechanged",this,this.$fileInput,"fileselected")},_onClearClick:function(){this._changeFieldState(),this._dirty=!0,e.trigger("field:image:fileclear",this)},_onHeaderCancelClick:function(){this._dirty&&this.context.get("action")==="edit"&&this.render()},prepareFile:function(){e.trigger("field:image:filechanged",this,this.$fileInput,"preparing");var t=[_.bind(this._readFileData,this)];this._fileType==="image"&&t.push(_.bind(this._resizeImage,this)),async.series(t,_.bind(function(n){n?e.trigger("field:image:filechanged",this,n.message||e.lang.get("ERR_MOBILE_FILE_PROCESSING"),"error"):(this.$fileInput.fieldName=this.name,this._changeFieldState(!0),e.trigger("field:image:filechanged",this,this.$fileInput,"prepared"))},this))},_changeFieldState:function(e){e?(this.def.required||this.$fileRemoveBtn.removeClass("hide"),this.$el.find("i.icon-picture").addClass("hide"),this.$el.find(".value").text(this.$fileInput.fileData.name),this.$el.find(".placeholder").hide()):(this.def.required||this.$fileRemoveBtn.addClass("hide"),this.$el.find("i.icon-picture").removeClass("hide"),this.$el.find(".value").text(""),this.$el.find(".placeholder").show(),this._resetField())},_readFileData:function(t){var n=this.$fileInput[0].files[0];if(n){var r=this,i=new FileReader,s=this._binaryToDataUri;i.onload=function(e){r.$fileInput.fileData={name:n.name,size:n.size,type:n.type,binary:e.target.result,dataURI:s(e.target.result,n.type)},$.os.ios&&(r.$fileInput.fileData.name=r._getUniqFileName(n.name));try{r._setImageOrientation(e.target.result,n.name)}catch(i){}finally{t()}},i.onerror=function(n){var i=n.target.error;t({message:e.lang.get(r._fileErrorCodesToStrings[i.code]||"ERR_MOBILE_FILE_READ")}),e.logger.error("Failed to read file: ["+i.code+"]")};if(n.size>e.config.fileSizeLimit*1024*1024||n.name===r._fileIsTooBigMessage)return t({message:e.lang.get("ERR_MOBILE_FILE_SIZE_LIMIT_EXCEEDED",null,{size:e.nomad.utils.humanFileSize(e.config.fileSizeLimit*1024*1024,!0)})});i.readAsBinaryString(n)}else t({message:"No file selected"})},_resizeImage:function(t){var n=new Image,r=this,i=!1;n.onload=function(){function s(){r.$fileInput.fileData.type=n.split(",")[0].split(";")[0].split(":")[1],r.$fileInput.fileData.dataURI=n,r.$fileInput.fileData.binary=r._dataUriToBinary(n),t()}i=!0;var n=r._resizeWithCanvas(this);if(n.split(",")[1].length===0){t({message:"Image resizing failed (Failed to render to canvas)"});return}e.config.canvasTestModeOnUpload?$(r._canvas).css({position:"fixed",top:200,left:0,border:"2px red solid",zIndex:999999999}).appendTo("body").on("click",function(){$(r._canvas).remove(),s()}):s()},n.src=this.$fileInput.fileData.dataURI,_.delay(function(){i||t({message:"Image resizing failed (Failed to load file as image)"})},e.config.imageResizeTimeout)},_resizeWithCanvas:function(e){var t=$.os.ios?this._iosRenderWithCanvas:this._commonRenderWithCanvas,n=document.createElement("canvas");return n.width=e.naturalWidth,n.height=e.naturalHeight,t.call(this,e,n,{width:e.naturalWidth,height:e.naturalHeight,orientation:this.$fileInput.fileData?this.$fileInput.fileData.orientation:1})},_iosRenderWithCanvas:function(n,r,i){var s=new MegaPixImage(n),o={maxWidth:i.width,maxHeight:i.height,orientation:i.orientation};return i.width*i.height>e.config.iosCanvasSizeLimit*1024*1024&&_.extend(o,this._scaleImage(i)),s.render(r,o),r.toDataURL("image/jpeg")},_scaleImage:function(t){var n=t.width/t.height,r=e.config.iosCanvasSizeLimit*1024*1024,i,s;return i=Math.sqrt(r/n),s=i*n,{maxHeight:Math.floor(i),maxWidth:Math.floor(s)}},_commonRenderWithCanvas:function(t,n,r){function s(e,t,n,r){switch(r){case 5:case 6:case 7:case 8:e.width=n,e.height=t;break;default:e.width=t,e.height=n}var i=e.getContext("2d");switch(r){case 2:i.translate(t,0),i.scale(-1,1);break;case 3:i.translate(t,n),i.rotate(Math.PI);break;case 4:i.translate(0,n),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-n);break;case 7:i.rotate(.5*Math.PI),i.translate(t,-n),i.scale(-1,1);break;case 8:i.rotate(-0.5*Math.PI),i.translate(-t,0);break;default:}}var i=n.getContext("2d");return i.clearRect(0,0,r.width,r.height),r.orientation&&s(n,r.width,r.height,r.orientation),i.drawImage(t,0,0,r.width,r.height),this._getJpegImage(n)},_getJpegImage:function(t){var n;if(!e.supportedFeatures.canvasJpegEncoding){var r=new JPEGEncoder,i=t.getContext("2d"),s=i.getImageData(0,0,t.width,t.height);n=r.encode(s,e.config.jpegEncoderQuality)}else n=t.toDataURL("image/jpeg",e.config.jpegEncoderQuality/100);return n},_setImageOrientation:function(t,n){var r=new JpegMeta.JpegFile(t,n),i,s=this;"tiff"in r?"Orientation"in r.tiff?(s.$fileInput.fileData.orientation=parseInt(r.tiff.Orientation,10),i="Orientation tag: "+r.tiff.Orientation):i='No "Orientation" tag in image':i="No TIFF tags in image",e.config.canvasTestModeOnUpload&&e.alert.show("orientation info",{level:"info",messages:i,closeable:!0,autoClose:!0})},_binaryToDataUri:function(e,t){return"data:"+t+";base64,"+window.btoa(e)},_dataUriToBinary:function(e){return window.atob(e.split(",")[1])},_getFileType:function(e){var t=e.split("/"),n=_.find(this.supportedTypes,function(e){var n=e.split("/");return _.every(n,function(e,n){return e==="*"||e===t[n]})});if(n)return n.split("/")[0]},_getUniqFileName:function(e){var t=e.match(/.*(\..+)$/i)[1],n=e.match(/^(.+)\./i)[1];return n+"_"+ +(new Date)+t},_resetField:function(){this.$fileInput.replaceWith(this.$fileInput.clone()),this.$fileInput=this.$(".input_upload")}})}(SUGAR.App),function(e){e.view.fields.ImageField=e.view.fields.FileField.extend({supportedTypes:["image/jpeg","image/png","image/gif"],initialize:function(){e.view.fields.FileField.prototype.initialize.apply(this,arguments),this._canvas=document.createElement("canvas")},onAfterRender:function(){e.view.fields.FileField.prototype.onAfterRender.apply(this,arguments),this.value&&this._showAndPositionImage()},_setForcedRefresh:function(e){this.cacheDisabled=e},_showAndPositionImage:function(t){var n=this,r=new Image,i=this.$el,s=i.find("div.avatar"),o=t||e.api.buildFileURL({field:this.name,module:this.module,id:this.model.id},e.nomad.getFileOptions())+"&_id="+this.model.get(this.name),u;r.onload=function(){n._setForcedRefresh(!1);var i={image:r,height:s.css("height"),width:s.css("width")};e.nomad.utils.sizePicture(i),u=t||n._resizeWithCanvas(r),s.css({backgroundSize:i.sizeProp,backgroundImage:"url("+u+")"})},r.onerror=function(){n._setForcedRefresh(!0);var t=n.context.get("name"),r=e.utils.formatString("url(img/offline-{0}.svg)",[t]);s.css({backgroundImage:r})},r.src=o},prepareFile:function(){e.trigger("field:image:filechanged",this,this.$fileInput,"preparing"),async.series([_.bind(this._readFileData,this),_.bind(this._resizeImage,this),_.bind(this._applyPreview,this)],_.bind(function(n){n?e.trigger("field:image:filechanged",this,n.message||e.lang.get("ERR_MOBILE_FILE_PROCESSING"),"error"):(this.$fileInput.fieldName=this.name,this._changeFieldState(!0),e.trigger("field:image:filechanged",this,this.$fileInput,"prepared"))},this))},_changeFieldState:function(e){e?(this.def.required||this.$fileRemoveBtn.removeClass("hide"),this.$el.find("i.icon-picture").hide(),this.$el.find(".placeholder").hide()):(this.def.required||this.$fileRemoveBtn.addClass("hide"),this.$el.find("i.icon-picture").show(),this.$el.find("div.avatar").css({backgroundImage:"none"}),this.$el.find(".placeholder").show())},_readFileData:function(t){var n=this.$fileInput[0].files[0];if(n){var r=this,i=new FileReader,s=this._binaryToDataUri;i.onload=function(e){r.$fileInput.fileData={name:n.name,size:n.size,type:n.type,binary:e.target.result,dataURI:s(e.target.result,n.type)};try{r._setImageOrientation(e.target.result,n.name)}catch(i){}finally{t()}},i.onerror=function(n){var i=n.target.error;t({message:e.lang.get(r._fileErrorCodesToStrings[i.code]||"ERR_MOBILE_FILE_READ")}),e.logger.error("Failed to read file: ["+i.code+"]")},i.readAsBinaryString(n)}else t({message:"No file selected"})},_applyPreview:function(e){this.$el.find(".icon-user").hide(),this._showAndPositionImage(this.$fileInput.fileData.dataURI),e()},_resizeWithCanvas:function(t){var n=this._canvas,r=e.config.resizeImagesOnUpload,i=t.naturalWidth,s=t.naturalHeight,o=Math.max(i,s),u=$.os.ios?this._iosRenderWithCanvas:this._commonRenderWithCanvas;r||(r=o);var a=o<r?1:r/o,f=Math.round(i*a),l=Math.round(s*a);return n.width=f,n.height=l,u.call(this,t,n,{width:f,height:l,orientation:this.$fileInput.fileData?this.$fileInput.fileData.orientation:1})}})}(SUGAR.App),function(e){e.view.fields.FloatField=e.view.NumericField.extend({isFloat:!0})}(SUGAR.App),function(e){e.view.fields.EnumField=e.view.NomadField.extend({fieldTag:"select",cacheDisabled:!0,events:{"focusin select":"onFocus","focusout select":"onBlur"},initialize:function(){this._super("initialize",arguments),this.filteredItems=e.metadata.getEditableDropdownFilter(this.def.options)},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this);var t=this.model.get(this.name),n=this.view.isEditView();this.setRenderItems();if(!this.model||!n||!e.nomad.isEmptyValue(t))return;if(n&&_.isUndefined(t)){var r=this.getDefaultValue();r&&(this.value=t,this.model.set(this.name,r,{silent:!0}))}},getItems:function(){var t=this.def.options;return _.isEmpty(this.items)?_.isString(this.def.options)&&(t=e.lang.getAppListStrings(this.def.options)):t=this.items,t||[]},setRenderItems:function(){var e=this.getItems();this.renderItems={},!_.isEmpty(this.filteredItems)&&!_.isArray(e)?_.each(e,function(e,t){if(this.filteredItems[t]||this.getValue()===e)this.renderItems[t]=e},this):this.renderItems=e},onAfterRender:function(){e.view.NomadField.prototype.onAfterRender.call(this),this.placeholder=this.$el.find(".placeholder").eq(0);var t=this.getValue(),n=this.getDefaultValue();t===""&&!this.hasEmptyOption()&&t!==n&&(t=n),this.value=t,this.placeholder.toggle(e.nomad.isEmptyValue(t)),this.$el.toggle(!_.isEmpty(this.renderItems))},onFocus:function(){this.placeholder.hide()},onBlur:function(){this.placeholder.toggle(!this.value),document.activeElement.blur()},onFieldChange:function(){var e=this.unformat(this._$fieldEl.val()||this._$fieldEl.attr("value"));this.value=e,this.model.set(this.name,e,{disableRenderForContext:this.view}),this.onBlur()},getValue:function(){return this.model.get(this.name)},getDefaultValue:function(){var e=this.def["default"],t=this.getKeys();return _.isNumber(e)&&(e=e.toString(10)),!_.contains(t,e)&&!_.isEmpty(t)&&(e=t[0]),e},hasEmptyOption:function(){var e=this.getKeys();return _.contains(e,"")},getKeys:function(){var t=[];return _.isString(this.def.options)?t=e.lang.getAppListKeys(this.def.options):_.isObject(this.def.options)&&(t=_.keys(this.def.options)),t}})}(SUGAR.App),function(e){e.view.fields.NativeEnumField=e.view.fields.EnumField.extend({fieldTag:".actionsheet-select",events:{"click .actionsheet-select":"onFocus"},onFocus:function(){var t=this;this._super("onFocus",arguments),e.nomad._showActionSheet("",_.values(this.renderItems),function(n){var r=null;_.each(t.renderItems,function(e,t){e===n&&(r=t)}),t._$fieldEl.attr("value",r),t._$fieldEl.text(n),t.onFieldChange()})},onBeforeRender:function(){this._super("onBeforeRender",arguments),this.valueText=this.renderItems[this.model.get(this.name)]}})}(SUGAR.App),function(e){e.view.fields.EmailField=e.view.NomadField.extend({events:{"click .actions-btn":"showActions","click .value a":"sendEmail",'keyup [email-id="-1"] input':"onNewEmailFieldKeyUp"},_getValue:function(){return this.model.get(this.name)},_getPrimaryEmail:function(){return _.findWhere(this._getValue(),{primary_address:!0})},_render:function(){var t=this._getValue();t&&t.length&&(_.each(t,function(e){_.each(["primary_address","opt_out","invalid_email"],function(t){e[t]=!!Number(e[t])})}),t=_.sortBy(t,function(e){return-Number(e.primary_address)}),this.model.set(this.name,t,{silent:!0})),e.view.NomadField.prototype._render.apply(this,arguments)},onAfterRender:function(){var t=this._getPrimaryEmail();!this.model.get("email1")&&t&&this._setEmail1Value(t.email_address),e.view.NomadField.prototype.onAfterRender.apply(this,arguments)},_moduleHasEmail1:function(){return!!this.model.fields.email1},_setEmail1Value:function(e){this._moduleHasEmail1()&&this.model.set("email1",e,{silent:!0})},_getEmailObject:function(e){var t=e.closest("[email-id]").attr("email-id");return t!=-1&&this._getValue()[t]||null},setPrimaryEmail:function(e){var t=this._getValue(),n=this._getPrimaryEmail();n&&(n.primary_address=!1),this.$el.find(".primary-address").removeClass("primary-address"),n=t[e],n.primary_address=!0,this._setEmail1Value(n.email_address),this.$el.find('[email-id="'+e+'"]').addClass("primary-address")},_toggleAttr:function(e,t){var n=this._getValue()[e],r=t.replace("_","-"),i=n[t]=!n[t];this._getEmailFieldRow(e)[i?"addClass":"removeClass"](r)},toggleOptOut:function(e){this._toggleAttr(e,"opt_out")},toggleInvalid:function(e){this._toggleAttr(e,"invalid_email")},_getEmailFieldRow:function(e){return this.$el.find('.controls-flex[email-id="'+e+'"]')},removeEmail:function(e){var t=this._getValue(),n=t.splice(e,1)[0];if(n.primary_address){var r="";t.length&&(t[0].primary_address=!0,r=t[0].email_address),this._setEmail1Value(r)}this.model.trigger("change:email")},_makeEmail:function(e){var t=!this._getValue().length;return _.isUndefined(e)&&(e=""),t&&this._setEmail1Value(e),{email_address:e,primary_address:t,invalid_email:!1,opt_out:!1}},onFieldChange:function(e){var t=$(e.currentTarget),n=this._getEmailObject(t),r=this.unformat(t.val()),i;n?n.email_address=r:r&&(i=this._getValue(),i||(i=[],this.model.set(this.name,i,{silent:!0})),i.push(this._makeEmail(r))),this.model.trigger("change:email")},onNewEmailFieldKeyUp:function(e){var t=$(e.currentTarget),n=this.unformat(t.val());this.$el.find(".add-btn").css({visibility:n?"visible":"hidden"})},_displayValidationMessage:function(t){var n,r=[];this.$(".controls").children(".error-display").remove(),this.$(".control-group").removeClass("error"),this.$("[email-address]").removeClass("error").remove(".icon-exclamation-sign");if(t){var i=[];this.$(".control-group").addClass("error"),_.each(this._getValue(),function(e,n){_.contains(t.email,e.email_address)&&i.push(n)}),_.each(i,function(e){this.$('[email-id="'+e+'"]').addClass("error").append('<span class="icon icon-exclamation-sign"></span>')}),_.each(t,function(t,n){r.push(e.error.getErrorString(n,t))}),n=e.template.get("edit-field-error"),this.$(".controls").append(n(r))}e.analytics.trackEvent("validation",this.name)},showActions:function(t){function u(){n.removeClass("active")}var n=$(t.currentTarget);n.addClass("active");var r=n.closest("[email-id]").attr("email-id"),i=this._getValue()[r],s=[this.toggleOptOut,this.toggleInvalid,this.removeEmail],o=[i.opt_out?"LBL_EMAIL_ACTION_SET_OPT_IN":"LBL_EMAIL_ACTION_SET_OPT_OUT",i.invalid_email?"LBL_EMAIL_ACTION_SET_VALID":"LBL_EMAIL_ACTION_SET_INVALID","LBL_REMOVE"];return i.primary_address||(o.unshift("LBL_EMAIL_ACTION_SET_PRIMARY"),s.unshift(this.setPrimaryEmail)),s=_.map(s,function(e){return _.bind(e,this,r)},this),o=_.map(o,function(t){return e.lang.get(t)}),e.nomad._showActionSheet(null,o,function(e,t){s[t](),u()},u),!1},sendEmail:function(t){var n=$(t.target).data("index");if(n){var r=this._getValue();_.isObject(r[n])&&e.nomad.sendEmail([r[n].email_address])}}})}(SUGAR.App),function(e){e.view.fields.ParentField=e.view.NomadField.extend({events:{"click .secondary-btn":"onSecondaryClick","click .parent":"onClick"},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this);var t=this.model.get("parent_type");this.hasAccess=e.acl.hasAccess("read",t)&&!_.isEmpty(e.metadata.getModule(t));var n=this.model.get(this.def.id_name);this.link=!_.contains(e.config.readonlyModules,t)&&n&&e.acl.hasAccess("view",t)?e.router.buildRoute(t,n):null},onClick:function(t){if(t.defaultPrevented)return!1;var n=e.context.getContext({layout:"parent-picker-list",model:this.model,collection:new e.BeanCollection,skipFetch:!0});n.prepare();var r=e.controller.loadDynamic({layoutDef:{className:"layout-list list-picker",gaTrack:"parent-picker-list",meta:{components:[{view:"list-picker"}]},context:n}}),i=r.getComponent("list-picker");i.setTemplateOption("partials",{"list-item-picker":e.template.get("list-item-parent-picker")}),i.getHeaderData=function(){return{title:e.lang.get("LBL_CHOOSE_PARENT_TYPE"),cancel:!0,plus:!1}};var s=e.lang.getAppListStrings(this.def.options)||{},o=e.metadata.getModuleNames({filter:"visible"}),u=_.intersection(_.keys(s),o);_.contains(["Notes","Tasks"],this.module)&&(u=_.without(u,"Contacts")),u=_.filter(u,function(t){return e.acl.hasAccess("read",t)},this);var a=_.map(u,function(e){return{value:e,label:s[e]}}).sort(function(e,t){return e.label>t.label?1:-1});i.setData({items:a}),i.on("row:clicked",function(e,t){this.createParentListLayout(t,this.model)},this),i.render()},createParentListLayout:function(t,n){var r=e.context.getContext({module:t}).prepare(),i=e.controller.loadDynamic({layoutDef:{gaTrack:"parent-list",name:"list",subType:"parent",editable:!0,context:r}}),s=i.getComponent("list-parent");s.setTemplateOption("partials",{"list-item-picker":e.template.get("list-item-parent")}),s.on("menu:item:clicked",function(r){n.set({parent_name:r.get("name"),parent_id:r.get("id"),parent_type:t}),e.controller.disposeDynamic({disposeAll:!0})},this)},onSecondaryClick:function(e){return this.model.set({parent_name:"",parent_id:"",parent_type:""}),!1}})}(SUGAR.App),function(e){e.view.fields.PhoneField=e.view.NomadField.extend({events:{"click .value a":"callPhone"},format:function(e){if(!e)return;e=_.isString(e)?e.trim():e;var t="",n=e.match(/^\(?([0-9,;#*+]{3})?\)?[\-. ]?([0-9,;#*+]{3})[\-. ]?([0-9,;#*+]{4,10})$/);return n&&n.length===4&&(n[1]&&(t+="("+n[1]+") "),t+=n[2]+"-"+n[3]),t||e},onFieldChange:function(){var e=this.format(this.unformat(this._$fieldEl.val()))||"",t=this.model.get(this.name);this.model.set(this.name,e),t===e&&this.model.trigger("change:"+this.name,this.model,e)},callPhone:function(){e.nomad.callPhone(this.value,this.model)}})}(SUGAR.App),function(e){e.view.fields.TextareaField=e.view.NomadField.extend({fieldTag:"textarea",events:{"click .textarea":"onClick"},onClick:function(e){var t=this.isReadOnly();if(_.isEmpty(this.value)&&t)return;var n=this.getContext(),r=this.getLayoutDef(n);this.show(r)},getContext:function(){var t=e.context.getContext({create:!0,parentModel:this.model,fieldName:this.def.name,isReadOnly:this.isReadOnly()});return t.prepare(),t},getLayoutDef:function(e){return{className:"textarea",gaTrack:"textarea",meta:{components:[{view:"textarea-edit",editedFieldName:this.label}]},context:e}},show:function(t){var n=e.controller.loadDynamic({layoutDef:t}),r=n.getComponent("textarea-edit");r.setValue(this.model.get(this.name)||"")}})}(SUGAR.App),function(e){var t;e.view.fields.EmailbodyField=t=e.view.fields.TextareaField.extend({fieldTag:"textarea",events:{"click textarea":"onClick"},onClick:function(t){if(_.isEmpty(this.value)&&this.isReadOnly())return;e.nomad.showEmailBody(this.def,this.model)},format:function(e){return _.isEmpty(e)&&(e=t.getPlainTextValue(this.name,this.model)),e}},{getPlainTextValue:function(e,t){var n=e.replace(/_html$/,""),r=t.get(n)||"";return $.trim(r)}})}(SUGAR.App),function(e){e.view.fields.RadioenumField=e.view.NomadField.extend({events:{"click .btn-group .btn":"onClick"},onClick:function(e){this.model.set(this.name,$(e.currentTarget).val())}})}(SUGAR.App),function(e){e.view.fields.RelateField=e.view.NomadField.extend({events:{"click .secondary-btn":"onSecondaryClick","click .relate":"onClick"},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this);var t=this.def.module;this.hasAccess=e.acl.hasAccess("read",t)&&!_.isEmpty(e.metadata.getModule(t));var n=this.model.get(this.def.id_name);this.link=!_.contains(e.config.readonlyModules,t)&&n&&e.acl.hasAccess("view",t)?e.router.buildRoute(t,n):null,!this.hasAccess&&this.view.name==="edit"&&(this.options.viewName="readonly")},onClick:function(t){if(t.defaultPrevented)return!1;var n=e.metadata.getModule(this.module).fields[this.name],r=n.module,i=e.context.getContext({module:r}).prepare(),s=e.controller.loadDynamic({layoutDef:{gaTrack:"relate",name:"list",subType:"relate",editable:!0,context:i}}),o=s.getComponent("list-relate");o.on("menu:item:clicked",function(t){this.onRelatedItemSelected(t),e.controller.goBack()},this)},onRelatedItemSelected:function(t){var n={},r=e.metadata.getModule(this.view.module).fields[this.name];n[r.id_name]=t.get("id"),n[r.name]=t.get("name"),r.populate_list&&r.auto_populate&&_.each(r.populate_list,function(r,i){i=_.isNumber(i)?r:i;var s=t.get(i);!_.isUndefined(s)&&e.acl.hasAccessToModel("edit",this.model,r)&&(n[r]=s,this.view.module==="RevenueLineItems"&&i==="discount_price"&&_.each(["likely_case","best_case","worst_case"],function(e){n[e]=s})),i==="currency_id"&&this.model.get("currency_id")!==s&&this.model.changeCurrencyId(s)},this),this.model.set(n)},onSecondaryClick:function(e){return this.model.set(this.name,""),this.model.set(this.def.id_name,""),!1}})}(SUGAR.App),function(e){e.view.fields.MultienumField=e.view.NomadField.extend({events:{"touchstart .remove":"highlightRemoveClick","click .remove":"onRemoveClick","click .multiselect":"onClick"},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this);var t=this.model.get(this.name);this.view.isEditView()&&_.isArray(t)&&!this.def.required&&t.length===1&&t[0]===""&&this.model.set(this.name,[],{silent:!0})},onClick:function(t){if(t.defaultPrevented||this.isReadOnly())return!1;var n=e.context.getContext({create:!0});n.prepare();var r=e.controller.loadDynamic({layoutDef:{className:"layout-list",gaTrack:"multienum",meta:{components:[{view:"list-multiselect"}]},context:n}}),i=r.getComponent("list-multiselect"),s=e.lang.getAppListStrings(this.def.options),o={};_.each(s,function(e,t){!_.contains(this.value,t)&&t!==""&&(o[t]=e)},this),i.setData({items:o}),i.on("multienum:save:clicked",this.onClickSave,this),i.render(),t.preventDefault()},onClickSave:function(t){var n=_.compact(this.model.get(this.name));this.model.set(this.name,_.union(n,t)),e.controller.disposeDynamic()},highlightRemoveClick:function(e){$(e.target).addClass("selected-item")},onRemoveClick:function(e){var t=this.model.get(this.name),n=$(e.target).is("[item-id]")?$(e.target):$(e.target).closest("[item-id]"),r=n.attr("item-id"),i=_.without(t,r);return this.model.set(this.name,i),!1}})}(SUGAR.App),function(e){e.view.fields.TeamsetField=e.view.NomadField.extend({cacheDisabled:!0,events:{"click .primary-btn":"onPrimaryClick","click .secondary-btn":"onSecondaryClick","click .teamset":"onClick"},initialize:function(t){e.view.NomadField.prototype.initialize.call(this,t),this.model.on("change:team_name",function(){this.$el.find("[team-id]").removeClass("active")},this)},_render:function(){var t=this.model.get(this.name);_.isArray(t)&&(t=_.sortBy(t,function(e){return e.primary!==!0}),this.model.set(this.name,t,{silent:!0})),e.view.NomadField.prototype._render.apply(this,arguments)},onClick:function(t){if(t.defaultPrevented||this.isReadOnly())return!1;var n="Teams",r=e.context.getContext({module:n}).prepare(),i=e.controller.loadDynamic({layoutDef:{name:"list",subType:"teamset",editable:!0,gaTrack:"teamset",context:r}});i.getComponent("list-teamset").on("multienum:save:clicked",this.onClickSave,this)},onClickSave:function(t){t=_.map(t,function(e){return _.pick(e.attributes,"id","name","name_2")});var n=_.compact(this.model.get("team_name")),r=_.pluck(n,"id");r=_.map(r,function(e){return e.toString()});var i=_.chain(t).reject(function(e){return _.include(r,e.id.toString())}).union(n).value();this.model.set("team_name",i),e.controller.goBack()},onPrimaryClick:function(e){var t=this.$el.find("[team-id].active").removeClass("active").attr("team-id"),n=$(e.currentTarget);n.addClass("active");var r=_.find(this.model.get("team_name"),function(e){return e.id==t});r&&(r.primary=!1);var i=$(e.currentTarget).attr("team-id"),s=_.find(this.model.get("team_name"),function(e){return e.id==i});return s.primary=!0,!1},onSecondaryClick:function(e){var t=this.model.get("team_name"),n=$(e.target).is("[team-id]")?$(e.target):$(e.target).closest("[team-id]"),r=n.attr("team-id"),i=_.reject(t,function(e){return e.id==r});return this.model.set("team_name",i),!1}})}(SUGAR.App),function(e){e.view.fields.UrlField=e.view.NomadField.extend({regexp:/^(https?:\/\/)?([\da-zA-Z\.-]+)\.([a-zA-Z\.]{2,6})([\/\w \.-]*)*\/?$/,events:{"click .value a":"openUrl"},unformat:function(e){var t="://",n=e;e=$.trim(e);if(e.indexOf(t)>-1){n=e.split(t)[1];if(!n)return""}return e},openUrl:function(){e.nomad.openUrl(this.model.get(this.name))}})}(SUGAR.App),function(e){e.view.fields.FavoriteField=e.view.NomadField.extend({events:{"click .favorite-icon":"onClick"},onClick:function(t){t.preventDefault(),t.stopPropagation(),e.alert.dismissAll();var n=$(t.currentTarget),r=n.hasClass("icon-star"),i=this.model,s=function(){i.set("my_favorite",r)};return i.favorite(!r,{error:s}),!1}})}(SUGAR.App),function(e){e.view.fields.FieldsetField=e.view.NomadField.extend({fields:null,subfields:"",initialize:function(t){var n=this;e.view.NomadField.prototype.initialize.call(this,t),_.each(this.def.fields,function(e){if(e.type==="label"){var t=e.css_class.match(/label_[^\s]+/);if(t.length>0){var r=t[0].substring(6);n.model.on("change:"+r,function(){var e=n.model.get(r);e||e===0||e===""?n.$el.find(".label_"+r).removeClass("hide"):n.$el.find(".label_"+r).addClass("hide")},n)}}})},_render:function(){this.template===e.template.empty&&e.view.NomadField.prototype._render.apply(this,arguments)},getPlaceholder:function(){var t="",n=this;return this.fields||(this.fields=[],_.each(this.def.fields,function(r){var i=e.view.createField({def:r,view:n.view,model:n.model});n.fields.push(i),t+=i.getPlaceholder()})),this.def.orientation==="horizontal"?(this.subfields=new Handlebars.SafeString(t),e.view.NomadField.prototype.getPlaceholder.call(this)):new Handlebars.SafeString(t)}})}(SUGAR.App),function(e){e.view.fields.FollowField=e.view.NomadField.extend({events:{"click .follow-label":"onClick"},onClick:function(e){e.preventDefault(),e.stopPropagation(),this.model.follow(!this.model.get("following"),{error:_.bind(this.onError,this)})},onError:function(){this.model.set("following",!this.model.get("following"))}})}(SUGAR.App),function(e){e.view.fields.LabelField=e.view.NomadField.extend({onAfterRender:function(){e.view.NomadField.prototype.onAfterRender.call(this);if(this.el){var t=this.el.className.match(/label_[^\s]+/);if(t.length>0){var n=this.model.get(t[0].substring(6));n||n===0||n===""?$(this.el).removeClass("hide"):$(this.el).addClass("hide")}}}})}(SUGAR.App),function(e){e.view.fields.AddressField=e.view.NomadField.extend({cacheDisabled:!0,events:{"click .control-group":"onClick","click .value a":"openAddress"},initialize:function(t){e.view.NomadField.prototype.initialize.call(this,t),this.model.on("error:validation",this._handleValidationError,this),this.fieldNames=_.pluck(this.def.fields,"name"),this.required=_.any(this.def.fields,function(t){return t.required||e.metadata.getModule(this.module).fields[t.name].required},this)},onClick:function(){if(this.isReadOnly())return;var t=this,n=new e.NomadBean;n.module=this.model.module,n.fields={},n.attributes=e.utils.deepCopy(this.model.attributes),_.each(this.def.fields,function(r){n.fields[r.name]=e.utils.deepCopy(t.model.fields[r.name]),n.attributes[r.name]=t.model.attributes[r.name]});var r=e.context.getContext({editedFieldName:this.label,addressFields:this.def.fields,parentModel:this.model,model:n,collection:new e.BeanCollection,skipFetch:!0});r.prepare(),e.controller.loadDynamic({layoutDef:{className:"edit-address",gaTrack:"address",meta:{components:[{view:"address-edit"}]},context:r}})},bindDataChange:function(){this.model&&_.each(this.def.fields,function(e){this.model.on("change:"+e.name,this.render,this)},this)},onBeforeRender:function(){e.view.NomadField.prototype.onBeforeRender.call(this),e.serverInfo.isSevenUp||(e.acl.hasAccessToModel("edit",this.model,this.def.fields[0].name)?this.options.viewName="edit":this.options.viewName="readonly");var t=[],n=[],r=/street/;_.each(this.def.fields,function(i){var s=this.model.get(i.name);if(s){var o=i.name;r.exec(o)?(e.serverInfo.isSevenUp?s=e.nomad.utils.nl2br(s):(s=s.replace(/(\n(\r)?)/g," ").replace(/\s{2,}/g," "),this.model.set(o,s)),t.push(s)):n.push(s)}},this),this.address=(t.length>0?t.join()+"<br>":"")+n.join(" ")},_handleValidationError:function(t){var n,r={},i=[],s=this.$(".controls"),o=this.model.module;_.each(t,function(e,t){_.contains(this.fieldNames,t)&&(r[t]=e)},this),s.children(".error-display").remove();if(_.isEmpty(r))return;this.$(".control-group").addClass("error"),_.each(r,function(t,n){var r=_.find(this.def.fields,function(e){return e.name===n}),s=r?e.lang.get(r.label,o):n;_.each(t,function(t,n){i.push(s+" : "+e.error.getErrorString(n,t))})},this),n=e.template.get("edit-field-error"),s.append(n(i))},openAddress:function(){var t={};t[this.name]=this.def.fields;var n=this.model.getAddresses(t);e.nomad.openAddress(n)}})}(SUGAR.App),function(e){var t,n,r=document.getElementById("viewport-meta"),i={"default":r?r.getAttribute("content"):null};e.augment("nomad",{timePaused:0,globalEvents:["app:access:error","app:orientation:changed","app:header:save","app:header:cancel","app:header:clicked","app:header:home","app:header:add","app:header:picturechanged","app:header:action","app:settings:changed","app:rightmenu:show","app:mainmenu:show","edit:view:save","associate:view:save","actionsheet:show","acl:change","field:image:filechanged","field:image:fileclear","app:keyboard:hide","app:dashboards:changed"],_onAppStart:function(){e.supportedFeatures.dashboards&&!e.nomad.dashboards.isStarted()?e.nomad.dashboards.start(function(t){t&&e.logger.error(t),e.nomad.startApp()}):e.nomad.startApp()},startApp:function(){var t=e.nomad.utils.getHash().replace("#","");e.supportedFeatures.settingsDefaultView&&!t&&e.nomad.navigateToDefaultView(),e.started?e.router.start():e.start(),e.nomad.disposeAllAdditionalComponents(),e.controller.loadAdditionalComponents(e.config.additionalComponents),_.each(e.additionalComponents,function(e){e.bindGlobalEvents()}),e.nomad.mainMenu.start()},navigateToDefaultView:function(){var t=e.nomad.getSetting("default_view")||e.config.defaultViewScheme,n=this.getDefaultRoute(t);e.routing.replaceRoute(n)},getDefaultRoute:function(t){var n=t.split(":");if(n[0]==="Modules"){if(_.contains(e.metadata.getModuleNames(),n[1]))return n.shift(),n.join("/");n=["Search"]}return _.contains(["Dashboards","Search"],n[0])&&!e.supportedFeatures.dashboards&&(n=["home"]),n.join("/")},deviceReady:function(){var t=this;window.App=SUGAR.App,e.isNative=!_.isUndefined(window.cordova),e.isTouchCapable="ontouchstart"in window,this._computeMode(),e.clientInfo={app:{name:e.config.appName||e.config.appId,isNative:e.isNative},device:null,browser:_.extend($.browser,{userAgent:navigator.userAgent})},e.nomad.initSupportedFeatures(),e.events.on("nomad:sync:complete",this._onAppStart),async.waterfall([function(t){e.keyValueStore=e[e.config.keyValueStore],e.isNative&&$.os.android&&$.os.version&&e.utils.versionCompare("5",$.os.version,">=")&&(e.keyValueStore=e.sqlKeyValueStore),e.keyValueStore.open({name:"store-"+e.config.appId+"-"+e.config.env,"native":e.isNative}),e.keyValueStore.initBucket("ac",function(n,r){n||(e.nomad.utils.migrateKeyValueStore(r),e.cache.store=r),t(n)})},function(n){t.preInit(e.clientInfo,n)},function(e){t.start()}],function(t){t&&(e.logger.fatal("Failed to init the app: "+t),e.nomad.showAlert(e.lang.get("ERR_INTERNAL_ERR_MSG"),null,e.lang.get("ERR_GENERIC_TITLE")))}),!e.isNative&&$.os.android&&$.smartbanner&&$.smartbanner({layer:!0})},_computeMode:function(){e.isTablet=e.config.deviceMode.type==="tablet"||e.config.deviceMode.type==="auto"&&(document.body.clientWidth>=768||document.body.clientHeight>=768),e.isNarrowTabletMode=e.isTablet&&(document.body.clientWidth<601||document.body.clientHeight<601),e.isTablet?($(document.body).removeClass("mobile"),$(document.body).addClass("tablet"),e.isNarrowTabletMode&&$(document.body).addClass("narrow-tablet-mode")):($(document.body).removeClass("tablet narrow-tablet-mode"),$(document.body).addClass("mobile")),$.os.desktop&&$(document.body).addClass("desktop")},disposeAllAdditionalComponents:function(){_.each(e.additionalComponents,function(e){e&&(e.unbindGlobalEvents(),e.dispose(),e.$el&&(e.$el.html(""),e.unbind()),e.unbindData(),e.stopListening(),e.model=null,e.collection=null,e.context=null,e.$el=null,e.el=null)}),e.additionalComponents={}},start:function(){this.computeOrientation(),e.logger.debug("Client: "+JSON.stringify(e.clientInfo)),e.nomad._initializeRemoteWebInspector(),$.__swipeHelper.init();try{var t=e.config.env+":"+e.config.appId+":settings",n=window.localStorage.getItem(t);n&&n[1]==="'"&&window.localStorage.setItem(t,n.replace(/'/g,'"'))}catch(r){}e.init({el:"#nomad"}),e.nomad.handleAuthTokens(),e.api.debug=e.config.debugSugarApi,e.api.setRefreshTokenSuccessCallback(function(e){e()}),e.api.handleExternalLogin=_.bind(e.nomad.handleExternalLogin,this),e.telephony.clearCallLog(),this.setFontSize(e.nomad.getSetting("fontSize")),_.each(this.globalEvents,function(t){e.events.register(t,e)}),e.logger.debug("App started in "+(e.isNative?"native shell":"browser")),document.addEventListener("pause",_.bind(this.onPause,this),!1),document.addEventListener("resume",_.bind(this.onResume,this),!1),document.addEventListener("memoryWarning",_.bind(this.onMemoryWarning,this),!1),document.addEventListener("backbutton",_.bind(this.onBackButtonClicked,this),!1),window.addEventListener("orientationchange",_.bind(this.onOrientationChange,this),!1),e.isSynced?this._onAppStart():e.start()},initSupportedFeatures:function(){e.supportedFeatures={fileUpload:function(){var n=$.os.version;if($.os&&$.os.version){if($.os.ios)return e.utils.versionCompare(n,"6",">=");if($.os.android)return e.utils.versionCompare(n,"4.0.3",">=")}return!0}(),menuAnimation:function(){return $.os&&$.os.version?!$.os.android||!e.utils.versionCompare($.os.version,"4.0.3","<"):!0}(),canvasJpegEncoding:function(){var t=document.createElement("canvas"),n=t.toDataURL("image/jpeg");return n.indexOf("image/jpeg")!==-1}(),bulkApi:!1,recents:!1,offline:!1,fileUploadForDocs:!1,fts:!1,followingPreloaderFilter:!1,productsModule:!1,dashboards:!1,configurableSavedReportsChart:!1,settingsDefaultView:!1,nativeEnum:!1}},updateSupportedFeatures:function(t){var n=_.isEmpty(e.metadata.getServerInfo())?t?t.server_info:{}:e.metadata.getServerInfo();e.supportedFeatures.offline=e.offline&&e.offline.isSupported(n),e.supportedFeatures.fts=n.fts&&n.fts.enabled,e.supportedFeatures.productsModule=e.nomad.isSevenUp(n),e.supportedFeatures.dashboards=e.config.dashboards.enabled&&e.utils.versionCompare(n.version,e.config.dashboards.minServerVersion,">=");var r=e.config.dashboards.dashlets["activitystream-dashlet"];e.supportedFeatures.activities=!!r&&r.enabled&&e.utils.versionCompare(n.version,r.minServerVersion,">="),e.utils.versionCompare(n.version,"7.1.5",">=")&&(e.supportedFeatures.settingsDefaultView=!0),e.utils.versionCompare(n.version,"7.2",">=")&&(e.supportedFeatures.recents=!0,e.supportedFeatures.followingPreloaderFilter=!0),e.utils.versionCompare(n.version,"7.2.1",">=")&&(e.supportedFeatures.bulkApi=!0,e.supportedFeatures.fileUploadForDocs=!0),e.utils.versionCompare(n.version,"7.6.0.0RC1",">=")&&(e.supportedFeatures.configurableSavedReportsChart=!0),e.isNative&&$.os.tablet&&($.os.android&&e.utils.versionCompare($.os.version,"5",">=")||$.os.ipad&&e.utils.versionCompare($.os.version,"8",">="))&&(e.supportedFeatures.nativeEnum=!0),this._patchConfig()},updateServerInfo:function(){e.serverInfo=e.metadata.getServerInfo(),this.updateSupportedFeatures()},_patchConfig:function(){e.supportedFeatures.productsModule?e.config.unsupportedModules=_.without(e.config.unsupportedModules,"Products"):_.contains(e.config.unsupportedModules,"Products")||e.config.unsupportedModules.push("Products"),e.supportedFeatures.fileUploadForDocs?e.config.nonCreatableModules=_.without(e.config.nonCreatableModules,"Documents"):_.contains(e.config.nonCreatableModules,"Documents")||e.config.nonCreatableModules.push("Documents")},isSevenUp:function(t){return t?e.utils.versionCompare(t.version,"7.0RC",">="):!1},resetMeta:function(t,n){var r=e.cache.get("app:build")!==e.config.appBuild,i=t||!e.config.cacheMeta||r,s=e.metadata.getHash();if(i){e.logger.debug("Resetting meta"),e.metadata.clearCache(),e.cache.cut("user");var o=JSON.parse(JSON.stringify(e.baseMetadata));!t&&s&&!r&&(o._hash=s),e.metadata.set(o,!1,!0),e.cache.set("app:build",e.config.appBuild)}(i||n)&&e.cache.set("app:synced","0"),e.isSynced=!n&&!i&&e.config.cacheMeta&&e.cache.get("app:synced")==="1",e.logger.debug("App is synced: "+e.isSynced)},resetAuth:function(){e[e.config.authStore].cut("AuthAccessToken"),e[e.config.authStore].cut("AuthRefreshToken")},saveUser:function(){e.cache.set("user",e.user.toJSON())},restoreUser:function(){e.user.set(e.cache.get("user")||{})},resetUserSettings:function(){var t=this.fetchSettings(),n=t.loginName;t.prevUsername!==n?(_.each(t,function(e,n){_.contains(["loginName","loginUrl","siteUrl"],n)||delete t[n]}),t.prevUsername=n,this.saveSettings(t),e.cache.cut("lang"),e.user.clear(),this.saveUser(),e.nomad.dashboards.cleanDashboardsCache()):t.prevSiteUrl!==t.siteUrl&&(e.nomad.removeSetting("default_view"),e.nomad.dashboards.cleanDashboardsCache(),t.prevSiteUrl=t.siteUrl,this.saveSettings(t))},getSetting:function(e){return this.fetchSettings()[e]},setSetting:function(e,t){var n=this.fetchSettings();_.isObject(e)?n=_.extend(n,e):n[e]=t,this.saveSettings(n)},removeSetting:function(e){var t=this.fetchSettings();delete t[e],this.saveSettings(t)},fetchSettings:function(){return _.isUndefined(n)&&(n=e.cache.get("settings")||{}),n},saveSettings:function(t){n=t,e.cache.set("settings",n)},enableOffline:function(t){var n=!1;t&&(n=e.nomad.getSetting("prevSiteUrl")!==e.nomad.getSetting("siteUrl"),e.nomad.setSetting("prevSiteUrl",e.nomad.getSetting("siteUrl"))),e.offline.userEnabled=_.isUndefined(e.nomad.getSetting("offlineEnabled"))?!0:!n&&Boolean(e.nomad.getSetting("offlineEnabled"))},getRelationshipLink:function(t,n){var r=e.metadata.getModule(t),i=_.find(r.fields,function(t){if(t.type==="link"){var r=e.metadata.getRelationship(t.relationship);return r&&(r.lhs_module===n||r.rhs_module===n)}});return i?i.name:null},getRelationship:function(t,n){var r=e.metadata.getModule(t),i=r.fields[n].relationship;return e.metadata.getRelationship(i)},onPause:function(t){e.activeComponents.closeAll(),e.telephony.appPaused(),e.logger.debug("App was paused"),e.logger.debug(t),e.analytics.trackEvent("device","pause"),this.timePaused=(new Date).getTime()},onResume:function(n){var r=((new Date).getTime()-(this.timePaused||0))/1e3,i=e.controller.layoutManager.getRootLayout(),s=e.controller.layoutManager.getRecordLayout(),o=i;!e.isTablet&&s&&(o=s),e.logger.debug("App resumed: "+r),e.logger.debug(n),r>60*(e.config.analytics.sessionTimeout||30)&&e.analytics.startSession(),e.analytics.trackEvent("device","resume",parseInt(r,10)),e.telephony.appResumed(),this._shouldRefresh(o)&&(o.context.resetLoadFlag(),o.loadData(),this.timePaused=0),_.delay(function(){var n=t;n!==e.nomad.computeOrientation()&&e.trigger("app:orientation:changed",window.orientation)},1e3)},_shouldRefresh:function(t){if(t&&!t.disposed&&t.name!=="edit"){var n=(new Date).getTime();if(n-this.timePaused>e.config.refreshOnResumeTimeout)return!0}return!1},onMemoryWarning:function(){e.controller.clean(),e.logger.warn("App received memory warning"),e.analytics.trackEvent("device","low-memory")},onBackButtonClicked:function(){e.analytics.trackEvent("device","back");if(e.activeComponents.hasActiveComponents()){e.activeComponents.closeRecent();return}if(e.overlay.isActive())return;e.nomad.dismissAlerts();var t=e.events._events;document.activeElement&&document.activeElement.blur(),e.controller.goBack()},onOrientationChange:function(){var t=this,n=$("body");e.isTablet&&document.activeElement&&document.activeElement.blur(),n.addClass("rotate"),_.delay(function(){n.removeClass("rotate"),$.os.ios&&e.utils.versionCompare($.os.version,"7",">=")&&window.scrollTo(0,window.scrollY),t.computeOrientation(),e.analytics.trackEvent("orientation",window.orientation),e.trigger("app:orientation:changed",window.orientation)},1e3)},computeOrientation:function(){e.isTablet&&(e.config.deviceMode.landscape||e.config.deviceMode.portrait)?(e.config.deviceMode.landscape&&(t="landscape"),e.config.deviceMode.portrait&&(t="portrait")):$.os.ios?t=window.orientation===90||window.orientation===-90?"landscape":"portrait":t=document.body.clientWidth>document.body.clientHeight?"landscape":"portrait";var n=$.os.ios?t==="portrait"?screen.height-window.innerHeight:screen.width-window.innerHeight:0;return i.landscape=", height="+(screen.width-n),i.portrait=", height="+(screen.height-n),t==="landscape"?($.os.ios&&e.isTablet&&r.setAttribute("content",i.default+i.landscape),$("html").removeClass("portrait").addClass("landscape")):($.os.ios&&e.isTablet&&r.setAttribute("content",i.default+i.portrait),$("html").removeClass("landscape").addClass("portrait")),t},getOrientation:function(){return t},dismissAlerts:function(){e.alert.dismissAll("success"),e.alert.dismissAll("error")},supportsFavs:function(t){if(t==="Home")return!0;var n=e.metadata.getModule(t);return n?n.favoritesEnabled:!1},supportsMyItems:function(t){if(t==="Home")return!0;var n=e.metadata.getModule(t);return n?!_.isUndefined(n.fields.assigned_user_id):!1},buildLinkRoute:function(e,t,n,r,i){var s=_.isString(e)?e:e.get("module");return s+="/"+t+"/link/"+n,r&&(s+="/"+r),i&&(s+="/"+i),s},_initializeRemoteWebInspector:function(){if(e.config.weinre&&e.config.weinre.server!==""){var t=document.createElement("script");t.setAttribute("src","http://"+e.config.weinre.server+":"+e.config.weinre.port+"/target/target-script-min.js#"+e.config.weinre.guid),$("body").append(t)}},contextMetaViews:{list:{numberOfItems:2},detail:{numberOfItems:999},all:{numberOfItems:999,customModsOnly:!0,useVarDef:!0}},contextMeta:{},initializeContextMeta:function(){var t=this;_.each(t.contextMetaViews,function(n,r){t.contextMeta[r]=t.contextMeta[r]||{};var i=n.type||r,s=e.metadata.getModuleNames();s.push("Users"),s.push("TxLog"),n.customModsOnly&&(s=_.reject(s,function(t){return e.nomad.isStandardModule(t)})),_.each(s,function(n){if(e.metadata.getModule(n)){var s=e.data.createBean(n);t.contextMeta[r][n]=t.calculateContextMeta(s,n,i)}})})},calculateContextMeta:function(t,n,r){var i=null,s=[],o=this.contextMetaViews[r].numberOfItems||999,u=e.metadata.getView(n,r);return this.contextMetaViews[r].useVarDef?s=[e.metadata.getModule(n)]:u&&(s=u.panels),_.each(s,function(e,n){i=t.getContextMetaData(e.fields,{fieldsNumber:o,contextData:i})}),i},getContextMeta:function(t,n){this.contextMeta[n]=this.contextMeta[n]||{};if(!this.contextMeta[n][t]){e.logger.warn("Context Menu Meta for "+t+":"+n+" was not found in the cache. Calculating.");var r=e.data.createBean(t);this.contextMeta[n][t]=this.calculateContextMeta(r,t,n)}return this.contextMeta[n][t]},isStandardModule:function(t){return _.contains(e.config.knownModules,t)},initSubpanels:function(){var t=e.metadata.getModuleNames({filter:"visible"});t.push("Users"),_.each(t,function(n){var r=e.metadata.getModule(n,"layouts"),i=r?r.subpanels:null;if(!i)return;var s=[];_.each(i.meta.components,function(r,i){var o,u;try{o=e.data.getRelatedModule(n,r.context.link),u=e.nomad.getRelationship(n,r.context.link)}catch(a){o=null,u=null}_.contains(t,o)||(o=null),o&&u?(r.module=o,r.creatable=(_.isUndefined(r.canCreate)&&_.isUndefined(r.creatable)?!0:r.canCreate||r.creatable)&&!_.contains(e.config.nonCreatableModules,o),r.linkable=(_.isUndefined(r.canLink)&&_.isUndefined(r.linkable)?!0:r.canLink||r.linkable)&&!_.contains(e.config.nonLinkableModules,o)&&(!_.contains(["Meetings","Calls","Notes","Tasks"],o)||!u.via_parent_id),r.unlinkable=_.isUndefined(r.unlinkable)?!0:r.unlinkable):s.push(i)});for(var o=0;o<s.length;++o)i.meta.components.splice(s[o]-o,1)})},hasLinkableSubpanels:function(t){return _.any(t,function(t){return t.linkable&&e.acl.hasAccess("list",t.module)})},hasCreatableSubpanels:function(t){return _.any(t,function(t){return t.creatable&&e.acl.hasAccess("create",t.module)})},getSubpanels:function(t){var n=e.metadata.getModule(t,"layouts").subpanels;return n&&n.meta?n.meta.components:[]},canCreateModule:function(t){return e.acl.hasAccess("create",t)&&!_.include(e.config.nonCreatableModules,t)},hasAccessToReqFields:function(t,n){var r=n||"edit",i="edit",s=e.metadata.getModule(t).fields,o=s.assigned_user_name,u=["team_name"];return o&&o.type==="relate"&&u.push(o.name,o.id_name),!_.chain(e.metadata.getView(t,i).panels[0].fields).filter(function(e){return _.contains(u,e.name)?!1:s[e.name]&&s[e.name].required}).find(function(n){return!e.acl.hasAccess(r,t,null,n.name)}).value()},canCreateRelated:function(e,t,n,r){return this.canCreateModule(e)&&this.hasAccessToReqFields(e,n)&&this._getSubpanel(t,r).creatable},canLinkRelated:function(e,t){return this._getSubpanel(e,t).linkable},canUnlinkRelated:function(e,t){return this._getSubpanel(e,t).unlinkable},canDisplay:function(e,t){return!e.context.get("link")||!(t.type==="parent"||t.type==="relate"&&_.include(e.relateFields,t.name))},_getSubpanel:function(e,t){return _.find(this.getSubpanels(e),function(e){return e.context.link===t})||{}},getSingularModuleName:function(t){return e.lang.getModuleName(t)},getPluralModuleName:function(t){return e.lang.getModuleName(t,{plural:!0})},showAlert:function(t,n,r,i){this._showAlert(t,n,r||e.lang.get("LBL_WARNING"),i||e.lang.get("LBL_OK"))},showConfirm:function(t,n,r,i){this._showConfirm(t,n,r||e.lang.get("LBL_CONFIRM"),i||[e.lang.get("LBL_NO"),e.lang.get("LBL_YES")])},_executeActionSheetCallback:function(t){e.routing.emulateBackButton?e.activeComponents.executeOnActiveComponentClose(t):t()},sendEmail:function(t,n,r){var i=this;t.length>1?this._showActionSheet(e.lang.get("LBL_MOBILE_CHOOSE_RECIPIENT"),t,function(e,t){i._executeActionSheetCallback(function(){i._showEmailComposer(n,r,e)})}):this._showEmailComposer(n,r,t[0])},showEmailBody:function(t,n){var r=_.isArray(t)?t[0]:t,i=n.get(r.name),s=e.view.fields.EmailbodyField.getPlainTextValue(r.name,n),o="emailbody-edit",u=e.context.getContext({create:!0});u.prepare(),e.controller.loadDynamic({layoutDef:{className:"EmailBodyView",gaTrack:"EmailBodyView",meta:{components:[{view:o,editedFieldName:e.lang.get(r.label,"Emails"),value:i||e.nomad.utils.nl2br(s)}]},context:u}})},sendConsoleLog:function(e,t,n){var r=this;this._getConsoleLogFilename(function(i){r._showEmailComposer(t,n,e,i)})},callPhone:function(t,n){var r=this;if(_.isArray(t)&&t.length>1){var i=this._buildNamedList(t);this._showActionSheet(e.lang.get("LBL_MOBILE_CHOOSE_PHONE"),i,function(i,s){r._executeActionSheetCallback(function(){e.telephony.callPhone(r._extractValue(t,s),n)})})}else e.telephony.callPhone(this._extractValue(t),n)},sendSms:function(t,n){var r=this;if(_.isArray(t)&&t.length>1){var i=this._buildNamedList(t);this._showActionSheet(e.lang.get("LBL_MOBILE_CHOOSE_PHONE"),i,function(e,i){r._executeActionSheetCallback(function(){r._showSmsComposer(r._extractValue(t,i),n)})})}else this._showSmsComposer(this._extractValue(t),n)},openUrl:function(t){if(_.isArray(t)&&t.length>1){var n=_.map(t,function(e){return _.keys(e)[0]}),r=this;this._showActionSheet(e.lang.get("LBL_MOBILE_CHOOSE_URL"),n,function(e,n){r._executeActionSheetCallback(function(){r._browseUrl(r._normalizeUrl(r._extractValue(t,n)))})})}else this._browseUrl(this._normalizeUrl(this._extractValue(t)))},showDateTimePicker:function(e,t,n){this._showDateTimePicker(e,t,n)},openDoc:function(t){var n=this;if(_.isArray(t)&&t.length>1){var r=_.map(t,function(t,n,r){return e.nomad.utils.replaceGuid(_.keys(t)[0],e.lang.get("LBL_MOBILE_DOC")+" "+(n+1))});this._showActionSheet(e.lang.get("LBL_MOBILE_CHOOSE_DOC"),r,function(e,r){n._executeActionSheetCallback(function(){n._openDocWorker(t,r)})})}else this._openDocWorker(t)},_openDocWorker:function(t,n){var r=_.clone(this._extractValue(t,n)),i=this._normalizeUrl(r.url);r.url=i.replace("{download_token}",e.api.getDownloadToken()).replace("{oauth_token}",e.api.getOAuthToken()),this._flushCacheUrl(r),r.openExternally?this._browseUrl(r.url):this._browseDoc(r)},openAddress:function(t){var n=e.clientInfo.device,r=n.osVersion||n.version||"",i=!n.ios||n.ios&&!e.isNative?"g":"a";if(_.isArray(t)&&t.length>1){var s=this,o=_.map(t,function(e){return _.keys(e)[0]});this._showActionSheet(e.lang.get("LBL_MOBILE_CHOOSE_LOCATION"),o,function(e,n){s._executeActionSheetCallback(function(){s._openMap(s._extractValue(t,n),i)})})}else this._openMap(this._extractValue(t),i)},_openMap:function(t,n){var r="",i=n==="a"?"maps.apple.com":"maps.google.com";if(!t)t="";else{var s="";if(t.country&&_.isString(t.country)){s=t.country.replace(/\s?\,\s?/g,",");if(/ of$/.test(s)||/ of the$/.test(s)){var o=s.split(",");s=o[o.length-1];for(var u=0;u<o.length-1;u++)s=s.concat(" "+o[u])}else s=t.country.replace(/\,/g,"")}t=_.compact([t.street,t.city,t.state,t.postalcode,s]).join(",")}r="http://"+i+"/maps?q="+encodeURI(t),e.logger.debug("Opening map: "+r),this._browseUrl(r)},_buildNamedList:function(e){return _.map(e,function(e){return _.keys(e)[0]+" - "+_.values(e)[0]})},_extractValue:function(e,t){return t||(t=0),_.isString(e)?e:_.values(e[t])[0]||e[t].value||e[t]},_normalizeUrl:function(t){if(e.nomad.utils.urlHasProtocolRegExp.test(t))return t;if(/^\.\.\//.test(t)){var n=window.location.href.split("#")[0].split("index.html")[0];return t=n+t,t}return"http://"+t},_flushCacheUrl:function(e){if(_.has(e,"noCache")&&!e.noCache)return;var t=e.url.split("#")[0],n=[t,t.indexOf("?")!==-1?"&":"?","__ts=",+(new Date)];e.noCache=!1,e.url=n.join("")},isEmptyValue:function(e){return _.isNull(e)||_.isUndefined(e)||!_.isNumber(e)&&_.isEmpty(e)||_.isNumber(e)&&!_.isFinite(e)},redraw:function(e){function r(){t.append(n),_.delay(function(){n.remove()},e)}var t=$(document.body),n=$("<style> body {opacity: 0.99;}</style>");e?_.delay(r,e):r()},clearSelection:function(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()},showDataSyncStartAlert:function(t,n,r){r=r||{},r.disableOverlay||this.showDataSyncOverlay(n),t&&e.alert.show("data_syncing",{level:"load",messages:t,closeable:!1,autoClose:!1})},showDataSyncOverlay:function(t){e.overlay.show("data:sync"+(t?":"+t:""),{spinner:!1})},hideDataSyncOverlay:function(t,n,r){e.overlay.hide("data:sync"+(r?":"+r:""))},showDataSyncEndAlert:function(t,n,r,i){this.hideDataSyncOverlay(n,r,i),e.alert.dismiss("data_syncing");if(n)return;t&&e.alert.show("data_sync_success",{level:"success",messages:t,autoClose:!0,method:r})},configure:function(t,n,r){function i(){window.location.href="#",e.router.navigate(r,{trigger:!0})}function s(){e.nomad.setSetting({loginName:n,loginUrl:t,siteUrl:e.config.siteUrl});var r=e.controller.context.get("params");if(r&&r.layout==="login"){$("#username").val(n),$("#url").val(t),$("#password").val("");var s=e.controller.context.get("model");s&&(s.set("username",n),s.set("url",t),s.set("password",""))}else e.router.login();_.delay(function(){i()},1e3)}if(!e.config.allowUrlReconfigure)return i(),!1;e.logger.debug("Reconfiguring the client with username="+n+" and loginUrl="+t),n=n?decodeURIComponent(n):"",t=t?decodeURIComponent(t):"";if(e.config.configUrlWhiteList){var o=0;for(;o<e.config.configUrlWhiteList.length;o++){var u=new RegExp(e.config.configUrlWhiteList[o]);if(u.test(t))break}o===e.config.configUrlWhiteList.length&&(e.logger.warn("Configure server URL "+t+" is not in the white list. Ignoring value"),t=e.nomad.getSetting("loginUrl")||"")}var a=n!==e.nomad.getSetting("loginName")||t!==e.nomad.getSetting("loginUrl");return a?e.api.isAuthenticated()?e.logout({complete:function(){s()}},!0):s():i(),a},updateAuthStore:function(){e.isNative&&(e.keychain.OAUTH["meta:hash"]=e.metadata.getHash(),e.keychain.OAUTH["userpref:hash"]=e.user.get("_hash"))},isDownloadTokenSupported:function(){return!_.isEmpty(e.api.getDownloadToken())},getFileOptions:function(){var t=e.nomad.isDownloadTokenSupported();return{htmlJsonFormat:!1,iframe:!1,passOAuthToken:!t,passDownloadToken:t}},getVersion:function(){return e.clientInfo.app.version+"."+e.clientInfo.app.build+(e.config.env!=="prod"?" ("+e.config.env+")":"")+(_.isEmpty(e.config.buildTag)?"":" "+e.config.buildTag)},getServerVersion:function(){var t="N/A";return e.serverInfo&&e.api.isAuthenticated()&&(t=e.serverInfo.version+" "+e.serverInfo.flavor+" (FTS: "+(e.serverInfo.fts.enabled?e.serverInfo.fts.type:"N/A")+")"),t},getServerUrl:function(){return e.isNative?e.config.siteUrl+"/rest/v"+e.config.restVersion:e.config.serverUrl},getDesktopUrl:function(){return e.config.siteUrl+"?mobile=0"},canFollow:function(t){var n=t.module;return e.serverInfo.isSevenUp&&_.contains(e.config.followableModules,n)&&e.acl.hasAccessToModel("view",t)},getModuleRelationships:function(t){var n=e.metadata.getModule(t);if(_.isEmpty(n.layouts.subpanels))return;var r=n.layouts.subpanels.meta.components,i=_.map(r,function(e){return e.context.link}),s=_.select(n.fields,function(e){return _.contains(i,e.name)&&e.type==="link"});return _.chain(s).pluck("name").map(function(n){return e.nomad.getRelationship(t,n)}).select(function(e){return!_.isEmpty(e)}).map(function(e,t){return e.label=_.find(r,function(e){return e.context.link===s[t].name}).label,e}).value()},showBackToSugarPage:function(t){e.controller.loadScreen({root:"Error",errorCode:404,backToSugar:!0,sugarRoute:t})},configureSugarLogic:function(){if(e.isSynced){var t=[e.view.views.EditView,e.view.views.DetailView,e.view.views.ListView];_.each(t,function(t){var n=t.prototype.plugins,r=n.indexOf("SugarLogic"),i=r!==-1;e.config.sugarLogic.enabled&&!i?n.push("SugarLogic"):!e.config.sugarLogic.enabled&&i&&n.splice(r,1)})}},setFontSize:function(t){t||(t=e.config.UI.defaultFontSize),document.documentElement.style.fontSize=e.config.UI.fontSizes[t]+"px"},buildBulkRequest:function(t){var n,r="/v"+e.config.restVersion;return t=t||{},n=e.api.buildURL.call({serverUrl:r},t.module,null,t.attributes,t.params),{url:n,method:t.method||"GET",headers:t.headers,data:t.data}},syncApp:function(t){e.sync({callback:function(t){if(!t){var n=[e.nomad.startRecordsPreloader];e.nomad.updateServerInfo(),e.supportedFeatures.dashboards&&(e.nomad.dashboards.reset(),n.push(function(n){e.nomad.dashboards.start(n)})),async.parallel(n,function(t,n){t&&(e.logger.warn(t),t==="could_not_fetch_dashboards"&&e.nomad.showAlert(e.lang.get("ERR_DASHBOARDS_FETCHING"))),e.events.trigger("nomad:sync:complete")})}}})},getFtsEnabledModules:function(){if(e.supportedFeatures.fts){var t=[];return _.each(e.metadata.getModules(),function(e,n){e.ftsEnabled&&t.push(n)},this),t}return null}})}(SUGAR.App),function(e){_.extend(e.nomad,{recordsPreloaderPromptKey:"preload_prompted",startRecordsPreloader:function(t){e.offlineEnabled&&e.config.offline.prefetch.enabled&&e.offline.storage.getMigrationSummary().storageRebuilt?(e.logger.debug("Prefetching static modules"),e.offline.syncManager.recordsPreloader.start({callback:function(n){n?t(n):e.nomad.promptAndPreloadUserRecords(!0,null,t)}})):t()},promptAndPreloadUserRecords:function(t,n,r){var i=this,s=e.lang.get(t?"LBL_OFFLINE_PREFETCH_FIRST_PROMPT":"LBL_OFFLINE_PREFETCH_PROMPT"),o=t?[e.lang.get("LBL_LATER"),e.lang.get("LBL_YES")]:null,u=n?"_preloadRelationships":"_preloadRecords";if(t){var a=this.getSetting(this.recordsPreloaderPromptKey);if(a)return r()}e.nomad.showConfirm(s,function(t){i.setSetting(i.recordsPreloaderPromptKey,!0),t===2?(e.nomad.dismissAlerts(),i[u](function(t){e.controller.clean(),t?e.alert.show("prefetch_failed",{level:"error",messages:e.lang.get("LBL_OFFLINE_PREFETCH_ERROR"),autoClose:!0,closable:!0}):e.alert.show("prefetch_success",{level:"success",messages:e.lang.get("LBL_OFFLINE_PREFETCH_SUCCESS"),autoClose:!0,closable:!0}),r&&r(t)})):r&&r()},null,o)},_preloadRecords:function(t){var n=this._getModulesToPreload(),r=this._getPreloaderFilter();e.offline.syncManager.recordsPreloader.start({filter:r,callback:t,modules:n})},_preloadRelationships:function(t){var n=this._getPreloaderFilter(),r=this._getModulesToPreload(),i={};_.each(r,function(t,n){var r=this.getModuleRelationships(n);i[n]={maxThreshold:t,relationships:{}},_.each(r,function(t){t.rhs_key!=="id"&&e.offline.storage.getRelationshipType(t.name)!=="many-to-many"&&(i[n].relationships[t.rhs_module]=t)})},this),e.offline.syncManager.recordsPreloader.start({filter:n,callback:t,relatedModules:i})},_getPreloaderFilter:function(){return e.supportedFeatures.followingPreloaderFilter?["my_items","favorites","following"]:["my_items","favorites"]},_getModulesToPreload:function(){var t={},n=_.filter(e.offline.utils.getOfflineModules(),function(t){return!e.config.offline.prefetch.staticModules[t]});return _.each(n,function(n){var r=e.config.offline.prefetch.dynamicModules&&e.config.offline.prefetch.dynamicModules[n]?e.config.offline.prefetch.dynamicModules[n]:e.config.offline.prefetch.maxThreshold;r=r||100,t[n]=r}),t}})}(SUGAR.App),function(e){e.nomad.dashboards={_started:!1,isStarted:function(){return this._started},reset:function(){this._started=!1},resetCollection:function(){this.collection&&this.collection.reset()},start:function(t){function r(e){_.isEmpty(e)||(n.collection.reset(e,{silent:!0}),n._onDashboardsReady(t)),n.fetchDashboards(e,function(r){r?(n.collection.reset(e,{silent:!0}),n._onDataSyncError(t)):n._onDashboardsFetched(e,t)})}this._started=!0,this.initCollection();var n=this;t=_.once(t),this.cache.storage.get("dashboards",function(t,n){t&&e.logger.error("Error retrieving dashboards from cache"),r(n)})},_onDashboardsFetched:function(t,n){var r=this.collection.toJSON();!_.isEmpty(t)&&this._isAnyDashboardChanged(r,t)&&e.events.trigger("app:dashboards:changed"),this._onDashboardsReady(n)},_isAnyDashboardChanged:function(e,t){return e.length!==t.length||_.any(e,function(e){return!_.any(t,function(t){return e.id===t.id&&e.date_modified===t.date_modified},this)},this)},_onDashboardsReady:function(e){var t=this;this.dashboardsCount=this.collection.length,this.cache.storeDashboards(this.collection,function(){t.initialized=!0}),e()},_onDataSyncError:function(e){e("could_not_fetch_dashboards")},initCollection:function(){if(this.collection)return;this.collection=e.data.createBeanCollection("Dashboards")},getCollection:function(){return this.collection},getNames:function(){if(this.collection)return _.chain(this.collection.toJSON()).pluck("name").map(function(t){return e.lang.get(t)}).value()},fetchDashboards:function(e,t){var n=this.collection.clone();n.once("sync",function(){async.series([_.bind(this.getDashboardMetadata,this,n,e),_.bind(this.updateDashboardsCache,this)],t)},this),n.once("data:sync:error",function(e,n,r){t(r)},this),n.fetch({disableGlobalDataAlerts:!0})},getDashboardMetadata:function(t,n,r){var i=this,s;s=_.map(t.models,function(t){return e.nomad.buildBulkRequest({module:"Dashboards",attributes:{id:t.id}})},this);if(_.isEmpty(s))return r();var o={success:function(e){_.each(e,function(e,r){var s;if(e.status===200){var o=e.contents;s=t.get(o.id),i.adjustDashboardMetadata(o.metadata),s&&s.set(o,{silent:!0})}else{var u;s=i.collection.at(r),s&&(u=_.find(n,function(e){return s.id===e.id})),u&&s.clear({silent:!0}).set(u,{silent:!0})}},this),i.adjustDashboardsCollection(t),i.collection=t,r(null,e)},error:function(t){e.logger.debug("Get dashboards metadata error: "+t),r(t)}};e.api.bulk({requests:s},o)},adjustDashboardsCollection:function(e){var t=[];e.each(function(e){var n=e.get("metadata");(!n||_.isEmpty(n.dashlets))&&t.push(e)}),e.remove(t,{silent:!0})},adjustDashboardMetadata:function(t){var n=[],r=this;t.dashlets=[],_.each(t.components,function(i){_.each(i.rows,function(i){var s=[];_.each(i,function(i,o){var u=i.view,a;if(!u)return;a=[u.type,u.filter||u.filter_id,u.module],u.type==="saved-reports-chart"&&(a=_.union(a,[u.chart_type,u.saved_report_id])),i.id=Math.abs(e.nomad.utils.getHashCode(a.join(":"))),!i.view.module&&i.context&&(i.view.module=i.context.module),!_.contains(n,i.id)&&r.canCreateDashlet(i)?(r.normalizeDashletData(i),t.dashlets.push(i),n.push(i.id)):s.push(o)}),_.each(s,function(e){i.splice(e,1)})})})},canCreateDashlet:function(t){var n=!1,r=t.view.template||t.view.type;if(this.isDashletSupported(t))if(r==="tabbed-dashlet"){var i=e.metadata.getView(null,t.view.type);n=Boolean(i)&&_.any(i.tabs,function(t){return e.nomad.utils.isAccessibleModule(t.module,"list")})}else r==="dashablelist"?n=e.nomad.utils.isAccessibleModule(t.view.module,"list"):n=!0;return n},isDashletSupported:function(t){var n=t.view.template||t.view.type,r=e.config.dashboards.dashlets[n];return r&&r.enabled&&e.utils.versionCompare(e.serverInfo.version,r.minServerVersion,">=")},normalizeDashletData:function(e){e.view&&!e.view.module&&e.context&&e.context.module&&(e.view.module=e.context.module)},getDashboardDashlets:function(e){return this.collection.get(e).get("metadata").dashlets},getDashletsIds:function(){var t=[];return this.collection.each(function(e){var n=_.pluck(e.get("metadata").dashlets,"id");t=_.union(t,n)}),t},isDashletAvailable:function(e,t){return _.chain(this.getDashboardDashlets(e)).pluck("id").contains(t).value()},getDashletConfig:function(e,t){var n=_.find(this.getDashboardDashlets(e)||[],function(e){return e.id.toString()===t});return n},updateDashboardsCache:function(t){var n=this.collection.toJSON(),r=this,i=[];i.push(function(t){r.getCachedDashboards(function(e,n){e?t(e):t(null,n)})}),i.push(function(t,i){_.each(n,function(e){var n=_.findWhere(t,{id:e.id});n&&n.date_modified===e.date_modified&&n.metadata&&_.extend(e,n)}),r.cacheDashboards(n,function(e){e?i("error_caching_dashboards"):i()})}),async.waterfall(i,function(n){n?(e.logger.error(n),t(n)):t()})},cacheDashboards:function(e,t){this.cache.storage.set("dashboards",e,function(e){e?t("error_caching_dashboards"):t()})},getCachedDashboards:function(e){this.cache.storage.get("dashboards",function(t,n){t&&e?e("error_getting_cached_dashboards"):e(null,n)})},verifyDefaultView:function(){if(e.nomad.getSetting("default_view")){var t=e.nomad.getSetting("default_view").split(":"),n=!0;t[0]==="Dashboards"&&(t.length===2?n=this.collection.get(t[1]):n=this.isDashletAvailable(t[1],parseInt(t[2])),n||e.nomad.removeSetting("default_view"))}},cleanDashboardsCache:function(){this.cache.storage.cutAll()},cleanDashletsCache:function(t){var n=this.getDashletsIds();this.cache.storage.cut(n,function(e){t()})}}}(SUGAR.App),function(e){e.view.NomadLayoutManager=_.extend({_dynamicLayout:null,init:function(t){return this.rootLayout={el:t.rootHolder,layoutRef:null},this.recordLayout={el:t.recordHolder,layoutRef:null},this.layoutCache=new e.nomad.hashmap,this},loadStatic:function(t){var n=this._getLayoutDefs(t);this._beforeLoadStatic(t,n);var r=this._buildLayoutsFromDef(n);return e.isTablet&&this.getRecordLayout()&&n.length===1&&this._disposeLayout(this.getRecordLayout()),this._afterLoad(t),r},loadDynamic:function(e){_.defaults(e,{isDynamic:!0,animateRender:!0,appendTo:"record"}),e.appendTo=e.appendTo==="record"?this._getRecordLayoutContainer():this.rootLayout;var t=this._buildLayoutsFromDef([e])[0];return this._afterLoad.apply(this,arguments),t},getLayouts:function(){var e=[];return this.getRootLayout()&&e.push(this.getRootLayout()),this.getRecordLayout()&&e.push(this.getRecordLayout()),e},_getRootLayoutDef:function(e){var t;switch(e.root){case"home":t={mixed:!0,module:"Home",name:"home"};break;case"Recents":t={module:"Recents",name:"list"};break;case"Search":t={mixed:!0,module:e.root,name:"list"};break;case"Offline":e.module==="TxLog"?t={module:"TxLog",name:"list"}:(t={module:e.root,name:e.module?e.module:"offline",create:!0},t.cacheDisabled=!0);break;case"Dashboards":t=this._getDashboardLayoutParams(e);if(_.isEmpty(t))return null;break;case"About":case"Settings":case"ErrorEmulation":case"Error":case"Login":t={module:e.root,name:e.root.toLowerCase(),create:!0,cacheDisabled:!0},e.root==="Error"&&(t.code=e.errorCode,t.backToSugar=e.backToSugar,t.sugarRoute=e.sugarRoute);break;default:e.link?t={name:"list",link:e.link,parentModelId:e.parentModelId,parentModule:e.parentModule,subType:"relationships"}:t={module:e.module,name:"list"}}return t.appendTo=this.rootLayout,t},_getDashboardLayoutParams:function(t){var n=e.nomad.dashboards.getCollection().get(t.dashboardId),r={module:"Dashboards",model:n,name:"detail",dashletId:t.dashletId};return r},_getRecordLayoutDef:function(e){var t,n=e.action;return e.module==="Dashboards"||!e.modelId&&n!=="create"&&n!=="associate"?null:(e.link?n==="create"?t={link:e.link,parentModule:e.parentModule,parentModelId:e.parentModelId,create:!0,name:"edit",layoutOptions:e.layoutOptions}:n==="associate"?t={link:e.link,parentModule:e.parentModule,parentModelId:e.parentModelId,skipFetch:!0,name:"list",subType:"associate"}:t={link:e.link,parentModule:e.parentModule,parentModelId:e.parentModelId,modelId:e.modelId,name:n||"detail"}:n==="create"?t={module:e.module,create:!0,name:"edit"}:n==="create-related"||n==="associate-related"?t={parentModelId:e.modelId,parentModule:e.module,name:"pickerlist",create:!0,action:n==="create-related"?"create":"associate"}:t={module:e.module,modelId:e.modelId,name:n||"detail"},t.appendTo=this._getRecordLayoutContainer(),t.animateRender=!0,t)},_getLayoutDefs:function(t){var n,r,i=[];return n=this._getRootLayoutDef(t),n&&i.push(n),r=this._getRecordLayoutDef(t),r&&i.push(r),e.isTablet?i:[_.last(i)]},_beforeLoadStatic:function(t,n){this.disposeDynamicLayout({disposeAll:!0}),e.activeComponents.closeAll(),$(document.body).toggleClass("show-content-child",n.length===2),$("#menu-left").toggleClass("hide",t.root==="Login")},_afterLoad:function(e){this._checkAlerts()},_getLayout:function(t){var n=this._getLayoutId(t),r=this.layoutCache.get(n);if(!r){var i=t.context||this._getPreparedContext(t);return e.view.createLayout(_.extend(_.omit(t,"appendTo"),{context:i,def:t}))}return r.options.def=t,r},_attachLayout:function(t){function s(){i&&!e.isTablet&&$.os.android&&i.$el.hide(),r.layoutRef=t,t.$el.show(),$(r.el).append(t.$el),t.onAfterShow(n)}var n=t.options.def,r=n.appendTo,i=n.appendTo.layoutRef;if(!i||i&&i!==t)t.getDefinition().animateRender&&t.getOverlay$El().show(),s();return this._renderLayout(t),i},_renderLayout:function(e){e.cached?e.renderFromCache({animation:{enabled:e.getDefinition().animateRender,preAnimationDelay:0,animationLength:200}}):e.render({animation:this._getFreshRenderAnimationOptions(e)})},_getFreshRenderAnimationOptions:function(e){return{enabled:e.getDefinition().animateRender,preAnimationDelay:200,animationLength:200}},_cacheLayout:function(t){var n=t.options.def,r=this._getLayoutId(n),i=this.layoutCache.get(r);if(!this._canCache(n))return;i?(this.layoutCache.remove(i),this.layoutCache.push(r,i)):(t.cached=!0,this.layoutCache.push(r,t));if(this.layoutCache.count()>e.config.layoutCacheSize){var s=this.layoutCache.shift();this._disposeLayout(s,{hardDispose:!0})}},_canCache:function(t){var n=t.cacheDisabled||t.isDynamic||t.name==="edit"&&t.create===!0||_.contains(e.config.disableLayoutCache,t.name);return!n},_disposeLayout:function(t,n){if(t.disposed===!0){e.logger.debug("Trying to dispose already disposed layout "+t.name+".");return}n=n||{},t.onDetach(),t.getDefinition().appendTo.layoutRef===t&&(t.getDefinition().appendTo.layoutRef=null);var r=this._dynamicLayout&&this._dynamicLayout.prevLayout===t;if((r||t.cached)&&!n.hardDispose)if(n.detachDelay){var i=this;_.delay(function(){!_.contains(i.getLayouts(),t)&&!t.disposed&&t.$el.detach()},n.detachDelay)}else t.$el.detach();else delete t.prevLayout,t.dispose()},_getPreparedContext:function(t){var n=e.context.getContext(t);return n.prepare(),n},_buildLayoutsFromDef:function(e){var t=[];return _.each(e,function(e){var n=this._getLayout(e),r=this._attachLayout(n);this._cacheLayout(n),n.isDynamic()?(r.cached=!0,n.prevLayout=r,this._dynamicLayout=n):this._dynamicLayout=null,r&&r!==n&&this._disposeLayout(r,{detachDelay:200}),t.push(n)},this),t},getRecordLayout:function(){return this._getRecordLayoutContainer().layoutRef},getRootLayout:function(){return this.rootLayout.layoutRef},isDynamicLayoutLoaded:function(){return!!this._dynamicLayout},invalidateLayouts:function(e){var t=this;this.layoutCache.iterate(function(n){n.module===e.module&&n.type===e.type&&(n.type==="list"?n.needLoadData=!0:t._invalidateRecordLayout(n,e)),e.listModules&&n.type==="list"&&_.contains(e.listModules,n.module)&&(n.needLoadData=!0)})},_invalidateRecordLayout:function(e,t){if(!t.modelId||t.modelId&&t.modelId===e.model.get("id"))e.needLoadData=!0},disposeDynamicLayout:function(e){function n(){return e.disposeAll?!!t._dynamicLayout:!1}e=e||{};var t=this;do if(this._dynamicLayout){var r=this._dynamicLayout,i=r.prevLayout;this._attachLayout(i),this._dynamicLayout=i.isDynamic()?i:null,this._disposeLayout(r,{hardDispose:!0})}while(n())},_getLayoutId:function(e){return JSON.stringify(_.omit(e,"child","appendTo","context","animateRender","dashletId"))},_getRecordLayoutContainer:function(){return e.isTablet?this.recordLayout:this.rootLayout},_checkAlerts:function(){var t=e.alert.getAll();_.each(t,function(t,n){t.viewCounter||(t.viewCounter=0),t.viewCounter++,t.viewCounter>=(e.config.maxAlertsPerLayout||2)&&e.alert.dismiss(n)})},clean:function(e){var t=this,n=function(e){function n(e,t){return e.prevLayout===t?!0:e.prevLayout?n(e.prevLayout,t):!1}return t._dynamicLayout&&n(t._dynamicLayout,e)};e.disposeAll&&(this.disposeDynamicLayout({disposeAll:!0}),_.each(this.getLayouts(),function(e){e&&this._disposeLayout(e,{hardDispose:!0})},this));var r=[];this.layoutCache.iterate(function(e){this.getRootLayout()!==e&&this.getRecordLayout()!==e&&!n(e)?(e.dispose(),r.push(e)):_.isFunction(e.clean)&&e.clean()},this),_.each(r,function(e){this.layoutCache.remove(e)},this)}},Backbone.Events)}(SUGAR.App),function(e){var t={},n={triggerViewSync:function(e,n,r,i){_.each(t,function(t){this.shouldSync(t,e)&&t.receiveSyncData(n,r,i)},this)},shouldSync:function(e,t){return e!==t},registerView:function(e){t[e.cid]=e},unregisterView:function(e){delete t[e.cid]},_getSyncableViews:function(){return t},_reset:function(){t={}}};e.augment("syncableViewsManager",n)}(SUGAR.App),function(e){var t=/(?:(?:(?:(?:(?:(?:https?)|ftp|itms|itms-apps):\/\/)|skype:)[a-z0-9-\._~\:/?#[\]@!$&'()*+,;=%]+)|(?:[a-z0-9]{1}(?:[a-z0-9-]+\.)+(?:com|net|gov|edu|us)(?:(?:\?|\/)[a-z0-9-\._~\:/?#[\]@!$&'()*+,;=%]+)?))/ig,n=/[.?,!]+$/;$.merge=function(){return _.union.apply(this,arguments)},e.nomad.utils={urlHasProtocolRegExp:/^(?!javascript)[a-z-]+:/i,execRegex:function(e,t,n){var r;while((r=t.exec(e))!==null)r.index===t.lastIndex&&t.lastIndex++,n(r)},sizePicture:function(e){var t=parseInt(e.height,10),n=parseInt(e.width,10),r=e.image.naturalHeight,i=e.image.naturalWidth;r<i?e.sizeProp=t/r*i+"px "+t+"px":e.sizeProp=n+"px "+n/i*r+"px"},stripLastEmptyStrings:function(e){var t=e.split("\n");while(t.length>0){if(!_.isEmpty(_.last(t)))break;t.pop()}return t.join("\n")},minutesToQuarterHours:function(e){e=parseInt(e,10);if(e===0)return e;if(e<8)return 15;var t=Math.floor(e/15),n=e%15;return n>7&&(t+=1),t*15},pad:function(e,t,n){return n=n||"0",e=String(e),e.length>=t?e:(new Array(t-e.length+1)).join(n)+e},getPrimaryEmail:function(e,t){var n=_.find(e,this.isPrimaryEmail);return t&&n?n.email_address:n},replaceGuid:function(e,t){var n=/([\w\d]{8}\-[\w\d]{4}-[\w\d]{4}-[\w\d]{4}-[\w\d]{12})/;return e.replace(n,t)},extractAndSortEmails:function(e){var t=_.flatten(_.map(e,_.values));return t=_.reject(t,function(e){return Number(e.invalid_email)||Number(e.opt_out)}),t=_.sortBy(t,function(e){return Number(e.primary_address)?0:1}),t=_.pluck(t,"email_address"),t},isPrimaryEmail:function(e){var t=e.primary_address;return _.isBoolean(t)||(t=!!parseInt(e.primary_address,10)),t},nl2br:function(e){var t=e||"";return t=String(t),t.replace(/\n|\r|\r\n/g,"<br />")},iso2sugar:function(n,r){return $.os.android&&(e.isNative||r.nativeSupport)?n:n.replace(/\.?\d+?Z/,"+00:00")},getTimeZoneOffsetString:function(e){var t=e||(new Date).getTimezoneOffset(),n=t>=0?"+":"-";t=Math.abs(t);var r=Math.floor(t/60),i=t%60;return n+this.pad(r,2)+":"+this.pad(i,2)},getHash:function(){var t=e.routing.location.hash;return t&&(t=t.split("~")[0]),t||"#"},isOnDynamicRoute:function(){return e.routing.location.hash.indexOf("~")!==-1},canGoBack:function(){var e=$.browser.chromeMobile?2:1;return window.history.length>e},resolveUrl:function(e,t){var n=document,r=n.getElementsByTagName("base")[0],i=r&&r.href,s=n.head||n.getElementsByTagName("head")[0],o=r||s.appendChild(n.createElement("base")),u=n.createElement("a"),a;return o.href=t,u.href=e,a=u.href,r?r.href=i:s.removeChild(o),a},merge:function(){function e(e,t){return t}return function(n,r,i){var s;if(_.isUndefined(n))s=r;else{if(!_.isUndefined(r)){var o=_.first(arguments,2),u=_.map(o,_.keys),a=_.intersection.apply(_,u),f={};return _.each(o,function(e,t){_.each(u[t],function(t){f[t]=e[t]})}),_.isUndefined(i)&&(i=e),_.each(a,function(e){f[e]=i(n[e],r[e])}),f}s=n}return _.clone(s)}}(),deepClone:function r(e){var t={};return _.each(e,function(e,n){t[n]=_.isObject(e)?r(e):e}),t},getOfflineStatusClass:function(){var t=e.offline.status;if(t){if(t.state===e.offline.STATE.ERROR)return"status-error";if(t.state===e.offline.STATE.WARNING)return"status-warning"}return"status-success"},humanFileSize:function(){function n(e,n){var r=0,i=1024,s=n?0:1;while(e>i/10&&++r<t.length-1)e/=i;this.value=(e+.05).toFixed(s),this.units=t[r]}var t=" K M G T P E Z Y".split(" ").map(function(e){return e+"B"});return n.prototype._i18nUnits=function(){var t="LBL_FILE_SIZE_UNITS_"+this.units,n=e.lang.get(t);return n===t?null:n},n.prototype.toString=function(e){var t=e&&this._i18nUnits()||this.units;return this.value+" "+t},function(e,t){return e!==-1?new n(e,t):null}}(),isErrorEmulationEnabled:function(){return e.config.errorEmulation.enabled&&e.user.get("user_name")===e.config.errorEmulation.user.toLowerCase()},parseQueryString:function(e){function t(e,t){var n=String(e).replace(/^&/,"").replace(/&$/,"").split("&"),r=n.length,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=function(e){return decodeURIComponent(e.replace(/\+/g,"%20"))};t||(t=this.window);for(i=0;i<r;i++){p=n[i].split("="),d=b(p[0]),v=p.length<2?"":b(p[1]);while(d.charAt(0)===" ")d=d.slice(1);d.indexOf("\0")>-1&&(d=d.slice(0,d.indexOf("\0")));if(d&&d.charAt(0)!=="["){g=[],m=0;for(s=0;s<d.length;s++)if(d.charAt(s)==="["&&!m)m=s+1;else if(d.charAt(s)==="]"&&m){g.length||g.push(d.slice(0,m-1)),g.push(d.substr(m,s-m)),m=0;if(d.charAt(s+1)!=="[")break}g.length||(g=[d]);for(s=0;s<g[0].length;s++){h=g[0].charAt(s);if(h===" "||h==="."||h==="[")g[0]=g[0].substr(0,s)+"_"+g[0].substr(s+1);if(h==="[")break}f=t;for(s=0,y=g.length;s<y;s++){d=g[s].replace(/^['"]/,"").replace(/['"]$/,""),l=s!==g.length-1,a=f;if(d!==""&&d!==" "||s===0)f[d]===c&&(f[d]={}),f=f[d];else{o=-1;for(u in f)f.hasOwnProperty(u)&&+u>o&&u.match(/^\d+$/g)&&(o=+u);d=o+1}}a[d]=v}}}var n={};return t(e,n),n},docIsAvailable:function(t){return!_.isEmpty(t)&&(!e.offline||e.offline.isOnline())},isValidDate:function(e){return _.isDate(e)&&!isNaN(e.getTime())},isModelSynchronized:function(t,n){var r,i=["_last_fetched","_client_date_modified"],s,o,u,a;return t.get("date_modified")!==n.date_modified?!1:(o=_.omit(n,i),s=_.omit(t.toJSON(),i),u=this.getObjectPrimitives(s),a=this.getObjectPrimitives(o),_.isEmpty(e.utils.getChangedProps(u,a,!1)))},getObjectPrimitives:function(e){function n(e){return!_.isObject(e)&&!_.isFunction(e)}var t={};return _.each(e,function(e,r){n(e)&&(t[r]=e)}),t},waitFor:function(e,t,n){var r=!1,i=new Date-0,s=!1;n=n||2e3;var o=function(){s=new Date-0-i>n,r=e(),!r&&!s?window.setTimeout(o,200):t(s?{message:"Max wait timeout"}:null)};window.setTimeout(o,200)},deepExtend:function(){var e=this;if(arguments.length<1||typeof arguments[0]!="object")return!1;if(arguments.length<2)return arguments[0];var t=arguments[0],n=Array.prototype.slice.call(arguments,1),r,i,s;return n.forEach(function(n){if(typeof n!="object")return;for(var o in n)if(n[o]!==void 0){i=t[o],r=n[o];if(r===t)continue;if(typeof r!="object"||r===null){t[o]=r;continue}if(typeof i!="object"){s=Array.isArray(r)?[]:{},t[o]=e.deepExtend(s,r);continue}Array.isArray(r)?s=Array.isArray(i)?i:[]:s=Array.isArray(i)?{}:i,t[o]=e.deepExtend(s,r)}}),t},isTabletLandscapeMode:function(){return e.isTablet&&e.nomad.getOrientation()==="landscape"},isForecastConfigValid:function(){var t=!0,n=e.metadata.getModule("Forecasts","config"),r=n.sales_stage_won,i=n.sales_stage_lost,s=n.sales_stage_won.concat(n.sales_stage_lost),o=e.lang.getAppListStrings("sales_stage_dom");return r.length===0||i.length===0||_.isEmpty(o)?t=!1:t=_.every(s,function(e){return e!==""&&_.has(o,e)},this),t},getForecastNotSetUpMessage:function(t){var n=t?"LBL_DASHLET_FORECAST_NOT_SETUP_ADMIN":"LBL_DASHLET_FORECAST_NOT_SETUP",r=e.lang.get(n,"Forecasts");if(t){var i=e.lang.get("LBL_DASHLET_FORECAST_CONFIG_LINK_TEXT","Forecasts");r+='  <a class="lnk-non-forecast" href="'+e.config.about.forecastsConfig+'">'+i+"</a>"}return r},wrapAsyncCallback:function(t){return{success:function(n){t(null,n)},error:t}},isAccessibleModule:function(t,n){return n=n||"list",!_.contains(e.config.unsupportedModules,t)&&_.contains(e.metadata.getModuleNames({filter:"visible",access:n}),t)},getClosedStatusValue:function(e){var t={Calls:"Held",Tasks:"Completed",Meetings:"Held"};return t[e]},isModuleVisible:function(t){var n=e.metadata.get().modules_info[t];return n&&n.visible},getHashCode:function(e){var t=0,n,r,i;if(e.length===0)return t;for(n=0,i=e.length;n<i;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t},charHtmlEntity:function(e,t){var n=e;return t?e==="<"?n="&lt;":e===">"?n="&gt;":e==="\n"&&(n="<br>"):e==="&"?n="&amp;":e==="<"?n="&lt;":e===">"?n="&gt;":e==='"'?n="&quot;":e==="\n"&&(n="<br>"),n},executeNextTickWithScreenLock:function(t){var n=(new Date).getTime()+"";e.overlay.show(n),_.defer(function(){t(function(){e.overlay.hide(n)})})},migrateKeyValueStore:function(t){var n=e.config.env+":"+e.config.appId+":";if(t.get(n+"store:version")===t.version)return;_.chain(localStorage).keys().filter(function(e){return e.indexOf(n)===0}).each(function(n){t.set(n,e.cache.get(n)),localStorage.removeItem(n)}).value(),t.set(n+"store:version",t.version)},formatLinks:function(r){var i="";return r&&r.length>0&&(i=r.replace(t,_.bind(function(e){var t=e.match(n)||"";t&&(e=e.replace(n,""));var r=this.urlHasProtocolRegExp.test(e)?e:"http://"+e;return'<a href="'+r+'">'+e+"</a>"+t},this))),i}}}(SUGAR.App),function(e){var t=function(){this.stack=[],this.hash={}};t.prototype={clear:function(){this.stack=[],this.hash={}},iterate:function(e,t){_.each(this.stack,function(t,n){e.call(this,t.item,n)},t)},remove:function(e,t){var n=[];if(!_.isFunction(e)){var r=-1,i;for(var s=0;s<this.stack.length;s++)if(_.isString(e)?this.stack[s].uid===e:this.stack[s].item===e){r=s,i=this.stack[s];break}r>-1&&i&&(delete this.hash[i.uid],this.stack.splice(r,1))}else _.each(this.stack,function(r,i){var s=e.call(t,r.item,i);s&&n.push(r)},this),_.each(n,function(e){this.remove(e.uid)},this)},shift:function(){var e=this.stack.shift();return delete this.hash[e.uid],e.item},pop:function(){var e=this.stack.pop();return delete this.hash[e.uid],e.item},push:function(e,t){this.hash[e]||this.stack.push({uid:e,item:t}),this.hash[e]=t},get:function(e){return this.hash[e]},getByIndex:function(e){var t=this.stack[e];return t?t.item:null},count:function(){return this.stack.length},isEmpty:function(){return!this.stack.length}},e.nomad.hashmap=t}(SUGAR.App),function(e){var t={_callbacks:[],_executeOnceOnPopState:[],CLOSE_RECENT:"close-recent",CLOSE_ALL:"close-all",DYNAMIC_LAYOUT:"dynamic-layout",enableBackButtonHandling:function(){window.addEventListener("popstate",_.bind(e.activeComponents.handlePopState,e.activeComponents),!1)},add:function(t,n,r){var i={componentId:t,closeCallback:n,context:r};if(e.routing.emulateBackButton){var s=this.buildHash(t);e.nomad.utils.isOnDynamicRoute()?e.routing.history.replaceState(null,null,s):e.routing.history.pushState(null,null,s)}this._callbacks.push(i)},remove:function(t,n,r,i){_.isUndefined(i)&&(i=!0);if(!t){this._callbacks=[];return}this._callbacks=_.reject(this._callbacks,function(e){return this._callbackMatches(e,t,n,r)},this),e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()&&i&&(this.hasActiveComponents()?this.setRecentComponentUrl():this.goBack(!0))},setRecentComponentUrl:function(){var t=_.last(this._callbacks),n=this.buildHash(t.componentId);e.nomad.utils.isOnDynamicRoute()?e.routing.history.replaceState(null,null,n):e.routing.history.pushState(null,null,n)},close:function(e,t,n){this._callbacks=_.reject(this._callbacks,function(r){var i=this._callbackMatches(r,e,t,n);return i&&this._runCallback(r),i},this)},closeAll:function(){_.each(this._callbacks,function(e){this._runCallback(e,this.CLOSE_ALL)},this),this.clear()},hasActiveComponents:function(){return this._callbacks.length>0},clear:function(){this._callbacks=[]},closeRecent:function(){var t=this._callbacks.pop();t&&(this._runCallback(t,this.CLOSE_RECENT),e.routing.emulateBackButton&&this.hasActiveComponents()&&this.setRecentComponentUrl())},_callbackMatches:function(e,t,n,r){var i=t===e.componentId,s=!n||n===e.closeCallback,o=!r||r===e.context;return i&&s&&o},_runCallback:function(e,t){var n=e.closeCallback,r=e.context;r?n.call(r,t):n(t)},buildHash:function(t){var n=e.nomad.utils.getHash();return n+"~"+t},getActiveComponentId:function(){return e.routing.location.hash.split("~")[1]||""},goBack:function(t){this.silentGoBack=t,e.routing.history.back()},registerDynamicLayout:function(t){if(!e.routing.emulateBackButton)return;e.activeComponents.add(this.DYNAMIC_LAYOUT,function(){e.controller.disposeDynamic({fromActiveComponents:!0})},e.controller)},unregisterDynamicLayout:function(t){if(!e.routing.emulateBackButton)return;t&&t.fromActiveComponents?this.hasActiveComponents()&&this.setRecentComponentUrl():this.removeDynamicLayoutsCallbacks(t)},removeDynamicLayoutsCallbacks:function(t){function n(e){return e.componentId===this.DYNAMIC_LAYOUT}if(t&&t.disposeAll)this._callbacks=_.reject(this._callbacks,n,this);else{var r=_.select(this._callbacks,n,this),i=_.last(r);this._callbacks.splice(this._callbacks.indexOf(i),1)}this.hasActiveComponents()?this.setRecentComponentUrl():e.nomad.utils.isOnDynamicRoute()&&this.goBack()},executeOnActiveComponentClose:function(e){this._executeOnceOnPopState.push(e)},executePopStateCallbacks:function(){_.each(this._executeOnceOnPopState,function(e){e()}),this._executeOnceOnPopState=[]},handlePopState:function(){function t(){e.activeComponents.closeRecent()}this.executePopStateCallbacks();if(this.silentGoBack){this.silentGoBack=!1;return}e.activeComponents.hasActiveComponents()&&($.browser.chromeMobile||$.browser.chrome?_.defer(t):$.os.ios&&_.delay(t,100))}};e.augment("activeComponents",t,!1),e.events.on("actionsheet:show",function(t,n){t?e.activeComponents.add(n.ACTIONSHEET,n.onCancel,n):e.activeComponents.remove(n.ACTIONSHEET)}).on("list:actionsheet:item:click",function(t,n){e.routing.emulateBackButton&&!n?e.activeComponents.executeOnActiveComponentClose(t):t()}).on("tutorial:show",function(t,n){t?e.activeComponents.add(n.TUTORIAL,n.hide,n):e.activeComponents.remove(n.TUTORIAL)}).on("app:mainmenu:show",function(t){var n=e.activeComponents,r="main-menu";t.show?n.add(r,function(){t.view.toggleMenu(!1,t.disableAnimation,t.callback)}):n.remove(r)}).on("app:rightmenu:show",function(t){var n=t.view,r=n?n.RIGHT_MENU+n.cid:!1,i=e.activeComponents,s=t.disableAnimation;t.show?i.add(r,function(){n.toggleRightMenu(!1,s,t.callback)}):n&&i.remove(r)}).on("list:item:context:menu:show",function(t,n,r){t?e.activeComponents.add(n.LIST_VIEW_CONTEXT_MENU,function(t){var r=t!==e.activeComponents.CLOSE_ALL;n.hideContextMenu(null,!0,r)}):e.activeComponents.remove(n.LIST_VIEW_CONTEXT_MENU,null,null,!r)}).on("list:item:contextmenu:action:execute",function(t,n){e.routing.emulateBackButton&&!n?e.activeComponents.executeOnActiveComponentClose(t):t()}).on("list:item:contextmenu:action:end",function(t,n,r){e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()&&!n?e.activeComponents.goBack(!0):t.hideContextMenu(r,!0)})}(SUGAR.App),function(e){var t=e.alert.show,n={};e.events.on("offline:status:update",function(e){e.noConnection||(n={})}),e.events.on("app:view:change",function(e){if(e.layoutDef&&e.layoutDef.isDynamic)return;$(document.body).toggleClass("has-pagination",e.root==="Dashboards")}),e.alert.show=function(r,i){i=i||{};if(i.pageHash&&i.pageHash!==window.location.hash)return;if(i.uid&&e.offlineEnabled){var s=i.requestOptions?i.requestOptions.params:{};if(!s.skipOfflineRead&&n[i.uid])return;n[i.uid]=1}t.apply(this,arguments)}}(SUGAR.App),function(e){var t=e.data.sync,n=e.data.createBeanCollection,r=e.data.createMixedBeanCollection;_.extend(e.data,{sync:function(n,r,i){var s=this,o=i.success,u,a;i.method=n,i.apiOptions=i.apiOptions||{},i.apiOptions.cid=r.cid,i.apiOptions.pageHash=window.location.hash,i.apiOptions.preserveNomadFilter=r.preserveNomadFilter,i.params=i.params||{},n==="read"&&e.offlineEnabled&&(i.params.skipOfflineRead=r.offlineReadDisabled),i.success=function(e,t,n){s._computePaginationInfo(e,t,n),o&&o.apply(this,arguments)},r instanceof e.BeanCollection&&i.query&&(u=r.orderBy,r.orderBy=null);var f;return r instanceof e.MixedBeanCollection&&!_.isEmpty(r.module_list)?f=r.module_list:this._isRecentsCollection(r)&&(f=e.metadata.getModuleNames({filter:"visible",access:"list"}),i.module_list=f,i.max_num=e.config.fetchLimit.recents),r.limit&&(i.limit=r.limit),f&&!i.fields&&(i.fields=this._getMergedFields(f)),a=t.apply(this,arguments),u&&(r.orderBy=u),a},_getMergedFields:function(t){return _.chain(t).map(function(t){return e.metadata.getModule(t).mergedFields}).flatten().uniq().value()},_isRecentsCollection:function(t){return t instanceof e.BeanCollection&&t.module==="Recents"},createBeanCollection:function(e,t,r){return this._createCollection(n,arguments)},createMixedBeanCollection:function(e){return this._createCollection(r,arguments)},_createCollection:function(e,t){var n=e.apply(this,t);return n.cid=_.uniqueId("c"),n},_computePaginationInfo:function(t,n,r){t instanceof e.BeanCollection&&(t.offset=t.next_offset!==-1?t.next_offset:r.offset,t.records_count=n.length)}})}(SUGAR.App),function(e){var t=e.plugins.attach;_.extend(e.plugins,{attach:function(n,r){_.each(n.plugins,function(t,i){if(_.isObject(t)){var s=_.keys(t)[0];t=s}var o=e.plugins._get(t,r);o&&!this._isPluginDisabled(n,t)&&o.pluginGlobalEvents&&(n.hasOwnProperty("globalEvents")||(n.globalEvents={}),_.extend(n.globalEvents,o.pluginGlobalEvents))},this),t.apply(this,arguments)}})}(SUGAR.App),function(e){_.extend(e.Router.prototype,{login:function(){var t=e.controller.layoutManager.getRootLayout(),n=t&&t.name==="login";n||(e.controller.clean({disposeAll:!0}),e.controller.loadScreen({root:"Login"}))},logout:function(t){t=t==="1",e.logger.debug("Logging out: "+t),e.logout({complete:function(){e.router.navigate("#"),e.router.login()}},t)}});var t=e.routing.beforeRoute;e.routing.location=window.location,e.routing.history=window.history,e.routing.beforeRoute=function(n,r){document.activeElement&&document.activeElement.blur();if(n==="about")return!0;if(n==="Configure"){var i=r[0]||e.nomad.getSetting("loginUrl"),s=r[1]||e.nomad.getSetting("loginName"),o=r[2]?decodeURIComponent(r[2]):"#";return e.nomad.configure(i,s,o),!1}if(e.api.isAuthenticated()&&this.firstStart){e.logger.debug("PARSING ROUTE ON STARTUP FOR DETECTING SUGAR ROUTE"),this.firstStart=!1;var u=this.location.hash.replace("#","").split("~")[0];if(u){var a=e.routing.utils.convertSugarRoute(u);if(a!==u)return _.isString(a)?this.replaceRoute("#"+a):e.nomad.showBackToSugarPage(u),!1}}if(e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()){if(e.nomad.utils.canGoBack())window.history.go(-1);else{var f=e.nomad.utils.getHash();this.replaceRoute(f)}return!1}return e.api.isAuthenticated()&&!e.isSynced?(e.nomad.syncApp(),!1):t.call(this,n,r)},e.routing.replaceRoute=function(e){e[0]!=="#"&&(e="#"+e),this.history.replaceState?(this.history.replaceState(null,null,e),Backbone.history.loadUrl(e)):this.location.replace(e)}}(SUGAR.App),function(e){function i(t,n,r,i){var s,o=/.*?(?:translateLabel\((?:'|")(\w+)(?:'|")\s*,\s*(?:'|")(\w*)(?:'|")\)).*?/mg,u=[/.*?(?:getDropdownValue\((?:'|")(\w+)(?:'|"))+.*?/mg,/.*?(?:getDropdownKeySet\((?:'|")(\w+)(?:'|"))+.*?/mg,/.*?(?:getDropdownValueSet\((?:'|")(\w+)(?:'|"))+.*?/mg];e.nomad.utils.execRegex(t,o,function(e){var t=e[2];_.isEmpty(t)?n[e[1]]=!0:(r[t]=r[t]||{},r[t][e[1]]=!0)});var a=function(t){i[t[1]]=!0};for(s=0;s<3;++s)e.nomad.utils.execRegex(t,u[s],a)}function s(t){_.each(t,function(n,r){e.config.dashboards.dashlets[r]||n.meta&&n.meta.tabs?n.templates&&(n.templates=null):delete t[r]})}function o(e,t){t&&e&&_.each(t,function(n,r){if(e[r])return;delete t[r]})}function u(e){var t=_.chain(e.subpanels.subpanel_setup).values().sortBy(function(e){return e.order}).value();_.each(t,function(e){e.context={link:e.get_subpanel_data},e.label=e.title_key,E(e,["subpanel_name","title_key","get_subpanel_data","order"])}),e.layouts=_.extend(e.layouts||{},{subpanels:{meta:{components:t}}}),delete e.subpanels}function a(t,n){if(t._hash==="_base_")return;var r=null;t.modules=_.omit(t.modules,"Forecasts"),_.each(t.modules,function(i,s){var o=[];_.each(i.views,function(t){if(t.meta){var n=_.chain(t.meta.panels[0].fields).filter(function(e){return e.type!=="link"}).map(function(e){return _.isString(e)?{name:e}:e}).value();r=new e.view.View({context:e.context.getContext(),meta:{panels:[{fields:n}]}}),o=_.union(o,r.getFieldNames(s)),r.dispose(),_.contains(o,"email")&&o.push("email1")}}),o=_.union(o,n?["name","my_favorite","following"]:["name"]),_.find(o,function(e){return i.fields[e]&&i.fields[e].type==="currency"})&&(o=_.union(o,["currency_id"])),s==="Opportunities"&&(o=_.union(o,["closed_revenue_line_items"])),s==="Documents"&&(o=_.union(o,["doc_url","doc_type","filename"]));if(!t.server_info.ftsEnabled||!i.ftsEnabled)o=_.chain(i.fields).filter(function(e){return!!e.unified_search&&e.type!=="link"}).map(function(e){return e.name}).union(o).value();i.mergedFields=_.union(i.mergedFields||[],o)})}function f(e){var t=e.toUpperCase();return t.substr(-2)==="_C"&&(t=t.substr(0,t.length-2)),"LBL_"+t}function w(t){function a(e){function t(e){return e.charCodeAt(0)&255}var n=Array.prototype.map.call(e,t),r=new Uint8Array(n);return r.buffer}var n=t.files,r=t.files.fieldName,i=n.fileData.name||"newfile",s=n.fileData.type||"application/octet-stream",o=n.fileData.binary,u={"OAuth-Token":e.api.getOAuthToken()},f="xxxxxx",l="\r\n",c="";return c+="--"+f+l,c+="Content-Disposition: form-data;",c+='name="'+r+'"; filename="'+i+'"'+l,c+="Content-Type: "+s+l+l,c+=o+l,c+="--"+f+"--",$.ajax({complete:t.complete,error:t.error,success:t.success,type:"POST",url:t.url,data:a(c),processData:!1,contentType:"multipart/form-data; boundary="+f,headers:u,dataType:"json"})}function E(e,t){_.each(t,function(t){t instanceof RegExp?E(e,_.filter(_.keys(e),function(e){return t.test(e)})):delete e[t]})}SUGAR.forms.FlashField=function(){},e.metadata.copy=function(t,n){return n=n||{},n.bean instanceof e.Bean?e.utils.deepCopy(t):t};var t=SUGAR.expressions.SidecarExpressionContext.prototype.setValue;SUGAR.expressions.SidecarExpressionContext.prototype.setValue=function(e,n){t.apply(this,arguments);var r=this.getField(e);r&&r.type==="enum"&&r.def.visibility_grid&&r.render()},SUGAR.expressions.SidecarExpressionContext.prototype.setFieldRequired=function(t,n){n=SUGAR.expressions.Expression.isTruthy(n);var r=this.view.getField(t,this.model);r&&(r.def=e.utils.deepCopy(r.def),r.def.required=n,r.render())},_.extend(SUGAR.expressions.SidecarExpressionContext.prototype,{addClass:function(e,t){var n=this.view.getField(e,this.model);n&&n.$el.addClass(t)},removeClass:function(e,t){var n=this.view.getField(e,this.model);n&&n.$el.removeClass(t)}});var n=e.metadata.set,r=["collection"];e.metadata.set=function(t,l,c){t._override_values&&_.each(t._override_values,function(e,n){t[e]||delete t._override_values[n]});if(t.config){var h={};t.config.analytics&&!e.isNative&&(e.config.analytics.enabled=Boolean(t.config.analytics.enabled),h.analytics=e.config.analytics,e.analytics.init()),h.offlineEnabled=Boolean(t.config.offlineEnabled),t.config=h}var p=!1;t.server_info?(p=e.nomad.isSevenUp(t.server_info),t.server_info.isSevenUp=p):t.server_info={};if(!c&&t._hash!=="_base_"){s(t.views);var d=e.metadata.getHash();d!==t._hash&&d!=="_base_"&&(t.modules?(e.logger.debug("Metadata hash has changed. Resetting to base."),e.metadata.reset(),e.metadata.set(JSON.parse(JSON.stringify(e.baseMetadata)),!1,!0)):t._hash=d),e.nomad.initSupportedFeatures(),e.nomad.updateSupportedFeatures(t),t.app_list_strings&&t.app_list_strings.available_language_dom&&delete t.app_list_strings.available_language_dom[""],t.currencies||(t.currencies={}),_.each(t.currencies,function(e){e.conversion_rate=e.conversion_rate||e.rate}),_.each(t.modules_info,function(n,r){_.contains(e.config.unsupportedModules,r)&&delete t.modules_info[r]}),t.modules_info&&_.each(e.config.hiddenModules,function(e){t.modules_info[e]&&(t.modules_info[e].visible=!1)}),t.mod_strings||(t.mod_strings={}),t.mod_strings=_.extend({},e.mod_strings,t.mod_strings);var v=e.config.unsupportedModules||[];_.each(t.modules,function(e,n){_.contains(v,n)&&(delete t.modules[n],delete t.mod_strings[n])});var m=_.contains(["ENT","ULT"],t.server_info.flavor),g="portal_flag";_.isEmpty(t.relationships)&&(t.relationships={});var y=t.relationships.tasks_notes;y&&(y.relationship_role_column="parent_type",y.relationship_role_column_value="Tasks",y.relationship_type="one-to-many"),_.each(t.relationships,function(e,n){e=e||{},e.relationship_type=e.true_relationship_type||e.relationship_type;if(t.modules[e.lhs_module]&&t.modules[e.rhs_module]){if(e.relationship_role_column==="parent_type"||n==="contact_tasks"||n==="contact_notes")e.via_parent_id=!0}else n!=="_hash"&&delete t.relationships[n]}),t.relationships.accounts_opportunities&&(t.relationships.accounts_opportunities={lhs_key:"id",lhs_module:"Accounts",lhs_table:"accounts",name:"accounts_opportunities",relationship_type:"one-to-many",rhs_key:"account_id",rhs_module:"Opportunities",rhs_table:"opportunities"}),_.extend(t.relationships,e.baseMetadata.relationships);var b={},w={},S={};_.each(t.modules,function(n,s){if(n._patched)return;p&&delete n.subpanels;var o=S[s]||{},a={};S[s]=o;var l=["fieldTemplates","menu"];s!=="Forecasts"&&l.push("config"),E(n,l),s!=="Activities"&&n.filters&&(n.filters={basic:n.filters.basic}),n.layouts&&(E(n.layouts,_.filter(_.keys(n.layouts),function(e){return!_.contains(["list","detail","edit","subpanels"],e)})),n.layouts.subpanels&&n.layouts.subpanels.meta&&n.layouts.subpanels.meta.components&&_.each(n.layouts.subpanels.meta.components,function(e){o[e.label]=!0})),n.views&&E(n.views,_.filter(_.keys(n.views),function(e){return!_.contains(["list","detail","edit","forecast-pipeline"],e)}));if(n.views&&n.views["forecast-pipeline"]){var c=n.views["forecast-pipeline"];_.extend(c.meta.timeperiod[0],{type:"enum",view:"edit"}),delete c.meta.panels,delete c.templates}m||delete n.fields[g],(s==="RevenueLineItems"||s==="Products")&&n.fields.opportunity_name&&n.fields.opportunity_id&&n.fields.opportunity_id.required&&(n.fields.opportunity_name.required=!0),_.each(n.fields,function(e,t){if(_.contains(r,e.type)){delete n.fields[t];return}if(t!=="_hash"&&_.isEmpty(e.name)){delete n.fields[t];return}E(e,["comment","dbType","isnull","table","reportable","audited","join_name","merge_filter","duplicate_merge","bean_name","cols","rows","function","importable","massupdate","studio","bean_filter_field","link_class","link_file","rhs_key_override","enable_range_search","sortable","duplicate_merge_dom_value","help","no_default","comments","custom_module","db_concat_fields","sort_on","subquery","query_type","operator","db_field","custom_type"]),o[e.vname]=!0,e.type==="id"&&delete e.len;if(e.name==="name"||e.type==="name")e.unified_search=!0;e.formula&&i(e.formula,b,S,w),e.options&&(w[e.options]=!0);var s=["id","assigned_user_id","modified_user_id","create_by"];_.contains(s,e.name)&&(e.unified_search=!1),(e.type==="relate"||e.type==="parent")&&delete e.len,e.relationship_fields&&(a[e.name]=!0,_.each(e.relationship_fields,function(e){a[e]=!0;var t=n.fields[e];t&&(o[t.vname]=!0,t.options&&(w[t.options]=!0))})),e.required&&n.fields.email&&e.name==="email1"&&(n.fields.email.required=!0)});var h=n.fields.team_name;h&&(delete h.len,h.type="teamset"),h=n.fields.name,h&&(h.type="name"),s==="Meetings"?(h=n.fields.date_start,h&&h.validation&&delete h.validation.compareto,_.each(n.views.edit.meta.panels[0].fields,function(e){_.isObject(e)&&(e.name==="reminder"||e.name==="email_reminder")&&_.each(["fields","related_fields"],function(t){_.find(e[t],function(n,r){if((n.name||n)===e.name+"_checked")return e[t].splice(r,1),!0})})})):s==="Activities"&&(n.views=e.baseMetadata.modules.Activities.views),n.views&&(delete n.views.listview,delete n.views.search);var d;t.mod_strings&&t.mod_strings[s]&&(t.mod_strings[s].LBL_EMAIL?d="LBL_EMAIL":t.mod_strings[s].LBL_EMAIL_ADDRESS&&(d="LBL_EMAIL_ADDRESS"));var y=/^(?=.*address)((?!email).)*$/,x=_.find(n.fields,function(e){return e.type==="file"});s!=="Forecasts"&&_.each(n.views,function(t,r){if(t.meta){delete t.meta.templateMeta;if(t.meta.panels){t.meta.panels.length&&(t.meta.panels.length=1);if(t.meta.panels[0]){var i=[],u=t.meta.panels[0].fields,l=-1;delete t.meta.panels[0].label,u=_.reject(u,function(t){var i=_.isString(t)?t:t.name,o=_.isEmpty(n.fields[i])&&t.type!=="fieldset";return o&&e.logger.error(s+"."+r+"."+i+" field is missing vardef"),o}),r==="list"&&(u=_.filter(u,function(e){return!!e["default"]})),t.meta.panels[0].fields=u,_.each(u,function(e,t){var s=_.isObject(e),c=s?e.name:e,h=n.fields[c],p;e.options&&(w[e.options]=!0),a[c]=!0,o[e.label||h.vname]=!0,h&&(h.options&&(w[h.options]=!0),h.type==="relate"?(a[h.id_name]=!0,a[h.link]=!0):h.type==="parent"&&(a.parent_id=!0,a.parent_type=!0)),e.type==="fieldset"&&_.each(e.fields,function(e){a[e.name]=!0,e["default"]?o[e["default"]]=!0:o[e.label||n.fields[e.name].vname]=!0,e.options&&(w[e.options]=!0)}),!m&&c===g&&(l=t);if(s){E(e,["default","enabled","link","width","wireless_edit_only","customCode"]);if(y.test(e.name)&&h)if(r==="edit")p=_.extend(e,{index:t}),p.group||(p.group=h.group),p.group&&i.push(p);else if(e.group||h.group)o[f(e.group||h.group)]=!0;e.name==="email1"&&(u[t]={name:"email",type:"email",label:e.label||d,required:h.required},o[e.label||d]=!0,a.email=!0)}else y.test(c)&&h&&(r==="edit"&&h.group?i.push({name:c,group:h.group,index:t}):h.group&&(o[f(h.group)]=!0)),e==="email1"&&(u[t]={name:"email",type:"email",label:d,required:h.required},o[d]=!0,a.email=!0)}),l!==-1&&u.splice(l,1);var c={};if(i.length>0){c=_.groupBy(i,"group");var h=0;_.each(c,function(e,t){var n=e[0].index-h;_.each(e,function(e){u.splice(n,1)});var r={name:t,fields:_.pluck(e,"name"),type:"address",label:f(t)};u.splice(n,0,r),h+=e.length-1,o[r.label]=!0})}r==="edit"&&(s==="Meetings"||s==="Calls")&&(u.push({name:"send_invites",type:"bool",label:"LBL_SEND_INVITE"}),u.push({name:"invitees",type:"invitees",label:"LBL_INVITEES"}))}}var p=_.map(t.meta.panels[0].fields,function(e){return e.name||e});x&&!_.contains(p,x.name)&&r==="edit"&&s!=="Notes"&&t.meta.panels[0].fields.push(x.name)}});var T=[],N=[],C=function(n,r,i){T.push(r),r=n[r];if(r){var s=1e3;_.each(r.collection_list,function(r,u){if(!n[u]&&!r.generate_select&&!_.contains(N,r.module)&&!_.contains(v,r.module)){r.title_key="LBL_"+r.get_subpanel_data.toUpperCase()+"_SUBPANEL_TITLE",r.order=-(s++),r.creatable=!_.contains(e.config.nonCreatableModules,r.module),r.linkable=!1,n[u]=r;var a=t.mod_strings[i];a&&!a[r.title_key]&&(a[r.title_key]=r.module),o[r.title_key]=!0,N.push(r.module)}})}};_.isObject(n.subpanels)&&!_.isArray(n.subpanels)&&!_.isEmpty(n.subpanels.subpanel_setup)?(_.each(n.subpanels.subpanel_setup,function(r,i){if(!r)return;if(i!=="activities"&&i!=="history"){s!=="Meetings"&&s!=="Calls"||!_.contains(["Users","Leads","Contacts"],r.module)?r.panel_definition?r.module!=="Users"?(r.creatable=!_.contains(e.config.nonCreatableModules,r.module)&&!_.isEmpty(_.find(r.top_buttons,function(e){return!e.widget_class||e.widget_class.indexOf("Create")>-1})),r.linkable=!_.contains(e.config.nonLinkableModules,r.module)&&!_.isEmpty(_.find(r.top_buttons,function(e){return!e.widget_class||e.widget_class.indexOf("Select")>-1})),o[r.title_key]=!0):T.push(i):(r.creatable=(_.isUndefined(r.canCreate)?!0:r.canCreate)&&!_.contains(e.config.nonCreatableModules,r.module),r.linkable=(_.isUndefined(r.canLink)?!0:r.canLink)&&!_.contains(e.config.nonLinkableModules,r.module),o[r.title_key]=!0):(r.linkable=!0,r.creatable=r.module!=="Users",o[r.title_key]=!0),r.panel_definition&&(r.order=-r.order),r.get_subpanel_data&&r.get_subpanel_data.indexOf("function:")===0&&(r.get_subpanel_data=r.set_subpanel_data);var u=n.fields[r.get_subpanel_data];if(!u||!t.relationships[u.relationship])T.push(i),delete o[r.title_key],t.modules[r.module]&&e.logger.error("Invalid "+s+"."+i+" subpanel")}E(r,["add_subpanel_data","set_subpanel_data","top_buttons","panel_definition","sort_by","sort_order","subpanel_name"])}),C(n.subpanels.subpanel_setup,"activities",s),C(n.subpanels.subpanel_setup,"history",s),_.each(T,function(e){delete n.subpanels.subpanel_setup[e]}),u(n)):delete n.subpanels}),t.views&&_.each(e.baseMetadata.views,function(e,n){t.views[n]||(t.views[n]=e)});if(!e.config.skipStringCleanup)if(_.isEmpty(t.modules)&&!_.isEmpty(e.metadata.getModules())){o(e.metadata.getStrings("app_strings"),t.app_strings),o(e.metadata.getStrings("app_list_strings"),t.app_list_strings);if(!_.isEmpty(t.mod_strings)){var x=e.metadata.getStrings("mod_strings");_.each(x,function(e,n){o(e,t.mod_strings[n])})}}else t.mod_strings&&!t.mod_strings._patched&&(_.each(t.mod_strings,function(n,r){_.each(n,function(n,i){var s=S[r]||{};!s[i]&&!_.contains(e._mod_strings,i)&&delete t.mod_strings[r][i],_.each(s,function(e,n){t.mod_strings[n]||(b[n]=!0)})})}),t.mod_strings._patched=!0),t.app_list_strings&&!t.app_list_strings._patched&&(_.each(t.app_list_strings,function(n,r){!w[r]&&!_.contains(e._app_list_strings,r)&&delete t.app_list_strings[r]}),t.app_list_strings._patched=!0),t.app_strings&&!t.app_strings._patched&&(_.each(e._app_strings,function(e){b[e]=!0}),_.each(t.app_strings,function(e,n){b[n]||delete t.app_strings[n]}),t.app_strings._patched=!0);if(t.app_list_strings.reminder_time_options){if(!_.isArray(t.app_list_strings.reminder_time_options)){var T=[],N=_.keys(t.app_list_strings.reminder_time_options).sort(function(e,t){return e-t});_.each(N,function(e){T.push([e,t.app_list_strings.reminder_time_options[e]])}),t.app_list_strings.reminder_time_options=T}var C=_.find(t.app_list_strings.reminder_time_options,function(e){return e[0]==-1});C||t.app_list_strings.reminder_time_options.unshift([-1,t.app_strings.LBL_NONE])}}t.views&&t.views.forecastdetails&&(t.views.forecastdetails.meta.timeperiod[0].type="enum"),t.views&&t.views.bubblechart&&_.extend(t.views.bubblechart.meta.filter_duration[0],{type:"enum",view:"edit"}),n.apply(this,arguments),a(t,p)};var l={base:1,bool:1,currency:1,date:1,datetimecombo:1,email:1,emailbody:1,"enum":1,"float":1,file:1,image:1,"int":1,multienum:1,name:1,parent:1,password:1,phone:1,radioenum:1,relate:1,address:1,invitees:1,send_invites:1,teamset:1,text:1,textarea:1,url:1},c={image:function(){return e.supportedFeatures.fileUpload?undefined:["edit"]},password:["edit"],emailbody:["list"],html:[],encrypt:[],currency_id:[]},h={currency_symbol:[]},p=e.metadata._patchMetadata;e.metadata._patchMetadata=function(e,t){return!t||t._patched===!0?t:(p.apply(this,arguments),_.each(t.views,function(e,n){e.meta&&_.each(e.meta.panels,function(e){var r=[];_.each(e.fields,function(e,i){var s=c[e.type];_.isFunction(s)&&(s=s()),s&&(s.length===0||_.contains(s,n))&&r.push(i);var o=h[e.name];o&&(o.length===0||_.contains(o,n))&&r.push(i),n==="edit"&&!l[e.type]&&(e.view="readonly"),n==="edit"&&e.name==="date_modified"&&(e.view="readonly"),n==="edit"&&e.name==="date_entered"&&(e.view="readonly"),e.type==="url"&&t.fields[e.name]&&Boolean(t.fields[e.name].gen)&&r.push(i)}),_.each(r,function(t,n){e.fields.splice(t-n,1)})},this)},this),t)},e.error.errorName2Keys.email="ERR_MOBILE_EMAIL";var d={All:["created_by","created_by_name","modified_by_name","modified_user_id","date_entered","date_modified","my_favorite","deleted",/^email([^_]|_(?!c$|reminder))+$/],Employees:["user_name","user_hash","system_generated_password","pwd_last_changed","authenticate_id","sugar_login","is_admin","picture","status"],Calls:["status"],Contacts:["portal_active","portal_app","portal_name","portal_password","portal_password1"],Notes:["contact_email","contact_phone","file_mime_type","file_url"],Tasks:["contact_email","contact_phone","status"],Meetings:["status"],RevenueLineItems:["quote_id","quote_name"],Opportunities:["closed_revenue_line_items"]},v=["file","password","image"],m=function(){function r(t,r){var i=_.find(n,function(n,i){if(!e.utils.versionCompare(r,i,">="))return!1;var s=_.find(n,function(e,n){var r=n.split(/,\s*/);return _.contains(r,t)});return s});return i&&_.values(i)[0]}function i(){if(t!==null)return t;var n=e.metadata.getServerInfo(),i=n.flavor,s=n.version,o=d,u=r(i,s);return t=e.nomad.utils.merge(o,u,function(e,t){return _.union(e,t)}),t}var t=null;e.events.on("app:sync:complete",function(){t=null});var n={"7.0":{"ENT, ULT":{Opportunities:["amount","date_closed"]}}};return function(e){var t=i(),n=t.All,r=t[e];return r&&(n=_.union(n,r)),n}}(),g=e.Bean.prototype.copy;e.Bean.prototype.copy=function(t,n,r){_.each(this._defaults,function(e,t){this.set(t,"")},this),g.call(this,t,n,r);var i=this.get("email1"),s=function(e,t){_.isString(t)?e.unset(t):_.each(e.attributes,function(n,r){t.test(r)&&e.unset(r)})};_.each(m(this.module),function(e){s(this,e)},this);var o=e.metadata.getModule(this.module),u=o?o.fields:null,a=_.chain(u).filter(function(e){return _.contains(v,e.type)}).pluck("name").value();_.each(a,function(e){this.unset(e)},this),i&&this.set("email1",i),_.each(this.toJSON(),function(t,n){(!e.acl.hasAccessToModel("edit",this,n)||u[n].readonly)&&s(this,n)},this)},e.MixedBeanCollection.prototype.fetch=function(t){var n=e.metadata.getModuleNames({filter:"visible",access:"list"});t=t||{},t.module_list=this.module_list=t.module_list||this.module_list||n,t.module_list!==n&&(t.module_list=_.filter(t.module_list,function(e){return _.contains(n,e)}));if(!t.module_list.length)return;var r=_.clone(t),i=_.isUndefined(r.myItems)?this.myItems:r.myItems;return i&&(r.module_list=_.reject(r.module_list,function(t){return!e.nomad.supportsMyItems(t)})),e.BeanCollection.prototype.fetch.call(this,r)},e.augment("hacks",{hackModuleList:function(){var t=e.user.get("module_list"),n=e.metadata.getModules();for(var r=0;r<t.length;++r)n[t[r]]||t.splice(r--,1)},hackAcls:function(){var t=e.user.getAcls(),n=t.Users;n["delete"]="no",_.isArray(n.fields)&&(n.fields={}),n.fields.status={create:"no",write:"no"},_.each(_.keys(t),function(n){!e.metadata.getModule(n)&&!_.contains(e.user.get("module_list"),n)&&delete t[n]}),e.user.set("acl",t)}}),delete e.validation.validators.datetime,delete e.validation.validators.primaryEmail;var y=$.param;$.param=function(e){return e instanceof ArrayBuffer?e:y.apply(this,arguments)};var b=$.ajax;$.ajax=function(e){return e.files&&e.files.length>0?w(e):b.apply($,arguments)};var S=e.metadata.sync;e.metadata.sync=function(t,n){if(e.lang.getLanguage()&&e.user.get("preferences")&&e.lang.getLanguage()!==e.user.get("preferences").language||!e.config.cacheMeta)n=n||{},n.forceRefresh=!0,e.logger.debug("Forcing meta refresh as user language has changed");S.call(this,t,n)},e.accessibility={run:function(){}},e.logger.ServerWriter.write=function(){},e.cache.clean=function(){},e.events.on("app:init",function(){var t=e.api.records;e.api.records=function(n,r,i,s,o,u){var a;return u=u||{},r==="Meetings"&&n==="read"&&!u.preserveNomadFilter&&e.serverInfo.isSevenUp&&_.isEmpty(i)?(s=s?e.utils.deepCopy(s):{},s.filter=s.filter||[],s.filter.push({date_start:{$gte:(new Date(new Date-9e5)).toISOString()}})):r==="Recents"&&(r="recent",o.success&&(a=o.success,o.success=function(e){e.next_offset=-1,a.apply(this,arguments)})),t.apply(e.api,arguments)};var n=e.api.buildURL;e.api.buildURL=function(e,t,r,i){var s=n.apply(this,arguments);if(t==="favorite"||t==="unfavorite"){var o={fields:"my_favorite,following"};t==="favorite"&&(o.viewed=1),s+="?"+$.param(o)}return s}});var x=e.view.createField;e.view.createField=function(t){return e.supportedFeatures.nativeEnum&&t.def.type==="enum"&&(t.def.view==="edit"||t.view.name==="edit")&&(t.type="nativeEnum"),x.apply(this,arguments)};var T=e.template.getField;e.template.getField=function(t,n){return e.supportedFeatures.nativeEnum&&t==="enum"&&n==="edit"&&(t="nativeEnum"),T.apply(this,arguments)}}(SUGAR.App),function(e){e.augment("overlay",{init:function(){this.overlayHash={}},show:function(t,n){if(this.overlayHash[t])return!1;n=_.extend({tint:!1,spinner:!0,template:!1},n);var r=n.message||"";!r&&n.label&&(r=e.lang.get(n.label));var i=$(e.template.get("overlay")());if(n.template)i.html(e.template.get(n.template)({message:r}));else{var s=i.find("#overlay-message");i.toggleClass("tint",n.tint),i.toggleClass("spinner",n.spinner),s.text(r).show()}e.$rootEl.append(i),i.show(),this.overlayHash[t]=i},hide:function(e,t){var n=this.overlayHash[e];n&&(t?n.animate({opacity:"0"},500,"ease",function(){n.remove()}):n.remove()),delete this.overlayHash[e]},hideAll:function(){_.each(this.overlayHash,function(e,t){e&&(e.remove(),delete this.overlayHash[t])},this)},isActive:function(){return!_.isEmpty(e.overlay.overlayHash)}})}(SUGAR.App),function(e){e.view.ActionSheet=Backbone.View.extend({events:{"touchstart .item":"onItemTouchStart","touchmove .item":"onItemTouchMove","click .item":"onSelect","click .cancel":"onCancel"},plugins:["fast-click-highlight"],ACTIONSHEET:"actionsheet",initialize:function(t){var n=this;$(window).on("orientationchange.actionsheet",function(){$(n.popup).addClass("invisible"),_.delay(function(){n.position()},1e3)}),e.plugins.attach(this,"view"),this.container=$("#actionsheet-overlay"),this.orientationSupport=_.isNumber(window.orientation),this.options=_.extend({title:"",template:"actionsheet",items:[],onSelect:!1,onCancel:!1,cancelText:e.lang.get("LBL_CANCEL_BUTTON_LABEL")},t),this.render(),this.show()},onItemTouchStart:function(e){this._moved=!1},onItemTouchMove:function(e){this._moved=!0},onSelect:function(e){if(this._moved)return this._moved=!1,!1;var t=parseInt(e.target.dataset.index,10),n=this.options.items[t],r=!0;this.options.onSelect&&(r=this.options.onSelect.call(this,n,t)),r!==!1&&this.remove()},onCancel:function(){this.remove(),this.options.onCancel&&this.options.onCancel.call(this)},render:function(){var t=e.template.get(this.options.template)(this.options),n=$(t);this.popup=n,this.container.empty(),this.$el.empty().append(n).appendTo(this.container),_.delay(_.bind(this.position,this),20)},show:function(){this.render(),this.container.show(),e.trigger("actionsheet:show",!0,this)},hide:function(){this.container.hide(),$.os.ios&&e.nomad.redraw(100)},position:function(){var e=this.popup,t=this.orientationSupport&&_.contains([90,-90],window.orientation);e.toggleClass("compact",t);var n=document.documentElement,r=e.get(0),i=n.clientWidth,s=n.clientHeight,o=r.offsetWidth,u=r.offsetHeight,a=s-u,f=i-o,l,c;a<=0?l=0:l=a/2,f<=0?c=0:c=f/2,e.css({top:l+"px",left:c+"px"}).removeClass("invisible")},remove:function(){Backbone.View.prototype.remove.call(this),this.hide(),e.trigger("actionsheet:show",!1,this),this.container.empty(),$(window).off("orientationchange.actionsheet")}},{show:function(t,n,r,i){return new e.view.ActionSheet({title:t,items:n,onSelect:r,onCancel:i})}})}(SUGAR.App),function(e){function i(){if(!$.os.android)return!1;var e,t=navigator.userAgent.match(/Android\s+([\d\.]+)/);return t?(e=t[1],version_compare(e,"4.1","<")&&version_compare(e,"2.4",">=")):!1}var t=$.os.android?1e3:500,n=25,r=75,s=_.extend({instance:null,scrollFixClassName:"scroll-fix",needsScrollFix:i(),show:function(t,n){if(e.config.skipTutorial)return;if(e.tutorial.data)this.doTutorial(t,n);else{var r=this;$.getJSON(e.config.tutorualURL||"tutorial.json",function(i){e.tutorial.data=i,r.doTutorial(t,n)})}},doTutorial:function(t,n){var r=this.getPrefs(),i=new RegExp("^"+t+"([~:].*)?$","i"),s=_.chain(e.tutorial.data).keys().select(function(e){return i.test(e)}).value().sort(function(e,t){return e.indexOf(":")>-1?1:-1}),o,u;_.each(s,function(e){e.indexOf("~")>-1&&!_.contains(e.split("~"),n)?o=e:e.indexOf(":")>-1&&_.contains(e.split(":"),n)?o=e:e===t&&(o=e)}),u=_.clone(e.tutorial.data[o]),u&&(!r.skipVersion[o]||r.skipVersion[o]<u.version)&&(!r.viewedVersion[o]||r.viewedVersion[o]<u.version)&&this.createInstance(u,o,r)},createInstance:function(t,n,r){t.content=this.cutStepForOtherDevice(t),t.tutorialCombo=[],n==="home"&&e.isTablet&&e.nomad.getOrientation()==="landscape"&&this.joinTutorials(t,"home-menu",r),this.instance=new o(_.extend(t,{tutorialName:n})),this.instance.show()},joinTutorials:function(t,n,r){var i=this.cutStepForOtherDevice(e.tutorial.data[n]);for(var s=0;s<i.length;s++)i[s].scroll||(i[s].scroll=e.tutorial.data[n].scroll,i[s].tutorialName=n);t.tutorialCombo.push(n),t.content=t.content.concat(i)},cutStepForOtherDevice:function(t){var n=[];return _.each(t.content,function(t,r){var i=e.isTablet&&t.mobile||!e.isTablet&&t.tablet;i||n.push(t)}),n},getPrefs:function(){var t=e.nomad.getSetting("tutorialPrefs")||{};return t.viewedVersion=t.viewedVersion||{},t.skipVersion=t.skipVersion||{},t},resetPrefs:function(t){t=t||{},t.viewedVersion={},t.skipVersion={},e.nomad.setSetting("tutorialPrefs",t)},skipTutorial:function(){var t=this.getPrefs();_.each(e.tutorial.data,function(n,r){t.skipVersion[r]=e.tutorial.data[r].version}),e.nomad.setSetting("tutorialPrefs",t)},addLeftMenuScrollFix:function(){if(!this.needsScrollFix)return;$("#moduleList").addClass(this.scrollFixClassName)},removeLeftMenuScrollFix:function(){if(!this.needsScrollFix)return;$("#moduleList").removeClass(this.scrollFixClassName)}}),o=Backbone.View.extend({events:{"click .btn.disabled":function(e){return!1},"click .back-btn:not(.disabled)":"back","click .next-btn:not(.disabled)":"next","click .done-btn":"setStepViewed",click:"preventEvents",swipe:"preventEvents",swipeLeft:"onSwipeLeft"},TUTORIAL:"tutorial",initialize:function(t){t||(t={}),this.index=0,this.setIntro(t.intro),this.setContent(t.content),this.setScroll(t.scroll),this.options=t,this.tutorialName=t.tutorialName,this.tutorialCombo=t.tutorialCombo,this.tplContext={brandName:e.config.brandName},e.events.on("app:orientation:changed",this._onOrientationChange,this)},preventEvents:function(e){e.stopPropagation()},_onOrientationChange:function(){if(e.isTablet){this.hide();return}this.highlightItem(this.index)},setContent:function(e){this.content=e},setIntro:function(e){this.intro=e},setScroll:function(e){this.scroll=e},reset:function(){this.index=0},onSwipeLeft:function(t){t.stopPropagation(),e.tutorial.skipTutorial(),this.hide(t)},show:function(t){t=_.extend({},t||{}),t.content&&this.setContent(t.content),t.intro&&this.setIntro(t.intro),t.scroll&&this.setScroll(t.scroll),t.reset&&this.reset(),this.render(),this.intro&&!this.introShown?(this.index=-1,this.introShown=!0,this.showMessageOnly(!1,this.intro)):this.highlightItem(this.index),e.events.trigger("tutorial:show",!0,this)},hide:function(t){t&&!_.isString(t)&&(t.preventDefault(),t.stopPropagation()),this.remove(),e.events.trigger("tutorial:show",!1,this)},setStepViewed:function(t){var n=e.tutorial.getPrefs();n.viewedVersion[this.tutorialName]=e.tutorial.data[this.tutorialName].version,e.nomad.setSetting("tutorialPrefs",n),this.hide(t)},back:function(e){e.preventDefault(),e.stopPropagation(),this.highlightItem(this.index-1)},next:function(e){e.preventDefault(),e.stopPropagation(),this.highlightItem(this.index+1)},highlightItem:function(i){var s=this;if(i<0||i>=this.content.length||this.animate)return;var o=this.content[i];if(!o.name)this.showMessageOnly(o.textTitle,o.text,o.textAdditional,o.textFormatClass);else{var u=e.controller.layoutManager.getRootLayout(),a=e.controller.layoutManager.getRecordLayout(),f;a?f=a.$el.find(o.name):f=u.$el.find(o.name),f=f.length?f:$(document.body).find(o.name);var l=this.index>i?-1:1;if(f.length===0||f.css("display")==="none"||!f.offset().height||!f.offset().width)return i+l>=this.content.length&&this.$el.find(".next-btn").addClass("disabled"),this.highlightItem(i+l);this.highlight||(this.highlight=$("<div/>"),this.highlight.attr("id","highlight"),this.highlightText=$("<div/>"),this.highlightText.attr("id","highlight-text"),this.highlight.html(this.highlightText),$("#tutorial-content").html(this.highlight)),this.highlightText.empty().hide(),this.hideGlow();var c=o.scroll?$(o.scroll):$(s.scroll),h,p,d,v,m=a?a.$el.find(".navbar-inner").height():u.$el.find(".navbar-inner").height();this.tutorialName==="home"&&!o.tutorialName&&(p=e.controller.layoutManager.getRootLayout(),d=p.getComponent("home"),h=d.scroll.scroller,v=function(e){var t=$(window).height(),n=$(e).offset(),r=t-$("#tutorial-controls").offset().top,i=[m,t];return n.top>i[0]&&n.top+n.height<i[1]-r});var g=c[0];if(s.scroll&&c.find(o.name).length>0)if(h){if(!v(f)){var y=f.offset(),b=h.getValues().top,w=b+y.top-y.height/2-m;h.scrollTo(0,w,!1)}}else{var E=g.scrollTop,S=f.offset().top-c.offset().top,x=c.offset().height+E,T=E>E+S,N=E+S>x-f.height()-r;if(T||N){var C=E+S-n;e.tutorial.addLeftMenuScrollFix(),g.scrollTop=C}}var k=f.offset().top+(o.vertAdj||0),L=f.offset().left+(o.horizAdj||0);Math.floor($("#highlight").offset().top)===Math.floor(k)&&Math.floor($("#highlight").offset().left)===Math.floor(L)?((o.glow===undefined||o.glow!==!1)&&s.showGlow(),s.showHighlightText(o.text)):(s.animate=!0,s.highlight.animate({"-webkit-transform":"translate3d("+L+"px, "+k+"px, 0)",width:o.full?f.offset().width:"",height:o.full?f.offset().height:""},t,"linear",function(){if(s.disposed)return;(o.glow===undefined||o.glow!==!1)&&s.showGlow(),s.showHighlightText(o.text),s.animate=!1}))}i<=0?this.$el.find(".back-btn").addClass("disabled"):this.$el.find(".back-btn").removeClass("disabled"),i>=this.content.length-1?this.$el.find(".next-btn").addClass("disabled"):this.$el.find(".next-btn").removeClass("disabled"),this.index=i,o.directionEl&&_.delay(function(){s.showDirectionArrow(o.directionEl)},200)},showGlow:function(){this.$el.find("#mask").css("background-image","-webkit-radial-gradient("+(this.highlight.offset().left+this.highlight.width()/2)+"px "+(this.highlight.offset().top+this.getTotalHeight(this.highlight)/2)+"px , "+this.highlight.width()+"px "+this.highlight.height()+"px, transparent, black "+Math.max(this.highlight.width(),this.highlight.height())+"px)"),this.$el.find("#mask").css("background-color","transparent")},hideGlow:function(){this.$el.find("#mask").css({"background-color":"","background-image":""})},showHighlightText:function(t){var n;this.highlightText.html(e.lang.get(t,null,this.tplContext)),this.highlightText.show();if(this.highlight.offset().left-this.getTotalWidth(this.highlightText)>0&&this.findIntersectors([this.highlight.offset().left-this.getTotalWidth(this.highlightText),this.highlight.offset().left],[this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2+this.getTotalHeight(this.highlightText)],".btn-group").length===0)this.highlightText.css("left",0-this.getTotalWidth(this.highlightText)),n=this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlightText.offset().top+this.highlightText.offset().height>$(window).height()-50?this.highlightText.css("top",n-40):this.highlightText.css("top",n>=0?n:0),this.highlightText.css("text-align","right");else if(this.highlight.offset().left+this.getTotalWidth(this.highlight)+this.getTotalWidth(this.highlightText)<$(window).width()&&this.findIntersectors([this.highlight.offset().left+this.getTotalWidth(this.highlight),this.highlight.offset().left+this.getTotalWidth(this.highlight)+this.getTotalWidth(this.highlightText)],[this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlight.offset().top+this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2+this.getTotalHeight(this.highlightText)],".btn-group").length===0)this.highlightText.css("left",this.getTotalWidth(this.highlight)),n=this.getTotalHeight(this.highlight)/2-this.getTotalHeight(this.highlightText)/2,this.highlightText.offset().top+this.highlightText.offset().height>$(window).height()-50?this.highlightText.css("top",n-40):this.highlightText.css("top",n>=0?n:0),this.highlightText.css("text-align","left");else{var r=this.getTotalWidth(this.highlight)/2-this.getTotalWidth(this.highlightText)/2,i=this.highlight.offset().left+r;r=i<0?0-this.highlight.offset().left:r;var s=this.highlight.offset().left+r+this.getTotalWidth(this.highlightText);r=s>$(window).width()?r-(s-$(window).width()):r;var o;this.highlight.offset().top+this.getTotalHeight(this.highlight)+this.getTotalHeight(this.highlightText)<$(window).height()&&this.findIntersectors([this.highlight.offset().left+r,this.highlight.offset().left+r+this.getTotalWidth(this.highlightText)],[this.highlight.offset().top+this.getTotalHeight(this.highlight),this.highlight.offset().top+this.getTotalHeight(this.highlight)+this.getTotalHeight(this.highlightText)],".btn-group").length===0?o=this.getTotalHeight(this.highlight):o=-5-this.getTotalHeight(this.highlightText),this.highlightText.offset().top+this.highlightText.offset().height>$(window).height()-50&&(o-=40),this.highlightText.css("left",r),this.highlightText.css("top",o),this.highlightText.css("text-align","center")}},findIntersectors:function(e,t,n){var r=[],i=this;return this.$el.find(n).each(function(){var n=$(this),s=n.offset(),o=[s.left,s.left+i.getTotalWidth(n)],u=[s.top,s.top+i.getTotalHeight(n)];e[0]<o[1]&&e[1]>o[0]&&t[0]<u[1]&&t[1]>u[0]&&r.push(n)}),r},showMessageOnly:function(t,n,r,i){var s=e.template.get("tutorial-message");this.message={},this.message.textTitle=t||"",this.message.text=e.lang.get(n,null,this.tplContext),this.message.textAdditional=r||"",this.message.textFormatClass=i||"",$("#tutorial-content").html(s(this.message)),this.highlight=null,this.hideGlow()},showDirectionArrow:function(e){var t=this.$el.find(".text-container .text");if(!t.length)return;var n=t.offset().left,r=n+t.width(),i=$(e),s=i.offset().left,o=s+i.width();r>o?t.prepend("<span class='icon icon-arrow-circle-left'></span>"):n<s&&t.prepend("<span class='icon icon-arrow-circle-right'></span>")},getTotalWidth:function(e){var t=e.width();return t+=parseInt(e.css("padding-left"),10)+parseInt(e.css("padding-right"),10),t+=parseInt(e.css("margin-left"),10)+parseInt(e.css("margin-right"),10),t},getTotalHeight:function(e){var t=e.height();return t+=parseInt(e.css("padding-top"),10)+parseInt(e.css("padding-bottom"),10),t+=parseInt(e.css("margin-top"),10)+parseInt(e.css("margin-bottom"),10),t},render:function(){var t=e.template.get("tutorial");return $("body").append(t()),this.$el=$("#tutorial"),this.delegateEvents(),this.$el.show(),this},remove:function(){this.disposed=!0,delete this.highlight,delete this.highlightText,Backbone.View.prototype.remove.call(this),e.events.off("app:orientation:changed",this._onOrientationChange,this);if(this.tutorialName==="home-menu"||_.contains(this.tutorialCombo,"home-menu")){e.tutorial.removeLeftMenuScrollFix();var t=$(e.tutorial.data["home-menu"].scroll)[0];t&&(t.scrollTop=0)}if(this.tutorialName==="home"){var n=e.controller.layoutManager.getRootLayout(),r=n.name==="home"&&n.getComponent("home");r&&r.scroll.scroller.scrollTo(0,0)}else this.scroll&&$(this.scroll)[0]&&($(this.scroll)[0].scrollTop=0)}});e.augment("tutorial",s)}(SUGAR.App),function(e){var t=function(e){e=e||{},this.items=[]};_.extend(t.prototype,{add:function(t){this.items.unshift(t),this.items.length>e.config.navigationHistoryLimit&&this.items.pop()},getItem:function(e){return this.items[e]},getRecent:function(){return this.getItem(1)},reset:function(){this.items=[]},onGoBack:function(){}});var n=function(){t.apply(this,arguments)};n.prototype=Object.create(t.prototype),_.extend(n.prototype,{add:function(e){var n=JSON.stringify(e),r=JSON.stringify(this.getItem(0));n!==r&&t.prototype.add.call(this,e)},onGoBack:function(){this.items.shift()}});var r=e.Controller.extend({_screenContext:{},_propagatingData:null,_navigationInfo:{SAVE_ACTION:0,BACK_ACTION:1,LINK_ACTION:2,ACCESS_ERROR:4,error:null,navigatingBackBy:null},initialize:function(){e.plugins.attach(this,"view"),this.context=e.context.getContext(),e.isTouchCapable&&e.config.fastClickEnabled&&window.FastClick.attach(document.body),_.isEmpty($.os)||$(document.body).addClass($.os.android?"android":"ios"),this.layoutManager=e.view.NomadLayoutManager.init({rootHolder:e.$contentEl,recordHolder:$("#content-child")}),this._initializeHistory(),this._initializeNavigation(),this._initializeOffline()},_initializeHistory:function(){this.contextHistory=new t,this.routeHistory=new n},_duplicateRecord:function(t){var n=this,r=t.link,i,s=this.layoutManager.loadStatic(_.extend(t,{dupe:!0,action:"create"}));if(r){var o=e.data.createBean(t.parentModule,{id:t.parentModelId});i=e.data.createRelatedBean(o,t.modelId,r)}else i=e.data.createBean(t.module,{id:t.modelId});return i.fetch({relate:!!t.link,complete:function(){var e=n.layoutManager.getRecordLayout();e&&e.context.get("model").copy(i)}}),s},_createCall:function(t){var n=t.callData,r=this.layoutManager.loadStatic(_.extend(t,{action:"create",layoutOptions:{isLoggingCall:n&&n.logCall}})),i=this.layoutManager.getRecordLayout(),s=e.nomad.utils.minutesToQuarterHours(n.durationMinutes),o=n.durationHours;return s===60&&(o=n.durationHours+1,s=0),i.model.set({direction:n.direction,date_start:n.startDate,duration_hours:String(o),duration_minutes:String(s),status:n.status}),r},loadDynamic:function(t){var n=t.layoutDef,r=this.layoutManager.loadDynamic(n);return e.activeComponents.registerDynamicLayout(n),this._loadData([r]),this._afterLoad(t),r},disposeDynamic:function(t){this.layoutManager.disposeDynamicLayout(t),e.activeComponents.unregisterDynamicLayout(t)},loadScreen:function(e){if(!this.canLoadScreen(e))return!1;var t;this._beforeLoadStatic(e),e.action==="duplicate"?t=this._duplicateRecord(e):e.action==="createCall"?t=this._createCall(e):t=this.layoutManager.loadStatic(e),this._propagatingData&&this._propagateData(t),this._loadData(t),this._afterLoad(e)},getScreenContext:function(){return this._screenContext},getScreenContextRoot:function(){var e=this._screenContext.root;return e==="Dashboards"&&(e=[e],this._screenContext.dashboardId&&(e.push(this._screenContext.dashboardId),this._screenContext.dashletId&&e.push(this._screenContext.dashletId)),e=e.join("/")),e},_afterLoad:function(t){t=t||{},this._navigationInfo.navigatingBackBy=null;var n=t.layoutDef&&t.layoutDef.isDynamic?t:this._screenContext;e.trigger("app:view:change",_.clone(n))},_beforeLoadStatic:function(t){this._screenContext=e.utils.deepCopy(t),t.root==="Login"?(this.contextHistory.reset(),this.routeHistory.reset()):(this.contextHistory.add(t),this.routeHistory.add(t)),this._navigationInfo.error=null,this._propagatingData=null,t.modelId&&this._navigationInfo.navigatingBackBy===null&&_.each(this.layoutManager.getLayouts(),function(e){var n=e?e.getDataById(t.modelId):null;n&&(this._propagatingData=n)},this)},_propagateData:function(e){_.each(e,function(e){(e.type==="edit"||e.type==="detail")&&e.model.id===this._propagatingData.id&&e.model.set(this._propagatingData,{silent:!1})},this)},_loadData:function(t){_.each(t,function(t){var n=t.context.isDataFetched(),r=!1,i=this._navigationInfo.navigatingBackBy===null,s;!n||t.isDynamic()?r=!0:t.needLoadData?(delete t.needLoadData,r=!0):_.contains(["detail","edit"],t.type)?r=i:t.type==="list"&&(this._hasListModuleChanged()&&(_.contains(e.config.modulesToAlwaysRefresh,t.module)||e.config.forceListReload)?(r=!0,s=e.offlineEnabled?{forceServerSync:!0}:null):r=!1),r&&this._loadDataWithParams(t,s)},this)},_hasListModuleChanged:function(){var e=this.contextHistory.getRecent(),t=this.getScreenContextRoot();return _.isEmpty(e)?!0:t&&t===e.root?!1:e.module!==this._screenContext.module},_loadDataWithParams:function(e,t){t=t||{};if(e.name==="detail"||e.name==="edit")t.viewed=!0;e.context.resetLoadFlag(),e.loadData({params:t})},goBack:function(){this.layoutManager.isDynamicLayoutLoaded()?this.disposeDynamic():this._hasAccessErrorOnRecordView()&&!this._isNavigatedFromListView()?e.routing.replaceRoute(this._getGoBackRoute()):this._navigateBack()},_isNavigatedFromListView:function(){var e=this._screenContext,t=this.contextHistory.getRecent(),n=e.link?["link","parentModelId","parentModule"]:["module"],r=!t.action&&!t.modelId;return r&&_.isEqual(_.pick(e,n),_.pick(t,n))},_navigateBack:function(){var t=this.routeHistory.getRecent();this._navigationInfo.navigatingBackBy=this._navigationInfo.BACK_ACTION,!t&&e.isNative?navigator.app&&navigator.app.exitApp&&(e.logger.debug("Exiting Application"),navigator.app.exitApp()):(this.routeHistory.onGoBack(),e.router.goBack())},_hasAccessErrorOnRecordView:function(){var e=this._screenContext,t=this.contextHistory.getRecent(),n=this._navigationInfo.error===this._navigationInfo.ACCESS_ERROR;return e.modelId&&_.contains(["edit","detail"],e.action)&&n&&t},_initializeNavigation:function(){e.events.on("app:header:cancel",function(){this.goBack()},this),e.events.on("data:sync:success",function(t,n,r){var i={};if(t==="delete"){var s=this.layoutManager.getRootLayout(),o=_.without(["Recents","Home"],s.module),u=s.context.get("parentModel"),a=s.context.get("parentModule");i={listModules:o,type:"detail",modelId:n.id},n.link&&this._invalidateAfterLinkAction(n),_.isEmpty(u)||this.layoutManager.invalidateLayouts({type:"detail",modelId:u.id,module:a}),this.layoutManager.invalidateLayouts(i)}var f=this.layoutManager.getRecordLayout(),l;t==="delete"&&f&&f.model.id===n.id?(l=this._getGoBackRoute(),this._navigationInfo.navigatingBackBy=this._navigationInfo.SAVE_ACTION,e.routing.replaceRoute(l)):r.params.viewed&&this.getScreenContextRoot()!=="Recents"&&this.layoutManager.invalidateLayouts({listModules:["Recents"]})},this),e.events.on("data:sync:error",function(t,n,r,i){var s=this._screenContext;i&&e.error.isAccessError(i)&&s.action==="edit"&&s.modelId&&(this._navigationInfo.error=this._navigationInfo.ACCESS_ERROR)},this),e.events.on("edit:view:save",function(t){var n={},r=t.model;t.isCreate?n={listModules:[t.model.module,"Recents","Home","Search"]}:n={listModules:["Home","Search"]},this.layoutManager.invalidateLayouts(n),r.link&&this._invalidateAfterLinkAction(r);var i=t.isCreate,s,o=this.contextHistory.getRecent();this._navigationInfo.navigatingBackBy=this._navigationInfo.SAVE_ACTION,e.acl.hasAccessToModel("view",t.model)?i&&this._screenContext.link&&(!o||this._screenContext.parentModelId===o.modelId)?this._handleAfterLinkNavigation(t):e.isTablet||e.config.detailAfterCreate&&i?(s=this._getGoBackRoute(r.id),e.routing.replaceRoute(s)):this._screenContext.action==="duplicate"?e.router.go(-2):e.router.go(-1):(this.layoutManager.invalidateLayouts({type:"detail",module:t.model.module,modelId:t.model.get("id")}),s=this._getGoBackRoute(),e.routing.replaceRoute(s))},this),e.events.on("associate:view:save",this._handleAfterLinkNavigation,this),e.events.on("app:access:error",function(e){this.layoutManager.invalidateLayouts({listModules:[e.module]})},this)},_invalidateAfterLinkAction:function(e){var t={type:"detail",modelId:e.link.bean.id,module:e.link.bean.module};this.layoutManager.invalidateLayouts(t)},_initializeOffline:function(){e.events.on("offline:data:updated",function(e){e.action==="delete"&&this.layoutManager.invalidateLayouts({listModules:[e.module,"Recents","Home"]});if(e.isCollection){var t=this.layoutManager.getRootLayout();(t.type!=="list"||t.module!==e.module)&&this.layoutManager.invalidateLayouts({listModules:[e.module]})}},this)},_handleAfterLinkNavigation:function(t){var n=this.contextHistory.getRecent(),r=t.model,i=t.parentModel;this._navigationInfo.navigatingBackBy=this._navigationInfo.LINK_ACTION,this.layoutManager.invalidateLayouts({listModules:[r.module,"Recents","Home"],module:i.module,type:"detail",modelId:i.id}),this.contextHistory.items.length>1?n&&_.contains(["associate-related","create-related"],n.action)?e.router.go(-2):e.router.go(-1):this.navigate(e.router.buildRoute(i.module,i.id))},_getGoBackRoute:function(t){var n=this.getScreenContext(),r=this.getScreenContextRoot(),i=n.link,s=i?n.parentModule:n.module,o;return o=i?e.nomad.buildLinkRoute(s,n.parentModelId,i,t):e.router.buildRoute(s,t),r&&(t?o=r+"/"+o:o=r),o},clean:function(t){t=t||{},e.session.cutAll(),e.activeComponents.closeAll(),e.overlay.hideAll(),t.disposeAll&&e.supportedFeatures.dashboards&&e.nomad.dashboards.resetCollection(),this.layoutManager.clean(t)},navigate:function(t){var n=this;e.routing.emulateBackButton&&e.nomad.utils.isOnDynamicRoute()?($(window).one("hashchange",function(){n._navigateToRoute(t)}),e.activeComponents.closeAll(),e.activeComponents.goBack()):this._navigateToRoute(t)},_navigateToRoute:function(t){e.routing.location.hash===t?e.routing.replaceRoute(t):e.routing.location.hash=t},canLoadScreen:function(t){var n=t.module||t.parentModule,r=!0,i=e.nomad.dashboards.dashboardsCount;if(t.root==="home"&&e.supportedFeatures.dashboards)return e.nomad.navigateToDefaultView(),!1;if(t.root==="Dashboards")return e.supportedFeatures.dashboards?!t.dashboardId||!e.nomad.dashboards.getCollection().get(t.dashboardId)?(e.nomad.navigateToDefaultView(),!1):!0:(e.routing.replaceRoute("home"),!1);t.parentModule&&t.link?(n=e.data.getRelatedModule(t.parentModule,t.link),r=n&&!!e.metadata.getModule(n)):t.module&&(r=!!e.metadata.getModule(t.module)||_.contains(e.config.customViews,t.module));if(!r){var s=e.nomad.utils.getHash().substring(1);return e.nomad.showBackToSugarPage(s),!1}if(!_.contains(e.config.nonAclModules,n))if(t.action==="create"&&!e.nomad.canCreateModule(n)||!e.acl.hasAccess("access",n))return this.loadScreen({root:"Error",errorCode:403}),!1;return!e.offlineEnabled&&this._isOfflineScreen(t)?(e.controller.navigate("#home"),!1):!0},_isOfflineScreen:function(e){return e.root==="Offline"||e.module==="TxLog"}});e.augment("NomadController",r,!1)}(SUGAR.App),function(e){_.extend(e.nomad,{declareRoutes:function(){var t=this.customRoutes;this.routes=[{route:"About",name:"about",callback:t.about},{route:"Settings",name:"settings",callback:t.settings},{route:"error/:code",name:"error:code",callback:t.error},{route:"error",name:"error",callback:t.error},{route:"logout",name:"logout",callback:t.logout},{route:"ErrorEmulation",name:"erroremulation",callback:t.errorEmulation},{route:"logout/?clear=:clear",name:"logout:clear",callback:t.logout},{route:"Offline(/:module)(/:id)",name:"offline",callback:t.offline},{route:"createCall?direction=:direction&start_date=:start_date&duration_hours=:duration_hours&duration_minutes=:duration_minutes&status=:status",name:"relationships:createCall",callback:t.createCall},{route:":module/:id/link/:calls_link/createCall?direction=:direction&start_date=:start_date&duration_hours=:duration_hours&duration_minutes=:duration_minutes&status=:status&log_call=:log_call",name:"record:createCall",callback:t.createRelatedCall},{route:":module/:id/link/:link",name:"relationships:list",callback:t.relatedList},{route:":module/:id/link/:link/create",name:"relationships:create",callback:t.createRelated},{route:":module/:id/link/:link/associate",name:"relationships:create",callback:t.associate},{route:":module/:id/link/:link/:relatedId(/:action)",name:"relationships:action",callback:t.relatedRecord},{route:"Recents",name:"recents:list",callback:_.partial(t.list,"Recents")},{route:"Recents/:module/create",name:"recents:create",callback:_.partial(t.create,"Recents")},{route:"Recents/:module/:id(/:action)",name:"recents:record",callback:_.partial(t.record,"Recents")},{route:"Search",name:"search:list",callback:_.partial(t.list,"Search")},{route:"Search/:module/create",name:"search:create",callback:_.partial(t.create,"Search")},{route:"Search/:module/:id(/:action)",name:"search:record",callback:_.partial(t.record,"Search")},{route:"",name:"home",callback:_.partial(t.list,"home")},{route:"home",name:"home:list",callback:_.partial(t.list,"home")},{route:"home/:module/create",name:"home:create",callback:_.partial(t.create,"home")},{route:"home/:module/:id(/:action)",name:"home:record",callback:_.partial(t.record,"home")},{route:"Dashboards(/:dashboardId)(/:dashletId)(/:module)(/:recordId)(/:action)",name:"home:dashboard",callback:t.dashboard},{route:":module",name:"list",callback:_.partial(t.list,"")},{route:":module/create",name:"create",callback:_.partial(t.create,"")},{route:":module/:id(/:action)",name:"record",callback:_.partial(t.record,"")},{route:/Configure\/([^\/]*)\/([^\/]*)\/([^\/]*)/,name:"Configure",callback:function(){}},{route:/Configure\/([^\/]*)\/([^\/]*)/,name:"Configure",callback:function(){}}],e.routing.setRoutes(this.routes)},customRoutes:{dashboard:function(t,n,r,i,s){e.logger.debug("Route changed to Dashboard"+(t?", dashboardId: "+t:"")+(n?", dashletId: "+n:"")+(r?", recordModule: "+r:"")+(i?", recordId: "+i:"")+(s?", recordAction: "+s:""));var o={root:"Dashboards",dashboardId:t,dashletId:n,module:r,modelId:i,action:s};e.controller.loadScreen(o)},list:function(t,n){return e.logger.debug("Route changed to list: "+(t||n)),e.controller.loadScreen({root:t,module:n})},record:function(t,n,r,i){return e.logger.debug("Route changed: "+n+"/"+r+"/"+i),e.controller.loadScreen({root:t,module:n,modelId:r,action:i})},create:function(t,n){return e.logger.debug("Route changed: create "+n),e.controller.loadScreen({root:t,module:n,action:"create"})},relatedList:function(t,n,r){return e.logger.debug("Route changed to list rels: "+t+"/"+n+"/"+r),e.controller.loadScreen({link:r,parentModule:t,parentModelId:n})},relatedRecord:function(t,n,r,i,s){return e.logger.debug("Route changed to action rel: "+t+"/"+n+"/"+r+"/"+i),e.controller.loadScreen({link:r,parentModule:t,parentModelId:n,modelId:i,action:s})},associate:function(t,n,r){return e.logger.debug("Route changed to associate related record: "+t+"/"+n+"/"+r+"/associate"),e.controller.loadScreen({link:r,parentModule:t,parentModelId:n,action:"associate"})},createRelated:function(t,n,r){return e.logger.debug("Route changed to create related record: "+t+"/"+n+"/"+r+"/create"),e.controller.loadScreen({link:r,parentModule:t,parentModelId:n,action:"create"})},about:function(){return e.controller.loadScreen({root:"About"})},logout:function(t){e.activeComponents.closeAll(),e.overlay.show("logout",{spinner:!0,tint:!0,label:"LBL_MOBILE_WAIT"}),t=t==="1",e.logout({success:function(t){e.api.isExternalLogin()&&t&&t.url&&e.nomad.handleExternalLogout(t.url)},complete:function(){e.router.navigate("#"),e.router.login()}},t,{timeout:e.config.logoutTimeout})},settings:function(){e.controller.loadScreen({root:"Settings"})},error:function(t){e.controller.loadScreen({root:"Error",errorCode:t})},offline:function(t,n){e.controller.loadScreen({root:"Offline",module:t,modelId:n})},errorEmulation:function(){e.controller.loadScreen({root:"ErrorEmulation"})},createCall:function(t,n,r,i,s){return e.controller.loadScreen({module:"Calls",action:"createCall",callData:{direction:t,startDate:n,durationHours:r,durationMinutes:i,status:s}})},createRelatedCall:function(t,n,r,i,s,o,u,a,f){return e.controller.loadScreen({parentModule:t,parentModelId:n,action:"createCall",link:r,callData:{direction:i,startDate:s,durationHours:o,durationMinutes:u,status:a,logCall:f}})}}}),e.routing.utils={convertSugarRoute:function(t){function y(){var e=u?a:"";return e+_.toArray(arguments).join("/")}if(_.isEmpty(t))return"";if(t==="logout")return"logout";var n=_.reduce(e.nomad.routes,function(e,t){var n=t.route;return _.isString(n)&&n.indexOf(":")===-1&&e.push(n),e},[]);if(_.contains(n,t))return t;var r=t.split("/"),i=r[0],s,o=["home","search","recents","dashboards"],u=_.contains(o,r[0].toLowerCase()),a=u?r[0]+"/":null;if(i==="bwc"){var f=r[1],l=f.split("?")[1],c=e.nomad.utils.parseQueryString(l);i=c.module;if(!i)return"";var h=c.action,p=c.record;h=h.toLowerCase(),h==="index"?s=[i]:h==="detailview"&&!_.isEmpty(p)?s=[i,p]:h==="editview"&&_.isEmpty(p)?c.parent_type&&c.parent_id?s=[c.parent_type,c.parent_id,"link",i.toLowerCase(),"create"]:s=[i,"create"]:s=[i]}else s=r;var d=s.length;if(u){if(i==="Dashboards")return t;if(i==="Home"&&r.length===2)return t.replace("Home","Dashboards");if(!s[1]||!_.contains(e.metadata.getModuleNames(),s[1]))return r[0].toLowerCase()==="home"?"home":r[0];s.shift(),i=s[0]}var v=s[1],m=s[2],g=s[3],b=e.metadata.getModule(i),w=(u?a:"")+s.join("/");if(u&&d===2)return w;if(i==="Offline"){var E=["TxLog","offlineStats","offlineSettings"];return t===i||v==="TxLog"&&m||_.contains(E,v)&&s.length===2?w:!1}if(i==="Configure"||i.substring(0,10)==="createCall")return w;if(b){var S=["vcard-import","create"],x=v==="create";if(x)return y(i,"create");if(!_.isEmpty(v)&&!x){if(_.isEmpty(m)&&!_.contains(S,v))return y(i,v);if(_.contains(["duplicate","edit","create-related","associate-related"],m)&&(_.isEmpty(g)||_.isNumber(parseInt(g))))return w;if(m==="links"&&_.contains(["create","associate"],g))return w}var T=["vcard-import"];if(!_.isEmpty(v)&&_.contains(T,v))return!1;if(m==="link"){var N=s[4],C=s[5];return!_.isEmpty(g)&&_.isEmpty(N)?w:g==="calls"&&N.split("?")[0]==="createCall"?w:N&&_.isEmpty(C)?w:N&&_.contains(["duplicate","edit"],C)?w:!1}return i}return v==="offline"&&m==="TxLog"&&!_.isEmpty(g)?w:i==="error"&&v&&!m?w:!1}}}(SUGAR.App),function(e){function s(){if(!e.offline.isUp()){e.nomad.showAlert(e.lang.get("ERR_OFFLINE_START_FAILED_OUT_OF_SPACE"));return}var t=new Date-0;if(t-i<e.config.offline.cleanupConfirmationInterval)return;i=t,e.nomad.showConfirm(e.lang.get("ERR_OFFLINE_CLEAN_UP_CONFIRMATION"),function(t){var n="db_cleanup";e.nomad.dismissAlerts(),t===2&&(e.overlay.show(n),e.alert.show(n,{level:"info",messages:e.lang.get("LBL_OFFLINE_DB_CLEANING_IN_PROGRESS"),autoClose:!1,closable:!1}),e.offline.compactStorage({callback:function(t){e.router.navigate("home",!0),e.overlay.hide(n),e.alert.dismiss(n),t?e.alert.show(n,{level:"error",messages:e.lang.get("ERR_OFFLINE_DB_CLEANING_ERROR"),autoClose:!0,closable:!0}):e.alert.show(n,{level:"success",messages:e.lang.get("LBL_OFFLINE_DB_CLEANING_COMPLETED"),autoClose:!0,closable:!0})}}))})}var t=window.nomadAppEventHandlerContext={},n=[],r=function(e){var t=_.pluck(n,"module"),r=_.indexOf(t,e.module);r!==-1?n[r]=e:n.unshift(e)},i=0;e.events.on("all",function(t){var n=[],r=arguments;_.each(e.events._events,function(e,r){var i=r.split(".");i.length>1&&i[0]===t&&n.push(r)}),n.length>0&&_.each(n,function(t){r[0]=t,e.events.trigger.apply(e.events,r)})}),e.events.on("app:init",function(){window.clearInterval(e.metadata._validateMDInterval),e.metadata._validateMDInterval=null,e.routing.emulateBackButton=!e.isNative&&e.config.emulateBackButton,e.routing.emulateBackButton&&e.activeComponents.enableBackButtonHandling(),e.routing.firstStart=!0,e.isBodyScrollRequired=$.os.android&&!e.isTablet,_.extend(e.metadata.fieldTypeMap,{iframe:"url",link:"url",multienum:"multienum",name:"name","double":"float",username:"text",user_name:"text"}),_.extend(e.view.NomadField.prototype.viewFallbackMap,{view:"readonly",edit:"readonly",about:"readonly",settings:"edit"}),e.lang.setCurrentLanguage(e.lang.getLanguage()||"en_us"),e.nomad.updateServerInfo(),e.nomad.resetMeta(!1,!1),e.nomad.restoreUser(),e.nomad.enableOffline(),e.nomad.initSubpanels(),e.data.declareModels(),e.nomad.declareRoutes(),e.nomad.updateAuthStore(),e.config.sugarLogic=e.config.sugarLogic||{},e.config.sugarLogic.enabled&&e.config.sugarLogic.isDynamic&&e.loadSugarLogic(),e.nomad.configureSugarLogic(),e.isSynced&&e.nomad.initializeContextMeta(),e.api.setExternalLogin(e.config.externalLoginEnabled&&e.nomad.getSetting("externalLogin"));if(e.isNative){var t=e.nomad.getSetting("serverUrl"),n=e.nomad.getSetting("siteUrl");t&&(t=t.replace(/\/rest\/v10/,""),e.nomad.removeSetting("serverUrl")),e.config.siteUrl=n||t||"http://localhost:8888",e.api.serverUrl=e.nomad.getServerUrl(),n||e.nomad.setSetting("siteUrl",e.config.siteUrl)}e.logger.debug("Site URL: "+e.config.siteUrl),e.isNative&&navigator.splashscreen&&_.delay(function(){navigator.splashscreen.hide()},500)},t).on("app:sync",function(){e.nomad._isSyncing=!0,e.overlay.show("app:sync",{template:"preloader-panel",label:"LBL_LOADING"})},t).on("app:sync:complete",function(){e.api.isExternalLogin()&&e.nomad.setSetting("loginName",e.user.get("user_name")),e.nomad._isSyncing=!1,e.nomad._hasAskedForSync=!1,e.logger.debug("Sync complete"),e.hacks.hackModuleList(),e.nomad.initSubpanels(),e.hacks.hackAcls(),e.nomad.saveUser(),e.nomad.initializeContextMeta(),e.nomad.updateAuthStore(),e.analytics.init(),e.nomad.configureSugarLogic()},t).on("nomad:sync:complete",function(){_.delay(function(){e.overlay.hide("app:sync",!0)},300),e.cache.set("app:synced","1")},t).on("app:sync:error",function(t){e.nomad._isSyncing=!1,e.nomad._hasAskedForSync=!1,e.logger.debug("Sync failed");if(t instanceof SUGAR.Api.HttpError)t.code!=="invalid_grant"?e.nomad.showConfirm(e.lang.get("LBL_MOBILE_META_SYNC_FAILED_RETRY"),function(t){e.nomad.dismissAlerts(),t!==2?(e.overlay.hide("app:sync",!0),e.router.login()):e.nomad.syncApp()},e.lang.get("ERR_GENERIC_TITLE"),e.lang.get("LBL_MOBILE_RELOGIN_BUTTON")+","+e.lang.get("LBL_YES")):(e.overlay.hide("app:sync"),e.error.handleInvalidGrantError());else{var n=_.extend({version:"N/A",flavor:"N/A",minVersion:e.config.minServerVersion,supportedFlavors:e.config.supportedServerFlavors.join(", ")},t.server_info);t=e.lang.get(t.label,null,n)||(_.isString(t)?t:e.lang.get("LBL_MOBILE_META_SYNC_FAILED")),e.nomad.showAlert(t,function(){e.nomad.dismissAlerts(),e.overlay.hide("app:sync",!0),e.router.login()},e.lang.get("ERR_GENERIC_TITLE"))}},t).on("offline:prefetch:start",function(){n=[],e.overlay.hide("app:sync"),e.overlay.show("app:sync",{template:"preloader-panel",label:"LBL_OFFLINE_PREFETCHING"})},t).on("offline:prefetch:complete",function(t){n=[],t&&t.status!==412&&e.nomad.showAlert(e.lang.get("ERR_OFFLINE_PREFETCH_FAILED"))},t).on("offline:prefetch:progress",function(t){var i=e.config.maxPreloaderPanelMessages||4,s=[],o={};o.module=e.nomad.getPluralModuleName(t.module),t.parentModule&&(o.parentModule=e.nomad.getPluralModuleName(t.parentModule),o.relationship=e.lang.get(t.relatedModules[t.module].label,t.parentModule),o.module=e.lang.get("LBL_OFFLINE_PREFETCHING_RELATIONSHIP",null,o)),r(_.extend(t,o)),_.each(n,function(t,n){if(n+1>i)return!1;n===0?(t.estimatedTime,s.push("<span class='current'>"+e.lang.get("LBL_OFFLINE_PREFETCHING_MODULE",null,t)+"</span>")):s.push("<span class='completed'>"+e.lang.get("LBL_OFFLINE_PREFETCHING_MODULE_COMPLETE",null,t)+"</span>")}),e.overlay.hide("app:sync"),e.overlay.show("app:sync",{template:"preloader-panel",message:s.join("<br />")})},t).on("data:sync:start",function(t,n,r){if(!!r.disableGlobalDataAlerts)return;var i;if(t==="read"){if(e.offlineEnabled&&!n.offlineReadDisabled)return;r.offset||(i=e.lang.get("LBL_LOADING")),n instanceof e.BeanCollection&&(r.disableOverlay=!0)}else t==="delete"?i=r.relate?e.lang.get("LBL_UNLINKING"):e.lang.get("LBL_DELETING"):i=e.lang.get("LBL_SAVING");e.nomad.showDataSyncStartAlert(i,n.cid,r)},t).on("data:sync:success",function(t,n,r,i){if(t==="read"){var s=n.get("_acl");if(s){var o=s?s.fields:null,u=n._acl_previous||{};n._acl_previous=o,o=_.extend(u,o),e.trigger("acl:change",o)}}if(!!r.disableGlobalDataAlerts||n.skipLoadAlertHiding)return;var a;if(t==="delete")a=r.relate?e.lang.get("LBL_UNLINKED"):e.lang.get("LBL_DELETED");else if(t==="read"){if(e.offlineEnabled&&!n.offlineReadDisabled)return}else a=e.lang.get("LBL_SAVED");e.nomad.showDataSyncEndAlert(a,null,t,n.cid)},t).on("data:sync:error",function(t,n,r,i){e.nomad.showDataSyncEndAlert(null,i,t,n.cid)},t).on("data:sync:abort",function(t,n){t==="read"&&e.nomad.showDataSyncEndAlert(null,null,t,n.cid)},t).on("app:login:success",function(){e.nomad.resetUserSettings(),e.nomad.enableOffline(!0),e.nomad.setSetting("externalLogin",e.config.externalLoginEnabled&&e.api.isExternalLogin()),e.nomad.syncApp()},t).on("app:logout",function(){e.alert.dismiss("logout"),e.nomad.resetMeta(!1,!0),e.data.declareModels(),e.activeComponents.closeAll(),e.nomad.disposeAllAdditionalComponents(),e.controller.clean({disposeAll:!0})}).on("app:view:change",function(t){var n=e.controller.layoutManager.getRootLayout(),r=e.controller.layoutManager.getRecordLayout(),i=r||n;e.tutorial.show(i.name,i.module)},t).on("app:start",function(){e.started=!0},t).on("offline:failure",function(t){t===e.offline.Error.StorageUnavailableError&&e.nomad.showAlert(t.localizedMessage()+"\n"+e.lang.get("LBL_OFFLINE_DISABLED")),t!==e.offline.Error.OfflineDisabledError&&(t===e.offline.Error.OutOfSpaceError?s():e.alert.show("offline_error",{level:"error",messages:t.localizedMessage(),autoClose:!0}))},t).on("app:dashboards:changed",function(){if(!e.api.isAuthenticated())return;var t=e.lang.get("LBL_DASHBOARDS_CHANGED_PROMPT");e.nomad.dashboards.verifyDefaultView(),e.nomad.showConfirm(t,function(t){t===2&&(e.nomad.dismissAlerts(),e.nomad.navigateToDefaultView(),e.controller.clean(),e.nomad.mainMenu.render())})},t)}(SUGAR.App),function(e){var t=1048576,n=function(e,t,n){e[t]||(e[t]=[]),e[t].push(n)},r=function(e,t,n){e[t]=n},i={byType:{name:{dataName:"nameField",action:r},fullname:{dataName:"fullNameField",action:r},image:{dataName:"imageField",action:function(e,t,n){e.docFields[n.name]=n}},phone:{dataName:"phoneFields",action:n},url:{dataName:"urlFields",action:n},email:{ignore:!1,dataName:"emailFields",action:n},file:{dataName:"docFields",action:function(e,t,n){e.docFields[n.name]=n}},fieldset:{action:function(e,t,r){var s=!0;_.each(r.fields,function(t){var n=i.byType[t.type];n&&(n.action(e,n.dataName,r),s=!1)}),s&&n(e,"otherFields",r)}},emailbody:{dataName:"emailbodyFields",action:n}},byNameRegEx:{"^(?=.*address)((?!email).)*$":{dataName:"addressFields",action:n}},"default":{dataName:"otherFields",action:n}},s=function(e){var t=null;return _.each(i.byNameRegEx,function(n,r){var i=new RegExp(r);i.test(e.name)&&(t=n)}),t},o=e.data.beanModel;e.NomadBean=e.data.beanModel.extend({initialize:function(){this.addValidationTask("nomadValidation",_.bind(this._nomadValidator,this)),o.prototype.initialize.apply(this,arguments)},_nomadValidator:function(t,n,r){var i=e.metadata.getModule(this.module).fields;_.each(t,function(e,t){var r=i[t];r&&r.type==="image"&&this._imageRequiredValidator(r,t,this)&&(n[t]=n[t]||{},n[t].required=!0)},this),r(null,t,n)},_imageRequiredValidator:function(t,n,r){if(!e.supportedFeatures.fileUpload)return;var i=!1;return t.required&&(i=_.isEmpty(r.get(n))),i},getContextMetaData:function(t,n){n=n||{};var r=n.fieldsNumber||0,o=i,u=this,a={},f=n.contextData||{otherFields:n.otherFields||[],phoneFields:[],urlFields:[],emailFields:[],addressFields:[],displayListFields:[],docFields:{},emailbodyFields:[]};_.each(t,function(t,n){var i=o.byType[t.type]||s(t)||(f[o["default"].dataName].length<r?o["default"]:null);i&&!i.ignore&&i.action(f,i.dataName,t),n>0&&n<=e.config.numberOfAdditionalListFields&&f.displayListFields.push(t)}),f.headerField=f.fullNameField||f.nameField,f.subpanels=e.nomad.getSubpanels(this.module),f.hasLinkableSubpanels=e.nomad.hasLinkableSubpanels(f.subpanels),f.hasCreatableSubpanels=e.nomad.hasCreatableSubpanels(f.subpanels),f.avatarField=_.find(t,function(t){return t.type==="image"&&t.name==="picture"&&_.contains(e.config.modulesWithAvatars,u.module)}),f.addressFieldsGroups=_.groupBy(f.addressFields,function(e){return e.type==="address"?e.name:u.fields[e.name].group}),f.actions=a,f.phoneFields.length&&(a.phone={cssClass:"phone",iconCssClass:"icon-phone",action:"phone"},a.message={cssClass:"message sms",iconCssClass:"icon-comment",action:"sms"}),f.emailFields.length&&(a.email={cssClass:"email",iconCssClass:"icon-envelope",action:"email"}),f.urlFields.length&&(a.url={cssClass:"link",iconCssClass:"icon-external-link",action:"url"}),_.keys(f.addressFieldsGroups).length&&(a.map={cssClass:"map",iconCssClass:"icon-map-marker",action:"map"});if(this._canHaveFiles(f.docFields)||this._canHavePDFs()||this.canHaveAttachments())a.doc={cssClass:"doc",iconCssClass:"icon-file",action:"doc"};return f.emailbodyFields.length&&(a.emailbody={cssClass:"emailbody",iconCssClass:"icon-font",action:"emailbody"}),a.available=_.any(a),f},getAddresses:function(t){var n,r,i,s=this;return _.chain(t).map(function(t,o){o.lastIndexOf("_c")===o.length-2&&(o=o.replace("_c","")),i={},_.each(t,function(t,r){var u=s.get(t.name);if(u){n=t.name,n=n.replace(o+"_",""),n.lastIndexOf("_c")===n.length-2&&(n=n.replace("_c",""));if(t.type==="enum"){var a=e.metadata.getModule(s.module).fields[t.name],f=e.lang.getAppListStrings(a.options)||{};u=f[u]||u}i[n]=u}});if(_.keys(i).length){r={};var u=e.lang.get("LBL_"+o.toUpperCase(),s.module);return r[u]=i,r}}).compact().value()},getDocuments:function(t,n){var r=this;this.docsLoading=!0,t=_.filter(t,function(t){return e.acl.hasAccessToModel("read",this,t.name)},this);if(this.canHaveAttachments()){var i=this.get("attachment_list");this._createDocData(i,t)}else if(this._canHaveFiles(t)){var s=[],o=this.get("doc_url");if(_.has(this.fields,"doc_url")&&!_.isEmpty(o)){var u=this.get("filename");_.has(this.fields,"doc_type")&&(u+=" ("+this.get("doc_type")+")"),s=this._createDocData([{name:u,uri:o,openExternally:!0,nonSugarURL:!0}],t,null,{silent:!0})}n?r._createDocData(n,t,s):this.getFiles({success:function(e){r._createDocData(e,t,s)},error:function(t){e.logger.debug("Error creating file url for "+r.module+" : "+t),r.docsLoading=!1,r.trigger("docs:ready",s)}},{iframe:!1,deleteIfFails:!1})}else this._canHavePDFs()?this._createDocData([{name:this.module+".pdf",uri:e.api.serverUrl+"/"+this.module+"/"+this.id+"/pdf",file_mime_type:"application/pdf",filename:this.get("name")+".pdf",oauth:!0}],t):(this.docsLoading=!1,this.trigger("docs:ready",[]))},_createDocData:function(n,r,i,s){function a(t){return!_.isString(t)||o.module==="Documents"?!1:!e.acl.hasAccessToModel("read",o,t)||!_.contains(u,t)}var o=this,u=_.pluck(r,"name");return this.docsLoading=!1,s=s||{},i=i||[],_.each(n,function(n,s){var u,f,l,c,h=n.uri||n.file_uri,p=n["content-length"],d=n.name||n.document_revision_filename;if(!h||a(s))return;f=_.find(r,function(e){return e.name===s}),l=f?e.lang.get(f.label,o.module):d,d&&p&&(l+=" ("+o._fileSizeFormat(n["content-length"])+")",p>t&&(n.openExternally=!0)),d&&!n.nonSugarURL&&(c=h.split(/rest\/v\d*\//)[1],h=e.api.serverUrl+"/"+c+"?platform="+e.config.platform,e.nomad.isDownloadTokenSupported()?n.oauth||(h+="&download_token={download_token}"):h+="&oauth_token={oauth_token}"),u={},u[l]={url:h,openExternally:n.openExternally||!1,isImage:f&&f.type==="image",file_mime_type:n.file_mime_type||this.get("file_mime_type")||n["content-type"]||"",filename:n.filename||this.get("filename")||n.name||"",oauth:n.oauth},i.push(u)},this),s.silent||this.trigger("docs:ready",i),i},_fileSizeFormat:function(t){return t<=0?"0":""+e.nomad.utils.humanFileSize(t)},_canHaveFiles:function(t){var n=e.config.modulesWithFiles||[];return!_.isEmpty(t)||_.contains(n,this.module)||_.has(this.fields,"doc_url")},_canHavePDFs:function(){var t=e.config.modulesWithPDFs||[];return _.contains(t,this.module)},getFieldsDataArray:function(t,n){var r,i,s,o,u=[],a=this,f,l;return _.each(t,function(t){o={},i=a.get(t.name),l=t.name,s=e.metadata.getModule(a.module).fields[l],i&&(_.isUndefined(n)||i.match(n))&&(f=t.label||s.label||s.vname||l,r=e.lang.get(f,a.module),o[r]=i,u.push(o))}),u},getAccessibleFields:function(t,n){n=n||"read";var r=this;return t=_.filter(t,function(t){return e.acl.hasAccessToModel(n,r,t.name)}),t||[]},getAccessibleFieldsGroups:function(e,t){var n={},r=this;return _.each(e,function(e,i){e=r.getAccessibleFields(e,t),e.length&&(n[i]=e)}),n},isDataDefined:function(e,t){return _.any(e,function(e){var n=this.get(e.name);return t?_.isString(n)&&n.match(t):n},this)},hasPrimaryEmail:function(t){return _.any(t,function(t){var n=this.get(t.name),r=e.nomad.utils.getPrimaryEmail(n,!0);return!_.isEmpty(r)},this)},hasActiveEmail:function(e){return _.any(e,function(e){return _.any(this.get(e.name),function(e){return!Number(e.invalid_email)&&!Number(e.opt_out)})},this)},hasDeleteAccess:function(){if(e.acl.hasAccessToModel("delete",this)&&!_.contains(e.config.nonDeletableModules,this.module))return!e.serverInfo.isSevenUp||!this.get("closed_revenue_line_items")&&!_.find(e.config.nonDeletableSalesStages,function(e){return e===this.get("sales_status")||e===this.get("sales_stage")},this)},hasUnlinkAccess:function(t,n){return n.relationship_type==="many-to-many"?!0:_.isEmpty(t)?n.via_parent_id?e.acl.hasAccessToModel("edit",this,n.relationship_role_column):!0:!_.find(t,function(t){return!e.acl.hasAccessToModel("edit",this,t.name)},this)},changeCurrencyId:function(t,n){n=n||{};var r=this.get("currency_id")||t,i={},s=n.silentField||{};_.each(this.fields,function(n,s){if(n.type!=="currency")return;var o=this.get(s);if(!!o){var u=e.currency.convertAmount(o,r,t);this.set(s,u,{silent:!0})}i[s]=!0},this),this.set("currency_id",t,{silent:!0}),n.silent||_.each(i,function(e,t){if(s===t)return!1;this.trigger("change:"+t)},this)},getChangeDiff:function(e,t){var n={};return e=e||{},t=t||[],_.each(this.attributes,function(r,i){if(_.contains(t,i))return;var s=e[i];_.isEqual(s,r)||(n[i]=s)}),n},save:function(e,t){return t=t||{},t.lastModified=this.get("date_modified"),o.prototype.save.call(this,e,t)},uploadFile:function(t,n,r,i){r=r||{},i=i||{},i.iframe=!1;var s=this;return i.deleteIfFails=!!i.isCreate,e.api.file("create",{id:this.id,module:this.module,field:t},n,{success:function(e,n,i){var o=e[t];if(o)s._onFileChange(e,t),r.success&&r.success(e);else{var u=new SUGAR.Api.HttpError({xhr:i});u.responseText=e.xhr?e.xhr.message:u.responseText,r.error&&r.error(u)}},error:function(e){e.isFileUploadError=!0,r.error.call(this,e)}},i)},deleteFile:function(t,n,r,i){var s=this,o;return i=i||{},o={success:function(e){s._onFileChange(e,t),r.success&&r.success(e)},error:function(e){e.isFileUploadError=!0,r.error&&r.error(e)}},e.api.file("delete",{module:this.module,id:this.id,field:t},null,o,i)},_onFileChange:function(e,t){this.set(t,e[t].name),e.record?this.set("date_modified",e.record.date_modified):this._docsUpdated=!0},isCloseActionAvailable:function(){var t=this.get("status"),n=e.nomad.utils.getClosedStatusValue(this.module),r=n===t;return n&&!r&&e.acl.hasAccessToModel("edit",this)&&!_.contains(e.config.nonEditableModules,this.module)}}),e.data.beanModel=e.NomadBean}(SUGAR.App),function(e){function n(){e.router.login()}var t={INTERNET_UNAVAILABLE:-1,CONNECTION_FAILED:-2,CONNECTION_TIMEOUT:-3,INVALID_CREDENTIALS:-4},r=e.error.handleStatusCodesFallback,i=e.error.enableOnError,s=e.error.handleUnhandledError;e.error.statusCodes[200]=e.error.statusCodes[0],e.error=_.extend(e.error,{enableOnError:function(){return e.config.raven&&e.config.raven.enabled?!0:i.apply(this,arguments)},_alertUnauthorized:function(){e.alert.show("auth_error",{level:"error",messages:e.lang.get("ERR_MOBILE_NOT_AUTHORIZED"),autoClose:!0})},_alertSystemError:function(t){var n=t.status||t.status===0?t.status.toString():"N/A",r;t instanceof e.offline.Error?r=t.localizedMessage():r=e.lang.get("ERR_MOBILE_INTERNAL").replace("{{{code}}}",n),e.alert.show("system_error",{level:"error",messages:r,autoClose:!0,uid:"ERR_MOBILE_INTERNAL_"+n,pageHash:t.request?t.request.params.pageHash:null})},handleNeedLoginError:function(){e.alert.show("auth_error",{level:"error",messages:e.lang.get("ERR_MOBILE_INVALID_CREDS"),autoClose:!0}),n(),this._sendAnalytics(t.INVALID_CREDENTIALS)},handleInvalidGrantError:function(){e.alert.show("auth_error",{level:"error",messages:e.lang.get("ERR_MOBILE_SESSION_EXPIRED"),autoClose:!0}),n()},handleUnhandledError:function(t,n,r){try{this.logFatalError(t,{url:n,line:r,version:e.nomad.getVersion(),serverVersion:e.nomad.getServerVersion(),serverUrl:e.nomad.getServerUrl(),clientInfo:e.clientInfo})}catch(i){}},logFatalError:function(t,n){try{var r=e.config.env==="prod";t=t||"Unknown error",e.logger.fatal(JSON.stringify(n)),t=r?e.lang.get("ERR_INTERNAL_ERR_MSG"):"FATAL: "+t,e.alert.show("system_error",{level:"error",messages:t,autoClose:!0}),e.analytics.trackEvent("device","exception")}catch(i){}},handleUnauthorizedError:function(){this._alertUnauthorized(),n()},handleForbiddenError:function(e){this._alertUnauthorized(),this._sendAnalytics(e.status)},handleNotFoundError:function(t){e.alert.show("not_found_error",{level:"error",messages:this._adjustErrorMessage("ERR_MOBILE_NOT_FOUND",t),autoClose:!0}),this._sendAnalytics(t.status)},handleTimeoutError:function(n){e.alert.show("system_error",{level:"error",messages:this._adjustErrorMessage("ERR_MOBILE_TIMEOUT",n),autoClose:!0,uid:"ERR_MOBILE_TIMEOUT",pageHash:n.request.params.pageHash}),this._sendAnalytics(t.CONNECTION_TIMEOUT)},handleMethodConflictError:function(e){this._sendAnalytics(e.status)},handleStatusCodesFallback:function(i,s,o){var u,a=i.status;e.alert.dismissAll({animate:!1});if(_.isUndefined(i.status)){i===e.offline.Error.OutOfSpaceError&&e.alert.show("offline_error",{level:"error",messages:i.localizedMessage(),autoClose:!0});return}var f;if(i.status!="0"||i.textStatus!=="error"&&i.textStatus!=="abort"||!_.isEmpty(i.errorThrown))if(i.status=="412"){if(e.nomad._isSyncing||e.nomad._hasAskedForSync)return;e.nomad._hasAskedForSync=!0,e.nomad.showConfirm(e.lang.get("ERR_MOBILE_METADATA_CHANGED_RELOAD"),function(t){e.nomad.dismissAlerts(),t===2?(document.activeElement&&document.activeElement.blur(),e.controller.clean({disposeAll:!0}),e.nomad.syncApp()):(e.nomad._hasAskedForSync=!1,e.alert.show("meta_error",{level:"error",messages:e.lang.get("ERR_MOBILE_METADATA_CHANGED"),autoClose:!0}))})}else i.status=="422"&&i.message&&(f=i.message.match(/^(.*) is an invalid email address$/))?e.alert.show("meta_error",{level:"error",messages:e.lang.get("ERROR_EMAIL",null,{email:f[1]}),autoClose:!1}):i.status=="433"?e.nomad.showConfirm(e.lang.get("ERR_MOBILE_INCOMPATIBLE_CLIENT_VERSION",null,{brandName:e.config.brandName}),function(t){e.nomad.dismissAlerts(),t===2&&e.nomad.openAppStore(),n()}):(this._alertSystemError(i),i.status=="400"&&n());else e.nomad.isOnline()?(u="Server is unreachable. "+(navigator.connection?"Connection: "+navigator.connection.type:""),a=t.CONNECTION_FAILED):(u="Device is offline",a=t.INTERNET_UNAVAILABLE),e.alert.show("network_error",this.prepareNetworkAlertParams(i,o));var l=!_.contains([0,433,412],i.status);if(l||!l&&e.logger.levels[e.config.logLevel].value<=e.logger.levels.DEBUG.value)u&&e.logger.error(u),r(i),this._logRequestUrl(i);this._sendAnalytics(a)},handleNotSupportedPlatform:function(){window.location.replace("error-not-supported-platform.html?desktop_url="+e.nomad.getDesktopUrl())},handleExternalLoginNotAvailable:function(){e.alert.show("sso_error",{level:"error",messages:e.lang.get("ERR_MOBILE_SSO_NOT_CONFIGURED"),autoClose:!0})},isAccessError:function(e){return _.contains([403,404],e.status)},prepareNetworkAlertParams:function(t,n){var r,i=e.nomad.isOnline()?this._adjustErrorMessage("ERR_MOBILE_CONNECTION_FAILED",t):e.lang.get("ERR_MOBILE_INTERNET_UNAVAILABLE");return r={level:"error",messages:i,autoClose:!0,pageHash:t.request.params.pageHash,requestOptions:n},t.isFileUploadError||(r.uid="ERR_MOBILE_CONNECTION_FAILED"),r},_sendAnalytics:function(t){t=t||"unknown",e.analytics.trackEvent("api-error",t)},_adjustErrorMessage:function(t,n){var r=n&&n.request&&n.request.params?e.api.isLoginRequest(n.request.params.url):!1;return r&&(t+="_LOGIN"),e.lang.get(t,null,{brandName:e.config.brandName,minVersion:e.config.minServerVersion,supportedFlavors:e.config.supportedServerFlavors.join(", ")})},_logRequestUrl:function(t){t.request&&t.request.params&&t.request.params.url&&e.logger.error("URL of failed request: "+t.request.params.url)}}),e.error.statusCodes[422]=e.error.handleStatusCodesFallback}(SUGAR.App),function(e){var t={DIMENSIONS:{offline_mode:1,connection:2},METRICS:{},initialized:!1,trackEventSplitter:/^(.*):([\-\w]+)\.?(\S+)?$/,eventSplitter:/\s{2,}/,currentViewId:"",loginProcessed:!0,init:function(){e.config.analytics.enabled&&e.nomad.loadAnalytics();if(e.config.analytics.enabled&&typeof Analytics!="undefined"&&Analytics){if(this.initialized)return;this.initialize();var t=e.config.analytics.id;t=_.isObject(t)?e.isNative?t["native"]:t.web:t,analytics.start(t,e.config.analytics),e.logger.debug("Analytics enabled - "+t)}else e.events.off(null,null,this),this.initialized=!1,e.logger.debug("Analytics disabled")},initialize:function(){e.events.on("app:view:change",function(t){var n,r,i,s;if(t.action){switch(t.action){case"duplicate":r="edit",i="duplicate";break;case"create-related":case"associate-related":r="pickerlist";break;case"associate":r=t.action,n=e.data.getRelatedModule(t.parentModule,t.link),i=t.parentModule;break;default:r=t.action?t.action:"detail"}t.action==="create"&&t.parentModelId&&(r="edit",n=t.parentModule,i=t.link,t.link="create"),n||(n=t.module||t.parentModule)}else if(t.parentModelId)t.modelId?(r="details",n=t.parentModule):(r="relationships",n=t.parentModule);else if(t.root)switch(t.root){case"Login":r=t.root.toLowerCase(),n=t.root,i="create";break;case"home":r=t.root,n=e.utils.capitalize(t.root);break;case"About":case"Settings":r=t.root.toLowerCase(),n=e.utils.capitalize(t.root),i="create";break;case"Offline":switch(t.module){case"TxLog":r=t.modelId?"detail":"list",n=t.module;break;case"offlineStats":r=t.module,n=t.root,i="create";break;default:r=t.root.toLowerCase(),n=t.root,i="create"}break;case"Search":case"Recents":t.module&&t.modelId?(r="detail",n=t.module):(r="list",n=t.root);break;case"Dashboards":if(t.dashletId){var o=e.nomad.dashboards.getDashletConfig(t.dashboardId,t.dashletId).view;r="dashlet",o.template==="tabbed-dashlet"?r="":o.type==="dashablelist"?(n="list",i=o.module):n=o.type}else r="dashboard"}else t.layoutDef?(s=t.layoutDef.gaTrack,s==="teamset"?(r="multienum",n=e.controller.getScreenContext().module,i="teamset"):s==="textarea"?(r=s,n=t.layoutDef.context.get("parentModel")?t.layoutDef.context.get("parentModel").module:null):(r=s,n=e.controller.getScreenContext().module,s==="relate"||s==="parent-list"?i=t.layoutDef.context.attributes.module:s==="about"&&(n="Login"))):(r=t.modelId?"detail":"list",n=t.module||t.parentModule||t.root);var u=(r||"")+(n?"/"+n:"")+(i?"/"+i:"")+(t.link?"/"+t.link:"");_.isEmpty(u)||this.setActiveView(u)},this).on("app:login:success",function(){_.isEmpty(e.serverInfo.version)?e.analytics.loginProcessed=!1:(e.analytics.trackEvent("login",e.serverInfo.version),e.analytics.loginProcessed=!0)},this).on("app:sync:complete",function(){e.analytics.loginProcessed||(e.analytics.trackEvent("login",e.serverInfo.version),e.analytics.loginProcessed=!0)},this).on("app:logout",function(){e.analytics.loginProcessed=!1},this).on("offline:enabled",function(t){e.analytics.setDimension(e.analytics.DIMENSIONS.offline_mode,t?"enabled":"disabled")},this).on("offline:failure",function(t){e.analytics.trackEvent("offline-failure",t.code)},this).on("offline:tx:create",function(t){e.analytics.trackEvent("tx-create",e.offline.utils.actionToSymbol(t.txOptions))},this).on("offline:tx:success",function(t){e.analytics.trackEvent("tx-success",e.offline.utils.actionToSymbol(t.tx),e.offline.utils.getTxAge(t.tx))},this).on("offline:tx:error",function(t){e.analytics.trackEvent("tx-error",t.errorCode||"unknown",e.offline.utils.getTxAge(t.tx),e.offline.utils.actionToSymbol(t.tx))},this).on("offline:tx:rollback",function(t){e.analytics.trackEvent("tx-rollback",e.offline.utils.actionToSymbol(t.tx),e.offline.utils.getTxAge(t.tx))},this).on("offline:wins:completed",function(t){e.analytics.trackEvent("offline:wins","synced",t.syncedRecords,"numRecords")},this),this.initialized=!0},setActiveView:function(e,t){this.currentViewId=e,t||this.trackPageView(e)},trackPageView:function(t){if(!this.initialized)return;e.logger.debug("GAN-page: "+t),e.offlineEnabled&&this.setDimension(this.DIMENSIONS.connection,e.offline.status.noConnection?"offline":"online"),analytics.trackPageView(t)},trackEvent:function(t,n,r,i){if(!this.initialized)return;n=""+(n||"[unknown]"),i=""+(i||this.currentViewId),e.logger.debug("GAN-event: "+t+":"+n+"("+r+")"+" for "+i),analytics.trackEvent({category:t,action:n,label:i,value:r})},startSession:function(){if(!this.initialized)return;analytics.startSession()},setDimension:function(e,t){if(!this.initialized)return;analytics.setDimension({index:e,value:t})},setMetric:function(e,t){if(!this.initialized)return;analytics.setMetric({index:e,value:t})},detachAnalytics:function(e){var t=this.getTrackableElements(e);t.unbind(".analytics")},attachAnalytics:function(e){var t=this,n=this.getTrackableElements(e);n.unbind(".analytics"),n.each(function(e,n){t._attachAnalytics(n)})},getTrackableElements:function(e){var t=this._getTrackableElements(e);return e.attr("track")&&(t=t.add(e)),t},_getTrackableElements:function(e){return $("[track]",e)},_attachAnalytics:function(e){var t=$(e),n=(t.attr("track")||"").trim();if(n==="")return;var r=n.match(this.trackEventSplitter),i=(r[1]||"").trim(),s=r[2],o=r[3]||"",u=i.replace(this.eventSplitter," ").split(" ");u=_.map(u,function(e){return e+".analytics"}),i=u.join(" "),this._attachEvents(i,s,o,t)},_attachEvents:function(t,n,r,i){t&&(i.off(t),i.on(t,function(t){n=n||t.currentTarget.id,e.analytics.trackEvent(t.type,n,r&&$(this).hasClass(r)?1:0)}))},dispose:function(){e.events.off(null,null,t),this.initialized=!1}};e.augment("analytics",t,!1)}(SUGAR.App),function(e){var t={CALL_STATE:{IDLE:"IDLE",DIALING:"DIALING",CONNECTED:"CONNECTED"},_callModule:"Calls",getCallLog:function(){return e.nomad.getSetting("callLog")},setCallLog:function(t){e.nomad.setSetting("callLog",t)},clearCallLog:function(){e.nomad.removeSetting("callLog")},callPhone:function(t,n){var r={phone:t,module:n.module,recordId:n.id,recordName:n.get("name")};this.setCallLog(r),e.isNative||this.bindCallEnd(),e.logger.debug("Initiating a phone call to "+t),e.nomad._callPhone(t)},callStateChanged:function(t){t=JSON.parse(t);if(t.length===0)return;e.logger.debug("Call state changed: "+t.length);var n=t[0];e.logger.debug("First call: "+n.id+":"+n.state);var r=this.getCallLog(),i=$.os.ios&&e.utils.versionCompare($.os.version,8,">=");r&&(n.state===this.CALL_STATE.DIALING?(r.state=n.state,r.direction="Outbound",r.startedOn=(new Date).getTime(),i||(r.started=!0),this.setCallLog(r)):n.state===this.CALL_STATE.IDLE?(r.state=n.state,r.endedOn=(new Date).getTime(),this.setCallLog(r)):n.state===this.CALL_STATE.CONNECTED&&(r.started=!0,this.appResumed()))},appPaused:function(){},appResumed:function(){if(!e.isSynced)return;var t=this.getCallLog();if(!t)return;if($.os.android&&t.state!==this.CALL_STATE.IDLE&&e.isNative)return;if(!t.started){this.clearCallLog();return}t.endedOn=t.endedOn||(new Date).getTime();var n=this;this._canLogCall(t)&&e.nomad.showConfirm(e.lang.get("LBL_MOBILE_LOG_CALL_CONFIRM"),function(e){e===2&&n.logCall(t)}),this.clearCallLog()},logCall:function(t){var n=t.endedOn-t.startedOn,r=n/1e3,i=1,s=0;r>60&&(i=r/60,i>60&&(s=i/60,i%=60));var o=e.nomad.getRelationshipLink(t.module,this._callModule),u=t.direction==="Outbound"&&o?e.nomad.buildLinkRoute(t.module,t.recordId,o,null,"createCall"):"createCall";u+="?direction="+t.direction+"&start_date="+(new Date(t.startedOn)).toISOString()+"&duration_hours="+s+"&duration_minutes="+i+"&status=Held"+"&log_call=true",e.router.navigate(u,{trigger:!0})},_canLogCall:function(t){var n=["Employees","Calls"],r=!_.contains(n,t.module),i=e.metadata.getModule(this._callModule),s=i&&e.acl.hasAccess("create",this._callModule),o=t.module==="Users"&&t.recordId===e.user.get("id");return s&&i&&r&&!o},bindCallEnd:function(){var t,n=JSON.stringify([{state:this.CALL_STATE.DIALING}]);this.callStateChanged(n),$.os.android?(t=_.bind(function(){this._pageIsVisible()&&(e.logger.debug("bindCallEnd return handler called"),document.removeEventListener("webkitvisibilitychange",t),this.appResumed())},this),document.addEventListener("webkitvisibilitychange",t,!1)):$.os.ios&&(t=_.bind(function(){window.removeEventListener("pageshow",t),this.appResumed()},this),window.addEventListener("pageshow",t,!1))},_pageIsVisible:function(){return!document.webkitHidden}};e.augment("telephony",t,!1)}(SUGAR.App),function(e){e.baseMetadata={_hash:"_base_",modules:{Dashboards:{_hash:"DashboardsHash",fields:{_hash:"DashboardsFieldsHash",id:{name:"id",type:"id"},name:{name:"name",type:"varchar",unified_search:!0},dashboard_type:{name:"dashboard_type",type:"varchar"},date_modified:{name:"date_modified",type:"datetime"},url:{name:"url",type:"varchar"},metadata:{name:"metadata",type:"metadata"}},layouts:{detail:{meta:{components:[{view:"dashboard"}]}}},views:{detail:{meta:{panels:[{fields:[]}]}}}},Comments:{_hash:"CommentsHash",fields:{name:{name:"name",type:"varchar"},date_entered:{name:"date_entered",type:"datetime"},date_modified:{name:"date_modified",type:"datetime"},created_by:{name:"created_by",type:"id"},created_by_name:{name:"created_by_name",type:"relate",link:"created_by_link"},activities:{name:"activities",type:"link",relationship:"comments",module:"Activities"},parent_id:{name:"parent_id",type:"id"},data:{name:"data",type:"json"},_hash:"CommentsFieldsHash"}},Activities:{_hash:"ActivitiesHash",fields:{_hash:"ActivitiesFieldsHash",name:{name:"name",type:"varchar"},date_entered:{name:"date_entered",type:"datetime"},date_modified:{name:"date_modified",type:"datetime"},parent_id:{name:"parent_id",type:"id"},parent_type:{name:"parent_type",type:"varchar"},activity_type:{name:"activity_type",type:"varchar"},data:{name:"data",type:"json"},comment_count:{name:"comment_count",type:"int"},last_comment:{name:"last_comment",type:"json"},created_by:{name:"created_by",type:"id"},comments:{module:"Comments",name:"comments",relationship:"comments",type:"link"}},mergedFields:["name","my_favorite","following"],filters:{_hash:"ActivitiesFiltersHash",activity:{meta:{create:!1,default_filter:"all_records",quicksearch_field:[],quicksearch_priority:2,filters:[{id:"all_records",name:"LBL_LISTVIEW_FILTER_ALL",filter_definition:[],editable:!1},{id:"messages_for_create",name:"LBL_ACTIVITY_CREATE",filter_definition:{$or:[{activity_type:"create"},{activity_type:"attach"}]},editable:!1},{id:"messages_for_update",name:"LBL_ACTIVITY_UPDATE",filter_definition:{activity_type:"update"},editable:!1},{id:"messages_for_link",name:"LBL_ACTIVITY_LINK",filter_definition:{activity_type:"link"},editable:!1},{id:"messages_for_unlink",name:"LBL_ACTIVITY_UNLINK",filter_definition:{activity_type:"unlink"},editable:!1},{id:"messages_for_post",name:"LBL_ACTIVITY_POST",filter_definition:{activity_type:"post"},editable:!1}]}}},views:{"activitystream-dashlet":{meta:{panels:[{fields:[]}],view:{auto_refresh:0,currentFilterId:"all_records",limit:e.config.fetchLimit.activities,module:"Activities",type:"activitystream-dashlet"}}}}},Filters:{_hash:"FiltersHash",fields:{_hash:"FiltersFieldsHash"},layouts:{}},Teams:{_hash:"TeamsHash",favoritesEnabled:!1,ftsEnabled:!1,mergedFields:["id","name","name_2"],fields:{_hash:"TeamsFieldsHash",id:{name:"id",type:"id"},name:{name:"name",type:"varchar",unified_search:!0},name_2:{name:"name_2",type:"varchar",unified_search:!0},primary:{name:"primary",type:"boolean"}},views:{list:{meta:{panels:[{fields:[{name:"name",type:"text"},{name:"name_2",type:"varchar"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}}},Login:{_hash:"LoginHash",fields:{_hash:"LoginFieldsHash",username:{name:"username",type:"username",required:!0},password:{name:"password",type:"password",required:!0},url:{name:"url",type:"url",required:!0}},views:{login:{meta:{panels:[{label:"Login",fields:[{name:"username",label:"Username"},{name:"password",label:"Password"},{name:"url",label:"URL"}]}]}}},layouts:{login:{meta:{type:"login",components:[{view:"login"}]}}}},About:{_hash:"AboutHash",fields:{_hash:"AboutFieldsHash",app_version:{name:"app_version",type:"varchar"},server_version:{name:"server_version",type:"varchar"},server_url:{name:"server_url",type:"url"},support_email:{name:"support_email",type:"url"},support_website:{name:"support_website",type:"url"}},views:{about:{meta:{panels:[{label:"LNK_ABOUT",fields:[{name:"app_version",label:"LBL_MOBILE_APP_VERSION",view:"readonly"},{name:"server_version",label:"LBL_MOBILE_SERVER_VERSION",view:"readonly"},{name:"server_url",label:"LBL_MOBILE_SERVER_URL",view:"readonly"},{name:"support_email",label:"LBL_MOBILE_FEEDBACK",css_class:"support_email hide"},{name:"support_website",label:"LBL_MOBILE_SUPPORT",css_class:"support_website"}]}]}}},layouts:{about:{meta:{type:"about",components:[{view:"about"}]}}}},Error:{_hash:"Error",fields:{_hash:"ErrorHash",message:{name:"message",type:"varchar"}},layouts:{error:{meta:{type:"error",components:[{view:"error"}]}}},views:{error:{meta:{panels:[{fields:[]}]}}}},Settings:{_hash:"SettingsHash",fields:{_hash:"SettingsFieldsHash",language:{name:"language",type:"enum","default":"en_us"},logging:{name:"logging",type:"enum","default":e.config.logLevel},fontSize:{name:"fontSize",type:"enum","default":"normal"}},views:{settings:{meta:{panels:[{label:"LNK_SETTINGS",fields:[{name:"language",label:"LBL_LANGUAGE",options:"available_language_dom",view:"edit","default":"en_us"},{name:"logging",label:"LBL_LOG_LEVEL",options:["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"],view:"edit","default":e.config.logLevel},{name:"fontSize",label:"LBL_SET_FONTSIZE",view:"edit","default":"normal"}]}]}}},layouts:{settings:{meta:{type:"settings",components:[{view:"settings"}]}}}},TxLog:{_hash:"txLogHash",fields:{_hash:"TxLogFieldsHash",_tx_action:{name:"_tx_action"},_tx_bean_module:{name:"_tx_bean_module"},_tx_updated_fields:{name:"_tx_updated_fields"},_tx_error_count:{name:"_tx_error_count"}},views:{list:{meta:{panels:[{label:"XXX",fields:[{name:"_tx_action"},{name:"_tx_bean_module"}]}]}},detail:{meta:{panels:[{label:"XXX",fields:[{name:"_tx_action"},{name:"_tx_bean_module"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}},detail:{meta:{type:"detail",components:[{view:"detail"}]}}}},Offline:{_hash:"OfflineHash",fields:{_hash:"OfflineFieldsHash",language:{name:"language",type:"enum","default":"en_us"},logging:{name:"logging",type:"enum","default":e.config.logLevel}},views:{offline:{meta:{panels:[{label:"LNK_SETTINGS",fields:[]}]}}},layouts:{offline:{meta:{type:"offline",components:[{view:"offline"}]}},offlineSettings:{meta:{type:"offline",components:[{view:"offline-settings"}]}},offlineStats:{meta:{type:"offline",components:[{view:"offline-stats"}]}}}},Recents:{_hash:"RecentsHash",fields:{_hash:"RecentsFieldsHash"},views:{list:{meta:{panels:[{fields:[{name:"field_0"},{name:"field_1"}]}],label:"LBL_RECENTLY_VIEWED"}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}}},Search:{_hash:"SearchHash",fields:{_hash:"SearchFieldsHash",assigned_user_id:{name:"assigned_user_id"}},views:{list:{meta:{panels:[{fields:[]}],label:"LBL_MOBILE_GLOBAL_SEARCH"}}},layouts:{list:{meta:{type:"list",components:[{view:{name:"list"}}]}}},favoritesEnabled:!0},ErrorEmulation:{_hash:"ErrorEmulationHash",fields:{_hash:"ErrorEmulationHash",language:{name:"language",type:"enum","default":"en_us"}},views:{errors:{meta:{panels:[{label:"LNK_SETTINGS",fields:[]}]}}},layouts:{erroremulation:{meta:{type:"errors",components:[{view:"error-emulation"}]}}}},ProductTypes:{_hash:"ProductTypesHash",fields:{_hash:"ProductTypesFieldsHash",id:{name:"id",type:"id"},name:{name:"name",type:"varchar",vname:"LBL_NAME"}},views:{list:{meta:{panels:[{fields:[{name:"name"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["name"],ftsEnabled:!1,favoritesEnabled:!1,_patched:!0},ProductCategories:{_hash:"ProductCategoriesHash",fields:{_hash:"ProductCategoriesFieldsHash",id:{name:"id",vname:"LBL_ID",type:"id",required:!0},name:{name:"name",vname:"LBL_NAME",type:"varchar",len:50,required:!0},parent_id:{name:"parent_id",type:"id",vname:"LBL_PARENT_NAME"},parent_name:{id_name:"parent_id",link:"member_categories",module:"ProductCategories",name:"parent_name",source:"non-db",type:"relate",unified_search:!0,vname:"LBL_PARENT_CATEGORY"}},views:{list:{meta:{panels:[{fields:[{name:"name"},{name:"parent_name"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["name","parent_name","parent_id"],ftsEnabled:!1,favoritesEnabled:!1,_patched:!0},ProductTemplates:{_hash:"ProductTemplatesHash",fields:{_hash:"ProductTemplatesFieldsHash",id:{name:"id",vname:"LBL_ID",type:"id",required:!0},deleted:{name:"deleted",vname:"LBL_DELETED",type:"bool",required:!1,"default":"0"},date_entered:{name:"date_entered",vname:"LBL_DATE_ENTERED",type:"datetime"},date_modified:{name:"date_modified",vname:"LBL_DATE_MODIFIED",type:"datetime"},modified_user_id:{name:"modified_user_id",rname:"user_name",id_name:"modified_user_id",vname:"LBL_MODIFIED_ID",type:"assigned_user_name"},created_by:{name:"created_by",rname:"user_name",id_name:"modified_user_id",vname:"LBL_CREATED_ID",type:"assigned_user_name"},type_id:{name:"type_id",type:"id",required:!1,vname:"LBL_TYPE_ID"},manufacturer_id:{name:"manufacturer_id",type:"id",required:!1,vname:"LBL_LIST_MANUFACTURER_ID"},manufacturer_name:{name:"manufacturer_name",rname:"name",id_name:"manufacturer_id",type:"relate",vname:"LBL_MANUFACTURER_NAME",join_name:"manufacturers",link:"manufacturer_link",module:"Manufacturers"},category_id:{name:"category_id",type:"id",required:!1,vname:"LBL_LIST_CATEGORY_ID"},category_name:{name:"category_name",rname:"name",id_name:"category_id",vname:"LBL_CATEGORY_NAME",join_name:"product_categories",type:"relate",link:"category_link",module:"ProductCategories",source:"non-db"},type_name:{name:"type_name",rname:"name",id_name:"type_id",vname:"LBL_TYPE",join_name:"product_types",type:"relate",link:"type_link",module:"ProductTypes",source:"non-db"},name:{name:"name",vname:"LBL_NAME",type:"varchar",len:50,required:!0},mft_part_num:{name:"mft_part_num",vname:"LBL_MFT_PART_NUM",type:"varchar",len:50},vendor_part_num:{name:"vendor_part_num",vname:"LBL_VENDOR_PART_NUM",type:"varchar",len:50},date_cost_price:{name:"date_cost_price",vname:"LBL_DATE_COST_PRICE",type:"date"},cost_price:{name:"cost_price",vname:"LBL_COST_PRICE",type:"currency",required:!0,len:null},discount_price:{name:"discount_price",vname:"LBL_DISCOUNT_PRICE",required:!0,type:"currency",len:null},list_price:{name:"list_price",vname:"LBL_LIST_PRICE",required:!0,type:"currency",len:null},cost_usdollar:{name:"cost_usdollar",vname:"LBL_COST_USDOLLAR",type:"currency",len:null},discount_usdollar:{name:"discount_usdollar",vname:"LBL_DISCOUNT_USDOLLAR",type:"currency",len:null},list_usdollar:{name:"list_usdollar",vname:"LBL_LIST_USDOLLAR",type:"currency",len:null},currency_id:{name:"currency_id",vname:"LBL_CURRENCY",type:"currency_id",required:!1,"default":"-99"},currency_symbol:{name:"currency_symbol",type:"varchar",vname:"LBL_CURRENCY_SYMBOL_NAME",source:"non-db"},currency:{name:"currency",vname:"LBL_CURRENCY",type:"varchar",required:!1,sortable:!1},status:{name:"status",vname:"LBL_STATUS",type:"enum",options:"product_template_status_dom",len:100},tax_class:{name:"tax_class",vname:"LBL_TAX_CLASS",type:"enum",options:"tax_class_dom",len:100},date_available:{name:"date_available",vname:"LBL_DATE_AVAILABLE",type:"date"},website:{name:"website",vname:"LBL_URL",type:"varchar",len:255},weight:{name:"weight",vname:"LBL_WEIGHT",type:"decimal",len:12,precision:"2"},qty_in_stock:{name:"qty_in_stock",vname:"LBL_QUANTITY",type:"int",len:5},description:{name:"description",vname:"LBL_DESCRIPTION",type:"text"},support_name:{name:"support_name",vname:"LBL_SUPPORT_NAME",type:"varchar",len:50},support_description:{name:"support_description",vname:"LBL_SUPPORT_DESCRIPTION",type:"varchar",len:255},support_contact:{name:"support_contact",vname:"LBL_SUPPORT_CONTACT",type:"varchar",len:50},support_term:{name:"support_term",vname:"LBL_SUPPORT_TERM",type:"enum",options:"support_term_dom",len:100},pricing_formula:{name:"pricing_formula",vname:"LBL_PRICING_FORMULA",type:"varchar",len:100},pricing_factor:{name:"pricing_factor",vname:"LBL_PRICING_FACTOR",type:"decimal",len:8,precision:"2"},created_by_link:{name:"created_by_link",type:"link",relationship:"product_templates_created_by",vname:"LBL_CREATED_BY_USER",link_type:"one",module:"Users",source:"non-db"},modified_user_link:{name:"modified_user_link",type:"link",relationship:"product_templates_modified_user",vname:"LBL_MODIFIED_BY_USER",link_type:"one",module:"Users",source:"non-db"},category_link:{name:"category_link",type:"link",relationship:"product_templates_product_categories",vname:"LBL_PRODUCT_CATEGORIES",link_type:"one",module:"ProductCategories",source:"non-db"},type_link:{name:"type_link",type:"link",relationship:"product_templates_product_types",vname:"LBL_PRODUCT_TYPES",link_type:"one",module:"ProductTypes",source:"non-db"},manufacturer_link:{name:"manufacturer_link",type:"link",relationship:"product_templates_manufacturers",vname:"LBL_MANUFACTURERS",link_type:"one",module:"Manufacturers",source:"non-db"}},views:{list:{meta:{panels:[{fields:[{name:"name",label:"LBL_NAME"},{name:"category_name",label:"LBL_CATEGORY_NAME"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["currency_id","category_id","category_name","cost_price","cost_usdollar","discount_price,","discount_usdollar","list_price","list_usdollar","mft_part_num","name","tax_class","weight"],ftsEnabled:!1,favoritesEnabled:!1,_patched:!0},Forecasts:{_hash:"ForecastsHash",config:{sales_stage_won:["Closed Won"],sales_stage_lost:["Closed Lost"]}},Manufacturers:{_hash:"ManufacturersHash",fields:{_hash:"ManufacturersFieldsHash",id:{name:"id",type:"id"},name:{name:"name",type:"name",unified_search:!0}},views:{list:{meta:{panels:[{fields:[{name:"name",label:"LBL_NAME","default":!0,enabled:!0,type:"name"}]}]}}},layouts:{list:{meta:{type:"list",components:[{view:"list"}]}}},mergedFields:["name"],ftsEnabled:!1,favoritesEnabled:!1}},views:{"activitystream-dashlet":{meta:{}}},relationships:{comments:{lhs_key:"id",lhs_module:"Activities",lhs_table:"activities",name:"comments",relationship_type:"one-to-many",rhs_key:"parent_id",rhs_module:"Comments",rhs_table:"comments"},product_templates_product_types:{lhs_key:"id",lhs_module:"ProductTypes",lhs_table:"product_types",name:"product_templates_product_types",relationship_type:"one-to-many",rhs_key:"type_id",rhs_module:"ProductTemplates",rhs_table:"product_templates"},product_templates_product_categories:{lhs_key:"id",lhs_module:"ProductCategories",lhs_table:"product_categories",name:"product_templates_product_categories",relationship_type:"one-to-many",rhs_key:"category_id",rhs_module:"ProductTemplates",rhs_table:"product_templates"}},app_strings:{LBL_ACTIVITY_CREATE:"Created {{{record}}} {{{module}}}",LBL_ACTIVITY_UPDATE:"Updated {{{changes}}} on {{{record}}} {{{module}}}",LBL_ACTIVITY_LINK:"Linked {{{relatedRecord}}} to {{{record}}} {{{module}}}",LBL_ACTIVITY_UNLINK:"Unlinked {{{relatedRecord}}} from {{{record}}} {{{module}}}",LBL_OFFLINE_PREFETCHING_RELATIONSHIP:"{{relationship}} for {{parentModule}}",LBL_OFFLINE_PREFETCH_RELATED_ACTION:"Download related records...",ERR_OFFLINE_NO_CONNECTION_ENABLE_ERROR:"Failed to enable offline mode. Unable to reach the server.",LBL_SHOWING_CACHED_DATA:"Unable to reach the server. Showing latest available data ({{lastFetched}})",LBL_FUTURE:"Future",LBL_CLOSE_AND_SAVE_BUTTON:"Close {{moduleSingular}} and save",LBL_DASHBOARDS_CHANGED_PROMPT:"Your dashboard configuration has changed. Do you want to reload?",LBL_MOBILE_SPECIFIC_DASHBOARD:"Specific Dashboard",LBL_MOBILE_SPECIFIC_MODULE:"Specific Module",LBL_MOBILE_DEFAULT_VIEW:"Start Screen",LBL_MOBILE_DEFAULT_MODULE:"Selected Module",LBL_MOBILE_DEFAULT_DASHBOARD:"Selected Dashboard",LBL_MOBILE_DEFAULT_DASHLET:"Selected Dashlet",LBL_ALL_DASHLETS:"All Dashlets",LBL_MOBILE_GLOBAL_SEARCH:"Global Search",LBL_MOBILE_ACTIVITYSTREAM_POST_PLACEHOLDER:"Type @ to mention a user. Type # to reference a record.",LBL_MOBILE_NEW_COMMENT:"New comment",LBL_MOBILE_TUTORIAL_HOME_MENU_DASHBOARD:"Access your dashboards.",LBL_MOBILE_TUTORIAL_HOME_MENU_SEARCH:"Search across multiple modules.",LBL_MOBILE_TUTORIAL_HOME_MENU_RECENTS:"Access recently viewed records.",LBL_MOBILE_TUTORIAL_HOME_MENU_ACTIVITIES:"Access Activity Stream.",LBL_MOBILE_TUTORIAL_HOME_MENU_OFFLINE:"View offline status and preload records into offline storage.",LBL_RECORD_NOT_FOUND:"Record not found.",LBL_RELATED_RECORD_NOT_FOUND:"Related record not found.",LBL_NOT_AUTHORIZED:"You are not authorized to view this record.",LBL_SET_FONTSIZE:"Font size",LBL_FONTSIZE_TINY:"Tiny",LBL_FONTSIZE_SMALL:"Small",LBL_FONTSIZE_NORMAL:"Normal (default)",LBL_FONTSIZE_LARGE:"Large",LBL_FONTSIZE_LARGER:"Larger",LBL_FONTSIZE_HUGE:"Huge",LBL_FONTSIZE_EXTRA_HUGE:"Extra huge",LBL_CLOSE_SAVE_BUTTON:"Close task and save",LBL_MOBILE_PROCESSING_FILE:"Preparing file...",ERR_MOBILE_FILE_SIZE_LIMIT_EXCEEDED:"File is too big. Maximum allowed size is {{size}}",LBL_MOBILE_TUTORIAL_HOME_MENU_TOUR:"Access Tour at any time.",LBL_MOBILE_TUTORIAL_DETAIL_BACK_TABLET:"Go back.",LBL_MOBILE_TUTORIAL_DETAIL_RELATE_LINK:"Click to open a related record.",LBL_MOBILE_TUTORIAL_DETAIL_FOLLOW:"Follow/Unfollow a record.",LBL_MOBILE_TUTORIAL_DETAIL_SHOW_MORE:"Click to expand a detail information.",LBL_MOBILE_TUTORIAL_HOME_MENU_INTRO_TITLE:"Main menu view.",LBL_MOBILE_TUTORIAL_HOME_MENU_INTRO_TEXT:"The main menu opens on the left side of your screen.",LBL_MOBILE_TUTORIAL_DETAIL_INTRO_TITLE:"Detail View",LBL_MOBILE_TUTORIAL_DETAIL_INTRO_TEXT:"The detail view opens on the right side of your screen.",LBL_MOBILE_TUTORIAL_CONTROL_PANEL:"Use the arrows below for a quick tour through the key components of this menu.",LBL_LATER:"Later",LBL_LOADING_FILES:"Still loading document list. Please try again later",LBL_NEW_WEB_VERSION:"A new version of this application is available. Would you like to update?",LBL_MOBILE_DOWNLOAD_FAILED:"Download failed\r\n{{{this}}}",LBL_MOBILE_DETAIL_SHOW_MORE:"More...",LBL_MOBILE_DETAIL_SHOW_LESS:"...Less",LBL_OFFLINE_MODE:"Offline Mode",LBL_OFFLINE_PREFETCH_PROMPT:"Downloading your assigned, favorited, and followed records for offline access may take some time to complete. A fast connection is recommended. Would you like to proceed?",LBL_OFFLINE_PREFETCH_FIRST_PROMPT:"Do you want your assigned, favorited, and followed records to be downloaded now for offline access? A fast connection is recommended as this operation may take some time. You may download later from Main Menu > Offline.",LBL_OFFLINE_PREFETCH_SUCCESS:"Records downloaded successfully",LBL_OFFLINE_PREFETCH_ACTION:"Download your records...",LBL_OFFLINE_PREFETCH_ERROR:"Error while downloading records",LBL_OFFLINE_PREFETCHING:"Loading records...",LBL_OFFLINE_PREFETCHING_MODULE:"Loading {{module}} {{progressValue}}...",LBL_OFFLINE_PREFETCHING_EST_TIME:"Time left is about {{estimatedTime}}s...",LBL_OFFLINE_PREFETCHING_MODULE_COMPLETE:"Loading {{module}} completed",LBL_OFFLINE_DB_CLEANING_IN_PROGRESS:"Cleaning storage...",LBL_OFFLINE_DB_CLEANING_COMPLETED:"Clean-up completed",LBL_OFFLINE_ROLLBACK_PROMPT:"Do you want to rollback this change?",LBL_OFFLINE_ROLLBACK_SUCCESS:"Rollback completed",LBL_OFFLINE_ROLLBACK_FAILED:"Rollback failed",LBL_OFFLINE_CLEAR_DB:"Clear Storage...",LBL_OFFLINE_COMPACT_DB:"Compact Storage...",LBL_OFFLINE_CLEAN_UP_PROMPT:"This action will delete records you haven't accessed in a while. Proceed?",LBL_OFFLINE_CLEAR_DB_PROMPT:"Do you want to delete all records from the local storage?",LNK_OFFLINE_SETTINGS:"Offline",LBL_OFFLINE_SETTINGS:"Debug settings",LBL_OFFLINE_STATUS_NO_PENDING_TX:"No changes pending synchronization.",LBL_OFFLINE_STATUS_PENDING_TX:"Changes are pending synchronization.",LBL_OFFLINE_STATUS_ONLINE:"Device is online.",LBL_OFFLINE_STATUS_OFFLINE:"Device is offline.",LBL_OFFLINE_STATUS_BAD_NETWORK:"Unable to reach the server.",LBL_OFFLINE_STATUS_SYNC_FAILED:"Last synchronization attempt failed. Check the transaction log.",LBL_OFFLINE_SYNC_IN_PROGRESS:"Synchronization in progress...",LBL_OFFLINE_TRANSACTION_SYNCED:"Transaction synchronized.",LBL_OFFLINE_ENABLE_PROMPT:"Are you sure you want to turn on offline support?",LBL_OFFLINE_DISABLE_PROMPT:"Do you want to turn off offline support? All changes pending synchronization will be lost.",LBL_OFFLINE_ENABLED:"Offline mode enabled",LBL_OFFLINE_DISABLED:"Offline mode disabled",LBL_OFFLINE_STATS:"Storage statistics",LBL_OFFLINE_SERVER_FETCH:"Fetching from server...",LBL_OFFLINE_MERGE_DATA_CONFIRM:"Someone has edited the same record on the server. Confirm to auto-merge your changes or reject to discard them.",LBL_OFFLINE_LAST_SYNC_TS:"Last synchronization attempt: {{ts}}",LBL_ACTION_UPDATE:"UPDATE",LBL_ACTION_CREATE:"CREATE",LBL_ACTION_DELETE:"DELETE",LBL_ACTION_LINK:"LINK",LBL_ACTION_UNLINK:"UNLINK",LBL_ACTION_FAVORITE:"FAVORITE",LBL_ACTION_FOLLOW:"FOLLOW",LBL_ACTION_CREATE_EXPLANATION:'Created {{module}} "{{name}}"',LBL_ACTION_UPDATE_EXPLANATION:'Updated {{module}} "{{name}}"',LBL_ACTION_DELETE_EXPLANATION:'Deleted {{module}} "{{name}}"',LBL_ACTION_LINK_EXPLANATION:'Linked {{module}} "{{name}}" to {{relatedModule}} "{{relatedName}}"',LBL_ACTION_UNLINK_EXPLANATION:'Unlinked {{module}} "{{name}}" from {{relatedModule}} "{{relatedName}}"',LBL_ACTION_FOLLOW_EXPLANATION:'Followed {{module}} "{{name}}"',LBL_ACTION_UNFOLLOW_EXPLANATION:'Unfollowed {{module}} "{{name}}"',LBL_ACTION_FAVORITE_EXPLANATION:'Favorited {{module}} "{{name}}"',LBL_ACTION_UNFAVORITE_EXPLANATION:'Unfavorited {{module}} "{{name}}"',LBL_ACTION_CREATE_RELATED_EXPLANATION:'Created {{module}} "{{name}}" related to {{relatedModule}} "{{relatedName}}"',LBL_EMAIL_ACTION_SET_PRIMARY:"Primary",LBL_EMAIL_ACTION_SET_OPT_OUT:"Opt-out",LBL_EMAIL_ACTION_SET_OPT_IN:"Opt-in",LBL_EMAIL_ACTION_SET_VALID:"Valid",LBL_EMAIL_ACTION_SET_INVALID:"Invalid",LBL_ROLLBACK_BUTTON:"Rollback",LBL_TX_LOG:"Transaction Log",LBL_TX_LOG_DETAIL:"Transaction Detail",LBL_RECORD_DELETED:"(Record deleted)",LBL_FILE_SIZE_UNITS_B:"Bytes",LBL_FILE_SIZE_UNITS_KB:"kB",LBL_FILE_SIZE_UNITS_MB:"MB",LBL_CHOOSE_ITEMS:"Choose items",LBL_OFFLINE_DB_SIZE:"Database size",LBL_OFFLINE_RECORDS_PER_MODULE:"Records per module",LBL_OFFLINE_TOTAL_RECORDS_COUNT:"Total number of records",LBL_RECENTLY_VIEWED:"Recently Viewed",ERR_MOBILE_METADATA_CHANGED_RELOAD:"Server configuration has changed and reload is required. Proceed?",ERR_MOBILE_CONFLICT:"Someone has edited the same record on the server. Confirm to auto-merge your changes or reject to discard them.",ERR_MOBILE_METADATA_CHANGED:"Server configuration has changed.",ERR_MOBILE_FILE_READ:"Failed to read the file",ERR_MOBILE_FILE_NOT_FOUND:"File not found",ERR_MOBILE_FILE_NOT_READABLE:"File not readable",ERR_MOBILE_FILE_ABORTED:"Read operation was aborted",ERR_MOBILE_FILE_SECURITY:"File is locked",ERR_MOBILE_VIEW_NOT_SUPPORTED:"Mobile version does not support this functionality. Do you want to open the desktop version?",ERR_OFFLINE:"Offline error",ERR_OFFLINE_STORAGE_UNAVAILABLE:"Failed to open local storage",ERR_OFFLINE_STORAGE_CREATE:"Failed to create local storage",ERR_OFFLINE_START_FAILED_OUT_OF_SPACE:"Failed to create local storage: you've run out of space.",ERR_OFFLINE_OUT_OF_SPACE:"You've run out of space for local storage.",ERR_OFFLINE_DB_CLEANING_ERROR:"Database clean-up failed",ERR_OFFLINE_CLEAN_UP_CONFIRMATION:"You've run out of space for offline storage. Storage clean-up is recommended. Do you want to perform it now?",ERR_OFFLINE_PREFETCH_FAILED:"Failed to prefetch records from server",ERR_OFFLINE_SYNC_ERROR:"Synchronization error",ERR_OFFLINE_SYNC_CONFLICT:"Synchronization conflict",ERR_OFFLINE_SERVERTIME_UNAVAILABLE:"Failed to get server time",LBL_OK:"OK",LBL_YES:"Yes",LBL_NO:"No",LBL_CANCEL_BUTTON_LABEL:"Cancel",LBL_MOBILE_RELOGIN_BUTTON:"Re-login",LBL_MOBILE_META_SYNC_FAILED:"Unable to sync with server.",LBL_MOBILE_META_SYNC_FAILED_RETRY:"Unable to sync with server. Retry?",LBL_LOADING:"Loading...",LBL_WARNING:"Warning",LBL_CONFIRM:"Confirm",LNK_ABOUT:"About",LBL_MOBILE_APP_VERSION:"App Version",LBL_MOBILE_SERVER_VERSION:"Server Version",LBL_MOBILE_SERVER_URL:"Server URL",LBL_MOBILE_FEEDBACK:"Feedback",LBL_MOBILE_SUPPORT:"Support",LBL_COPYRIGHT:"Copyright © 2004-2015 SugarCRM Inc. All Rights Reserved.",LBL_TRADEMARK:"SugarCRM is a trademark of SugarCRM, Inc. All other company and product names may be trademarks of the respective companies with which they are associated.",LBL_TRADEMARK2:"SugarCRM ®, Sugar Enterprise™ and Sugar™ are trademarks of SugarCRM Inc.",LBL_LOGIN_USERNAME:"Username",LBL_LOGIN_PASSWORD:"Password",LNK_TERMS_OF_USE:"Terms of Use",LNK_PRIVACY_POLICY:"Privacy Policy",LNK_THIRD_PARTY_SOFTWARE:"Third Party Software",LBL_LOGIN_BUTTON_TITLE:"Log In",LBL_EXTERNAL_LOGIN_BUTTON_TITLE:"Single Sign-On",LBL_LOG_LEVEL:"Log Level",LBL_NOT_AVAILABLE:"N/A",LBL_USE_HTTPS:"Use secure connection",ERR_SYNC_FAILED:"Unable to sync with server.",ERR_INTERNAL_ERR_MSG:"Internal error",ERR_MOBILE_NOT_AUTHORIZED:"Access not authorized.",ERR_MOBILE_INVALID_CREDS:"Invalid username or password.",ERR_MOBILE_SESSION_EXPIRED:"Your session expired.",ERR_MOBILE_SSO_NOT_CONFIGURED:"SSO login is unavailable. Ensure the instance is on Sugar 7.5 or greater and configured for SSO.",ERR_MOBILE_NOT_FOUND:"Resource not found.",ERR_MOBILE_TIMEOUT:"Server is not responding.",ERR_MOBILE_CONNECTION_FAILED:"Can't reach the server.",ERR_MOBILE_NOT_FOUND_LOGIN:"No {{{brandName}}} server found at the given URL.",ERR_MOBILE_TIMEOUT_LOGIN:"Server is not responding at the given URL.",ERR_MOBILE_CONNECTION_FAILED_LOGIN:"Server unavailable at the given URL.",ERR_MOBILE_INTERNET_UNAVAILABLE:"Internet connection unavailable.",ERR_MOBILE_INTERNAL:"Internal error ({{{code}}}). Please try again later.",ERR_MOBILE_VALIDATION:"Record is invalid",ERR_SERVER_FLAVOR_INCOMPATIBLE:"Incompatible server flavor: {{{flavor}}}. Supported flavors: {{{supportedFlavors}}}.",ERR_SERVER_VERSION_INCOMPATIBLE:"Incompatible server version: {{{version}}}. Minimum required version: {{{minVersion}}}.",ERR_MOBILE_INCOMPATIBLE_CLIENT_VERSION:"Your app is outdated and is no longer compatible with the {{{brandName}}} instance you are connecting to. Do you want to download the new version from App Store?",ERR_GENERIC_TITLE:"Error"}},e._mod_strings=["LBL_MODULE_NAME","LBL_MODULE_NAME_SINGULAR","LBL_RELATED_RECORD_DEFAULT_NAME","LBL_RELATED_MODULE","LBL_CREATE_RELATED","LBL_CREATE_MODULE","LBL_RELATED_MODULE","LBL_EDIT_RELATED","LBL_EDIT","LBL_ASSOC_EXISTING","LBL_ASSOC","LBL_ASSIGN","LBL_RELATED_MODULE_PLURAL","LBL_DASHLET_FORECAST_NOT_SETUP","LBL_DASHLET_FORECAST_NOT_SETUP_ADMIN","LBL_DASHLET_FORECAST_CONFIG_LINK_TEXT","LBL_FORECASTS_MISSING_SALES_STAGE_VALUES","LBL_CLOSED","LBL_FORECAST_DETAILS_SURPLUS","LBL_FORECAST_DETAILS_EXCEED","LBL_FORECAST_DETAILS_DEFICIT","LBL_FORECAST_DETAILS_SHORT","LBL_FORECAST_DETAILS_NO_DATA","LBL_SALES_STAGE","LBL_AMOUNT","LBL_PERCENT","LBL_CUMULATIVE_TOTAL","LBL_OW_PROBABILITY","LBL_QUOTA","LBL_QUOTA_ADJUSTED","LBL_DASHLET_TOP10_SALES_OPPORTUNITIES_NAME"],e._app_list_strings=["record_type_display","moduleIconList","moduleList","moduleListSingular","available_language_dom","forecasts_options_dataset","forecasts_chart_options_group","top10_opportunities_duration_options","history_filter_options","generic_timeperiod_options"],e._app_strings=_.keys(e.baseMetadata.app_strings).concat(["LBL_ACTIVITY_STREAM","LBL_RECORD_NOT_FOUND","LBL_RELATED_RECORD_NOT_FOUND","LBL_NOT_AUTHORIZED","LBL_SET_FONTSIZE","LBL_LATER","LBL_ACTION_UPDATE","LBL_ACTION_CREATE","LBL_ACTION_DELETE","LBL_ACTION_LINK","LBL_ACTION_UNLINK","LBL_ACTION_FAVORITE","LBL_ACTION_FOLLOW","LBL_ROLLBACK_BUTTON","LBL_UNLINKING","LBL_DELETING","LBL_SAVING","LBL_UNLINKED","LBL_DELETED","LBL_SAVED","LBL_MOBILE_CHOOSE_RECIPIENT","LBL_MOBILE_CHOOSE_PHONE","LBL_MOBILE_CHOOSE_URL","LBL_MOBILE_DOC","LBL_MOBILE_CHOOSE_DOC","LBL_MOBILE_CHOOSE_LOCATION","LBL_MOBILE_WAIT","LBL_MOBILE_LOG_CALL_CONFIRM","LBL_MOBILE_TUTORIAL_HOME_INTRO","LBL_MOBILE_TUTORIAL_HOME_LOGO","LBL_MOBILE_TUTORIAL_HOME_CREATE","LBL_MOBILE_TUTORIAL_HOME_SEARCH","LBL_MOBILE_TUTORIAL_HOME_FAVORITES_BTN","LBL_MOBILE_TUTORIAL_HOME_MY_ITEMS_BTN","LBL_MOBILE_TUTORIAL_HOME_UPCOMING","LBL_MOBILE_TUTORIAL_HOME_RECENT","LBL_MOBILE_TUTORIAL_HOME_FAVORITES_ICON","LBL_MOBILE_TUTORIAL_HOME_GRIP","LBL_MOBILE_TUTORIAL_HOME_END","LBL_MOBILE_TUTORIAL_HOME_MENU_INTRO","LBL_MOBILE_TUTORIAL_HOME_MENU_INTRO_TITLE","LBL_MOBILE_TUTORIAL_HOME_MENU_INTRO_TEXT","LBL_MOBILE_TUTORIAL_HOME_MENU_PROFILE","LBL_MOBILE_TUTORIAL_HOME_MENU_LOGO","LBL_MOBILE_TUTORIAL_HOME_MENU_MODULES","LBL_MOBILE_TUTORIAL_HOME_MENU_TOUR","LBL_MOBILE_TUTORIAL_HOME_MENU_SETTINGS","LBL_MOBILE_TUTORIAL_HOME_MENU_DESKTOP","LBL_MOBILE_TUTORIAL_HOME_MENU_DASHBOARD","LBL_MOBILE_TUTORIAL_HOME_MENU_SEARCH","LBL_MOBILE_TUTORIAL_HOME_MENU_RECENTS","LBL_MOBILE_TUTORIAL_HOME_MENU_ACTIVITIES","LBL_MOBILE_TUTORIAL_HOME_MENU_OFFLINE","LBL_MOBILE_TUTORIAL_DETAIL_INTRO","LBL_MOBILE_TUTORIAL_DETAIL_INTRO_TITLE","LBL_MOBILE_TUTORIAL_DETAIL_INTRO_TEXT","LBL_MOBILE_TUTORIAL_DETAIL_RIGHT_ACTION","LBL_MOBILE_TUTORIAL_DETAIL_RECORD_ACTIONS","LBL_MOBILE_TUTORIAL_DETAIL_SHOW_MORE","LBL_MOBILE_TUTORIAL_DETAIL_RELATE_LINK","LBL_MOBILE_TUTORIAL_DETAIL_FOLLOW","LBL_MOBILE_TUTORIAL_DETAIL_BACK","LBL_MOBILE_TUTORIAL_DETAIL_BACK_TABLET","LBL_MOBILE_TUTORIAL_CONTROL_PANEL","LBL_MOBILE_DOWNLOAD_STARTED","LBL_MOBILE_DOWNLOAD_COMPLETED","LBL_UPCOMING","LBL_MOBILE_NO_RECORDS","LBL_RECENTLY_UPDATED","LBL_RECENTLY_VIEWED","LBL_MOBILE_NO_ACTIONS_AVAILABLE","LBL_DELETE_BUTTON","LBL_SAVE_BUTTON_LABEL","LBL_HOME","LBL_MOBILE_DESKTOP","LBL_LOGOUT","LBL_SEARCH_ALL_RECORDS","LBL_MOBILE_SEARCH_TEAMS","LBL_SEARCH_ALL","LBL_DONE_BUTTON_LABEL","LBL_OPTIONAL","LBL_CHOOSE_LINK","LBL_NO_ACCESS","LBL_NO_ACCESS_LOWER","LBL_CHOOSE_PARENT_TYPE","LBL_RELATED_MODULE","LBL_MOBILE_UPLOAD_IN_PROGRESS","LBL_MOBILE_UPLOAD_SUCCESS","LBL_MOBILE_PROCESSING_IMAGE","LBL_MOBILE_PROCESSING_FILE","LBL_MOBILE_DELETE_CONFIRM","LBL_DUPLICATE_BUTTON","LBL_CREATE_RELATED_RECORD","LBL_ASSOC_RELATED_RECORD","LBL_MOBILE_SELECT_TEAMS","LBL_CHOOSE_ITEMS","LBL_VIEW_BUTTON","LBL_EDIT_BUTTON","LBL_UNLINK_BUTTON","LBL_CALL_BUTTON","LBL_SMS_BUTTON","LBL_EMAIL_BUTTON","LBL_MAP_BUTTON","LBL_URL_BUTTON","LBL_FILE_BUTTON","LBL_FOLLOW","LBL_UNFOLLOW","LBL_FOLLOWING","LBL_MOBILE_SHOW_MORE_TOP","LBL_MOBILE_SHOW_MORE","LBL_MOBILE_DETAIL_SHOW_MORE","LBL_MOBILE_DETAIL_SHOW_LESS","LBL_MOBILE_PTR_PULL","LBL_MOBILE_PTR_RELEASE","LBL_LOADING_FILES","LBL_MOBILE_UNLINK_CONFIRM","LBL_INVITEES","LBL_SEND_INVITE","LBL_SELECT_ACTION_LABEL","LNK_SETTINGS","LNK_TOUR","LBL_LANGUAGE","LBL_NAME","LBL_NONE","LBL_TIME_RELATIVE","LBL_TIME_AGO_NOW","LBL_TIME_AGO_SECONDS","LBL_TIME_AGO_MINUTE","LBL_TIME_AGO_MINUTES","LBL_TIME_AGO_HOUR","LBL_TIME_AGO_HOURS","LBL_TIME_AGO_DAY","LBL_TIME_AGO_DAYS","LBL_TIME_AGO_YEAR","LBL_TIME_UNTIL_SECONDS","LBL_TIME_UNTIL_MINUTE","LBL_TIME_UNTIL_MINUTES","LBL_TIME_UNTIL_HOUR","LBL_TIME_UNTIL_HOURS","LBL_TIME_UNTIL_DAY","LBL_TIME_UNTIL_DAYS","LBL_TIME_UNTIL_YEAR","LBL_NOT_AVAILABLE","LBL_FILE_SIZE_UNITS_B","LBL_FILE_SIZE_UNITS_KB","LBL_FILE_SIZE_UNITS_MB","LBL_USE_HTTPS","LBL_REMOVE","LBL_TODAY","LBL_FUTURE","LBL_CLOSE_BUTTON_TITLE","LBL_CLOSE_AND_SAVE_BUTTON","LBL_MOBILE_SPECIFIC_DASHBOARD","LBL_MOBILE_SPECIFIC_MODULE","LBL_MOBILE_DEFAULT_VIEW","LBL_MOBILE_DEFAULT_MODULE","LBL_MOBILE_DEFAULT_DASHBOARD","LBL_MOBILE_DEFAULT_DASHLET","LBL_MOBILE_GLOBAL_SEARCH","LBL_DASHBOARDS_CHANGED_PROMPT","LBL_DEFAULT_HELP_DASHBOARD_TITLE","LBL_DEFAULT_HELP_DASHLET_TITLE","LBL_LEARNING_RESOURCES_NAME","LBL_DASHLET_RECENT_TWEETS_SUGARCRM_NAME","TPL_DASHLET_MY_MODULE","LBL_DEFAULT_DASHBOARD_TITLE","LBL_ACTIVE_TASKS_DASHLET_DUE_NOW","LBL_ACTIVE_TASKS_DASHLET_UPCOMING","LBL_ACTIVE_TASKS_DASHLET_TODO","LBL_COMMENT","LBL_ACTIVITY_CREATE","LBL_ACTIVITY_UPDATE","LBL_ACTIVITY_LINK","LBL_ACTIVITY_UNLINK","LBL_MOBILE_ACTIVITYSTREAM_POST_PLACEHOLDER","LBL_SUBMIT_BUTTON_LABEL","LBL_SHOWING_CACHED_DATA","LBL_DASHLET_FORECASTS_GROUPBY","LBL_DASHLET_FORECASTS_DATASET","LBL_LIKELY","LBL_BEST","LBL_INACTIVE_TASKS_DASHLET_DEFERRED","LBL_INACTIVE_TASKS_DASHLET_COMPLETED","LBL_ALL_DASHLETS","LBL_MOBILE_NEW_COMMENT","LBL_OFFLINE_MODE","LBL_OFFLINE_PREFETCH_PROMPT","LBL_OFFLINE_PREFETCH_FIRST_PROMPT","LBL_OFFLINE_PREFETCH_SUCCESS","LBL_OFFLINE_PREFETCH_ERROR","LBL_OFFLINE_PREFETCH_ACTION","LBL_OFFLINE_PREFETCH_RELATED_ACTION","LBL_OFFLINE_PREFETCHING","LBL_OFFLINE_PREFETCHING_MODULE","LBL_OFFLINE_PREFETCHING_EST_TIME","LBL_OFFLINE_PREFETCHING_RELATIONSHIP","LBL_OFFLINE_PREFETCHING_MODULE_COMPLETE","LBL_OFFLINE_DB_CLEANING_IN_PROGRESS","LBL_OFFLINE_DB_CLEANING_COMPLETED","LBL_OFFLINE_ROLLBACK_PROMPT","LBL_OFFLINE_ROLLBACK_FAILED","LBL_OFFLINE_ROLLBACK_SUCCESS","LNK_OFFLINE_SETTINGS","LBL_OFFLINE_ENABLE_PROMPT","LBL_OFFLINE_DISABLE_PROMPT","LBL_OFFLINE_ENABLED","LBL_OFFLINE_DISABLED","LBL_OFFLINE_CLEAR_DB","LBL_OFFLINE_COMPACT_DB","LBL_OFFLINE_CLEAN_UP_PROMPT","LBL_OFFLINE_CLEAR_DB_PROMPT","LBL_OFFLINE_SERVER_FETCH","LBL_OFFLINE_MERGE_DATA_CONFIRM","LBL_OFFLINE_LAST_SYNC_TS","LBL_OFFLINE_SYNC_IN_PROGRESS","LBL_OFFLINE_TRANSACTION_SYNCED","LBL_OFFLINE_TOTAL_RECORDS_COUNT","LBL_OFFLINE_DB_SIZE","LBL_OFFLINE_RECORDS_PER_MODULE","LBL_TX_LOG","LBL_TX_LOG_DETAIL","LBL_OFFLINE_SETTINGS","LBL_OFFLINE_STATS","LBL_ACTION_CREATE_EXPLANATION","LBL_ACTION_UPDATE_EXPLANATION","LBL_ACTION_DELETE_EXPLANATION","LBL_ACTION_LINK_EXPLANATION","LBL_ACTION_UNLINK_EXPLANATION","LBL_ACTION_FAVORITE_EXPLANATION","LBL_ACTION_FOLLOW_EXPLANATION","LBL_ACTION_UNFOLLOW_EXPLANATION","LBL_ACTION_UNFAVORITE_EXPLANATION","LBL_ACTION_CREATE_RELATED_EXPLANATION","LBL_EMAIL_ACTION_SET_PRIMARY","LBL_EMAIL_ACTION_SET_OPT_OUT","LBL_EMAIL_ACTION_SET_OPT_IN","LBL_EMAIL_ACTION_SET_VALID","LBL_EMAIL_ACTION_SET_INVALID","LBL_EMAIL_ADD","LBL_RECORD_DELETED","ERR_MOBILE_EMAIL","ERR_MOBILE_FILE_NOT_SUPPORTED","ERR_MOBILE_FILE_READ","ERR_MOBILE_FILE_NOT_FOUND","ERR_MOBILE_FILE_NOT_READABLE","ERR_MOBILE_FILE_ABORTED","ERR_MOBILE_FILE_SECURITY","ERR_MOBILE_FILE_SIZE_LIMIT_EXCEEDED","ERR_MOBILE_BROWSER_NOT_AUTHORIZED","ERR_MOBILE_BROWSER_FORBIDDEN","ERR_MOBILE_BROWSER_PAGE_NOT_FOUND","ERR_MOBILE_BROWSER_INTERNAL_SERVER_ERROR","ERR_MOBILE_BROWSER_SERVICE_UNAVAILABLE","ERR_MOBILE_STORAGE_UNAVAILABLE","ERR_MOBILE_GENERIC_NATIVE_ERROR","ERR_MOBILE_FILE_PROCESSING","ERR_MOBILE_METADATA_CHANGED","ERR_NO_DOCS","ERR_MOBILE_UPLOAD","ERR_MOBILE_VALIDATION","ERR_NO_RECORDS_SELECTED","ERR_RENDER_FAILED_TITLE","ERR_RENDER_FAILED_MSG","ERR_RENDER_FIELD_FAILED_MSG","ERR_CONTACT_TECH_SUPPORT","ERR_NO_VIEW_ACCESS_TITLE","ERR_LAYOUT_RENDER_TITLE","ERR_INTERNAL_ERR_MSG","ERROR_MAXVALUE","ERROR_MINVALUE","ERROR_MAX_FIELD_LENGTH","ERROR_MIN_FIELD_LENGTH","ERROR_DATETIME","ERROR_FIELD_REQUIRED","ERROR_EMAIL","ERROR_NUMBER","ERROR_IS_BEFORE","ERROR_IS_AFTER","ERROR_IS_GREATER_THAN","ERROR_IS_LESS_THAN","ERROR_DUPLICATE_EMAIL","ERR_MOBILE_CONFLICT","ERR_MOBILE_VIEW_NOT_SUPPORTED","ERR_OFFLINE","ERR_OFFLINE_STORAGE_UNAVAILABLE","ERR_OFFLINE_STORAGE_CREATE","ERR_OFFLINE_START_FAILED_OUT_OF_SPACE","ERR_OFFLINE_OUT_OF_SPACE","ERR_OFFLINE_CLEAN_UP_CONFIRMATION","ERR_OFFLINE_PREFETCH_FAILED","ERR_OFFLINE_DB_CLEANING_ERROR","ERR_OFFLINE_SYNC_CONFLICT","ERR_OFFLINE_SYNC_ERROR","ERR_OFFLINE_SERVERTIME_UNAVAILABLE","ERR_OFFLINE_NO_CONNECTION_ENABLE_ERROR","LBL_RELATED_RECORD_DEFAULT_NAME","LBL_RELATED_MODULE","LBL_CREATE_RELATED","LBL_CREATE_MODULE","LBL_RELATED_MODULE","LBL_EDIT_RELATED","LBL_EDIT","LBL_ASSOC_EXISTING","LBL_ASSOC","LBL_ASSIGN","LBL_RELATED_MODULE_PLURAL","LBL_CHART_LEGEND_CLOSE","LBL_CHART_LEGEND_OPEN","LBL_CHART_NO_DATA","LBL_DASHLET_TOP10_SALES_OPPORTUNITIES_NAME","LBL_DASHLET_PIPLINE_NAME","LBL_CHART_UNDEFINED","LBL_NO_FIELD_ACCESS"]),e.mod_strings={}}(SUGAR.App),function(e){var t=[],n=function(e){return _.find(t,function(t){return t.key===e})},r={maxCount:3,has:function(e){return _.isUndefined(this.get(e))?!1:!0},get:function(e){var t=n(e);return t?t.val:undefined},set:function(e,r){if(this.has(e)){var i=n(e);i.val=r}else this.maxCount<=t.length&&t.shift(),t.push({key:e,val:r})},cut:function(e){var n=null;_.find(t,function(t,r){var i=t.key===e;return i&&(n=r),i})&&t.splice(n,1)},cutAll:function(){t=[]}};e.augment("session",r)}(SUGAR.App),function(e){e.plugins.register("clear-field","view",{events:{"keyup.clear input":"checkIfFieldEmpty","focusin.clear input":"checkIfFieldEmpty","touchend.clear .icon-remove-sign":"clearOnClick"},checkIfFieldEmpty:function(e){var t=$(e.currentTarget);t.val()?t.parent().addClass("not-empty"):t.parent().removeClass("not-empty")},clearOnClick:function(e){var t=$(e.currentTarget).parent().find("input");t.val(""),t.parent().removeClass("not-empty");var n,r,i;t.hasClass("search-query")?(this.onSearchClearClick(),n=this.$el.find("input"),i=0):(r=t.parents(".control-group").eq(0).parent().index(),i=t.parents(".control-group").find("input").index(t),t.trigger("change"),n=this.$(".pad, .modal-body form").children().eq(r).find("input")),_.isEmpty(n)||(n=n.get(i),n&&n.focus()),e.preventDefault(),e.stopPropagation()}})}(SUGAR.App),function(e){function t(e,t){var n=e[t];e[t]=function(){n.apply(e,arguments),this._currentRecordId&&e.$el.find(this._currentRecordId).addClass("current")}}e.plugins.register("current-record","view",{pluginGlobalEvents:{"app:view:change":function(e){if(e.layoutDef&&e.layoutDef.isDynamic)return;this.selectCurrentRecord(e)}},onAttach:function(){t(this,"onAfterRender"),this instanceof e.view.views.HomeView&&(t(this,"_renderActivityStreamBucket"),t(this,"_renderActivityStream"))},selectCurrentRecord:function(t){var n=t.modelId||t.parentModelId,r;t.link?r=e.data.getRelatedModule(t.parentModule,t.link):r=t.module||t.parentModule,this.$el.find(".current").removeClass("current"),this._currentRecordId=!1,n&&(this._currentRecordId="#"+this.cid+r+n+"",this.$el.find(this._currentRecordId).addClass("current"))}})}(SUGAR.App),function(e){e.plugins.register("hide-alerts-onfocus","view",{events:{"focusin.hide input":"fieldOnFocus","touchstart.hide select":"fieldOnFocus"},fieldOnFocus:function(){var t={animate:!1};e.alert.dismissAll(!1,t)}})}(SUGAR.App),function(e){var t=function(){var t=this;this instanceof e.view.views.ListView&&_.each(this._listActions,function(e){t.contextMenuActions.push(e)}),this instanceof e.view.views.EditView&&(this.headerActions=this.headerActions||{},_.extend(this.headerActions,this._EditHeaderActions))};e.plugins.register("item-actions","view",{_listActions:[{name:"close",label:"LBL_CLOSE_BUTTON_TITLE",icon:"icon-times",isEnabled:function(e){return e.isCloseActionAvailable()},action:"onClose",autoClose:!0}],onClose:function(t,n){var r="status";n.set(r,e.nomad.utils.getClosedStatusValue(n.module||this.module)),n.save(null,{fields:[r],error:function(){n.set(r,n.previousAttributes()[r])},success:_.bind(function(){n.collection&&_.isArray(n.collection.filterDef)&&_.find(n.collection.filterDef,function(e){return e[r]&&e[r].$not_in&&_.contains(e[r].$not_in,n.get(r))})&&(this.collection.remove(n),this.collection.next_offset!==-1&&--this.collection.next_offset,this.collection.length||this.collection.fetch())},this)})},_EditHeaderActions:{close:{label:"LBL_CLOSE_AND_SAVE_BUTTON",fn:function(){this.model.set("status",e.nomad.utils.getClosedStatusValue(this.module)),this.saveRecord()},needsAccess:{field:"status",action:"edit"},showOnCreate:!1,isEnabled:function(e){return e.isCloseActionAvailable()}}},onAttach:function(){this.on("init",t,this)},onDetach:function(){this.off("init",t,this)}})}(SUGAR.App),function(e){e.plugins.register("fast-click-highlight","view",{events:{"touchstart .fast-click-highlighted":"onTouchStart","touchmove .fast-click-highlighted":"onTouchMove","touchend .fast-click-highlighted":"onTouchEnd","touchcancel .fast-click-highlighted":"onTouchEnd"},onTouchStart:function(e){_.delay(_.bind(function(){!this._flag&&$(e.currentTarget).hasClass("fast-click-highlighted")&&!$(e.target).hasClass("inert")&&!$(e.target).hasClass("grip")&&$(e.currentTarget).addClass("selected-item")},this),50)},onTouchEnd:function(){_.delay(_.bind(function(){this.$el&&(this.$el.find(".selected-item").removeClass("selected-item"),this._flag=!1)},this),50)},onTouchMove:function(){this._flag||this.$el.find(".selected-item").removeClass("selected-item"),this._flag=!0}})}(SUGAR.App),function(e){e.plugins.register("focus-on-input","view",{events:{"focus.foi input":"inputOnFocus"},inputOnFocus:function(t){if(!e.isTablet||!$.os.android)return;var n=$(t.target).parents(".scroll").get(0),r=$(t.target).parents("span[sfuuid]").get(0).offsetTop;_.delay(function(){n.scrollTop=r},1e3)}})}(SUGAR.App),function(e){var t=function(){this.collection&&this.collection.on("sync",this._onDataSyncSuccess,this)};e.plugins.register("pagination","view",{events:{"click  .show-more-top-btn":"showMoreTopRecords","click  .show-more-bottom-btn":"showMoreBottomRecords"},pluginGlobalEvents:{"offline:server:read.pagination":function(t){var n=t.status===e.offline.api.SERVER_READ_STATUS.start;if(this.collection.offlineReadDisabled)return;this.isCurrentListUpdated(t.apiOptions)&&this.toggleServerFetchLbl(n)}},onAttach:function(){this.on("init",t,this)},onDetach:function(){this.off("init",t,this),this.collection&&this.collection.off("sync",this._onDataSyncSuccess,this)},_onDataSyncSuccess:function(e,t,n){(this.needShowMoreTopButton()||this.collection.next_offset===-1&&this.collection.records_count+this.collection.offset>this.getMaxPageSize())&&this.$(".show-more-top-btn").show(),this.collection.next_offset!==-1&&this.$(".show-more-bottom-btn").show(),this.scroll&&this.scroll.reflow()},showMoreTopRecords:function(){this.showLoadingMsg(".show-more-top-btn",!0);var t=Math.max(this.collection.offset-this.collection.length-e.config.maxQueryResult,0);this.collection.options=null;var n=_.bind(function(e,n){if(n){this.collection.reset([]),this.$(".show-more-top-btn")[t===0?"hide":"show"]();while(n.length)this.collection.add(n.pop(),{addTop:!0,at:0});if(this.collection.length>this.getMaxPageSize())while(this.collection.length>this.getMaxPageSize()){var r=this.collection.pop({silent:!0});this.onItemRemoved(r)}this.collection.next_offset>-1&&this.$(".show-more-bottom-btn").show()}this.showLoadingMsg(".show-more-top-btn",!1)},this);this.refresh({add:!0,relate:!!this.context.get("link"),silent:!0,offset:t,limit:e.config.fetchLimit.maxPageSize,fields:this.collection.fields,success:n,error:n})},showMoreBottomRecords:function(){this.showLoadingMsg(".show-more-bottom-btn",!0),this.collection.options=null;var e=_.bind(function(){if(!this.collection)return;if(this.collection.length>this.getMaxPageSize()){this.$(".show-more-top-btn").show();while(this.collection.length>this.getMaxPageSize()){var e=this.collection.shift({silent:!0});this.onItemRemoved(e)}}this.showLoadingMsg(".show-more-bottom-btn",!1),this.collection.next_offset===-1&&this.$(".show-more-bottom-btn").hide(),this.scroll&&this.scroll.reflow()},this);this.refresh({paginate:!0,add:!0,relate:!!this.context.get("link"),success:e,error:e})},showLoadingMsg:function(e,t){t?(this.$(e+" .show_more_posts").hide(),this.$(e+" .loading-holder").show()):(this.$(e+" .show_more_posts").show(),this.$(e+" .loading-holder").hide())},toggleServerFetchLbl:function(t){if(this instanceof e.view.views.HomeView&&!this.collection.query)return;t?(this.$(".show-more-bottom-btn").hide(),this.$(".server-fetch-lbl").show()):(this.collection.next_offset!==-1&&this.collection.next_offset&&this.$(".show-more-bottom-btn").show(),this.$(".server-fetch-lbl").hide()),this.scroll&&this.scroll.reflow()},needShowMoreTopButton:function(){return this.collection.offset>this.getMaxPageSize()},needShowMoreBottomBtn:function(){return this.collection.models.length&&this.collection.next_offset!==-1}})}(SUGAR.App),function(e){var t=function(){this.scrollReflow()};e.plugins.register("pulldown-to-refresh","view",{pluginGlobalEvents:{"app:orientation:changed":function(){this.scrollReflow()},"app:rightmenu:show.ptr":function(t){e.isTablet||(t.show?this.destroyScroll():this.initScroll())},"app:keyboard:hide":function(){this.scrollReflow()},"app:logout.ptr":"destroyPullToRefresh","app:header:clicked.ptr":function(e){e===this.layout&&this.scrollToTop()}},onAttach:function(){var e=this;this.once("init",function(){this.collection.on("sync remove",t,this),this.layout.on("dispose",function(){this.destroyScroll()},this)},this);var n=this.onAfterRender;this.onAfterRender=function(){n.apply(this,arguments),this.scroll?e.scrollReflow():this.initScroll()}},onDetach:function(){this.layout.off("dispose",null,this),this.collection.off("sync",t,this),this.destroyScroll()},initScroll:function(){this.destroyScroll();if(window.EasyScroller){var e=this.$el.closest(".easy-scroller-parent"),t=e.get(0),n=e.find(".easy-scroller-holder").get(0);n&&t&&(this.scroll=new window.EasyScroller(n,t,{scrollingY:!0,scrollingX:!1}))}this.disablePtr||this.initPullToRefresh()},destroyScroll:function(){this.scroll&&(this.destroyPullToRefresh(),this.scroll.destroy(),this.scroll=null)},initPullToRefresh:function(){if(e.config.pullToRefresh&&this.scroll){var t=this.$el;t.pullToRefresh({callback:_.bind(this.onRefresh,this,!0),template:e.template.get("ptr"),templateTarget:this.$easyScrollerParent,height:50,scroller:this.scroll.scroller,command:e.lang.get("LBL_MOBILE_PTR_PULL"),action:e.lang.get("LBL_MOBILE_PTR_RELEASE"),refresh:e.lang.get("LBL_LOADING")})}},hidePullToRefresh:function(){e.config.pullToRefresh&&this.$el&&this.$el.pullToRefresh("hide")},destroyPullToRefresh:function(){this.$el&&this.$el.pullToRefresh&&this.$el.pullToRefresh("destroy")},scrollReflow:function(){this.scroll&&this.scroll.reflow()},onRefresh:function(t){var n={complete:_.bind(this.hidePullToRefresh,this),byPtr:t,disableGlobalDataAlerts:t};t&&(e.analytics.trackEvent("app","ptr"),e.offlineEnabled&&!this.collection.query&&(n.params={forceServerSync:!0})),this.ptrRefresh(n)},ptrRefresh:function(t){this instanceof e.view.views.HomeView?this.collection.query?e.view.views.ListView.prototype.refresh.call(this,t):this.layout.loadData(t):(this.collection.options=null,this.refresh(_.extend({relate:!!this.context.get("link")},t)))},scrollToTop:function(){this.scroll&&this.scroll.scroller.scrollTo(0,0,!0)}})}(SUGAR.App),function(e){var t=function(){this.hidePullToRefresh(),this.scrollReflow()};e.plugins.register("ptr","view",{pluginGlobalEvents:{"app:orientation:changed.ptr2":function(){this.scrollReflow()},"app:rightmenu:show.ptr2":function(t){e.isTablet||(t.show?this.destroyScroll():this.initScroll())},"app:keyboard:hide.ptr2":function(){this.scrollReflow()},"app:header:clicked.ptr2":function(e){e===this.layout&&this.scrollToTop()}},onAttach:function(){if(e.config.pullToRefresh){this.on("ptr:data:load:complete",t,this);var n=this.onAfterRender;this.onAfterRender=function(){n.apply(this,arguments),this.$easyScrollerParent?this.$easyScrollerParent.find("."+this.className).remove():this.$easyScrollerParent=$('<div class="easy-scroller-parent"><div class="easy-scroller-holder"></div></div>'),this.$easyScrollerParent.find(".easy-scroller-holder").append(this.$el),this.scroll?this.scrollReflow():this.initScroll()};var r=this._dispose;this._dispose=function(){this.destroyScroll(),r.apply(this,arguments)}}},initScroll:function(){this.destroyScroll();if(window.EasyScroller){var e=this.$easyScrollerParent,t=e.get(0),n=e.find(".easy-scroller-holder").get(0);n&&t&&(this.scroll=new window.EasyScroller(n,t,{scrollingY:!0,scrollingX:!1}))}this.initPullToRefresh()},destroyScroll:function(){this.scroll&&(this.destroyPullToRefresh(),this.scroll.destroy(),this.scroll=null)},initPullToRefresh:function(){if(this.scroll){var t=this.$el;t.pullToRefresh({callback:_.bind(this.onRefresh,this,!0),template:e.template.get("ptr"),templateTarget:this.$easyScrollerParent,height:50,scroller:this.scroll.scroller,command:e.lang.get("LBL_MOBILE_PTR_PULL"),action:e.lang.get("LBL_MOBILE_PTR_RELEASE"),refresh:e.lang.get("LBL_LOADING")})}},hidePullToRefresh:function(){this.$el&&this.$el.pullToRefresh("hide")},destroyPullToRefresh:function(){this.$el&&this.$el.pullToRefresh&&this.$el.pullToRefresh("destroy")},scrollReflow:function(){this.scroll&&this.scroll.reflow()},onRefresh:function(){this.ptrRefresh&&this.ptrRefresh()},scrollToTop:function(){this.scroll&&this.scroll.scroller.scrollTo(0,0,!0)}})}(SUGAR.App),function(e){e.plugins.register("android-keyboard-tracker","view",{events:{"focusin input":"onFocusInput"},onAttach:function(){var e=this.onAfterShow;this.onAfterShow=function(){if($.os.android){var t=this;_.delay(function(){t.offsetHeight=parseInt(document.body.offsetHeight,10)},600)}_.isFunction(e)&&e.apply(this,arguments)}},onFocusInput:function(){var t=this;$.os.android&&_.delay(function(){var n=window.setInterval(function(){t.offsetHeight===parseInt(document.body.offsetHeight)&&(e.trigger("app:keyboard:hide"),window.clearInterval(n))},200)},600)}})}(SUGAR.App),function(e){e.plugins.register("refresh-timeago","view",{onAttach:function(){var e=this.onBeforeRender,t=this.onAfterRender;this.onBeforeRender=function(){e.apply(this,arguments),this.removeTimeago()},this.onAfterRender=function(){t.apply(this,arguments),this.refreshTimeago()}},refreshTimeago:function(){this.$("time").liverelativedate()},removeTimeago:function(){this.$("time").liverelativedate("destroy")}})}(SUGAR.App),function(e){e.plugins.register("create-post","view",{createPost:function(t,n){n=n||{};var r=e.context.getContext({create:!0,model:t});r.prepare();var i=e.controller.loadDynamic({layoutDef:{appendTo:n.appendTo,meta:{components:[{view:{name:"taggable",context:r}}]},context:r}});t.once("change",n.savePost)}})}(SUGAR.App),function(e){function r(e,t,n){var r=e[t];e[t]=function(){return n.apply(this,arguments),r.apply(this,arguments)},e[t]._originalMethod=r}function i(e,t){e[t]=e[t]._originalMethod}function s(e,t,n){var r={method:e,module:t.module};return t.id&&(r.modelId=t.id),t.filterDef&&(r.filterDef=t.filterDef),n&&(r.options=_.pick(n,["byPtr","limit","myItems","query","offset"]),n.relate&&t.link&&t.link.bean&&(r.link=t.link.name,r.parentModule=t.link.bean.module,r.parentId=t.link.bean.id),n.favorite&&(r.action=t.get("my_favorite")?"favorite":"unfavorite"),n.following&&(r.action=t.get("following")?"follow":"unfollow")),r}function o(e){return{route:e}}function u(e,t,n){return{code:e.code,status:e.status}}function a(e){return{options:e}}var t=e.config.raven,n=function(){var e=[],n=t&&t.enabled&&t.enhancedErrorReporting&&t.enhancedErrorReporting.maxLogSize;return{push:function(t){t.timestamp=(new Date).toISOString(),e.push(t),e.length>n&&e.shift()},empty:function(){e=[]},getAll:function(){return _.clone(e).reverse()}}}(),f=[{context:e.data,method:"sync",filter:s,label:"data-manager.sync"},{context:e.nomad,method:"login",label:"app.login"},{context:e.nomad,method:"logout",label:"app.logout"},{context:e.nomad,method:"onMemoryWarning"},{context:e.nomad,method:"onResume"},{context:e.nomad,method:"onPause"},{context:e.error,method:"handleHttpError",filter:u},{context:e.NomadController.prototype,method:"navigate",filter:o},{context:e.NomadController.prototype,method:"goBack"},{context:e.NomadController.prototype,method:"clean",label:"controller.clean"},{context:e.view.NomadLayoutManager,method:"loadStatic",filter:a},{context:e.view.NomadLayoutManager,method:"loadDynamic",filter:a}],l={init:function(){if(!(t&&t.enabled&&t.enhancedErrorReporting)||this.initialized)return!1;_.each(f,function(e){r(e.context,e.method,function(){var t={label:e.label||e.method};e.filter&&_.extend(t,e.filter.apply(this,arguments)||{}),n.push(t)})}),this.initialized=!0},getLog:function(){return n.getAll()},dispose:function(){_.each(f,function(e){i(e.context,e.method)}),n.empty(),this.initialized=!1}};e.augment("enhancedErrorReporter",l,!0)}(SUGAR.App),function(e){var t="dashboards:table",n="dashlets-view:";e.nomad.dashboards.cache={storeDashboards:function(r,i){this._getCacheTable(_.bind(function(s,o){if(s){_.isFunction(i)&&i(s,o);return}var u=this.storage,a=[],f=0,l=0;o=o||{},_.each(o,function(e,t){r.get(t)||(_.each(e.dashletsIds,function(e){a.push(function(t){u.cut(e,t)})}),delete o[t],++f)}),_.each(r.models,function(t){o[t.id]||(o[t.id]={date_modified:e.utils.getTimestamp(t.get("date_modified")),dashletsIds:[]},++l)}),(f||l)&&a.push(function(e){u.set(t,o,e)}),a.length?async.parallel(a,i):_.isFunction(i)&&i(s,o)},this))},_getCacheTable:function(n){this.storage.get(t,n)}}}(SUGAR.App),function(e){var t=e.nomad.dashboards.cache.storage={_getApiCallMethod:function(r){return function(){var i=Array.prototype.slice.call(arguments,0);t.provider?t.provider.api[r].apply(t,i):(t.provider=t.providers[e.config.dashboards.cache.storageProvider],_.isFunction(t.provider.initialize)?t.provider.initialize(function(){t.provider.api[r].apply(t,i)}):t.provider.api[r].apply(t,i))}},providers:{},provider:null,apiMethods:["get","set","cut","cutAll"]};_.each(t.apiMethods,function(n){t[n]=t._getApiCallMethod(n)})}(SUGAR.App),function(e){var t,n="data",r;e.nomad.dashboards.cache.storage.providers.sql=r={initialize:function(t){r._openDb(),r._createDataTable(t)},_openDb:function(){if(t){e.logger.warn("Database `"+e.config.dashboards.cache.dbName+"` has been opened already.");return}e.config.dashboards.cache.storageAdapter==="native"?t=window.sqlitePlugin.openDatabase({name:e.config.dashboards.cache.dbName,bgType:1}):e.config.dashboards.cache.storageAdapter==="webSql"&&(t=window.openDatabase(e.config.dashboards.cache.dbName,"1.0",e.config.dashboards.cache.dbName,e.config.dashboards.cache.size*1024*1024));if(!t)throw new Error("`openDatabase` returned nothing")},_query:function(r,i,s){t.transaction(function(n){n.executeSql(r,i||[],function(t,n){_.isFunction(s)&&s(null,n)},function(n,o){e.logger.error("Database query failure: `"+r+"` with arguments `"+JSON.stringify(i)+"`"),_.isFunction(s)&&s(o)})})},_createDataTable:function(t){r._query("CREATE TABLE IF NOT EXISTS "+n+" (key STRING PRIMARY KEY, value TEXT)",[],t)},_truncateDataTable:function(t){r._query("DELETE FROM "+n,[],t)},api:{get:function(t,i){r._query("SELECT value FROM "+n+" WHERE key = ? LIMIT 1",[t],function(t,n){if(t){i.apply(this,arguments);return}var r=n.rows.length?JSON.parse(n.rows.item(0).value):null;i(null,r)})},set:function(t,i,s){r._query("REPLACE INTO "+n+" (key, value) values (?, ?)",[t,JSON.stringify(i)],s)},cut:function(t,i){_.isArray(t)||(t=[t]);var s=["DELETE FROM "+n];_.each(t,function(e,t){t<1?s.push("WHERE (key = ?)"):s.push("OR (key = ?)")}),r._query(s.join(" "),t,i)},cutAll:function(t){r._truncateDataTable(t)}}}}(SUGAR.App),function(e){_.extend(e.nomad,{preInit:function(t,n){t.app.version=e.config.appVersion,t.app.build=e.config.appBuild,t.device=$.os,window.navigator.standalone&&e.routing.replaceRoute("#home"),this.initAppCache(),this.initAnalytics(),!e.config.allowBrowserContextMenu&&$.browser.chromeMobile&&window.addEventListener("contextmenu",function(e){e.preventDefault()});if(!this._isPlatformSupported()){e.error.handleNotSupportedPlatform();return}e.offline&&e.config.offline&&(e.config.offline.storageAdapter="webSql"),e.config.dashboards.cache.storageAdapter="webSql",n()},initAppCache:function(){var t=window.applicationCache;if(!t)return;t.addEventListener("updateready",function(n){e.nomad.showConfirm(e.lang.get("LBL_NEW_WEB_VERSION"),function(){e.logger.debug("Swapping application cache and reloading page"),t.swapCache(),window.location.reload()})},!1)},_showConfirm:function(e,t,n,r){var i=confirm(e),s=i?2:1;t(s)},_showAlert:function(e,t,n,r){alert(e),t&&t()},_getConsoleLogFilename:function(e){e()},_showEmailComposer:function(e,t,n){window.location="mailto:"+n+"?subject="+(e||"")+"&body="+(t||"")},_showSmsComposer:function(e,t){window.location="sms:"+e},_callPhone:function(e){window.location="tel:"+e},_browseUrl:function(e){window.open(e)},openAppStore:function(){},_browseDoc:function(e){e.oauth?this._downloadDoc(e):this._browseUrl(e.url)},_downloadDoc:function(t){var n=new window.XMLHttpRequest,r="download_doc";n.open("GET",t.url),n.addEventListener("loadend",_.bind(function(){e.alert.dismiss(r);var i=this._getBlob(n.response,t.file_mime_type);this._makeBlobUrl(i,function(e){window.location=e})},this),!1),n.setRequestHeader("OAuth-Token",e.api.getOAuthToken()),n.overrideMimeType("application/octet-stream; charset=x-user-defined"),n.responseType="arraybuffer",n.send(null),e.alert.show(r,{level:"info",messages:e.lang.get("LBL_MOBILE_DOWNLOAD_STARTED",null,t.filename),autoClose:!0,closeable:!1})},_getBlob:function(e,t){var n;try{n=new Blob([e],{type:t})}catch(r){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(r.name=="TypeError"&&window.BlobBuilder){var i=new BlobBuilder;i.append([e.buffer]),n=i.getBlob(t)}else{if(r.name!="InvalidStateError")throw r;n=new Blob([e.buffer],{type:t})}}return n},_makeBlobUrl:function(t,n){var r=window.URL||window.webkitURL,i=$.os.ios&&(e.utils.versionCompare($.os.version,7,"<")||$.browser.chromeMobile);if(r&&!i)n(r.createObjectURL(t));else{var s=new window.FileReader;s.onloadend=function(){n(s.result)},s.readAsDataURL(t)}},_showActionSheet:function(t,n,r,i){e.view.ActionSheet.show(t,n,r,i)},_showDateTimePicker:function(e,t,n){},initAnalytics:function(){function e(){window.ga&&ga.apply(window,arguments)}Analytics=function(){},_.extend(Analytics.prototype,{start:function(t,n){e("create",t,"none"),n.optOut&&(window["ga-disable-"+t]=!0),e("set","anonymizeIp",n.anonymize)},startSession:function(){},trackPageView:function(t){e("send","pageview",t)},trackEvent:function(t){e("send","event",t.category,t.action,t.label,t.value)},setDimension:function(t){e("set","dimension"+t.index,t.value)},setMetric:function(t){e("set","metric"+t.index,t.value)}}),analytics=new Analytics},loadAnalytics:function(){(function(e,t,n,r,i,s,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=t.createElement(n),o=t.getElementsByTagName(n)[0],s.async=1,s.src=r,o.parentNode.insertBefore(s,o)})(window,document,"script","//www.google-analytics.com/analytics.js","ga")},getConnectionType:function(){return"none"},isOnline:function(){return window.navigator.onLine},handleExternalLogin:function(e,t){window.location.href=e.payload.url},handleExternalLogout:function(e){var t=new Image;t.src=e},handleAuthTokens:function(){var t,n,r=e[e.config.authStore],i=["_AuthAccessToken","_AuthRefreshToken","_DownloadToken"];_.each(i,function(e){t=window.localStorage.getItem(e),t&&(n=!0,r.set(e.slice(1),t),window.localStorage.removeItem(e))}),n&&(e.api.setExternalLogin(!0),e.trigger("app:login:success"))},_isPlatformSupported:function(){return $.os.ios?e.utils.versionCompare($.os.version,"7.1",">="):$.os.android&&$.browser.chrome&&e.utils.versionCompare($.os.version,"4.1",">=")?!0:$.os.desktop?!0:e.config.env==="dev"}})}(SUGAR.App)